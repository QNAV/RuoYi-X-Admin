"use strict";(self.webpackChunkruoyi_x_umi=self.webpackChunkruoyi_x_umi||[]).push([[813],{38868:function(A,R,e){e.r(R),e.d(R,{default:function(){return se}});var y=e(46686),C=e.n(y),T=e(35290),g=e.n(T),O=e(411),b=e.n(O),N=e(69946),I=e(30279),E=e.n(I),P=e(7093);function D(m){return a.apply(this,arguments)}function a(){return a=_asyncToGenerator(_regeneratorRuntime().mark(function m(o){return _regeneratorRuntime().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",request("/system/user/profile",_objectSpread({method:"GET"},o||{})));case 1:case"end":return p.stop()}},m)})),a.apply(this,arguments)}function t(m,o){return n.apply(this,arguments)}function n(){return n=b()(g()().mark(function m(o,v){return g()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,P.WY)("/system/user/profile",E()({method:"POST",headers:{"Content-Type":"application/json"},data:o},v||{})));case 1:case"end":return u.stop()}},m)})),n.apply(this,arguments)}function S(m,o,v,p){return f.apply(this,arguments)}function f(){return f=_asyncToGenerator(_regeneratorRuntime().mark(function m(o,v,p,u){var l;return _regeneratorRuntime().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return l=new FormData,p&&l.append("avatarfile",p),Object.keys(v).forEach(function(j){var r=v[j];r!=null&&l.append(j,_typeof(r)==="object"&&!(r instanceof File)?JSON.stringify(r):r)}),d.abrupt("return",request("/system/user/profile/avatar",_objectSpread({method:"POST",params:_objectSpread({},o),data:l,requestType:"form"},u||{})));case 4:case"end":return d.stop()}},m)})),f.apply(this,arguments)}function c(m,o){return x.apply(this,arguments)}function x(){return x=b()(g()().mark(function m(o,v){return g()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,P.WY)("/system/user/profile/updatePwd",E()({method:"POST",headers:{"Content-Type":"application/json"},data:o},v||{})));case 1:case"end":return u.stop()}},m)})),x.apply(this,arguments)}var h=e(78409),w=e(28622),M=e(55024),U=e(4733),L=e(50959),s=e(11527),Q=function(){var o=(0,L.useRef)(),v=(0,w.D)(b()(g()().mark(function l(){var i,d;return g()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,o==null||(i=o.current)===null||i===void 0?void 0:i.validateFields();case 2:if(d=r.sent,d!==void 0){r.next=5;break}return r.abrupt("return");case 5:return r.next=7,c(d);case 7:case"end":return r.stop()}},l)})),{onSuccess:function(){M.ZP.success("\u5BC6\u7801\u4FEE\u6539\u6210\u529F\uFF0C\u5373\u5C06\u81EA\u52A8\u9000\u51FA\u767B\u5F55\u5E76\u8DF3\u8F6C\u81F3\u767B\u5F55\u9875\u9762");var i=setTimeout(function(){(0,P.kS)(),clearTimeout(i)},1500)}}),p=v.mutate,u=v.isLoading;return(0,s.jsxs)(h.A96,{formRef:o,submitter:!1,children:[(0,s.jsx)(h.VaQ.Password,{name:"oldPassword",label:"\u65E7\u5BC6\u7801",rules:[{required:!0}],width:"md"}),(0,s.jsx)(h.VaQ.Password,{name:"newPassword",label:"\u65B0\u5BC6\u7801",width:"md",rules:[{required:!0},{pattern:P.nw,message:"\u957F\u5EA6\u57286-20\u4E4B\u95F4\uFF0C\u53EA\u80FD\u5305\u542B\u5B57\u6BCD\u3001\u6570\u5B57\u548C\u4E0B\u5212\u7EBF"},function(l){var i=l.getFieldValue;return{validator:function(j,r){return r!==i("oldPassword")?Promise.resolve():Promise.reject(new Error("\u65B0\u65E7\u5BC6\u7801\u4E0D\u80FD\u76F8\u540C"))}}}]}),(0,s.jsx)(h.VaQ.Password,{name:"confirmPassword",label:"\u786E\u8BA4\u5BC6\u7801",width:"md",rules:[{required:!0},function(l){var i=l.getFieldValue;return{validator:function(j,r){return!r||i("newPassword")===r?Promise.resolve():Promise.reject(new Error("\u4E24\u6B21\u5BC6\u7801\u8F93\u5165\u4E0D\u4E00\u81F4"))}}}]}),(0,s.jsx)(U.Z,{type:"primary",loading:u,onClick:function(){return p()},children:"\u66F4\u65B0\u5BC6\u7801"})]})},G=Q,K=e(93275),Y=e.n(K),z=e(70819),J=e(34804),H=e(21954),X=e(24239),W=e(77909),Z=e(43703),$=e(70686),k=e(37117),q="".concat("https://test-ryx-admin-api.p.quicknav.cn","/api/sys/profile/update-avatar"),_=[{dataIndex:"userName",title:"\u7528\u6237\u540D\u79F0",valueType:"text"},{dataIndex:"deptName",title:"\u6240\u5C5E\u90E8\u95E8",valueType:"text"},{dataIndex:"roleName",title:"\u6240\u5C5E\u89D2\u8272",valueType:"text"},{dataIndex:"createTime",title:"\u521B\u5EFA\u65F6\u95F4",valueType:"text"}],ee=[{dataIndex:"nickName",title:"\u7528\u6237\u6635\u79F0",valueType:"text"},{dataIndex:"phoneNumber",title:"\u624B\u673A\u53F7\u7801",valueType:"text",fieldProps:{maxLength:11},formItemProps:{rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7"},{pattern:P.RE,message:"\u624B\u673A\u53F7\u683C\u5F0F\u9519\u8BEF"}]}},{dataIndex:"email",title:"\u90AE\u7BB1",valueType:"text",formItemProps:{rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u90AE\u7BB1"},{pattern:P.ku,message:"\u90AE\u7BB1\u683C\u5F0F\u9519\u8BEF"}]}},{dataIndex:"sex",title:"\u6027\u522B",valueType:"radio",valueEnum:z.VJ}],te=function(){var o=(0,H.useModel)("@@initialState"),v=(0,w.D)(function(){var l=b()(g()().mark(function i(d){return g()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t(d);case 2:return r.next=4,o.refresh();case 4:M.ZP.success("\u4FEE\u6539\u6210\u529F");case 5:case"end":return r.stop()}},i)}));return function(i){return l.apply(this,arguments)}}()),p={onSave:function(){var l=b()(g()().mark(function d(j,r){var B;return g()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return B=j,V.next=3,v.mutateAsync(Y()({},B,r[B]));case 3:case"end":return V.stop()}},d)}));function i(d,j){return l.apply(this,arguments)}return i}()},u=o.initialState;return(0,s.jsxs)(X.Z,{align:"middle",children:[(0,s.jsx)(W.Z,{span:4,children:(0,s.jsxs)("div",{className:"w-[100px] relative m-auto",children:[(0,s.jsx)(Z.C,{src:u.userInfo.user.avatar||"Avatar",size:100}),(0,s.jsx)($.Z,{maxCount:1,showUploadList:!1,name:"avatarfile",accept:"image/jpeg,image/png",action:q,headers:{Authorization:(0,P.LP)()},onChange:function(i){if(i.file.status==="done"){var d=i.file.response,j=d.code,r=d.msg;if(j!==200){M.ZP.error(r);return}v.mutate({avatar:i.file.response.data})}},children:(0,s.jsx)(Z.C,{icon:(0,s.jsx)(J.Z,{}),className:"absolute bottom-0 right-0 bg-blue-500 cursor-pointer"})})]})}),(0,s.jsxs)(W.Z,{span:20,children:[(0,s.jsx)(h.vYc,{columns:_,dataSource:{userName:u.userInfo.user.userName,createTime:u.userInfo.user.createTime,deptName:u.userInfo.user.dept.deptName,roleName:u.userInfo.user.roles.map(function(l){return l.roleName}).join("/")}}),(0,s.jsx)(k.Z,{}),(0,s.jsx)(h.vYc,{columns:ee,dataSource:u.userInfo.user,editable:p})]})]})},re=te,F;(function(m){m.PASSWORD="PASSWORD"})(F||(F={}));var ne=function(){var o=(0,L.useState)(F.PASSWORD),v=C()(o,2),p=v[0],u=v[1];return(0,s.jsx)(h._zJ,{title:"\u4E2A\u4EBA\u4E2D\u5FC3",children:(0,s.jsxs)(h.QWM,{ghost:!0,direction:"column",gutter:[0,24],children:[(0,s.jsx)(h.QWM,{children:(0,s.jsx)(re,{})}),(0,s.jsx)(h.QWM,{tabs:{activeKey:p,onChange:function(i){return u(i)}},children:(0,s.jsx)(h.QWM.TabPane,{tab:"\u5B89\u5168\u8BBE\u7F6E",children:(0,s.jsx)(G,{})},F.PASSWORD)})]})})},se=ne},12415:function(A,R,e){var y=e(50959);function C(a,t){return a===t&&(a!==0||1/a===1/t)||a!==a&&t!==t}var T=typeof Object.is=="function"?Object.is:C,g=y.useState,O=y.useEffect,b=y.useLayoutEffect,N=y.useDebugValue;function I(a,t){var n=t(),S=g({inst:{value:n,getSnapshot:t}}),f=S[0].inst,c=S[1];return b(function(){f.value=n,f.getSnapshot=t,E(f)&&c({inst:f})},[a,n,t]),O(function(){return E(f)&&c({inst:f}),a(function(){E(f)&&c({inst:f})})},[a]),N(n),n}function E(a){var t=a.getSnapshot;a=a.value;try{var n=t();return!T(a,n)}catch{return!0}}function P(a,t){return t()}var D=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?P:I;R.useSyncExternalStore=y.useSyncExternalStore!==void 0?y.useSyncExternalStore:D},4322:function(A,R,e){A.exports=e(12415)},28622:function(A,R,e){e.d(R,{D:function(){return P}});var y=e(50959),C=e(61142),T=e(66146),g=e(42128),O=e(39210);class b extends g.l{constructor(t,n){super(),this.client=t,this.setOptions(n),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const n=this.options;this.options=this.client.defaultMutationOptions(t),(0,O.VS)(n,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this})}onUnsubscribe(){if(!this.listeners.length){var t;(t=this.currentMutation)==null||t.removeObserver(this)}}onMutationUpdate(t){this.updateResult();const n={listeners:!0};t.type==="success"?n.onSuccess=!0:t.type==="error"&&(n.onError=!0),this.notify(n)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(t,n){return this.mutateOptions=n,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,{...this.options,variables:typeof t<"u"?t:this.options.variables}),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const t=this.currentMutation?this.currentMutation.state:(0,C.R)(),n={...t,isLoading:t.status==="loading",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset};this.currentResult=n}notify(t){T.V.batch(()=>{if(this.mutateOptions){if(t.onSuccess){var n,S,f,c;(n=(S=this.mutateOptions).onSuccess)==null||n.call(S,this.currentResult.data,this.currentResult.variables,this.currentResult.context),(f=(c=this.mutateOptions).onSettled)==null||f.call(c,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context)}else if(t.onError){var x,h,w,M;(x=(h=this.mutateOptions).onError)==null||x.call(h,this.currentResult.error,this.currentResult.variables,this.currentResult.context),(w=(M=this.mutateOptions).onSettled)==null||w.call(M,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context)}}t.listeners&&this.listeners.forEach(U=>{U(this.currentResult)})})}}var N=e(6647),I=e(34118),E=e(4322);function P(a,t,n){const S=(0,O.lV)(a,t,n),f=(0,N.NL)({context:S.context}),[c]=y.useState(()=>new b(f,S));y.useEffect(()=>{c.setOptions(S)},[c,S]);const x=(0,E.useSyncExternalStore)(y.useCallback(w=>c.subscribe(T.V.batchCalls(w)),[c]),()=>c.getCurrentResult(),()=>c.getCurrentResult()),h=y.useCallback((w,M)=>{c.mutate(w,M).catch(D)},[c]);if(x.error&&(0,I.L)(c.options.useErrorBoundary,[x.error]))throw x.error;return{...x,mutate:h,mutateAsync:x.mutate}}function D(){}},34118:function(A,R,e){e.d(R,{L:function(){return y}});function y(C,T){return typeof C=="function"?C(...T):!!C}}}]);
