"use strict";(self.webpackChunkruoyi_x_umi=self.webpackChunkruoyi_x_umi||[]).push([[650],{15769:function(ce,Y,n){n.d(Y,{A:function(){return D}});var G=n(78054),M=n(50959),y=n(11527),D=function(a){return(0,M.cloneElement)((0,y.jsx)(G._zJ,{className:"px-[24px]",header:{title:"",breadcrumb:{}}}),a)}},74426:function(ce,Y,n){n.r(Y),n.d(Y,{default:function(){return Ke}});var G=n(15769),M=n(35290),y=n.n(M),D=n(411),T=n.n(D),a=n(87230),b=n(93275),q=n.n(b),X=n(30279),ee=n.n(X),A=n(10453),k=n(72259),z=n(78175),re=n(6647),V=n(28622),ne=n(88171),O=n(55024),P=n(98205),L="systemMenu",me=function(u){var c=function t(m){return m.filter(function(v){return v.menuType!==a.og.F}).map(function(v){var l=v.menuId,f=v.menuName,h=v.children;return{menuId:l,menuName:f,children:h?t(h):[]}})};return[{menuId:0,menuName:"\u6839\u76EE\u5F55",children:u?c(u):[]}]},U=(0,P.cn)({key:"".concat(L,"SelectedMenuId"),default:0}),o=function(){return(0,P.rb)(U)},d=function(){return(0,P.FV)(U)},g=function(){return(0,P.sJ)(U)},B=(0,P.cn)({key:"".concat(L,"VisibleCreateModal"),default:!1}),r=function(){return(0,P.rb)(B)},ve=function(){return(0,P.Zl)(B)},xe=function(){return(0,P.sJ)(B)},pe=[L,"list"],ae=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,z.a)(pe,T()(y()().mark(function c(){var t,m;return y()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,(0,A.CP)(u);case 2:return t=l.sent,m=(0,k.tw)(t,{id:"menuId",pId:"parentId",rootPId:null}),l.abrupt("return",{options:me((0,k.dH)(m)),treeData:(0,k.dH)(m),map:t.reduce(function(f,h){return ee()(ee()({},f),{},q()({},h.menuId,h))},{}),parentIds:(0,k.Vy)(t)});case 5:case"end":return l.stop()}},c)})))},fe=function(){var u=(0,re.NL)(),c=o();return(0,V.D)(function(){var t=T()(y()().mark(function m(v){return y()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:ne.Z.confirm({title:"\u5220\u9664\u83DC\u5355",content:"\u786E\u5B9A\u5220\u9664\u8BE5\u83DC\u5355\u5417\uFF1F",onOk:function(){var h=T()(y()().mark(function $(){return y()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,(0,A.tg)({menuId:v});case 2:return E.next=4,u.invalidateQueries(pe);case 4:c(),O.ZP.success("\u5220\u9664\u6210\u529F");case 6:case"end":return E.stop()}},$)}));function p(){return h.apply(this,arguments)}return p}()});case 1:case"end":return f.stop()}},m)}));return function(m){return t.apply(this,arguments)}}())},J=n(38135),Me=n(54064),i=n(78054),se=n(4733),N=n(50959),e=n(11527),he=function(u,c){var t=[0];if(c===0)return t;var m=function v(l){var f;!(u!=null&&u[l])||(u!=null&&(f=u[l])!==null&&f!==void 0&&f.parentId&&v(u[l].parentId.toString()),u[l].menuType!==a.og.F&&t.push(Number(l)))};return m(c.toString()),t},Ce=function(){var u,c=(0,J.md)(),t=(0,N.useRef)(),m=ve(),v=r(),l=xe(),f=g(),h=ae(),p=h.data,$=h.refetch,_=(0,V.D)(T()(y()().mark(function C(){var s,F,I;return y()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,(s=t.current)===null||s===void 0||(F=s.validateFieldsReturnFormatValue)===null||F===void 0?void 0:F.call(s);case 2:if(I=S.sent,I){S.next=5;break}return S.abrupt("return");case 5:return S.next=7,(0,A.FV)(I);case 7:case"end":return S.stop()}},C)})),{onSuccess:function(){var s;$(),v(),t==null||(s=t.current)===null||s===void 0||s.resetFields(),O.ZP.success("\u65B0\u5EFA\u6210\u529F")}}),E=_.isLoading,R=_.mutate;return(0,N.useEffect)(function(){var C;if(t!=null&&(C=t.current)!==null&&C!==void 0&&C.setFieldsValue&&p!==null&&p!==void 0&&p.map){var s;t==null||(s=t.current)===null||s===void 0||s.setFieldsValue({parentId:he(p.map,f)})}},[f,p==null?void 0:p.map,t==null?void 0:t.current]),(0,e.jsxs)(J.Nv,{accessible:c.canAddSysMenu,children:[(0,e.jsx)(se.Z,{type:"primary",onClick:function(){return m(!0)},icon:(0,e.jsx)(Me.Z,{}),children:"\u65B0\u5EFA"}),(0,e.jsx)(ne.Z,{visible:l,onCancel:v,title:"\u65B0\u5EFA\u83DC\u5355",width:515,okText:"\u63D0\u4EA4",onOk:function(){return R()},okButtonProps:{loading:E},children:(0,e.jsxs)(i.A96,{submitter:!1,formRef:t,children:[(0,e.jsx)(i.Ves,{name:"parentId",label:"\u7236\u7EA7\u83DC\u5355",initialValue:he((u=p==null?void 0:p.map)!==null&&u!==void 0?u:{},f),fieldProps:{options:p==null?void 0:p.options,fieldNames:{label:"menuName",value:"menuId",children:"children"},changeOnSelect:!0},rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u7236\u7EA7\u83DC\u5355"}],transform:function(s){return{parentId:s[s.length-1]}}}),(0,e.jsx)(i.$Oj.Group,{name:"menuType",label:"\u83DC\u5355\u7C7B\u578B",valueEnum:a.QZ,rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u83DC\u5355\u7C7B\u578B"}]}),(0,e.jsx)(i.ien,{name:["menuType"],children:function(s){var F=s.menuType;return F?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(i.UWz,{children:[(0,e.jsx)(i.VaQ,{name:"menuName",label:"\u83DC\u5355\u540D\u79F0",width:"sm",rules:[{required:!0}]}),(0,e.jsx)(i.k_F,{name:"orderNum",label:"\u663E\u793A\u6392\u5E8F",tooltip:"\u9ED8\u8BA4\u6570\u503C\u4E3A0\uFF0C\u6570\u503C\u8D8A\u5927\u6392\u5E8F\u8D8A\u9760\u540E\uFF0C\u6570\u503C\u76F8\u7B49\u6309\u7167\u521B\u5EFA\u65F6\u95F4\u5148\u540E\u6392\u5E8F",rules:[{required:!0}],width:"sm",initialValue:0})]}),F!==a.og.F&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(i.UWz,{children:[(0,e.jsx)(i.$Oj.Group,{tooltip:"\u9009\u62E9\u505C\u7528\u5219\u8DEF\u7531\u5C06\u4E0D\u4F1A\u51FA\u73B0\u5728\u4FA7\u8FB9\u680F\uFF0C\u4E5F\u4E0D\u80FD\u88AB\u8BBF\u95EE",name:"status",label:"\u83DC\u5355\u72B6\u6001",valueEnum:a.al,required:!0,initialValue:a.vu.ENABLE}),(0,e.jsx)(i.$Oj.Group,{name:"visible",label:"\u83DC\u5355\u662F\u5426\u663E\u793A",valueEnum:a.gc,required:!0,initialValue:a.Ve.YES,tooltip:"\u9009\u62E9\u5426\u5219\u8DEF\u7531\u5C06\u4E0D\u4F1A\u51FA\u73B0\u5728\u4FA7\u8FB9\u680F\uFF0C\u4F46\u4ECD\u7136\u53EF\u4EE5\u8BBF\u95EE"}),(0,e.jsx)(i.$Oj.Group,{name:"isFrame",label:"\u662F\u5426\u5916\u94FE",valueEnum:a.gc,required:!0,initialValue:a.Ve.NO,tooltip:"\u9009\u62E9\u662F\u5916\u94FE\u5219\u8DEF\u7531\u5730\u5740\u9700\u8981\u4EE5`http(s)://`\u5F00\u5934"})]}),(0,e.jsxs)(i.UWz,{children:[(0,e.jsx)(i.VaQ,{name:"icon",label:"\u83DC\u5355\u56FE\u6807",width:"sm",tooltip:"https://ant.design/components/icon-cn/"}),(0,e.jsx)(i.VaQ,{width:"sm",name:"path",label:"\u8DEF\u7531\u5730\u5740",tooltip:"\u8BBF\u95EE\u7684\u8DEF\u7531\u5730\u5740\uFF0C\u5982\uFF1A`user`\uFF0C\u5982\u5916\u7F51\u5730\u5740\u9700\u5185\u94FE\u8BBF\u95EE\u5219\u4EE5`http(s)://`\u5F00\u5934",rules:[{required:!0}]})]})]}),F===a.og.C&&(0,e.jsx)(i.VaQ,{name:"queryParam",label:"\u8DEF\u7531\u53C2\u6570",tooltip:'\u8BBF\u95EE\u8DEF\u7531\u7684\u9ED8\u8BA4\u4F20\u9012\u53C2\u6570\uFF0C\u5982\uFF1A{"id": 1, "name": "ry"}'}),F!==a.og.M&&(0,e.jsx)(i.VaQ,{name:"perms",label:"\u6743\u9650\u6807\u8BC6"})]}):null}}),(0,e.jsx)(i.$JJ,{name:"remark",label:"\u5907\u6CE8"})]})})]})},je=Ce,Fe=n(39449),Se=function(){var u=(0,J.md)(),c=g(),t=fe(),m=t.mutate,v=t.isLoading;return(0,e.jsx)(J.Nv,{accessible:u.canRemoveSysMenu,children:(0,e.jsx)(se.Z,{icon:(0,e.jsx)(Fe.Z,{}),loading:v,disabled:c===0,danger:!0,onClick:function(){return m(c)},children:"\u5220\u9664"})})},De=Se,le=n(96346),Ie=n(41202),Te=n(68707),ye=n(37117),ie={xs:1,sm:1,md:1,lg:1,xl:2},Pe=function(u){return(0,N.useMemo)(function(){var c=[];return u?(u!==a.og.F&&c.push({title:"\u72B6\u6001",dataIndex:"status",key:"status",valueType:"radio",valueEnum:a.al},{title:"\u662F\u5426\u663E\u793A",dataIndex:"visible",key:"visible",valueType:"radio",valueEnum:a.gc,tooltip:"\u9009\u62E9\u5426\u5219\u8DEF\u7531\u5C06\u4E0D\u4F1A\u51FA\u73B0\u5728\u4FA7\u8FB9\u680F\uFF0C\u4F46\u4ECD\u7136\u53EF\u4EE5\u8BBF\u95EE"},{title:"\u662F\u5426\u5916\u94FE",dataIndex:"isFrame",key:"isFrame",valueType:"radio",valueEnum:a.gc,tooltip:"\u9009\u62E9\u662F\u5916\u94FE\u5219\u8DEF\u7531\u5730\u5740\u9700\u8981\u4EE5`http(s)://`\u5F00\u5934"},{title:"\u56FE\u6807",dataIndex:"icon",key:"icon",valueType:"text",tooltip:"https://ant.design/components/icon-cn/"},{title:"\u8DEF\u7531\u5730\u5740",dataIndex:"path",key:"path",valueType:"text",tooltip:"\u8BBF\u95EE\u7684\u8DEF\u7531\u5730\u5740\uFF0C\u5982\uFF1A`user`\uFF0C\u5982\u5916\u7F51\u5730\u5740\u9700\u5185\u94FE\u8BBF\u95EE\u5219\u4EE5`http(s)://`\u5F00\u5934"},{title:"\u8DEF\u7531\u53C2\u6570",dataIndex:"queryParam",key:"queryParam",valueType:"code",tooltip:'\u8BBF\u95EE\u8DEF\u7531\u7684\u9ED8\u8BA4\u4F20\u9012\u53C2\u6570\uFF0C\u5982\uFF1A{"id": 1, "name": "ry"}'}),u!==a.og.M&&c.push({title:"\u6743\u9650\u6807\u8BC6",dataIndex:"perms",key:"perms",valueType:"text",copyable:!0}),c):[]},[u])},Be=function(){var u=(0,J.md)(),c=ae(),t=c.refetch,m=g(),v=(0,Ie.Z)(T()(y()().mark(function R(){return y()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,A.WJ)({menuId:m});case 2:return s.abrupt("return",s.sent);case 3:case"end":return s.stop()}},R)})),{ready:m>0,refreshDeps:[m]}),l=v.data,f=v.loading,h=v.refresh,p=(0,V.D)(A.Yh,{onSuccess:function(){h(),t(),O.ZP.success("\u4FDD\u5B58\u6210\u529F")}}),$=p.mutateAsync,_=Pe(l==null?void 0:l.menuType),E=u.canEditSysMenu?{onSave:function(){var R=T()(y()().mark(function s(F,I){var Q,S,H,j;return y()().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return Q=I.menuType,S=I.orderNum,H=I.menuName,j=I.menuId,K.next=3,$(q()({menuId:j,menuType:Q,orderNum:S,menuName:H},F,I[F]));case 3:case"end":return K.stop()}},s)}));function C(s,F){return R.apply(this,arguments)}return C}()}:void 0;return m===0?(0,e.jsx)(le._E,{description:"\u70B9\u51FB\u9009\u62E9\u5DE6\u4FA7\u83DC\u5355\u9879\u67E5\u770B\u8BE6\u60C5"}):(0,e.jsxs)(Te.Z,{spinning:f,children:[(0,e.jsx)(i.vYc,{columns:[{title:"\u7C7B\u578B",dataIndex:"menuType",key:"menuType",valueType:"select",valueEnum:a.QZ,editable:!1},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createTime",key:"createTime",valueType:"dateTime",editable:!1}],dataSource:l,column:ie}),(0,e.jsx)(ye.Z,{}),(0,e.jsx)(i.vYc,{columns:[{title:"\u540D\u79F0",dataIndex:"menuName",key:"menuName",valueType:"text"},{title:"\u663E\u793A\u987A\u5E8F",dataIndex:"orderNum",key:"orderNum",valueType:"digit",tooltip:"\u9ED8\u8BA4\u6570\u503C\u4E3A0\uFF0C\u6570\u503C\u8D8A\u5927\u6392\u5E8F\u8D8A\u9760\u540E\uFF0C\u6570\u503C\u76F8\u7B49\u6309\u7167\u521B\u5EFA\u65F6\u95F4\u5148\u540E\u6392\u5E8F"},{title:"\u5907\u6CE8",dataIndex:"remark",key:"remark",valueType:"textarea",hideInSearch:!0}],dataSource:l,editable:E,column:ie}),(0,e.jsx)(ye.Z,{}),(0,e.jsx)(i.vYc,{columns:_,dataSource:l,editable:E,column:ie})]})},Re=Be,Ae=n(46686),ue=n.n(Ae),be=n(62991),Oe=n(71600),Ne=n(29993),Z=n(21107),Ee=n(35082),Ze=n(27094),_e=n(83057),Ve=n(84495),Le=n(86322),Ue=n.n(Le),te={M:"blue",C:"green",F:"red"},$e=function(u){return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Z.Z,{color:"rgb(148 163 184)",children:u.orderNum}),(u==null?void 0:u.icon)&&(0,e.jsx)(le.z_,{name:u.icon,className:"mr-1"}),(0,e.jsx)(Z.Z,{color:te[u.menuType],style:{margin:"0 0 2px 0"},children:u.menuName}),(u==null?void 0:u.perms)&&(0,e.jsx)(Z.Z,{style:{margin:"0 0 2px 2px"},children:(0,e.jsxs)(Ee.Z,{size:"small",children:[u.perms,(0,e.jsx)(be.Z,{style:{color:"#1890ff"},onClick:function(t){Ue()(u.perms),O.ZP.success("\u590D\u5236\u6210\u529F"),t.stopPropagation()}})]})})]})},We=function(){return(0,e.jsxs)("div",{className:"mb-2",children:["\u6807\u7B7E\u542B\u4E49\uFF1A",(0,e.jsx)(Z.Z,{color:"rgb(148 163 184)",children:"\u663E\u793A\u987A\u5E8F"}),(0,e.jsx)(Z.Z,{color:te[a.og.M],children:"\u76EE\u5F55"}),(0,e.jsx)(Z.Z,{color:te[a.og.C],children:"\u83DC\u5355"}),(0,e.jsx)(Z.Z,{color:te[a.og.F],children:"\u6309\u94AE"}),(0,e.jsx)(Z.Z,{children:"\u6743\u9650\u6807\u8BC6"})]})},Ye=function(){var u,c=(0,N.useState)({}),t=ue()(c,2),m=t[0],v=t[1],l=(0,N.useState)([]),f=ue()(l,2),h=f[0],p=f[1],$=(0,N.useState)([]),_=ue()($,2),E=_[0],R=_[1],C=d(),s=ue()(C,2),F=s[0],I=s[1],Q=o(),S=ve(),H=ae(m),j=H.data,ge=H.refetch,K=fe(),we=K.mutate,Ge=function(w){p(w)},oe=(E==null?void 0:E.length)!==0&&(E==null?void 0:E.length)===(j==null||(u=j.parentIds)===null||u===void 0?void 0:u.length);return(0,N.useEffect)(function(){ge()},[m]),(0,N.useEffect)(function(){h!=null&&h[0]?I(h[0]):Q()},[h]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(We,{}),(0,e.jsxs)("div",{className:"flex justify-between items-center",children:[(0,e.jsx)(se.Z,{size:"small",className:"my-2",icon:oe?(0,e.jsx)(Oe.Z,{}):(0,e.jsx)(Ne.Z,{}),onClick:function(){return R(oe?[]:j==null?void 0:j.parentIds)},children:oe?"\u5168\u90E8\u6298\u53E0":"\u5168\u90E8\u5C55\u5F00"}),(0,e.jsxs)(i.MmX,{onFinish:function(){var W=T()(y()().mark(function w(Xe){return y()().wrap(function(de){for(;;)switch(de.prev=de.next){case 0:p([]),R([]),v(Xe);case 3:case"end":return de.stop()}},w)}));return function(w){return W.apply(this,arguments)}}(),children:[(0,e.jsx)(i.VaQ,{name:"menuName",label:"\u83DC\u5355\u540D\u79F0"}),(0,e.jsx)(i._IT,{name:"status",label:"\u72B6\u6001",valueEnum:a.al})]})]}),(0,e.jsx)(Ze.Z,{overlay:(0,e.jsx)(_e.Z,{items:[{label:"\u65B0\u5EFA",key:"create",onClick:function(){return S(!0)}},{label:"\u5728\u6839\u76EE\u5F55\u4E0B\u65B0\u5EFA",key:"create",onClick:function(){Q(),S(!0)}},{label:"\u5220\u9664",key:"delete",danger:!0,disabled:h.length===0,onClick:function(){return we(F)}}]}),trigger:["contextMenu"],children:(0,e.jsx)("div",{className:"max-h-[60vh] overflow-auto",children:j!=null&&j.treeData.length?(0,e.jsx)(Ve.Z,{blockNode:!0,selectedKeys:h,onSelect:Ge,expandedKeys:E,titleRender:$e,onExpand:R,showLine:{showLeafIcon:!1},fieldNames:{title:"menuName",key:"menuId",children:"children"},treeData:j==null?void 0:j.treeData,onRightClick:function(w){return p([w.node.key])}}):(0,e.jsx)(le._E,{})})})]})},ke=Ye,Qe=function(){return(0,e.jsx)(G.A,{children:(0,e.jsxs)(i.QWM,{ghost:!0,gutter:24,children:[(0,e.jsx)(i.QWM,{title:"\u83DC\u5355\u5217\u8868",colSpan:"550px",extra:(0,e.jsxs)(Ee.Z,{children:[(0,e.jsx)(je,{}),(0,e.jsx)(De,{})]}),children:(0,e.jsx)(ke,{})}),(0,e.jsx)(i.QWM,{title:"\u83DC\u5355\u8BE6\u60C5",children:(0,e.jsx)(Re,{})})]})})},Ke=Qe},10453:function(ce,Y,n){n.d(Y,{CP:function(){return re},FV:function(){return q},WJ:function(){return k},Yh:function(){return ee},bi:function(){return P},tg:function(){return ne}});var G=n(35290),M=n.n(G),y=n(30279),D=n.n(y),T=n(411),a=n.n(T),b=n(72259);function q(o,d){return X.apply(this,arguments)}function X(){return X=a()(M()().mark(function o(d,g){return M()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,b.WY)("/system/menu/add",D()({method:"POST",headers:{"Content-Type":"application/json"},data:d},g||{})));case 1:case"end":return r.stop()}},o)})),X.apply(this,arguments)}function ee(o,d){return A.apply(this,arguments)}function A(){return A=a()(M()().mark(function o(d,g){return M()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,b.WY)("/system/menu/edit",D()({method:"POST",headers:{"Content-Type":"application/json"},data:d},g||{})));case 1:case"end":return r.stop()}},o)})),A.apply(this,arguments)}function k(o,d){return z.apply(this,arguments)}function z(){return z=a()(M()().mark(function o(d,g){return M()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,b.WY)("/system/menu/info",D()({method:"GET",params:D()({},d)},g||{})));case 1:case"end":return r.stop()}},o)})),z.apply(this,arguments)}function re(o,d){return V.apply(this,arguments)}function V(){return V=a()(M()().mark(function o(d,g){return M()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,b.WY)("/system/menu/list",D()({method:"POST",headers:{"Content-Type":"application/json"},data:d},g||{})));case 1:case"end":return r.stop()}},o)})),V.apply(this,arguments)}function ne(o,d){return O.apply(this,arguments)}function O(){return O=a()(M()().mark(function o(d,g){return M()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,b.WY)("/system/menu/remove",D()({method:"POST",params:D()({},d)},g||{})));case 1:case"end":return r.stop()}},o)})),O.apply(this,arguments)}function P(o,d){return L.apply(this,arguments)}function L(){return L=a()(M()().mark(function o(d,g){return M()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,b.WY)("/system/menu/roleMenuTreeSelect",D()({method:"GET",params:D()({},d)},g||{})));case 1:case"end":return r.stop()}},o)})),L.apply(this,arguments)}function me(o,d){return U.apply(this,arguments)}function U(){return U=_asyncToGenerator(_regeneratorRuntime().mark(function o(d,g){return _regeneratorRuntime().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",request("/system/menu/treeSelect",_objectSpread({method:"POST",headers:{"Content-Type":"application/json"},data:d},g||{})));case 1:case"end":return r.stop()}},o)})),U.apply(this,arguments)}}}]);
