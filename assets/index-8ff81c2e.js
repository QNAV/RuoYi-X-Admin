import{aP as B,aQ as w,j as a,Y as I,A as g,a as l,q as S,t as U,v as M,aR as P,y as R,i as O,aS as T,aT as L,o as F,z as N,m as E,aU as K,F as D,B as q}from"./index-b5eebe28.js";import{bg as d,B as u,D as $,bq as H,r as C,U as b,aH as x,br as A,bn as j,aq as Y}from"./antd-f7a9cbdb.js";import{u as p}from"./useMutation-cb32f323.js";import{u as k}from"./index-942a5fdd.js";import{u as _}from"./useRequest-238e95e7.js";import"./@icon-park/react-8ab893b5.js";import"./@wangeditor/editor-2b25ac2d.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const G=({ossId:e})=>{const{message:t}=d.useApp(),{isLoading:o,mutate:n}=p(async()=>{const{data:i,headers:s}=await B({ossId:e},{format:"blob"}),c=new Blob([i],{type:"application/octet-stream"});c instanceof Blob?(w.saveAs(c,decodeURIComponent(s["download-filename"])),t.success("下载成功")):t.error("下载失败")},{onSuccess:()=>{}});return a(u,{type:"link",icon:a($,{}),loading:o,onClick:()=>{n()},children:"下载"})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const V=({configKey:e,configValue:t,onFinish:o})=>{const{modal:n}=d.useApp(),{mutate:i,isLoading:s}=p(I,{onSuccess:()=>{o()}});return a(g,{accessKey:"system:oss:edit",children:l(u,{danger:!0,type:"primary",ghost:!0,onClick:()=>{n.confirm({title:"操作确认",content:`确定${t?"停用":"启用"}"预览列表图片"配置吗？`,okButtonProps:{loading:s},onOk:()=>i({configKey:e,configValue:`${!t}`})})},children:["预览开关：",t?"启用":"停用"]})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const m=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/oss/model/index.ts/atomMainTableActions",S(void 0));m.debugLabel="atomMainTableActions";const X=()=>M(m),z=()=>U(m);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const v=({ossIds:e,batch:t,disabled:o})=>{const{message:n,modal:i}=d.useApp(),s=X(),{mutate:c,isLoading:h}=p(P,{onSuccess:()=>{var f;s==null||s.reload(),(f=s==null?void 0:s.clearSelected)==null||f.call(s),n.success("删除成功")}});return a(g,{accessKey:"system:oss:remove",children:a(R,{batch:t,disabled:o,onClick:()=>{i.confirm({title:"删除用户",content:`确定删除OSS对象存储编号为 ${e.join(",")} 的数据吗？`,onOk:()=>c({ossIds:e}),okButtonProps:{loading:h}})}})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Q=()=>{const e=O();return a(u,{icon:a(H,{}),type:"primary",ghost:!0,onClick:()=>{e("/system/oss-config")},children:"配置管理"})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const{Dragger:W}=j,J=async e=>{const{data:{code:t,msg:o}}=await T({file:e});return t!==200?Promise.reject(new Error(o)):o},Z=()=>{const[e,{toggle:t}]=k(),[o,n]=C.useState([]),{message:i,modal:s}=d.useApp(),{mutate:c,isLoading:h}=p(J,{onSuccess:r=>{t(),s.info({title:"导入结果",content:r})},onError:()=>{i.error("导入失败")}});return l(g,{accessKey:"system:oss:upload",children:[a(u,{type:"primary",icon:a(b,{}),onClick:t,children:"上传文件"}),a(x,{title:"上传文件",open:e,onCancel:t,okText:"提交",onOk:()=>c(o[0].originFileObj),okButtonProps:{loading:h},children:l(W,{accept:".xlsx, .xls, .doc, .docx, .ppt, .pptx, .txt, .pdf",maxCount:1,beforeUpload:()=>!1,onChange:r=>n(r.fileList),fileList:o,onRemove:()=>n([]),children:[a("p",{className:"ant-upload-drag-icon",children:a(A,{})}),a("p",{className:"ant-upload-text",children:"点击或拖拽文件到此区域上传"}),a("p",{className:"ant-upload-text",children:"请上传大小不超过5MB格式为doc/xls/ppt/txt/pdf的文件"})]})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const{Dragger:ee}=j,te=async e=>{const{data:{code:t,msg:o}}=await T({file:e});return t!==200?Promise.reject(new Error(o)):o},ae=()=>{const[e,{toggle:t}]=k(),[o,n]=C.useState([]),{message:i,modal:s}=d.useApp(),{mutate:c,isLoading:h}=p(te,{onSuccess:r=>{t(),s.info({title:"导入结果",content:r})},onError:()=>{i.error("导入失败")}});return l(g,{accessKey:"system:oss:upload",children:[a(u,{type:"primary",icon:a(b,{}),onClick:t,children:"上传图片"}),a(x,{title:"上传图片",open:e,onCancel:t,okText:"提交",onOk:()=>c(o[0].originFileObj),okButtonProps:{loading:h},children:l(ee,{accept:".png, .jpg, .jpeg, .docx",maxCount:1,beforeUpload:()=>!1,onChange:r=>n(r.fileList),fileList:o,onRemove:()=>n([]),children:[a("p",{className:"ant-upload-drag-icon",children:a(A,{})}),a("p",{className:"ant-upload-text",children:"点击或拖拽文件到此区域上传"}),a("p",{className:"ant-upload-text",children:"请上传大小不超过5MB格式为png/jpg/jpeg的文件"})]})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const oe=e=>[{title:"对象存储主键",dataIndex:"ossId",key:"ossId",valueType:"text",hideInSearch:!0},{title:"文件名",dataIndex:"fileName",key:"fileName",valueType:"text"},{title:"原名",dataIndex:"originalName",key:"originalName",valueType:"text"},{title:"文件后缀名",dataIndex:"fileSuffix",key:"fileSuffix",valueType:"text"},{title:"文件展示",dataIndex:"url",key:"url",valueType:"text",render:(t,o)=>["png","jpg","jpeg"].includes(o.fileSuffix)&&e?a(Y,{src:o.url,width:100,height:100}):o.url},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",hideInSearch:!0,sorter:!0},{title:"上传人",dataIndex:"createBy",key:"createBy",valueType:"text"},{title:"服务商",dataIndex:"service",key:"service",valueType:"text",sorter:!0},{title:"创建时间",dataIndex:"dateTimeRange",key:"dateTimeRange",valueType:"dateTimeRange",hideInTable:!0},{title:"操作",dataIndex:"action",valueType:"option",render:(t,o)=>l(D,{children:[a(G,{ossId:o.ossId}),a(v,{ossIds:[o.ossId]})]})}],se=({selectedRowKeys:e})=>a(v,{disabled:e.length===0,batch:!0,ossIds:e}),y="sys.oss.previewListResource",ne=()=>{const e=z(),{data:t,refresh:o}=_(async()=>{const{data:{msg:i}}=await L({configKey:y});return i==="true"}),n=oe(!!t);return a(F,{rowKey:"ossId",actionRef:e,columns:n,request:async(...i)=>{const{dateTimeRange:s,...c}=N(...i);return E(s)&&(c.beginCreateTime=s[0],c.endCreateTime=s[1]),await K(c)},toolbar:{actions:[a(Z,{},"ButtonUploadFile"),a(ae,{},"ButtonUploadImg"),a(V,{configKey:y,configValue:!!t,onFinish:()=>{o()}},"ButtonPreviewConfig"),a(Q,{},"ButtonToConfigPage")]},tableAlertOptionRender:se})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const pe=()=>a(q,{children:a(ne,{})});export{pe as default};
