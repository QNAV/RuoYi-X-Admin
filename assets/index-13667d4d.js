import{c as q,a as s,j as a,P as D,r as G,u as K,b as V,d as X,F as W,e as Q,f as Y,g as M,C as H,h as Z,i as ee,k as te,s as ae,S as $}from"./index-b5eebe28.js";import{e as R,M as re,r as S,m as L,k as z,g as i,af as ie,B as ne,W as U,X as B,al as oe,o as k,i as se,p as ce,bg as O,aL as le,bi as ue,bj as de,bk as _,bc as he,bl as me,aq as ge,aX as pe,a8 as fe}from"./antd-f7a9cbdb.js";import{P as I}from"./index-843b2515.js";import{u as ve}from"./useRequest-238e95e7.js";import"./@icon-park/react-8ab893b5.js";import"./@wangeditor/editor-2b25ac2d.js";var be=["rules","name","phoneName","fieldProps","captchaTextRender","captchaProps"],xe=R.forwardRef(function(e,t){var r=re.useFormInstance(),f=S.useState(e.countDown||60),m=L(f,2),n=m[0],v=m[1],y=S.useState(!1),T=L(y,2),b=T[0],P=T[1],C=S.useState(),u=L(C,2),h=u[0],g=u[1];e.rules,e.name;var E=e.phoneName,w=e.fieldProps,N=e.captchaTextRender,j=N===void 0?function(d,o){return d?"".concat(o," 秒后重新获取"):"获取验证码"}:N,A=e.captchaProps,c=z(e,be),F=function(){var d=U(B().mark(function o(p){return B().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.prev=0,g(!0),x.next=4,c.onGetCaptcha(p);case 4:g(!1),P(!0),x.next=13;break;case 8:x.prev=8,x.t0=x.catch(0),P(!1),g(!1),console.log(x.t0);case 13:case"end":return x.stop()}},o,null,[[0,8]])}));return function(p){return d.apply(this,arguments)}}();return S.useImperativeHandle(t,function(){return{startTiming:function(){return P(!0)},endTiming:function(){return P(!1)}}}),S.useEffect(function(){var d=0,o=e.countDown;return b&&(d=window.setInterval(function(){v(function(p){return p<=1?(P(!1),clearInterval(d),o||60):p-1})},1e3)),function(){return clearInterval(d)}},[b]),s("div",{style:i(i({},w==null?void 0:w.style),{},{display:"flex",alignItems:"center"}),ref:t,children:[a(ie,i(i({},w),{},{style:{flex:1,transition:"width .3s",marginRight:8}})),a(ne,i(i({style:{display:"block"},disabled:b,loading:h},A),{},{onClick:U(B().mark(function d(){var o;return B().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(l.prev=0,!E){l.next=9;break}return l.next=4,r.validateFields([E].flat(1));case 4:return o=r.getFieldValue([E].flat(1)),l.next=7,F(o);case 7:l.next=11;break;case 9:return l.next=11,F("");case 11:l.next=16;break;case 13:l.prev=13,l.t0=l.catch(0),console.log(l.t0);case 16:case"end":return l.stop()}},d,null,[[0,13]])})),children:j(b,n)}))]})}),ye=q(xe);const Pe=ye;var Ce=["options","fieldProps","proFieldProps","valueEnum"],Se=R.forwardRef(function(e,t){var r=e.options,f=e.fieldProps,m=e.proFieldProps,n=e.valueEnum,v=z(e,Ce);return a(D,i({ref:t,valueType:"checkbox",valueEnum:G(n,void 0),fieldProps:i({options:r},f),lightProps:i({labelFormatter:function(){return a(D,i({ref:t,valueType:"checkbox",mode:"read",valueEnum:G(n,void 0),filedConfig:{customLightMode:!0},fieldProps:i({options:r},f),proFieldProps:m},v))}},v.lightProps),proFieldProps:m},v))}),we=R.forwardRef(function(e,t){var r=e.fieldProps,f=e.children;return a(oe,i(i({ref:t},r),{},{children:f}))}),Te=q(we,{valuePropName:"checked"}),J=Te;J.Group=Se;const ke=J;var Fe=function(t){var r;return r={},k(r,t.componentCls,{display:"flex",width:"100%",height:"100%",backgroundSize:"contain","&-notice":{display:"flex",flex:"1",alignItems:"flex-end","&-activity":{marginBlock:24,marginInline:24,paddingInline:24,paddingBlock:24,"&-title":{fontWeight:"500",fontSize:"28px"},"&-subTitle":{marginBlockStart:8,fontSize:"16px"},"&-action":{marginBlockStart:"24px"}}},"&-container":{display:"flex",flex:"1",flexDirection:"column",maxWidth:"550px",height:"100%",paddingInline:0,paddingBlock:32,overflow:"auto",background:t.colorBgContainer},"&-top":{textAlign:"center"},"&-header":{display:"flex",alignItems:"center",justifyContent:"center",height:"44px",lineHeight:"44px",a:{textDecoration:"none"}},"&-title":{position:"relative",tinsetBlockStartop:"2px",color:"@heading-color",fontWeight:"600",fontSize:"33px"},"&-logo":{width:"44px",height:"44px",marginInlineEnd:"16px",verticalAlign:"top",img:{width:"100%"}},"&-desc":{marginBlockStart:"12px",marginBlockEnd:"40px",color:t.colorTextSecondary,fontSize:t.fontSize},"&-main":{width:"328px",margin:"0 auto","&-other":{marginBlockStart:"24px",lineHeight:"22px",textAlign:"start"}}}),k(r,"@media (max-width: ".concat(t.screenMDMin,"px)"),k({},t.componentCls,{flexDirection:"column-reverse",background:"none !important","&-notice":{display:"flex",flex:"none",alignItems:"flex-start",width:"100%","> div":{width:"100%"}}})),k(r,"@media (min-width: ".concat(t.screenMDMin,"px)"),k({},t.componentCls,{"&-container":{paddingInline:0,paddingBlockStart:128,paddingBlockEnd:24,backgroundRepeat:"no-repeat",backgroundPosition:"center 110px",backgroundSize:"100%"}})),k(r,"@media (max-width: ".concat(t.screenSM,"px)"),k({},t.componentCls,{"&-main":{width:"95%",maxWidth:"328px"}})),r};function Ee(e){return K("LoginFormPage",function(t){var r=i(i({},t),{},{componentCls:".".concat(e)});return[Fe(r)]})}var Ne=["logo","message","style","activityConfig","backgroundImageUrl","title","subTitle","actions","children"];function Ae(e){var t=e.logo,r=e.message,f=e.style,m=e.activityConfig,n=m===void 0?{}:m,v=e.backgroundImageUrl,y=e.title,T=e.subTitle,b=e.actions,P=e.children,C=z(e,Ne),u=V(),h=function(){var o,p;return C.submitter===!1||((o=C.submitter)===null||o===void 0?void 0:o.submitButtonProps)===!1?!1:i({size:"large",style:{width:"100%"}},(p=C.submitter)===null||p===void 0?void 0:p.submitButtonProps)},g=i(i({searchConfig:{submitText:u.getMessage("loginForm.submitText","登录")},render:function(o,p){return p.pop()}},C.submitter),{},{submitButtonProps:h()}),E=S.useContext(se.ConfigContext),w=E.getPrefixCls("pro-form-login-page"),N=Ee(w),j=N.wrapSSR,A=N.hashId,c=function(o){return"".concat(w,"-").concat(o," ").concat(A)},F=S.useMemo(function(){return t?typeof t=="string"?a("img",{src:t}):t:null},[t]);return j(s("div",{className:ce(w,A),style:i(i({},f),{},{backgroundImage:'url("'.concat(v,'")')}),children:[a("div",{className:c("notice"),children:n&&s("div",{className:c("notice-activity"),style:n.style,children:[n.title&&s("div",{className:c("notice-activity-title"),children:[" ",n.title," "]}),n.subTitle&&s("div",{className:c("notice-activity-subTitle"),children:[" ",n.subTitle," "]}),n.action&&s("div",{className:c("notice-activity-action"),children:[" ",n.action," "]})]})}),s("div",{className:c("container"),children:[s("div",{className:c("top"),children:[y||F?s("div",{className:c("header"),children:[F?a("span",{className:c("logo"),children:F}):null,y?a("span",{className:c("title"),children:y}):null]}):null,T?a("div",{className:c("desc"),children:T}):null]}),s("div",{className:c("main"),children:[s(X,i(i({isKeyPressSubmit:!0},C),{},{submitter:g,children:[r,P]})),b?a("div",{className:c("other"),children:b}):null]})]})]}))}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Be=()=>{const{message:e}=O.useApp();return s("div",{className:"flex flex-col justify-center items-center",children:[a(le,{plain:!0,children:a("span",{className:"text-sm font-normal text-neutral-400",children:"其他登录方式"})}),a("div",{onClick:()=>{e.info("敬请期待")},className:"flex justify-center items-center cursor-pointer rounded-full h-[40px] w-[40px] border-solid border border-gray-300",children:a(ue,{style:{fontSize:"20px",color:"#00ac84"}})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ie=()=>{const{message:e}=O.useApp();return s(W,{children:[a(I,{fieldProps:{maxLength:11,size:"large",prefix:a(de,{})},name:"phoneNumber",placeholder:"请输入手机号",rules:[{required:!0,message:"请输入手机号"},{pattern:Q,message:"手机号格式错误"}]}),a(Pe,{fieldProps:{size:"large",prefix:a(_,{})},captchaProps:{size:"large"},placeholder:"请输入验证码",captchaTextRender:(t,r)=>t?`${r} 获取验证码`:"获取验证码",name:"smsCode",rules:[{required:!0,message:"请输入验证码"}],onGetCaptcha:async()=>(e.info("敬请期待"),Promise.reject(new Error("敬请期待")))})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const je=({captchaImageSrc:e,onCaptchaImageClick:t})=>s(W,{children:[a(I,{name:"username",fieldProps:{size:"large",prefix:a(he,{})},placeholder:"admin",initialValue:"admin",rules:[{required:!0,message:"请输入用户名"}]}),a(I.Password,{name:"password",fieldProps:{size:"large",prefix:a(_,{})},placeholder:"admin123",initialValue:"admin123",rules:[{required:!0,message:"请输入密码"}]}),s(Y,{children:[a(I,{width:160,name:"code",placeholder:"请输入验证码",fieldProps:{size:"large",prefix:a(me,{})},rules:[{required:!0,message:"请输入验证码"}]}),a("div",{className:"h-[40px] w-[135px] rounded-md cursor-pointer border border-solid border-gray-300",children:e?a(ge,{src:`data:image/png;base64,${e}`,preview:!1,height:40,width:135,alt:"图片验证码",onClick:t,className:"rounded-md"}):a(pe.Button,{active:!0,block:!0,size:"large"})})]})]});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Le=(e={})=>M({path:"/captchaImage",method:"GET",secure:!0,skipErrorHandler:!1,...e});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Me=(e,t={})=>M({path:"/login",method:"POST",body:e,secure:!0,type:H.Json,skipErrorHandler:!1,...t});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Re=(e,t={})=>M({path:"/smsLogin",method:"POST",body:e,secure:!0,type:H.Json,skipErrorHandler:!1,...t});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const qe=()=>{const[e,t]=S.useState("USERNAME"),r=Z(),f=ee(),[m]=te(),{data:n,run:v}=ve(()=>Le({secure:!1})),y=async(u,h)=>{ae(u?$.LOCAL_STORAGE:$.SESSION_STORAGE,`Bearer ${h}`),await r(),f(m.get("redirect")??"/")},T=async(u,h)=>{const{token:g}=await Re(h);await y(u,g)},{message:b}=O.useApp(),P=async(u,h)=>{if(!n){b.error("请先获取图片验证码");return}const{token:g}=await Me({...h,uuid:n.uuid},{secure:!1});await y(u,g)},C=async u=>{try{const{autoLogin:h,...g}=u;if(e==="MOBILE"){await T(h,g);return}if(e==="USERNAME"){await P(h,g);return}}catch{e==="USERNAME"&&v()}};return S.useEffect(()=>{m.get("msg")&&b.error(m.get("msg"))},[]),a("div",{className:"h-[100vh]",children:s(Ae,{backgroundImageUrl:"https://gw.alipayobjects.com/zos/rmsportal/FfdJeJRQWjEeGTpqgBKj.png",logo:"https://github.githubassets.com/images/modules/logos_page/Octocat.png",title:"RuoYi X Admin",subTitle:"若依后台管理系统",actions:a(Be,{}),onFinish:C,children:[a(fe,{centered:!0,activeKey:e,onChange:u=>t(u),items:[{label:"账号密码登录",key:"USERNAME"},{label:"手机号登录",key:"MOBILE"}]}),e==="USERNAME"&&a(je,{captchaImageSrc:n==null?void 0:n.img,onCaptchaImageClick:v}),e==="MOBILE"&&a(Ie,{}),a(ke,{name:"autoLogin",children:"自动登录"})]})})};export{qe as default};
