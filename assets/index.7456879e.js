import{aw as Q,V as $,j as a,ax as K,_ as Z,r as p,e as i,az as O,ai as w,aA as _,aB as H,Z as J,aC as f,aW as U,aY as X,F as S,a7 as P,a1 as D,aZ as h,aD as V,aE as ee,aS as j,a_ as k,q as x,aF as ue,aI as L,aJ as ae,ap as y,$ as q,aP as F,a$ as te,aQ as se,b0 as re,b1 as oe,aK as ne,aL as ce,aM as le,aN as ie,b2 as de,b3 as he,aO as me,M as pe,at as N}from"./index.5d8f858f.js";import{d as I}from"./index.5043a57a.js";import{useShowCreateModal as R,useHideCreateModal as Fe,useValueCreateModal as Ce,useValueSelectedMenuData as v,useQueryMenuOptions as Ee,useReFetchMenuList as G,useDeleteMenu as W,useReFetchMenuOptions as ge,useStateSelectedMenuData as Me,useResetSelectedMenuData as be,useQueryMenuList as Ae}from"./index.146673f1.js";import{S as De,a as fe,b as Be}from"./SysMenuService.9bef3f43.js";import{P as Se}from"./index.57e3371e.js";import{P as Pe}from"./index.1dd7cf63.js";import{u as Y}from"./useMutation.esm.02eeb2ff.js";import{h as ye,b as Ne,i as Te,a as we,j as xe,C as Ie,k as ve,l as je,m as ke,n as qe,o as Oe,p as Ve}from"./index.670b3d91.js";import{u as Le}from"./useRequest.703789a1.js";import"./useQuery.esm.7ccda232.js";import"./utils.esm.98d2485c.js";import"./utils.d7d7d8f1.js";var Re=["fieldProps","request","params","proFieldProps"],Ge=function(u,n){var c=u.fieldProps,s=u.request,t=u.params,l=u.proFieldProps,C=$(u,Re);return a(K,Z({valueType:"cascader",fieldProps:c,ref:n,request:s,params:t,filedConfig:{customLightMode:!0},proFieldProps:l},C))};const We=Q.forwardRef(Ge);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,u){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,u),u)}};const Ye=(e,u)=>{const n=[0];if(u===0)return n;const c=s=>{const t=e.get(s);!t||((t==null?void 0:t.parentId)!==void 0&&c(t.parentId),t.menuType!==h.F&&n.push(s))};return c(u),n},ze=()=>{var E,g;const e=I(),u=p.exports.useRef(),n=R(),c=Fe(),s=Ce(),{selectedMenuId:t}=v(),{data:l,refetch:C}=Ee(),b=G(),{isLoading:A,mutate:o}=Y(async()=>{var d,M;const r=await((M=(d=u.current)==null?void 0:d.validateFieldsReturnFormatValue)==null?void 0:M.call(d));!r||await De(r)},{onSuccess:async()=>{var r;await Promise.all([C(),b()]),c(),(r=u==null?void 0:u.current)==null||r.resetFields(),x.success("\u65B0\u5EFA\u6210\u529F")}});return p.exports.useEffect(()=>{var r;s&&(l==null?void 0:l.map)&&((r=u==null?void 0:u.current)==null?void 0:r.setFieldsValue)&&u.current.setFieldsValue({parentId:Ye(l.map,t)})},[s,(E=u==null?void 0:u.current)==null?void 0:E.setFieldsValue]),i(O,{accessible:e.canAddSysMenu,children:[a(w,{type:"primary",onClick:n,icon:a(_,{}),children:"\u65B0\u5EFA"}),a(H,{open:s,onCancel:c,title:"\u65B0\u5EFA\u83DC\u5355",width:515,okText:"\u63D0\u4EA4",onOk:()=>o(),okButtonProps:{loading:A},children:i(J,{submitter:!1,formRef:u,children:[a(We,{name:"parentId",label:"\u7236\u7EA7\u83DC\u5355",fieldProps:{options:(g=l==null?void 0:l.options)!=null?g:[],fieldNames:{label:"menuName",value:"menuId",children:"children"},changeOnSelect:!0},rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u7236\u7EA7\u83DC\u5355"}],transform:r=>({parentId:r[r.length-1]})}),a(f.Group,{name:"menuType",label:"\u83DC\u5355\u7C7B\u578B",valueEnum:U,rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u83DC\u5355\u7C7B\u578B"}]}),a(X,{name:["menuType"],children:({menuType:r})=>r?i(S,{children:[i(P,{children:[a(D,{name:"menuName",label:"\u83DC\u5355\u540D\u79F0",width:"sm",rules:[{required:!0}]}),a(Se,{name:"orderNum",label:"\u663E\u793A\u6392\u5E8F",tooltip:"\u9ED8\u8BA4\u6570\u503C\u4E3A0\uFF0C\u6570\u503C\u8D8A\u5927\u6392\u5E8F\u8D8A\u9760\u540E\uFF0C\u6570\u503C\u76F8\u7B49\u6309\u7167\u521B\u5EFA\u65F6\u95F4\u5148\u540E\u6392\u5E8F",rules:[{required:!0}],width:"sm",initialValue:0})]}),r!==h.F&&i(S,{children:[i(P,{children:[a(f.Group,{tooltip:"\u9009\u62E9\u505C\u7528\u5219\u8DEF\u7531\u5C06\u4E0D\u4F1A\u51FA\u73B0\u5728\u4FA7\u8FB9\u680F\uFF0C\u4E5F\u4E0D\u80FD\u88AB\u8BBF\u95EE",name:"status",label:"\u83DC\u5355\u72B6\u6001",valueEnum:V,required:!0,initialValue:ee.ENABLE}),a(f.Group,{name:"visible",label:"\u83DC\u5355\u662F\u5426\u663E\u793A",valueEnum:j,required:!0,initialValue:k.YES,tooltip:"\u9009\u62E9\u5426\u5219\u8DEF\u7531\u5C06\u4E0D\u4F1A\u51FA\u73B0\u5728\u4FA7\u8FB9\u680F\uFF0C\u4F46\u4ECD\u7136\u53EF\u4EE5\u8BBF\u95EE"}),a(f.Group,{name:"isFrame",label:"\u662F\u5426\u5916\u94FE",valueEnum:j,required:!0,initialValue:k.NO,tooltip:"\u9009\u62E9\u662F\u5916\u94FE\u5219\u8DEF\u7531\u5730\u5740\u9700\u8981\u4EE5`http(s)://`\u5F00\u5934"})]}),i(P,{children:[a(D,{name:"icon",label:"\u83DC\u5355\u56FE\u6807",width:"sm",tooltip:"https://ant.design/components/icon-cn/"}),a(D,{width:"sm",name:"path",label:"\u8DEF\u7531\u5730\u5740",tooltip:"\u8BBF\u95EE\u7684\u8DEF\u7531\u5730\u5740\uFF0C\u5982\uFF1A`user`\uFF0C\u5982\u5916\u7F51\u5730\u5740\u9700\u5185\u94FE\u8BBF\u95EE\u5219\u4EE5`http(s)://`\u5F00\u5934",rules:[{required:!0}]})]})]}),r===h.C&&a(D,{name:"queryParam",label:"\u8DEF\u7531\u53C2\u6570",tooltip:'\u8BBF\u95EE\u8DEF\u7531\u7684\u9ED8\u8BA4\u4F20\u9012\u53C2\u6570\uFF0C\u5982\uFF1A{"id": 1, "name": "ry"}'}),r!==h.M&&a(D,{name:"perms",label:"\u6743\u9650\u6807\u8BC6"})]}):null}),a(Pe,{name:"remark",label:"\u5907\u6CE8"})]})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,u){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,u),u)}};const Qe=()=>{const e=I(),{hasSelected:u,selectedMenuId:n,selectedMenuName:c}=v(),{mutate:s,isLoading:t}=W();return a(O,{accessible:u&&e.canRemoveSysMenu,children:a(w,{icon:a(ue,{}),loading:t,danger:!0,onClick:()=>s({menuId:n,menuName:c}),children:"\u5220\u9664"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,u){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,u),u)}};const T={xs:1,sm:1,md:1,lg:1,xl:2},$e=e=>p.exports.useMemo(()=>{const u=[];return e?(e!==h.F&&u.push(Ie,ve,je,ke,qe),e===h.C&&u.push(Oe),e!==h.M&&u.push(Ve),u):[]},[e]),Ke=()=>{const e=I(),u=G(),n=ge(),{hasSelected:c,selectedMenuId:s}=v(),{data:t,loading:l,refresh:C}=Le(async()=>await fe({menuId:s}),{ready:c,refreshDeps:[s]}),{mutateAsync:b}=Y(Be,{onSuccess:()=>{C(),u(),n(),x.success("\u4FDD\u5B58\u6210\u529F")}}),A=$e(t==null?void 0:t.menuType),o=e.canEditSysMenu?{onSave:async(E,g)=>{const{menuType:r,orderNum:d,menuName:M,menuId:m}=g;await b({menuId:m,menuType:r,orderNum:d,menuName:M,[E]:g[E]})}}:void 0;return s===0?a(L,{description:"\u70B9\u51FB\u9009\u62E9\u5DE6\u4FA7\u83DC\u5355\u9879\u67E5\u770B\u8BE6\u60C5"}):i(ae,{spinning:l,children:[a(y,{columns:[ye,Ne],dataSource:t,column:T}),a(q,{}),a(y,{columns:[Te,we,xe],dataSource:t,editable:o,column:T}),a(q,{}),a(y,{columns:A,dataSource:t,editable:o,column:T})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,u){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,u),u)}};const Ze=e=>i(S,{children:[a(F,{color:"rgb(148 163 184)",children:e.orderNum}),(e==null?void 0:e.icon)&&a(te,{name:e.icon,className:"mr-1"}),a(F,{color:B[e.menuType],style:{margin:"0 0 2px 0"},children:e.menuName}),(e==null?void 0:e.perms)&&a(F,{style:{margin:"0 0 2px 2px"},children:i(se,{size:"small",children:[e.perms,a(re,{style:{color:"#1890ff"},onClick:u=>{oe(e.perms),x.success("\u590D\u5236\u6210\u529F"),u.stopPropagation()}})]})})]});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,u){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,u),u)}};const _e=()=>i("div",{className:"mb-2",children:["\u6807\u7B7E\u542B\u4E49\uFF1A",a(F,{color:"rgb(148 163 184)",children:"\u663E\u793A\u987A\u5E8F"}),a(F,{color:B[h.M],children:"\u76EE\u5F55"}),a(F,{color:B[h.C],children:"\u83DC\u5355"}),a(F,{color:B[h.F],children:"\u6309\u94AE"}),a(F,{children:"\u6743\u9650\u6807\u8BC6"})]});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,u){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,u),u)}};const B={M:"blue",C:"green",F:"red"},He=()=>{var M;const[e,u]=p.exports.useState({}),[n,c]=p.exports.useState(0),[s,t]=p.exports.useState([]),[l,C]=Me(),b=be(),A=R(),{data:o,refetch:E}=Ae(e,m=>{t(m)}),{mutate:g}=W(),r=(m,{node:{key:z}})=>{c(z)},d=(s==null?void 0:s.length)!==0&&(s==null?void 0:s.length)===((M=o==null?void 0:o.parentIds)==null?void 0:M.length);return p.exports.useEffect(()=>{E()},[e]),p.exports.useEffect(()=>{n>0?C({hasSelected:!0,selectedMenuId:n,selectedMenuName:o.map.get(n).menuName}):b()},[n]),i(S,{children:[a(_e,{}),i("div",{className:"flex justify-between items-center",children:[a(w,{size:"small",className:"my-2",icon:d?a(ne,{}):a(ce,{}),onClick:()=>t(d?[]:o==null?void 0:o.parentIds),children:d?"\u5168\u90E8\u6298\u53E0":"\u5168\u90E8\u5C55\u5F00"}),i(le,{onFinish:async m=>{c(0),t([]),u(m)},children:[a(D,{name:"menuName",label:"\u83DC\u5355\u540D\u79F0"}),a(ie,{name:"status",label:"\u72B6\u6001",valueEnum:V})]})]}),a(de,{overlay:a(he,{items:[{label:"\u65B0\u5EFA",key:"create",onClick:()=>A()},{label:"\u5728\u6839\u76EE\u5F55\u4E0B\u65B0\u5EFA",key:"create",onClick:()=>{b(),A()}},{label:"\u5220\u9664",key:"delete",danger:!0,disabled:!l.hasSelected,onClick:()=>g({menuId:l.selectedMenuId,menuName:l.selectedMenuName})}]}),trigger:["contextMenu"],children:a("div",{className:"h-[calc(100vh-310px)] overflow-auto",children:o!=null&&o.treeData.length?a(me,{blockNode:!0,selectedKeys:[n],onSelect:r,expandedKeys:s,titleRender:Ze,onExpand:t,showLine:{showLeafIcon:!1},fieldNames:{title:"menuName",key:"menuId",children:"children"},treeData:o==null?void 0:o.treeData,onRightClick:({node:{key:m}})=>c(m)}):a(L,{})})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,u){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,u),u)}};const lu=()=>a(pe,{children:i(N,{ghost:!0,gutter:24,children:[a(N,{title:"\u83DC\u5355\u5217\u8868",colSpan:"550px",extra:a(ze,{}),children:a(He,{})}),a(N,{title:"\u83DC\u5355\u8BE6\u60C5",extra:a(Qe,{}),children:a(Ke,{})})]})});export{lu as default};
