import{aO as z,W as Z,j as s,aP as _,_ as J,v as U,g as ee,aY as x,r as g,n as v,e as l,ak as L,aj as S,aK as te,am as R,$ as se,a2 as D,aH as ae,aQ as O,aZ as C,q as y,al as re,F as B,an as oe,a_ as ue,a$ as q,b0 as M,aB as f,a0 as w,b1 as ce,b2 as ne,b3 as ie,b4 as le,b5 as pe,b6 as j,as as de,O as he,aF as P}from"./index.43a5fefc.js";import{d as N}from"./index.4cad56ec.js";import{S as k,a as me,b as De,c as ge,d as Ee}from"./SysDeptService.084acc84.js";import{a as Fe,u as be}from"./utils.a6bcce70.js";import{u as Q}from"./useQuery.esm.ffab827d.js";import{P as fe}from"./index.ff73ac32.js";import{u as Pe}from"./index.1f0eb342.js";import{u as Ae}from"./useMutation.esm.3b5771e3.js";import{c as Ce,d as Se,a as ye,e as Be,f as Ne,g as Te,h as Ie,i as we}from"./index.408b5ebe.js";import{u as je}from"./useRequest.9b1e50c6.js";import"./utils.esm.79e318f9.js";var xe=["fieldProps","request","params","proFieldProps"],ve=function(t,u){var r=t.fieldProps,a=t.request,c=t.params,o=t.proFieldProps,n=Z(t,xe);return s(_,J({valueType:"treeSelect",fieldProps:r,ref:u,request:a,params:c,filedConfig:{customLightMode:!0},proFieldProps:o},n))},Le=z.forwardRef(ve);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const W="systemDept",F=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/dept/model/index.ts/AtomDeptDetails",Fe({open:!1,deptId:0,deptName:""}));F.debugLabel="AtomDeptDetails";const V=()=>U(F),Re=()=>{const e=ee(F);return(t,u)=>{e({open:!0,deptId:t,deptName:u})}},Oe=()=>be(F),K=[W,"list"],qe=(e,t)=>{const u=Q(K,async()=>{const r=await k(e),a=x(r,{id:"deptId",pId:"parentId",rootPId:null});return{map:r.reduce((c,o)=>c.set(o.deptId,o),new Map),treeData:a,allParentIds:Array.from(r.reduce((c,o)=>c.add(o.parentId),new Set))}},{onSuccess:r=>{t.onSuccess(r.allParentIds)}});return g.exports.useEffect(()=>{u.refetch()},[e]),u},Y=()=>{const e=v();return()=>e.invalidateQueries(K)},G=[W,"options"],H=()=>Q(G,async()=>{const e=await k({});return x(e,{id:"deptId",pId:"parentId",rootPId:null})}),X=()=>{const e=v();return()=>e.invalidateQueries(G)};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Me=()=>{const e=N(),t=g.exports.useRef(),[u,{toggle:r}]=Pe(),{data:a,refetch:c}=H(),{mutate:o,isLoading:n}=Ae(async()=>{var d;const p=await((d=t.current)==null?void 0:d.validateFields());await me(p)},{onSuccess:()=>{var p;y.success("\u65B0\u5EFA\u6210\u529F"),c(),r(),(p=t.current)==null||p.resetFields()}});return l(L,{accessible:e.canAddSysDept,children:[s(S,{type:"primary",icon:s(te,{}),onClick:r,children:"\u65B0\u5EFA"}),s(R,{title:"\u65B0\u5EFA\u90E8\u95E8",okText:"\u63D0\u4EA4",open:u,onCancel:r,onOk:()=>o(),okButtonProps:{loading:n},children:l(se,{submitter:!1,formRef:t,grid:!0,rowProps:{gutter:[16,0]},children:[s(Le,{name:"parentId",label:"\u4E0A\u7EA7\u90E8\u95E8",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u4E0A\u7EA7\u90E8\u95E8"}],fieldProps:{treeData:a!=null?a:[],fieldNames:{label:"deptName",value:"deptId"}}}),s(D,{name:"deptName",label:"\u90E8\u95E8\u540D\u79F0",rules:[{required:!0}],colProps:{span:12}}),s(fe,{name:"orderNum",label:"\u663E\u793A\u6392\u5E8F",initialValue:0,rules:[{required:!0}],colProps:{span:12}}),s(D,{name:"leader",label:"\u8D1F\u8D23\u4EBA",colProps:{span:12}}),s(D,{name:"phone",label:"\u8054\u7CFB\u7535\u8BDD",colProps:{span:12}}),s(D,{name:"email",label:"\u90AE\u7BB1",colProps:{span:12}}),s(ae.Group,{name:"status",label:"\u72B6\u6001",valueEnum:O,initialValue:C.ENABLE,colProps:{span:12}})]})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ke=()=>{const e=N(),{deptId:t,deptName:u,open:r}=V(),a=Oe(),c=Y(),o=X(),n=()=>{R.confirm({title:"\u5220\u9664\u786E\u8BA4",content:l(B,{children:["\u786E\u5B9A\u5220\u9664\u90E8\u95E8",s(oe.Text,{code:!0,children:u}),"\u5417\uFF1F"]}),onOk:async()=>{await De({deptId:t}),y.success("\u5220\u9664\u6210\u529F"),a(),c(),o()}})};return s(L,{accessible:r&&e.canRemoveSysDept,children:s(S,{danger:!0,ghost:!0,icon:s(re,{}),onClick:n,children:"\u5220\u9664"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const A={xs:1,sm:1,md:1,lg:1,xl:2},Qe=()=>{const[e,t]=g.exports.useState([]),u=N(),[r]=ue.useForm(),a=Y(),c=X(),{deptId:o,open:n}=V(),{data:p}=H(),d=we(p),{data:h,loading:E,refresh:$}=je(async()=>{var I;const{ancestors:i,...m}=await ge({deptId:o}),T=(I=i==null?void 0:i.split(","))!=null?I:[];return{...m,ancestors:Number(T[T.length-1])}},{ready:n&&o>0,refreshDeps:[o],onSuccess:()=>{t([])}}),b=u!=null&&u.canEditSysDept?{form:r,editableKeys:e,onChange:(i,m)=>{t(i),i.length===1&&!Array.isArray(m)&&r.setFieldsValue({[i[0]]:m[i[0]]})},onSave:async(i,m)=>{await Ee({deptId:o,deptName:h.deptName,orderNum:h.orderNum,parentId:0,[i]:m[i]}),y.success("\u4FDD\u5B58\u6210\u529F"),$(),a(),c()}}:void 0;return n?l(M,{spinning:E,children:[s(f,{column:A,editable:b,dataSource:h,columns:[Ce,Se,ye]}),s(w,{}),s(f,{column:A,editable:b,dataSource:h,columns:[Be,d]}),s(w,{}),s(f,{column:A,editable:b,dataSource:h,columns:[Ne,Te,Ie]})]}):s(q,{description:"\u70B9\u51FB\u9009\u62E9\u5DE6\u4FA7\u90E8\u95E8\u9879\u67E5\u770B\u8BE6\u60C5"})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const We=e=>l(B,{children:[s(j,{color:"rgb(148 163 184)",children:e.orderNum}),l(de,{children:[e.deptName,s(j,{color:e.status===C.ENABLE?"success":"error",children:e.status===C.ENABLE?"\u542F\u7528\u4E2D":"\u5DF2\u7981\u7528"})]})]}),Ve=()=>{var p;const[e,t]=g.exports.useState([]),[u,r]=g.exports.useState({}),{data:a,isFetching:c}=qe(u,{onSuccess:d=>{t(d)}}),o=Re(),n=(e==null?void 0:e.length)!==0&&(e==null?void 0:e.length)===((p=a==null?void 0:a.allParentIds)==null?void 0:p.length);return l(B,{children:[l("div",{className:"flex justify-between items-center",children:[s(S,{size:"small",className:"my-2",icon:n?s(ce,{}):s(ne,{}),onClick:()=>t(n?[]:a==null?void 0:a.allParentIds),children:n?"\u5168\u90E8\u6298\u53E0":"\u5168\u90E8\u5C55\u5F00"}),l(ie,{onFinish:async d=>r(d),children:[s(D,{name:"deptName",label:"\u90E8\u95E8\u540D\u79F0"}),s(le,{name:"status",label:"\u72B6\u6001",valueEnum:O})]})]}),a!=null&&a.treeData?s(M,{spinning:c,children:s("div",{className:"h-[calc(100vh-270px)]",children:s(pe,{blockNode:!0,showLine:{showLeafIcon:!1},titleRender:We,treeData:a.treeData,expandedKeys:e,onExpand:t,fieldNames:{title:"deptName",key:"deptId"},onSelect:(d,{selected:h,node:{key:E}})=>{!h||o(E,a.map.get(E).deptName)}})})}):s(q,{})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const et=()=>s(he,{children:l(P,{ghost:!0,gutter:24,children:[s(P,{title:"\u90E8\u95E8\u5217\u8868",colSpan:"500px",extra:s(Me,{}),children:s(Ve,{})}),s(P,{title:"\u90E8\u95E8\u8BE6\u60C5",extra:s(ke,{}),children:s(Qe,{})})]})});export{et as default};
