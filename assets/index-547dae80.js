import{R as U,k as X,r as d,cn as Z,d as t,aB as $,_ as q,ct as B,cw as J,cD as ee,cO as te,ay as ae,cg as O,j as c,ch as L,cP as G,aG as V,cs as E,cQ as H,cR as y,cS as K,aH as D,cT as se,cU as re,a_ as oe,aF as ne,cV as le,h as w,aN as A,cW as ce,cX as ie,cY as ue,v as de,cZ as he,aA as me,cj as pe,ck as ye,cl as ge,c_ as fe,cm as be,av as Me,bi as k}from"./index-5350100f.js";import{useShowModalAdd as Q,useAtomValueSelectedMenuData as R,useDeleteMenu as _,useReFetchMenuList as z,useReFetchMenuOptions as xe,useHideModalAdd as Se,useAtomValueModalAdd as Ce,useQueryMenuOptions as Te,useAtomStateSelectedMenuData as Pe,useResetSelectedMenuData as ve,useQueryMenuList as Fe}from"./index-5068c92a.js";import{c as Ne}from"./index-722ae1ee.js";import{u as we}from"./useRequest-4255831a.js";import{u as W}from"./useMutation.esm-86b49fa0.js";import{P as I}from"./index-e3484bbe.js";import{P as F}from"./index-93cc3606.js";import{P as C}from"./index-a5fd7a5b.js";import{P as Ae}from"./index-46fb540b.js";import{P as ke}from"./index-dc0c226c.js";import{T as f}from"./index-bb697dfd.js";import{l as Ie}from"./index-c98ebc0f.js";import{P as je}from"./index-985407df.js";import"./utils-d9326ed8.js";import"./Skeleton-d49ce276.js";var Ee=["fieldProps","request","params","proFieldProps"],De=function(a,r){var n=a.fieldProps,o=a.request,h=a.params,m=a.proFieldProps,b=X(a,Ee),u=d.exports.useContext(Z);return t($,q({valueType:"cascader",fieldProps:q({getPopupContainer:u.getPopupContainer},n),ref:r,request:o,params:h,filedConfig:{customLightMode:!0},proFieldProps:m},b))};const Re=U.forwardRef(De);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const qe=()=>{const e=Q();return t(B,{accessKey:"system:menu:add",children:t(J,{onClick:e})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Ve=()=>{const{hasSelected:e,selectedMenuId:a,selectedMenuName:r}=R(),n=_();return t(B,{accessKey:"system:menu:remove",children:t(ee,{disabled:!e,type:"primary",size:"middle",onClick:()=>n({menuId:a,menuName:r})})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const j={xs:1,sm:1,md:1,lg:1,xl:2},Be=e=>{const{valueEnumSysNormalDisable:a}=E(),{valueEnumSysShowHide:r}=H();return d.exports.useMemo(()=>{const n=[];return e?(e!==y.F&&n.push({title:"状态",dataIndex:"status",key:"status",valueType:"radio",valueEnum:a},{title:"是否显示",dataIndex:"visible",key:"visible",valueType:"radio",valueEnum:r,tooltip:"选择否则路由将不会出现在侧边栏，但仍然可以访问"},{title:"是否外链",dataIndex:"isFrame",key:"isFrame",valueType:"radio",valueEnum:K,tooltip:"选择是外链则路由地址需要以`http(s)://`开头"},{title:"图标",dataIndex:"icon",key:"icon",valueType:"text",tooltip:"https://ant.design/components/icon-cn/"},{title:"路由地址",dataIndex:"path",key:"path",valueType:"text",tooltip:"访问的路由地址，如：`user`，如外网地址需内链访问则以`http(s)://`开头"}),e===y.C&&n.push({title:"路由参数",dataIndex:"queryParam",key:"queryParam",valueType:"code",tooltip:'访问路由的默认传递参数，如：{"id": 1, "name": "ry"}'}),e!==y.M&&n.push({title:"权限标识",dataIndex:"perms",key:"perms",valueType:"text",copyable:!0}),n):[]},[e])},Oe=()=>{const e=z(),a=xe(),{hasSelected:r,selectedMenuId:n}=R(),{data:o,loading:h,refresh:m}=we(async()=>await te({menuId:n}),{ready:r,refreshDeps:[n]}),{mutateAsync:b}=W(se,{onSuccess:async()=>{await Promise.all([m(),e(),a()]),D.success("保存成功")}}),u=Be(o==null?void 0:o.menuType),x=Ne(),[S]=ae.useForm(),[l,T]=d.exports.useState([]),M=x("system:menu:edit")?{form:S,editableKeys:l,onChange:(s,i)=>{if(T(s),s.length>0){const[p]=s;S.setFieldsValue({[p]:i[p]})}},onSave:async(s,i)=>{const{menuType:p,orderNum:P,menuName:v,menuId:g}=i;await b({menuId:g,menuType:p,orderNum:P,menuName:v,[s]:i[s]})}}:void 0;return r?c(L,{spinning:h,children:[t(I,{columns:[{title:"类型",dataIndex:"menuType",key:"menuType",valueType:"select",valueEnum:G},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime"}],dataSource:o,column:j}),t(V,{}),t(I,{columns:[{title:"名称",dataIndex:"menuName",key:"menuName",valueType:"text"},{title:"排序",dataIndex:"orderNum",key:"orderNum",valueType:"digit"},{title:"备注",dataIndex:"remark",key:"remark",valueType:"textarea"}],dataSource:o,editable:M,column:j}),t(V,{}),t(I,{columns:u,dataSource:o,editable:M,column:j})]}):t(O,{description:"点击选择左侧菜单项查看详情"})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Le=()=>{var M;const e=d.exports.useRef(),a=Se(),r=Ce(),{selectedMenuId:n}=R(),{valueEnumSysNormalDisable:o,defaultValueSysNormalDisable:h}=E(),{valueEnumSysShowHide:m,defaultValueSysShowHide:b}=H(),{data:u,refetch:x}=Te(),S=z(),{isLoading:l,mutate:T}=W(async()=>{var i,p;const s=await((p=(i=e.current)==null?void 0:i.validateFieldsReturnFormatValue)==null?void 0:p.call(i));!s||await ie(s)},{onSuccess:async()=>{var s;await Promise.all([x(),S()]),a(),(s=e.current)==null||s.resetFields(),D.success("新建成功")}});return d.exports.useEffect(()=>{!r||d.exports.startTransition(()=>{var s,i;(i=e.current)==null||i.setFieldsValue({parentId:re((s=u==null?void 0:u.map)!=null?s:new Map,n)})})},[r]),t(oe,{open:r,onCancel:a,title:"新建菜单",width:515,onOk:()=>T(),okButtonProps:{loading:l},children:c(ne,{submitter:!1,formRef:e,children:[t(Re,{name:"parentId",label:"父级菜单",fieldProps:{options:(M=u==null?void 0:u.options)!=null?M:[],fieldNames:{label:"menuName",value:"menuId",children:"children"},changeOnSelect:!0},rules:[{required:!0}],transform:s=>s&&{parentId:s[s.length-1]}}),t(F.Group,{name:"menuType",label:"菜单类型",valueEnum:G,rules:[{required:!0}]}),t(le,{name:["menuType"],children:({menuType:s})=>s?c(w,{children:[c(A,{children:[t(C,{name:"menuName",label:"菜单名称",width:"sm",rules:[{required:!0}]}),t(Ae,{name:"orderNum",label:"显示排序",tooltip:"默认数值为0，数值越大排序越靠后，数值相等按照创建时间先后排序",rules:[{required:!0}],width:"sm",initialValue:0})]}),s!==y.F&&c(w,{children:[c(A,{children:[t(F.Group,{tooltip:"选择停用则路由将不会出现在侧边栏，也不能被访问",name:"status",label:"菜单状态",required:!0,valueEnum:o,initialValue:h}),t(F.Group,{name:"visible",label:"菜单是否显示",valueEnum:m,required:!0,initialValue:b,tooltip:"选择否则路由将不会出现在侧边栏，但仍然可以访问"}),t(F.Group,{name:"isFrame",label:"是否外链",valueEnum:K,required:!0,initialValue:ce.NO,tooltip:"选择是外链则路由地址需要以`http(s)://`开头"})]}),c(A,{children:[t(C,{name:"icon",label:"菜单图标",width:"sm",tooltip:"https://ant.design/components/icon-cn/"}),t(C,{width:"sm",name:"path",label:"路由地址",tooltip:"访问的路由地址，如：`user`，如外网地址需内链访问则以`http(s)://`开头",rules:[{required:!0}]})]})]}),s===y.C&&t(C,{name:"queryParam",label:"路由参数",tooltip:'访问路由的默认传递参数，如：{"id": 1, "name": "ry"}'}),s!==y.M&&t(C,{name:"perms",label:"权限标识"})]}):null}),t(ke,{name:"remark",label:"备注"})]})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Ge=()=>c("div",{className:"mb-2",children:["标签含义：",t(f,{color:"rgb(148 163 184)",children:"显示顺序"}),t(f,{color:N[y.M],children:"目录"}),t(f,{color:N[y.C],children:"菜单"}),t(f,{color:N[y.F],children:"按钮"}),t(f,{children:"权限标识"})]});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const He=e=>c(w,{children:[t(f,{color:"rgb(148 163 184)",children:e.orderNum}),(e==null?void 0:e.icon)&&t(ue,{name:e.icon,className:"mr-1"}),t(f,{color:N[e.menuType],style:{margin:"0 0 2px 0"},children:e.menuName}),(e==null?void 0:e.perms)&&t(f,{style:{margin:"0 0 2px 2px"},children:c(de,{size:"small",children:[e.perms,t("div",{onClick:a=>{a.stopPropagation()},children:t(Ie.CopyToClipboard,{text:e.perms,onCopy:async(a,r)=>{r&&D.success("复制成功")},children:t(he,{style:{color:"#1890ff"}})})})]})})]});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const N={M:"blue",C:"green",F:"red"},Ke={title:"menuName",key:"menuId"},Qe=()=>{var v;const[e,a]=d.exports.useState({}),[r,n]=d.exports.useState(0),[o,h]=d.exports.useState([]),[m,b]=Pe(),u=ve(),x=Q(),{valueEnumSysNormalDisable:S}=E(),{data:l,refetch:T,isFetching:M}=Fe(e,g=>{h(g)}),s=_(),i=(g,{node:{key:Y}})=>{n(Y)},p=({node:g})=>{n(g.key)},P=(o==null?void 0:o.length)&&(o==null?void 0:o.length)===((v=l==null?void 0:l.parentIds)==null?void 0:v.length);return d.exports.useEffect(()=>{T()},[e]),d.exports.useEffect(()=>{r>0?b({hasSelected:!0,selectedMenuId:r,selectedMenuName:l.map.get(r).menuName}):u()},[r]),c(w,{children:[t(Ge,{}),c("div",{className:"flex justify-between items-center",children:[t(me,{size:"small",className:"my-2",icon:P?t(pe,{}):t(ye,{}),onClick:()=>h(P?[]:l==null?void 0:l.parentIds),children:P?"全部折叠":"全部展开"}),c(ge,{onFinish:async g=>{n(0),h([]),a(g)},children:[t(C,{name:"menuName",label:"菜单名称"}),t(je,{name:"status",label:"状态",valueEnum:S})]})]}),t(L,{spinning:M,children:t(fe,{menu:{items:[{label:"新建",key:"create",disabled:!m.hasSelected,onClick:()=>x()},{label:"在根目录下新建",key:"createBase",onClick:()=>{u(),x()}},{label:"删除",key:"delete",danger:!0,disabled:!m.hasSelected,onClick:()=>s({menuId:m.selectedMenuId,menuName:m.selectedMenuName})}]},trigger:["contextMenu"],children:l!=null&&l.treeData.length?t(be,{blockNode:!0,selectedKeys:[r],onSelect:i,expandedKeys:o,titleRender:He,onExpand:h,showLine:{showLeafIcon:!1},fieldNames:Ke,height:700,treeData:l==null?void 0:l.treeData,onRightClick:p}):t(O,{})})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const nt=()=>c(Me,{children:[c(k,{ghost:!0,gutter:[16,16],wrap:!0,children:[t(k,{title:"菜单列表",colSpan:{xxl:8,xl:12,lg:14,md:24,sm:24,xs:24},extra:t(qe,{}),children:t(Qe,{})}),t(k,{title:"菜单详情",extra:t(Ve,{}),colSpan:{xxl:16,xl:12,lg:10,md:24,sm:24,xs:24},className:"h-full",children:t(Oe,{})})]}),t(Le,{})]});export{nt as default};
