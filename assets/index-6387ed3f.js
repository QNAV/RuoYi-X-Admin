import{j as a,d as c,e as C,f as E,L as w,g as S}from"./antdProComponents-1965180d.js";import{r as P,a as l,C as j,u as L,b as k,c as M,s as O,S as p}from"./index-2c084e82.js";import{be as u,aB as N,bg as R,bh as v,bi as x,ba as B,bj as F,ad as I,aD as z,r as f,Y as q}from"./antd-6bc2bb7d.js";import{u as G}from"./useRequest-cc46c8cb.js";import"./iconPark-3c306205.js";import"./wangEditor-f607bedb.js";import"./tslib.es6-3c43c0a4.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const U=()=>{const{message:e}=u.useApp();return a.jsxs("div",{className:"flex flex-col justify-center items-center",children:[a.jsx(N,{plain:!0,children:a.jsx("span",{className:"text-sm font-normal text-neutral-400",children:"其他登录方式"})}),a.jsx("div",{onClick:()=>{e.info("敬请期待")},className:"flex justify-center items-center cursor-pointer rounded-full h-[40px] w-[40px] border-solid border border-gray-300",children:a.jsx(R,{style:{fontSize:"20px",color:"#00ac84"}})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const J=()=>{const{message:e}=u.useApp();return a.jsxs(a.Fragment,{children:[a.jsx(c,{fieldProps:{maxLength:11,size:"large",prefix:a.jsx(v,{})},name:"phoneNumber",placeholder:"请输入手机号",rules:[{required:!0,message:"请输入手机号"},{pattern:P,message:"手机号格式错误"}]}),a.jsx(C,{fieldProps:{size:"large",prefix:a.jsx(x,{})},captchaProps:{size:"large"},placeholder:"请输入验证码",captchaTextRender:(s,n)=>s?`${n} 获取验证码`:"获取验证码",name:"smsCode",rules:[{required:!0,message:"请输入验证码"}],onGetCaptcha:async()=>(e.info("敬请期待"),Promise.reject(new Error("敬请期待")))})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const D=({captchaImageSrc:e,onCaptchaImageClick:s})=>a.jsxs(a.Fragment,{children:[a.jsx(c,{name:"username",fieldProps:{size:"large",prefix:a.jsx(B,{})},placeholder:"admin",initialValue:"admin",rules:[{required:!0,message:"请输入用户名"}]}),a.jsx(c.Password,{name:"password",fieldProps:{size:"large",prefix:a.jsx(x,{})},placeholder:"admin123",initialValue:"admin123",rules:[{required:!0,message:"请输入密码"}]}),a.jsxs(E,{children:[a.jsx(c,{width:160,name:"code",placeholder:"请输入验证码",fieldProps:{size:"large",prefix:a.jsx(F,{})},rules:[{required:!0,message:"请输入验证码"}]}),a.jsx("div",{className:"h-[40px] w-[135px] rounded-md cursor-pointer border border-solid border-gray-300",children:e?a.jsx(I,{src:`data:image/png;base64,${e}`,preview:!1,height:40,width:135,alt:"图片验证码",onClick:s,className:"rounded-md"}):a.jsx(z.Button,{active:!0,block:!0,size:"large"})})]})]});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const H=(e={})=>l({path:"/captchaImage",method:"GET",secure:!0,skipErrorHandler:!1,...e});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const _=(e,s={})=>l({path:"/login",method:"POST",body:e,secure:!0,type:j.Json,skipErrorHandler:!1,...s});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const $=(e,s={})=>l({path:"/smsLogin",method:"POST",body:e,secure:!0,type:j.Json,skipErrorHandler:!1,...s});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const ee=()=>{const[e,s]=f.useState("USERNAME"),n=L(),b=k(),[h]=M(),{data:i,run:g}=G(()=>H({secure:!1})),d=async(t,r)=>{O(t?p.LOCAL_STORAGE:p.SESSION_STORAGE,`Bearer ${r}`),await n(),b(h.get("redirect")??"/")},y=async(t,r)=>{const{token:o}=await $(r);await d(t,o)},{message:m}=u.useApp(),T=async(t,r)=>{if(!i){m.error("请先获取图片验证码");return}const{token:o}=await _({...r,uuid:i.uuid},{secure:!1});await d(t,o)},A=async t=>{try{const{autoLogin:r,...o}=t;if(e==="MOBILE"){await y(r,o);return}if(e==="USERNAME"){await T(r,o);return}}catch{e==="USERNAME"&&g()}};return f.useEffect(()=>{h.get("msg")&&m.error(h.get("msg"))},[]),a.jsx("div",{className:"h-[100vh]",children:a.jsxs(w,{backgroundImageUrl:"https://gw.alipayobjects.com/zos/rmsportal/FfdJeJRQWjEeGTpqgBKj.png",logo:"https://github.githubassets.com/images/modules/logos_page/Octocat.png",title:"RuoYi X Admin",subTitle:"若依后台管理系统",actions:a.jsx(U,{}),onFinish:A,children:[a.jsx(q,{centered:!0,activeKey:e,onChange:t=>s(t),items:[{label:"账号密码登录",key:"USERNAME"},{label:"手机号登录",key:"MOBILE"}]}),e==="USERNAME"&&a.jsx(D,{captchaImageSrc:i==null?void 0:i.img,onCaptchaImageClick:g}),e==="MOBILE"&&a.jsx(J,{}),a.jsx(S,{name:"autoLogin",children:"自动登录"})]})})};export{ee as default};
