import{aY as W,aj as X,ce as k,cf as E,cg as R,r as P,am as L,b9 as A,j as d,af as O,d as t,aA as C,ch as z,a_ as M,aF as Z,aH as v,ci as J,aZ as U,h as w,cj as $,ck as ee,ay as te,cl as ae,cm as q,cn as V,aG as S,co as se,cp as re,cq as oe,cr as ne,cs as ce,v as ie,av as le,bi as T}from"./index-16134bfd.js";import{a as ue,u as de}from"./utils-01d7059a.js";import{u as pe}from"./index-49291d2b.js";import{u as he}from"./useMutation.esm-8903e68d.js";import{P as me}from"./index-c21466f7.js";import{P as ge}from"./index-0e05913c.js";import{P as D}from"./index-dede09e7.js";import{P as fe}from"./index-4128b6b9.js";import{u as ye}from"./useRequest-549104bb.js";import{P as b}from"./index-816d4bcc.js";import{P as De}from"./index-8bcaf1e6.js";import{T as j}from"./index-40aa043e.js";import"./Skeleton-5f587d45.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Q="systemDept",I=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/dept/model/index.ts/atomDeptDetails",ue({open:!1,deptId:0,deptName:""}));I.debugLabel="atomDeptDetails";const _=()=>W(I),Pe=()=>{const e=X(I);return(a,r)=>{e({open:!0,deptId:a,deptName:r})}},Ie=()=>de(I),B=[Q,"list"],Te=(e,a)=>{const r=k(B,async()=>{const o=await E(e),n=R(o,{id:"deptId",pId:"parentId",rootPId:null});return{map:o.reduce((s,i)=>s.set(i.deptId,i),new Map),treeData:n,allParentIds:Array.from(o.reduce((s,i)=>s.add(i.parentId),new Set))}},{onSuccess:o=>{a.onSuccess(o.allParentIds)}});return P.exports.useEffect(()=>{r.refetch()},[e]),r},G=()=>{const e=L();return()=>e.invalidateQueries(B)},K=[Q,"options"],Y=()=>k(K,async()=>{const e=await E({});return R(e,{id:"deptId",pId:"parentId",rootPId:null})}),H=()=>{const e=L();return()=>e.invalidateQueries(K)};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const be=()=>{var u;const e=P.exports.useRef(),[a,{toggle:r}]=pe(),{data:o,refetch:n}=Y(),{data:s}=A("sys_normal_disable"),{mutate:i,isLoading:g}=he(async()=>{var p;const c=await((p=e.current)==null?void 0:p.validateFields());await J(c)},{onSuccess:()=>{var c;v.success("新建成功"),n(),r(),(c=e.current)==null||c.resetFields()}});return d(O,{accessible:!0,children:[t(C,{type:"primary",icon:t(z,{}),onClick:r,children:"新建"}),t(M,{title:"新建部门",okText:"提交",open:a,onCancel:r,onOk:()=>i(),okButtonProps:{loading:g},children:d(Z,{submitter:!1,formRef:e,grid:!0,rowProps:{gutter:[16,0]},children:[t(me,{name:"parentId",label:"上级部门",rules:[{required:!0,message:"请选择上级部门"}],fieldProps:{treeData:o!=null?o:[],fieldNames:{label:"deptName",value:"deptId"}}}),t(D,{name:"deptName",label:"部门名称",rules:[{required:!0}],colProps:{span:12}}),t(ge,{name:"orderNum",label:"显示排序",initialValue:0,rules:[{required:!0}],colProps:{span:12}}),t(D,{name:"leader",label:"负责人",colProps:{span:12}}),t(D,{name:"phone",label:"联系电话",colProps:{span:12}}),t(D,{name:"email",label:"邮箱",colProps:{span:12}}),t(fe.Group,{name:"status",label:"状态",valueEnum:(u=s==null?void 0:s.valueEnum)!=null?u:{},initialValue:s==null?void 0:s.defaultValue,colProps:{span:12}})]})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const xe=()=>{const{deptId:e,deptName:a,open:r}=_(),o=Ie(),n=G(),s=H();return t(O,{accessible:r,children:t(C,{danger:!0,ghost:!0,icon:t(U,{}),onClick:()=>{M.confirm({title:"删除确认",content:d(w,{children:["确定删除部门",t($.Text,{code:!0,children:a}),"吗？"]}),onOk:async()=>{await ee({deptId:e}),v.success("删除成功"),o(),n(),s()}})},children:"删除"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const x={xs:1,sm:1,md:1,lg:1,xl:2},Ae=()=>{var y;const[e,a]=P.exports.useState([]),[r]=te.useForm(),o=G(),n=H(),{deptId:s,open:i}=_(),{data:g}=Y(),{data:u}=A("sys_normal_disable"),{data:c,loading:p,refresh:h}=ye(async()=>{var N;const{ancestors:l,...m}=await ae({deptId:s}),F=(N=l==null?void 0:l.split(","))!=null?N:[];return{...m,ancestors:Number(F[F.length-1])}},{ready:i&&s>0,refreshDeps:[s],onSuccess:()=>{a([])}}),f={form:r,editableKeys:e,onChange:(l,m)=>{a(l),l.length===1&&!Array.isArray(m)&&r.setFieldsValue({[l[0]]:m[l[0]]})},onSave:async(l,m)=>{await se({deptId:s,deptName:c.deptName,orderNum:c.orderNum,parentId:0,[l]:m[l]}),v.success("保存成功"),h(),o(),n()}};return i?d(V,{spinning:p,children:[t(b,{column:x,editable:f,dataSource:c,columns:[{title:"状态",dataIndex:"status",key:"status",valueType:"select",valueEnum:(y=u==null?void 0:u.valueEnum)!=null?y:{}},{title:"排序",dataIndex:"orderNum",key:"orderNum",valueType:"digit"},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime"}]}),t(S,{}),t(b,{column:x,editable:f,dataSource:c,columns:[{title:"部门名称",dataIndex:"deptName",key:"deptName",valueType:"text"},{title:"上级部门",dataIndex:"parentId",key:"parentId",valueType:"treeSelect",fieldProps:{treeData:g,dropdownMatchSelectWidth:250,fieldNames:{label:"deptName",value:"deptId"}}}]}),t(S,{}),t(b,{column:x,editable:f,dataSource:c,columns:[{title:"负责人",dataIndex:"leader",key:"leader",valueType:"text"},{title:"联系电话",dataIndex:"phone",key:"phone",valueType:"text"},{title:"邮箱",dataIndex:"email",key:"email",valueType:"text"}]})]}):t(q,{description:"点击选择左侧部门项查看详情"})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Ce=e=>d(w,{children:[t(j,{color:"rgb(148 163 184)",children:e.orderNum}),d(ie,{children:[e.deptName,t(j,{color:e.status==="0"?"success":"error",children:e.status==="0"?"启用中":"已禁用"})]})]}),ve=()=>{var c,p;const[e,a]=P.exports.useState([]),[r,o]=P.exports.useState({}),{data:n}=A("sys_normal_disable"),{data:s,isFetching:i}=Te(r,{onSuccess:h=>{a(h)}}),g=Pe(),u=(e==null?void 0:e.length)!==0&&(e==null?void 0:e.length)===((c=s==null?void 0:s.allParentIds)==null?void 0:c.length);return d(w,{children:[d("div",{className:"flex justify-between items-center",children:[t(C,{size:"small",className:"my-2",icon:u?t(re,{}):t(oe,{}),onClick:()=>a(u?[]:s==null?void 0:s.allParentIds),children:u?"全部折叠":"全部展开"}),d(ne,{onFinish:async h=>o(h),children:[t(D,{name:"deptName",label:"部门名称"}),t(De,{name:"status",label:"状态",valueEnum:(p=n==null?void 0:n.valueEnum)!=null?p:{},initialValue:n==null?void 0:n.defaultValue})]})]}),s!=null&&s.treeData?t(V,{spinning:i,children:t("div",{className:"h-[calc(100vh-270px)]",children:t(ce,{blockNode:!0,showLine:{showLeafIcon:!1},titleRender:Ce,treeData:s.treeData,expandedKeys:e,onExpand:a,fieldNames:{title:"deptName",key:"deptId"},onSelect:(h,{selected:f,node:{key:y}})=>{!f||g(y,s.map.get(y).deptName)}})})}):t(q,{})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Qe=()=>t(le,{children:d(T,{ghost:!0,gutter:16,children:[t(T,{title:"部门列表",colSpan:"500px",extra:t(be,{}),children:t(ve,{})}),t(T,{title:"部门详情",extra:t(xe,{}),children:t(Ae,{})})]})});export{Qe as default};
