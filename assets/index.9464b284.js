import{aD as P,r as f,j as d,az as C,a as u,aF as l,as as v,aB as c,l as y,aW as w,aX as F,A as B,aY as x,aZ as A,a_ as T,a$ as E,aA as I,b0 as m,T as b}from"./index.d097f68a.js";import{B as D}from"./index.cbc4820e.js";import{a as N,r as j,b as q}from"./regExp.b11de8ba.js";import{u as h,S}from"./useMutation.esm.0381f337.js";import"./keepAlive.ea3ea7ee.js";import{u as U}from"./initialState.a50c2d25.js";import"./utils.esm.d9d6d79c.js";import"./useQuery.esm.5bfefc2d.js";async function O(e,s){return P("/system/user/profile",{method:"POST",headers:{"Content-Type":"application/json"},data:e,...s||{}})}async function k(e,s){return P("/system/user/profile/updatePwd",{method:"POST",headers:{"Content-Type":"application/json"},data:e,...s||{}})}const W=()=>{const e=f.exports.useRef(),{mutate:s,isLoading:n}=h(async()=>{var t;const a=await((t=e==null?void 0:e.current)==null?void 0:t.validateFields());a!==void 0&&await k(a)},{onSuccess:()=>{c.success("\u5BC6\u7801\u4FEE\u6539\u6210\u529F\uFF0C\u5373\u5C06\u81EA\u52A8\u9000\u51FA\u767B\u5F55\u5E76\u8DF3\u8F6C\u81F3\u767B\u5F55\u9875\u9762");const a=setTimeout(()=>{y(),clearTimeout(a)},1500)}});return d(C,{formRef:e,submitter:!1,children:[u(l.Password,{name:"oldPassword",label:"\u65E7\u5BC6\u7801",rules:[{required:!0}],width:"md"}),u(l.Password,{name:"newPassword",label:"\u65B0\u5BC6\u7801",width:"md",rules:[{required:!0},{pattern:N,message:"\u957F\u5EA6\u57286-20\u4E4B\u95F4\uFF0C\u53EA\u80FD\u5305\u542B\u5B57\u6BCD\u3001\u6570\u5B57\u548C\u4E0B\u5212\u7EBF"},({getFieldValue:a})=>({validator(t,o){return o!==a("oldPassword")?Promise.resolve():Promise.reject(new Error("\u65B0\u65E7\u5BC6\u7801\u4E0D\u80FD\u76F8\u540C"))}})]}),u(l.Password,{name:"confirmPassword",label:"\u786E\u8BA4\u5BC6\u7801",width:"md",rules:[{required:!0},({getFieldValue:a})=>({validator(t,o){return!o||a("newPassword")===o?Promise.resolve():Promise.reject(new Error("\u4E24\u6B21\u5BC6\u7801\u8F93\u5165\u4E0D\u4E00\u81F4"))}})]}),u(v,{type:"primary",loading:n,onClick:()=>s(),children:"\u66F4\u65B0\u5BC6\u7801"})]})},z="https://test-ryx-admin-api.p.quicknav.cn/api/sys/profile/update-avatar",L=[{dataIndex:"userName",title:"\u7528\u6237\u540D\u79F0",valueType:"text"},{dataIndex:"deptName",title:"\u6240\u5C5E\u90E8\u95E8",valueType:"text"},{dataIndex:"roleName",title:"\u6240\u5C5E\u89D2\u8272",valueType:"text"},{dataIndex:"createTime",title:"\u521B\u5EFA\u65F6\u95F4",valueType:"text"}],R=[{dataIndex:"nickName",title:"\u7528\u6237\u6635\u79F0",valueType:"text"},{dataIndex:"phoneNumber",title:"\u624B\u673A\u53F7\u7801",valueType:"text",fieldProps:{maxLength:11},formItemProps:{rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7"},{pattern:j,message:"\u624B\u673A\u53F7\u683C\u5F0F\u9519\u8BEF"}]}},{dataIndex:"email",title:"\u90AE\u7BB1",valueType:"text",formItemProps:{rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u90AE\u7BB1"},{pattern:q,message:"\u90AE\u7BB1\u683C\u5F0F\u9519\u8BEF"}]}},{dataIndex:"sex",title:"\u6027\u522B",valueType:"radio",valueEnum:S}],_=()=>{var t,o,p;const{data:e,refetch:s}=U(),n=h(async r=>{await O(r),await s(),c.success("\u4FEE\u6539\u6210\u529F")}),a={onSave:async(r,i)=>{await n.mutateAsync({[r]:i[r]})}};return d(w,{align:"middle",children:[u(F,{span:4,children:d("div",{className:"w-[100px] relative m-auto",children:[u(B,{src:(p=(o=(t=e==null?void 0:e.userInfo)==null?void 0:t.user)==null?void 0:o.avatar)!=null?p:"Avatar",size:100}),u(x,{maxCount:1,showUploadList:!1,name:"avatarfile",accept:"image/jpeg,image/png",action:z,headers:{Authorization:A()},onChange:r=>{if(r.file.status!=="done")return;const{code:i,msg:g}=r.file.response;if(i!==200){c.error(g);return}n.mutate({avatar:r.file.response.data})},children:u(B,{icon:u(T,{}),className:"absolute bottom-0 right-0 bg-blue-500 cursor-pointer"})})]})}),d(F,{span:20,children:[u(E,{columns:L,dataSource:{userName:e==null?void 0:e.userInfo.user.userName,createTime:e==null?void 0:e.userInfo.user.createTime,deptName:e==null?void 0:e.userInfo.user.dept.deptName,roleName:e==null?void 0:e.userInfo.user.roles.map(r=>r.roleName).join("/")}}),u(I,{}),u(E,{columns:R,dataSource:e==null?void 0:e.userInfo.user,editable:a})]})]})},J=()=>{const[e,s]=f.exports.useState("PASSWORD");return u(D,{title:"\u4E2A\u4EBA\u4E2D\u5FC3",children:d(m,{ghost:!0,direction:"column",gutter:[0,24],children:[u(m,{children:u(_,{})}),u(m,{bodyStyle:{paddingTop:0},children:u(b,{activeKey:e,onChange:n=>s(n),items:[{label:"\u5B89\u5168\u8BBE\u7F6E",key:"PASSWORD",children:u(W,{})}]})})]})})};export{J as default};
