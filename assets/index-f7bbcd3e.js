import{g as ee,l as te,d as s,aL as se,_ as O,ad as V,af as R,ag as I,r as w,b3 as p,j as u,bZ as q,aU as ae,bf as oe,aR as S,bg as re,aK as P,b_ as ce,bS as ie,b6 as ne,cv as le,b5 as _,aP as de,b4 as ue,cN as he,c5 as me,aJ as pe,c4 as ge,c9 as be,b7 as Pe,b8 as ye,k as fe,aF as we}from"./index-c1e79eac.js";import{b as g,d as j}from"./index-79c92d7c.js";import{a as Ae}from"./index-6b4dd17a.js";import{a as X,u as Y}from"./utils-43a92cc6.js";import{a2 as Te,a3 as Ce,a4 as K,a5 as Re,a6 as Ie,a7 as Se,a8 as ke,a9 as Me,aa as xe,ab as ve,ac as je}from"./System-b2753a68.js";import{u as A}from"./useRequest-b4998106.js";import{u as k}from"./useMutation.esm-db7dfe63.js";import{P as m}from"./index-cd920aef.js";import{P as Ee}from"./index-e2c34d08.js";import{P as C}from"./index-0451323f.js";import{P as Ne}from"./index-5b6d432a.js";import{u as Fe}from"./index-ac2301e3.js";import{P as De}from"./index-19c8c728.js";import"./utils.esm-bf1583a2.js";import"./index-45c29cec.js";var Ue=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],Be=ee.forwardRef(function(e,t){var r=e.fieldProps,o=e.unCheckedChildren,c=e.checkedChildren,a=e.proFieldProps,i=te(e,Ue);return s(se,O({valueType:"switch",fieldProps:O({unCheckedChildren:o,checkedChildren:c},r),ref:t,valuePropName:"checked",proFieldProps:a,filedConfig:{valuePropName:"checked",ignoreWidth:!0}},i))});const Le=Be;globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const E=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomMainTableActions",V(void 0));E.debugLabel="atomMainTableActions";const W=()=>R(E),Oe=()=>Ae(E),N=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomSelectedDeptId",V(0));N.debugLabel="atomSelectedDeptId";const Ve=()=>R(N),qe=()=>I(N),M=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomResetPwdModal",X({open:!1}));M.debugLabel="atomResetPwdModal";const _e=()=>{const e=I(M);return t=>{e({open:!0,record:t})}},Xe=()=>Y(M),Ye=()=>R(M),T=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomAddOrEditModal",X({open:!1,actionType:"add",userId:0}));T.debugLabel="atomAddOrEditModal";const Ke=()=>{const e=I(T);return()=>{e({open:!0,actionType:"add",userId:0})}},We=()=>{const e=I(T);return t=>{e({open:!0,actionType:"edit",userId:t})}},Ge=()=>Y(T),He=()=>R(T);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const $e=()=>{var D,U,B,L;const{canAddSysUser:e,canEditSysUser:t}=g(),r=w.exports.useRef(),o=W(),{open:c,actionType:a,userId:i}=He(),l=Ge(),F=()=>{var n;a==="edit"&&((n=r.current)==null||n.resetFields()),l()},{data:y}=j("sys_normal_disable"),{data:x}=j("sys_user_sex"),{data:f}=A(async()=>{const{posts:n,roles:d}=await Te({});return{posts:n.reduce((h,b)=>h.set(b.postId,b.postName),new Map),roles:d.reduce((h,b)=>h.set(b.roleId,b.roleName),new Map)}}),{data:H}=A(async()=>(await Ce({configKey:"sys.user.initPassword"})).data.msg),{data:v}=A(()=>K({}),{}),{data:$}=A(async()=>{const{postIds:n,roleIds:d,user:h}=await Re({userId:i});return{...h,postIds:n,roleIds:d}},{ready:c&&a==="edit"&&i>0,onSuccess:n=>{var d;(d=r.current)==null||d.setFieldsValue(n)},refreshDeps:[i]}),{isLoading:z,mutateAsync:J}=k(async()=>{var d,h;const n=await((h=(d=r.current)==null?void 0:d.validateFieldsReturnFormatValue)==null?void 0:h.call(d));if(a==="add"){const{roleIds:b=[],postIds:Q=[],...Z}=n;await Ie({roleIds:b,postIds:Q,...Z})}else await Se({...$,...n,userId:i})},{onSuccess:()=>{var n;l(),o==null||o.reload(),(n=r.current)==null||n.resetFields(),S.success(a==="add"?"新增成功":"编辑成功")}});return s(p,{accessible:e||t,children:u(q,{title:a==="add"?"新增用户":"编辑用户",formRef:r,grid:!0,colProps:{span:12},modalProps:{okText:"提交",onCancel:F,confirmLoading:z},width:600,open:c,onFinish:()=>J(),children:[s(m,{name:"nickName",label:"用户昵称",rules:[{required:!0}]}),s(Ee,{name:"deptId",label:"归属部门",fieldProps:{treeData:v!=null?v:[],fieldNames:{value:"id"}}}),s(m,{name:"phoneNumber",label:"手机号码",rules:[{pattern:ae,message:"手机号码格式错误"}],fieldProps:{maxLength:11}}),s(m,{name:"email",label:"邮箱",rules:[{pattern:oe,message:"邮箱格式错误"}]}),a==="add"&&s(m,{name:"userName",label:"用户名称",rules:[{required:!0}]}),a==="add"&&s(m.Password,{name:"password",label:"用户密码",rules:[{required:!0}],initialValue:H}),s(C,{name:"sex",label:"用户性别",valueEnum:(D=x==null?void 0:x.mapData)!=null?D:{}}),s(C,{name:"status",label:"状态",valueEnum:(U=y==null?void 0:y.mapData)!=null?U:{},rules:[{required:!0}]}),s(C,{name:"postIds",label:"岗位",valueEnum:(B=f==null?void 0:f.posts)!=null?B:{},mode:"multiple",colProps:{span:24}}),s(C,{name:"roleIds",label:"角色",valueEnum:(L=f==null?void 0:f.roles)!=null?L:{},mode:"multiple",colProps:{span:24}}),s(Ne,{name:"remark",label:"备注",colProps:{span:24}})]})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ze=()=>{const{canResetSysUserPwd:e}=g(),t=w.exports.useRef(),r=Xe(),{open:o,record:c}=Ye();return w.exports.useEffect(()=>{var a;if(o){(a=t.current)==null||a.resetFields();const i=setTimeout(()=>{var l;(l=t.current)==null||l.setFieldsValue({userName:c.userName}),clearTimeout(i)},0)}},[o]),s(p,{accessible:e,children:u(q,{title:"重置密码",open:o,formRef:t,modalProps:{onCancel:r},width:500,onFinish:async({password:a})=>{await ke({...c,password:a}),S.success("重置密码成功")},children:[s(m,{name:"userName",label:"用户名称",readonly:!0}),s(m.Password,{required:!0,name:"password",label:"新密码",rules:[{required:!0,message:"请输入新密码"},{pattern:re,message:"密码长度应在6-20之间，只能包含字母、数字和下划线"}]}),s(m.Password,{required:!0,name:"confirmPassword",label:"确认密码",rules:[{required:!0,message:"请输入确认密码"},({getFieldsValue:a})=>({validator(i,l){return!l||a().password===l?Promise.resolve():Promise.reject(new Error("两次输入的密码不一致"))}})]})]})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Je=()=>{const{canAddSysUser:e}=g(),t=Ke();return s(p,{accessible:e,children:s(P,{type:"primary",icon:s(ce,{}),onClick:t,children:"新增"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Qe=({userId:e})=>{const{canEditSysUser:t}=g(),r=We();return s(p,{accessible:t,children:s(P,{type:"link",icon:s(ie,{}),onClick:()=>r(e),children:"编辑"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ze=({searchParams:e})=>{const{canExportSysUser:t}=g(),{isLoading:r,mutate:o}=k(()=>Me(e),{onSuccess:()=>{S.success("导出成功")}});return s(p,{accessible:t,children:s(P,{icon:s(ne,{}),loading:r,onClick:()=>o(),children:"导出"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const et=()=>{const{canImportSysUser:e}=g(),t=w.exports.useRef(),[r,{toggle:o}]=Fe(),{mutate:c,isLoading:a}=k(()=>xe());return u(p,{accessible:e,children:[s(P,{icon:s(le,{}),onClick:o,children:"导入"}),u(_,{title:"导入用户",open:r,onCancel:o,children:[s("div",{className:"text-right",children:s(P,{type:"link",onClick:()=>c(),loading:a,children:"下载模板"})}),u(de,{layout:"horizontal",submitter:!1,formRef:t,children:[s(Le,{name:"isCover",label:"是否更新已经存在的用户数据"}),s(De,{name:"list"})]})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const G=({userId:e,isBatch:t,disabled:r})=>{const o=t?"批量删除":"删除",{canRemoveSysUser:c}=g(),a=W(),{mutateAsync:i,isLoading:l}=k(()=>ve({userIds:e}),{onSuccess:()=>{var y;a==null||a.reload(),(y=a==null?void 0:a.clearSelected)==null||y.call(a),S.success("删除成功")}});return s(p,{accessible:c,children:s(P,{type:"link",danger:!0,disabled:r,icon:s(ue,{}),onClick:()=>{_.confirm({title:"删除用户",content:`确定删除用户编号为 ${e} 的数据吗？`,onOk:()=>i(),okButtonProps:{loading:l}})},children:o})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const tt=({record:e})=>{const{canResetSysUserPwd:t}=g(),r=_e();return s(p,{accessible:t,children:s(P,{type:"link",danger:!0,icon:s(he,{}),onClick:()=>r(e),children:"重置密码"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const st=()=>{const[e,t]=w.exports.useState(""),r=qe(),{data:o,loading:c}=A(()=>K({deptName:e}),{refreshDeps:[e],debounceWait:500});return u(me,{spinning:c,children:[s(pe.Search,{allowClear:!0,placeholder:"请输入部门名称",className:"mb-3",onSearch:a=>{t(a)}}),!o||o.length===0?s(ge,{}):s(be,{treeData:o,defaultExpandAll:!0,fieldNames:{title:"label",key:"id"},onSelect:(a,{node:{key:i}})=>{r(i)},blockNode:!0})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const at=()=>{var t;const{data:e}=j("sys_normal_disable");return[{dataIndex:"userId",key:"userId",title:"用户编号",valueType:"text",hideInSearch:!0},{dataIndex:"userName",key:"userName",title:"用户名称",valueType:"text"},{dataIndex:"nickName",key:"nickName",title:"用户昵称",valueType:"text",hideInSearch:!0},{dataIndex:["dept","deptName"],key:"deptDeptName",title:"部门名称",valueType:"text",hideInSearch:!0},{dataIndex:"phoneNumber",key:"phoneNumber",title:"手机号码",valueType:"text",copyable:!0},{title:"状态",dataIndex:"status",key:"status",valueType:"select",valueEnum:(t=e==null?void 0:e.mapData)!=null?t:{}},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",hideInSearch:!0,sorter:!0},{title:"操作",valueType:"option",render:(r,o)=>o.userId===1?null:u(fe,{children:[s(Qe,{userId:o.userId}),s(G,{userId:o.userId}),s(tt,{record:o})]}),fixed:"right",width:300},{title:"创建时间",dataIndex:"createTimeRange",key:"createTimeRange",valueType:"dateTimeRange",hideInTable:!0}]},ot=({selectedRows:e})=>s(G,{disabled:e.length===0,isBatch:!0,userId:e.map(t=>t.userId).join(",")}),rt=(e,t)=>u("div",{className:"flex gap-4",children:[s("div",{className:"bg-white p-4",children:s(st,{})}),s("div",{className:"overflow-auto w-full",children:t})]}),ct=()=>{const e=Oe(),[t,r]=w.exports.useState({}),o=at(),c=Ve(),a=c>0?{deptId:c}:{};return s(Pe,{rowKey:"userId",actionRef:e,columns:o,params:a,request:async(...i)=>{const l=ye(...i);return r(l),await je(l)},toolbar:{actions:[s(Ze,{searchParams:t},"ButtonExport"),s(et,{},"ButtonImport"),s(Je,{},"ButtonAdd")]},tableRender:rt,tableAlertOptionRender:ot})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Tt=()=>u(we,{children:[s(ct,{}),s($e,{}),s(ze,{})]});export{Tt as default};
