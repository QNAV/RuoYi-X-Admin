import{j as a}from"./antdProComponents-1965180d.js";import{e as S,f as k,h as j,F as B,A as d,l as M,aA as R,b as P,G as N,a8 as y,d as A,m as f,B as D}from"./index-2c084e82.js";import{a as L,u as O}from"./utils-e1e68311.js";import{b as K,c as E,d as G,e as _,f as H,h as Y,i as q}from"./Tool-fbbc59e9.js";import{be as u,B as m,bs as F,r as T,bt as X,ay as C,bu as $,bv as V,a7 as W,Y as z,as as J}from"./antd-6bc2bb7d.js";import{u as p}from"./useMutation-f0283657.js";import{u as U}from"./index-28715962.js";import{u as Q}from"./useRequest-cc46c8cb.js";import{H as Z}from"./highlight-d719af13.js";import{l as ee}from"./index-c50b6b4b.js";import"./iconPark-3c306205.js";import"./wangEditor-f607bedb.js";import"./tslib.es6-3c43c0a4.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const x=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/tool/gen/model/index.ts/atomMainTableActions",S(void 0));x.debugLabel="atomMainTableActions";const te=()=>k(x),v=()=>j(x),b=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/tool/gen/model/index.ts/atomSelectedTableId",L({open:!1}));b.debugLabel="atomSelectedTableId";const ae=()=>j(b),se=()=>{const e=B(b);return t=>{e({open:!0,previewId:t})}},oe=()=>O(b);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const I=({tableIds:e,batch:t=!1,disabled:o=!1})=>{const{message:n,modal:l}=u.useApp(),s=v(),{mutate:i,isLoading:r}=p(K,{onSuccess:()=>{var c;s==null||s.reload(),(c=s==null?void 0:s.clearSelected)==null||c.call(s),n.success("删除成功")}}),h=()=>{l.confirm({title:"删除代码",content:`确定删除 表ID ${e.join(",")} 生成的代码吗？`,okButtonProps:{loading:r},onOk:()=>i({tableIds:e})})};return a.jsx(d,{accessKey:"tool:gen:remove",children:a.jsx(M,{batch:t,disabled:o,onClick:h})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ie=async e=>{const{data:t}=await E({tables:e},{format:"blob"});R.saveAs(new Blob([t],{type:"application/zip"}),`ruoyi_${new Date().getTime()}`)},w=({tableName:e,batch:t=!1,disabled:o=!1})=>{const n=t?"批量下载":"下载",{message:l}=u.useApp(),{isLoading:s,mutate:i}=p(ie,{onSuccess:()=>{l.success("下载成功")}});return a.jsx(d,{accessKey:"tool:gen:query",children:a.jsx(m,{loading:s,onClick:()=>i(e),type:"link",icon:a.jsx(F,{}),disabled:o,children:n})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ce=({tableId:e})=>{const t=P();return a.jsx(d,{accessKey:"tool:gen:edit",children:a.jsx(N,{onClick:()=>t(`/tool/gen-edit/${e}`)})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ne=[{title:"序号",dataIndex:"index",key:"index",valueType:"indexBorder"},{title:"表名称",dataIndex:"tableName",key:"tableName",valueType:"text"},{title:"表描述",dataIndex:"tableComment",key:"tableComment",valueType:"text"},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",hideInSearch:!0,sorter:!0},{title:"更新时间",dataIndex:"updateTime",key:"updateTime",valueType:"dateTime",hideInSearch:!0,sorter:!0},{title:"创建时间",dataIndex:"createTimeRange",key:"createTimeRange",valueType:"dateTimeRange",hideInTable:!0}],le=()=>{const e=T.useRef(),t=v(),[o,{toggle:n}]=U(),[l,s]=T.useState([]),{message:i}=u.useApp(),{mutate:r,isLoading:h}=p(_,{onSuccess:()=>{var c,g;t==null||t.reload(),n(),i.success("导入成功"),(g=(c=e.current)==null?void 0:c.clearSelected)==null||g.call(c)}});return a.jsxs(y,{accessible:!0,children:[a.jsx(m,{type:"primary",onClick:n,icon:a.jsx(X,{}),children:"导入"}),a.jsx(C,{open:o,onCancel:n,title:"导入表结构",onOk:()=>r({tables:l}),width:900,okText:"提交",confirmLoading:h,okButtonProps:{disabled:l.length===0},children:a.jsx(A,{ghost:!0,actionRef:e,columns:ne,rowKey:"tableName",search:{filterType:"light"},rowSelection:{alwaysShowAlert:!0,onChange:c=>{s(c)}},tableAlertOptionRender:!1,options:!1,request:(...c)=>G(f(...c))})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const re=({tableId:e})=>{const t=se();return a.jsx(d,{accessKey:"tool:gen:preview",children:a.jsx(m,{onClick:()=>t(e),type:"link",icon:a.jsx($,{}),children:"预览"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const he=({tableName:e})=>{const{message:t}=u.useApp(),{isLoading:o,mutate:n}=p(H,{onSuccess:()=>{t.success("同步成功")}});return a.jsx(d,{accessKey:"tool:gen:code",children:a.jsx(m,{loading:o,type:"link",icon:a.jsx(V,{}),onClick:()=>n({tableName:e}),children:"同步"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const de=()=>{const e=oe(),{open:t,previewId:o}=ae(),{message:n}=u.useApp(),{data:l,loading:s}=Q(async()=>{const i=await Y({tableId:o});return Object.keys(i).map(r=>({key:r,content:i[r],highlightContent:Z.highlightAuto(i[r]).value}))},{ready:t&&!!o,refreshDeps:[o]});return a.jsx(y,{accessible:!0,children:a.jsx(C,{open:t,onCancel:e,width:"90%",footer:!1,title:"预览代码",bodyStyle:{height:"700px"},children:a.jsx(W,{spinning:s,children:a.jsx(z,{tabPosition:"left",items:(l==null?void 0:l.map(({key:i,content:r,highlightContent:h})=>({key:i,label:i,children:a.jsxs("div",{className:"relative",children:[a.jsx(ee.CopyToClipboard,{text:r,onCopy:(c,g)=>{g&&n.success("复制成功")},children:a.jsx(m,{icon:a.jsx(J,{}),type:"link",className:"absolute top-[-5px] right-2",children:"复制代码"})}),a.jsx("pre",{children:a.jsx("code",{children:a.jsx("div",{className:"h-[650px] overflow-auto",dangerouslySetInnerHTML:{__html:h}})})})]})})))??[]})})})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ue=[{title:"序号",dataIndex:"index",key:"index",valueType:"indexBorder"},{title:"表名称",dataIndex:"tableName",key:"tableName",valueType:"text"},{title:"表描述",dataIndex:"tableComment",key:"tableComment",valueType:"text"},{title:"实体名称",dataIndex:"className",key:"className",valueType:"text",hideInSearch:!0},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",hideInSearch:!0,sorter:!1},{title:"更新时间",dataIndex:"updateTime",key:"updateTime",valueType:"dateTime",hideInSearch:!0,sorter:!0},{title:"创建时间",dataIndex:"createTimeRange",key:"createTimeRange",valueType:"dateTimeRange",hideInTable:!0},{title:"操作",valueType:"option",render:(e,t)=>a.jsxs(a.Fragment,{children:[a.jsx(re,{tableId:t.tableId}),a.jsx(ce,{tableId:t.tableId}),a.jsx(he,{tableName:t.tableName}),a.jsx(w,{tableName:t.tableName}),a.jsx(I,{tableIds:[t.tableId]})]})}],me=({selectedRows:e,selectedRowKeys:t})=>a.jsxs(a.Fragment,{children:[a.jsx(I,{tableIds:t,batch:!0,disabled:t.length===0}),a.jsx(w,{tableName:e.map(({tableName:o})=>o).join(","),batch:!0,disabled:t.length===0})]}),Se=()=>{const e=te();return a.jsxs(D,{children:[a.jsx(A,{rowKey:"tableId",actionRef:e,tableAlertOptionRender:me,columns:ue,toolbar:{actions:[a.jsx(le,{},"ButtonImport")]},request:(...t)=>q(f(...t))}),a.jsx(de,{})]})};export{Se as default};
