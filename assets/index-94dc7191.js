import{j as s,h as m,F as h,i as x}from"./antdProComponents-1965180d.js";import{bk as v,bl as T,Z as I,A as b,I as g,bm as k,bn as N,ad as f,B as E}from"./index-2c084e82.js";import{aB as j,F as A,r as p,B as d,aG as C,b8 as F,aF as S,be as B}from"./antd-6bc2bb7d.js";import{g as D,a as w}from"./Tool-fbbc59e9.js";import{u as O}from"./useRequest-cc46c8cb.js";import{u as P}from"./useMutation-f0283657.js";import"./iconPark-3c306205.js";import"./wangEditor-f607bedb.js";import"./tslib.es6-3c43c0a4.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Q=({dataSource:e,handleEdit:a})=>{const{valueEnumSysGenType:i}=v(),{valueEnumSysTplCategory:o}=T(),t=I()("tool:gen:edit")?{onSave:async(r,u)=>{const n=r;await a({[n]:u[n]})}}:void 0;return s.jsxs(s.Fragment,{children:[s.jsx(m,{dataSource:e,columns:[{title:"表名称",dataIndex:"tableName",key:"tableName",valueType:"text"},{title:"表描述",dataIndex:"tableComment",key:"tableComment",valueType:"text"},{title:"实体名称",dataIndex:"className",key:"className",valueType:"text",hideInSearch:!0},{title:"作者",dataIndex:"functionAuthor",key:"functionAuthor",valueType:"text"},{title:"备注",dataIndex:"remark",key:"remark",valueType:"textarea",hideInSearch:!0}],editable:t}),s.jsx(j,{}),s.jsx(m,{columns:[{title:"生成模版",dataIndex:"tplCategory",key:"tplCategory",valueType:"select",valueEnum:o},{title:"生成包路径",dataIndex:"packageName",key:"packageName",valueType:"text"},{title:"生成模块名",dataIndex:"moduleName",key:"moduleName",valueType:"text"},{title:"生成业务名",dataIndex:"businessName",key:"businessName",valueType:"text"},{title:"生成功能名",dataIndex:"functionName",key:"functionName",valueType:"text"},{title:"生成代码方式",dataIndex:"genType",key:"genType",valueType:"select",valueEnum:i},...(e==null?void 0:e.genType)==="ZIP"?[]:[{title:"自定义路径",dataIndex:"genPath",key:"genPath",valueType:"text"}]],dataSource:e,editable:t})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const _=()=>{const{valueEnumSysYesNo:e}=g(),{valueEnumSysQueryType:a}=k(),{valueEnumSysJavaType:i}=N();return[{title:"序号",dataIndex:"sort",valueType:"indexBorder",editable:!1},{title:"字段名称",dataIndex:"columnName",key:"columnName",valueType:"text",editable:!1,ellipsis:!0},{title:"字段描述",dataIndex:"columnComment",key:"columnComment",valueType:"text"},{title:"物理类型",dataIndex:"columnType",key:"columnType",valueType:"text",editable:!1,ellipsis:!0},{title:"JAVA类型",dataIndex:"javaType",key:"javaType",valueType:"select",valueEnum:i},{title:"JAVA属性",dataIndex:"javaField",key:"javaField",valueType:"text"},{title:"插入",dataIndex:"isInsert",key:"isInsert",valueType:"radioButton",valueEnum:e},{title:"编辑",dataIndex:"isEdit",key:"isEdit",valueType:"radioButton",valueEnum:e},{title:"列表",dataIndex:"isList",key:"isList",valueType:"radioButton",valueEnum:e},{title:"查询",dataIndex:"isQuery",key:"isQuery",valueType:"radioButton",valueEnum:e},{title:"必填",dataIndex:"isRequired",key:"isRequired",valueType:"radioButton",valueEnum:e},{title:"查询方式",dataIndex:"queryType",key:"queryType",valueType:"select",valueEnum:a}]},L=({dataSource:e,handleEdit:a,loading:i=!1})=>{const[o]=A.useForm(),[l,t]=p.useState([]),r=(l==null?void 0:l.length)>0,u=_();return s.jsx(h,{toolbar:{actions:r?[s.jsx(d,{onClick:()=>t([]),icon:s.jsx(C,{}),children:"取消编辑"},"cancelEdit"),s.jsx(d,{type:"primary",loading:i,icon:s.jsx(F,{}),onClick:async()=>{const n=await o.validateFields();await a({columns:Object.keys(n).map(c=>({...n[c],columnId:Number(c)}))}),t([])},children:"保存"},"edit")]:[s.jsx(b,{accessKey:"tool:gen:edit",children:s.jsx(d,{icon:s.jsx(S,{}),type:"primary",onClick:()=>{t(e.map(n=>n.columnId.toString()))},children:"编辑"})},"edit")]},rowKey:"columnId",ghost:!0,size:"small",scroll:{x:"max-content"},columns:u,value:e,recordCreatorProps:!1,editable:{form:o,editableKeys:l}})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const y={BASE_INFO:"基本信息",FIELD_INFO:"字段信息"},z=()=>{const e=f(),a=Number((e==null?void 0:e.tableId)??"0"),{message:i}=B.useApp(),[o,l]=p.useState("BASE_INFO"),{data:t,refresh:r}=O(()=>D({tableId:a}),{ready:a>0,refreshDeps:[a]}),{mutateAsync:u,isLoading:n}=P(async c=>{await w({tableId:a,businessName:t.info.businessName,functionName:t.info.functionName,className:t.info.className,functionAuthor:t.info.functionAuthor,moduleName:t.info.moduleName,packageName:t.info.packageName,tableComment:t.info.tableComment,tableName:t.info.tableName,columns:t.rows,...c})},{onSuccess:()=>{r(),i.success("保存成功")}});return s.jsx(E,{children:s.jsx(x,{tabs:{items:[{label:y.BASE_INFO,key:"BASE_INFO",children:s.jsx(Q,{dataSource:t==null?void 0:t.info,handleEdit:u})},{label:y.FIELD_INFO,key:"FIELD_INFO",children:s.jsx(L,{dataSource:t==null?void 0:t.rows,handleEdit:u,loading:n})}],activeKey:o,onChange:c=>{l(c)}}})})};export{z as default};
