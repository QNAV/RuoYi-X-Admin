import{r as f,j as i,a as t,F as N}from"./jsx-runtime-06f68cbc.js";import{bI as X,bc as R,aI as H,ag as A,be as J,bM as U,aC as Z,bN as j,aT as k,aJ as C,Y as _,bO as $,bP as ee,bQ as te,bR as ae,q as se,ay as oe,aU as S}from"./index-6fe704bc.js";import{A as E}from"./index-2a88ac4e.js";import{g as v}from"./index-512b82d5.js";import{c as re,u as ne,a as L,l as M,m as ce,n as ie,o as le,p as de}from"./react-8fc26eed.js";import{p as B}from"./index-58ea63b0.js";import{w as O}from"./utils-1fed7460.js";import{a as ue,u as me}from"./utils-75bcec49.js";import{u as pe}from"./index-66e83bf7.js";import{u as q}from"./useMutation-72610ef8.js";import{P as he}from"./index-6f4415e8.js";import{P as ge}from"./index-9016438e.js";import{P as y}from"./index-1e5188af.js";import{P as ye}from"./index-90b56d94.js";import{a as fe}from"./index-431aa2ed.js";import{u as De}from"./useRequest-30b64258.js";import{P as T}from"./index-a0a0d2e8.js";import{P as be}from"./index-11252502.js";import{T as F}from"./index-ee04e3d6.js";import"./mutation-2d78eeb5.js";import"./index-92527557.js";import"./Skeleton-a9073bed.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Q="systemDept",P=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/dept/model/index.ts/atomDeptDetails",ue({open:!1,deptId:0,deptName:""}));P.debugLabel="atomDeptDetails";const V=()=>re(P),Pe=()=>{const e=ne(P);return(a,o)=>{e({open:!0,deptId:a,deptName:o})}},Ie=()=>me(P),K=[Q,"list"],Se=(e,a)=>{const o=L(K,async()=>{const n=await M(e);return{treeData:B(n,{id:"deptId",pId:"parentId",rootPId:null}),map:n.reduce((s,r)=>s.set(r.deptId,r),new Map),allParentIds:Array.from(n.reduce((s,r)=>s.add(r.parentId),new Set))}},{onSuccess:n=>{a.onSuccess(n.allParentIds)}});return f.useEffect(()=>{o.refetch()},[e]),o},W=()=>{const e=O();return()=>e.invalidateQueries(K)},Y=[Q,"options"],z=()=>L(Y,async()=>{const e=await M({});return B(e,{id:"deptId",pId:"parentId",rootPId:null})}),G=()=>{const e=O();return()=>e.invalidateQueries(Y)};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Te=()=>{const e=f.useRef(),[a,{toggle:o}]=pe(),{data:n,refetch:u}=z(),{defaultValueSysNormalDisable:s,valueEnumSysNormalDisable:r}=v(),{mutate:p,isLoading:m}=q(async()=>{var d;const l=await((d=e.current)==null?void 0:d.validateFields());await ce(l)},{onSuccess:async()=>{var l;o(),(l=e.current)==null||l.resetFields(),u(),A.success("新增成功")}});return i(E,{accessKey:"system:dept:add",children:[t(X,{onClick:o}),t(R,{title:"新增部门",okText:"提交",open:a,onCancel:o,onOk:()=>p(),okButtonProps:{loading:m},children:i(H,{submitter:!1,formRef:e,grid:!0,rowProps:{gutter:[16,0]},children:[t(he,{name:"parentId",label:"上级部门",rules:[{required:!0,message:"请选择上级部门"}],fieldProps:{treeData:n??[],fieldNames:{label:"deptName",value:"deptId"}}}),t(y,{name:"deptName",label:"部门名称",rules:[{required:!0}],colProps:{span:12}}),t(ge,{name:"orderNum",label:"显示排序",initialValue:0,rules:[{required:!0}],colProps:{span:12}}),t(y,{name:"leader",label:"负责人",colProps:{span:12}}),t(y,{name:"phone",label:"联系电话",colProps:{span:12}}),t(y,{name:"email",label:"邮箱",colProps:{span:12}}),t(ye.Group,{name:"status",label:"状态",valueEnum:r,initialValue:s,colProps:{span:12}})]})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const xe=()=>{const{deptId:e,deptName:a,open:o}=V(),n=Ie(),u=W(),s=G();return t(E,{accessKey:"system:dept:remove",children:t(J,{disabled:!o,type:"primary",size:"middle",onClick:()=>{R.confirm({title:"删除确认",content:i(N,{children:["确定删除部门",t(U.Text,{code:!0,children:a}),"吗？"]}),onOk:async()=>{await ie({deptId:e}),await Promise.all([n(),u(),s()]),A.success("删除成功")}})}})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const x={xs:1,sm:1,md:1,lg:1,xl:2},Ne=()=>{const e=W(),a=G(),{deptId:o,open:n}=V(),{data:u}=z(),{valueEnumSysNormalDisable:s}=v(),{data:r,loading:p,refresh:m}=De(async()=>{const{ancestors:c,...h}=await le({deptId:o}),g=(c==null?void 0:c.split(","))??[];return{...h,ancestors:Number(g[g.length-1])}},{ready:n&&o>0,refreshDeps:[o],onSuccess:()=>{w([])}}),{mutateAsync:l}=q(de,{onSuccess:async()=>{m(),await Promise.all([e(),a()]),A.success("保存成功")}}),d=fe(),[D]=Z.useForm(),[b,w]=f.useState([]),I=d("system:dept:edit")?{form:D,editableKeys:b,onChange:(c,h)=>{if(w(c),c.length>0){const[g]=c;D.setFieldsValue({[g]:h[g]})}},onSave:async(c,h)=>{await l({deptId:o,deptName:r.deptName,orderNum:r.orderNum,parentId:r.parentId,[c]:h[c]})}}:void 0;return n?i(k,{spinning:p,children:[t(T,{column:x,editable:I,dataSource:r,columns:[{title:"状态",dataIndex:"status",key:"status",valueType:"select",valueEnum:s},{title:"排序",dataIndex:"orderNum",key:"orderNum",valueType:"digit"},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",editable:!1}]}),t(C,{}),t(T,{column:x,editable:I,dataSource:r,columns:[{title:"部门名称",dataIndex:"deptName",key:"deptName",valueType:"text"},{title:"上级部门",dataIndex:"parentId",key:"parentId",valueType:"treeSelect",fieldProps:{treeData:u,dropdownMatchSelectWidth:250,fieldNames:{label:"deptName",value:"deptId"}}}]}),t(C,{}),t(T,{column:x,editable:I,dataSource:r,columns:[{title:"负责人",dataIndex:"leader",key:"leader",valueType:"text"},{title:"联系电话",dataIndex:"phone",key:"phone",valueType:"text"},{title:"邮箱",dataIndex:"email",key:"email",valueType:"text"}]})]}):t(j,{description:"点击选择左侧部门项查看详情"})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Ae=e=>i(N,{children:[t(F,{color:"rgb(148 163 184)",children:e.orderNum}),i(se,{children:[e.deptName,t(F,{color:e.status==="0"?"success":"error",children:e.status==="0"?"启用中":"已禁用"})]})]}),ve=()=>{var l;const[e,a]=f.useState([]),[o,n]=f.useState({}),{valueEnumSysNormalDisable:u}=v(),{data:s,isFetching:r}=Se(o,{onSuccess:d=>{a(d)}}),p=Pe(),m=(e==null?void 0:e.length)!==0&&(e==null?void 0:e.length)===((l=s==null?void 0:s.allParentIds)==null?void 0:l.length);return i(N,{children:[i("div",{className:"flex justify-between items-center",children:[t(_,{size:"small",className:"my-2",icon:m?t($,{}):t(ee,{}),onClick:()=>a(m?[]:s==null?void 0:s.allParentIds),children:m?"全部折叠":"全部展开"}),i(te,{onFinish:async d=>n(d),children:[t(y,{name:"deptName",label:"部门名称"}),t(be,{name:"status",label:"状态",valueEnum:u})]})]}),t(k,{spinning:r,children:s!=null&&s.treeData.length?t(ae,{blockNode:!0,showLine:{showLeafIcon:!1},titleRender:Ae,treeData:s.treeData,expandedKeys:e,onExpand:a,height:700,fieldNames:{title:"deptName",key:"deptId"},onSelect:(d,{selected:D,node:{key:b}})=>{D&&p(b,s.map.get(b).deptName)}}):t(j,{})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Ue=()=>t(oe,{children:i(S,{ghost:!0,gutter:[16,16],wrap:!0,children:[t(S,{title:"部门列表",colSpan:{xxl:8,xl:12,lg:14,md:24,sm:24,xs:24},extra:t(Te,{}),children:t(ve,{})}),t(S,{title:"部门详情",colSpan:{xxl:16,xl:12,lg:10,md:24,sm:24,xs:24},className:"h-full",extra:t(xe,{}),children:t(Ne,{})})]})});export{Ue as default};
