import{l as H,n as J,aJ as j,r as D,q as k,g as d,af as L,j as t,ag as I,aC as U,ai as R,W as $,$ as m,az as Z,aK as B,aL as S,Y as P,ah as _,F as T,aF as ee,aM as te,aN as M,aO as O,au as F,X as w,aP as ae,aQ as se,aR as ue,aS as re,aT as oe,aU as v,aV as ne,I as ce,ax as f}from"./index.78e6d167.js";import{a as x}from"./index.3d32bccd.js";import{S as q,a as ie,b as le,c as de,d as pe}from"./SysDeptService.ed5af7af.js";import{a as he,u as me}from"./utils.578df49d.js";import{u as W}from"./useQuery.esm.82a3f304.js";import{P as De}from"./index.be2bd2ce.js";import{W as Ee}from"./index.c26e84a7.js";import{u as ge}from"./index.8444e60b.js";import{u as ye}from"./useMutation.esm.dfcb9615.js";import{u as Ae}from"./useRequest.9d48ca5c.js";import"./SysLoginService.33e65324.js";import"./utils.esm.55fd1c23.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Q="systemDept",g=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/dept/model/index.ts/AtomDeptDetails",he({open:!1,deptId:0,deptName:""}));g.debugLabel="AtomDeptDetails";const V=()=>H(g),Fe=()=>{const e=J(g);return(a,o)=>{e({open:!0,deptId:a,deptName:o})}},fe=()=>me(g),K=[Q,"list"],be=(e,a)=>{const o=W(K,async()=>{const u=await q(e),s=j(u,{id:"deptId",pId:"parentId",rootPId:null});return{map:u.reduce((c,r)=>c.set(r.deptId,r),new Map),treeData:s,allParentIds:Array.from(u.reduce((c,r)=>c.add(r.parentId),new Set))}},{onSuccess:u=>{a.onSuccess(u.allParentIds)}});return D.exports.useEffect(()=>{o.refetch()},[e]),o},X=()=>{const e=k();return()=>e.invalidateQueries(K)},Y=[Q,"options"],z=()=>W(Y,async()=>{const e=await q({});return j(e,{id:"deptId",pId:"parentId",rootPId:null})}),G=()=>{const e=k();return()=>e.invalidateQueries(Y)};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Se=()=>{const e=x(),a=D.exports.useRef(),[o,{toggle:u}]=ge(),{data:s,refetch:c}=z(),{mutate:r,isLoading:l}=ye(async()=>{var n;const p=await((n=a.current)==null?void 0:n.validateFields());await ie(p)},{onSuccess:()=>{var p;P.success("\u65B0\u5EFA\u6210\u529F"),c(),u(),(p=a.current)==null||p.resetFields()}});return d(L,{accessible:e.canAddSysDept,children:[t(I,{type:"primary",icon:t(U,{}),onClick:u,children:"\u65B0\u5EFA"}),t(R,{title:"\u65B0\u5EFA\u90E8\u95E8",okText:"\u63D0\u4EA4",open:o,onCancel:u,onOk:()=>r(),okButtonProps:{loading:l},children:d($,{submitter:!1,formRef:a,grid:!0,rowProps:{gutter:[16,0]},children:[t(Ee,{name:"parentId",label:"\u4E0A\u7EA7\u90E8\u95E8",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u4E0A\u7EA7\u90E8\u95E8"}],fieldProps:{treeData:s!=null?s:[],fieldNames:{label:"deptName",value:"deptId"}}}),t(m,{name:"deptName",label:"\u90E8\u95E8\u540D\u79F0",rules:[{required:!0}],colProps:{span:12}}),t(De,{name:"orderNum",label:"\u663E\u793A\u6392\u5E8F",initialValue:0,rules:[{required:!0}],colProps:{span:12}}),t(m,{name:"leader",label:"\u8D1F\u8D23\u4EBA",colProps:{span:12}}),t(m,{name:"phone",label:"\u8054\u7CFB\u7535\u8BDD",colProps:{span:12}}),t(m,{name:"email",label:"\u90AE\u7BB1",colProps:{span:12}}),t(Z.Group,{name:"status",label:"\u72B6\u6001",valueEnum:B,initialValue:S.ENABLE,colProps:{span:12}})]})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Ie=()=>{const e=x(),{deptId:a,deptName:o,open:u}=V(),s=fe(),c=X(),r=G(),l=()=>{R.confirm({title:"\u5220\u9664\u786E\u8BA4",content:d(T,{children:["\u786E\u5B9A\u5220\u9664\u90E8\u95E8",t(ee.Text,{code:!0,children:o}),"\u5417\uFF1F"]}),onOk:async()=>{await le({deptId:a}),P.success("\u5220\u9664\u6210\u529F"),s(),c(),r()}})};return t(L,{accessible:u&&e.canRemoveSysDept,children:t(I,{danger:!0,ghost:!0,icon:t(_,{}),onClick:l,children:"\u5220\u9664"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const b={xs:1,sm:1,md:1,lg:1,xl:2},Be=()=>{const[e,a]=D.exports.useState([]),o=x(),[u]=te.useForm(),s=X(),c=G(),{deptId:r,open:l}=V(),{data:p}=z(),{data:n,loading:y,refresh:E}=Ae(async()=>{var N;const{ancestors:i,...h}=await de({deptId:r}),C=(N=i==null?void 0:i.split(","))!=null?N:[];return{...h,ancestors:Number(C[C.length-1])}},{ready:l&&r>0,refreshDeps:[r],onSuccess:()=>{a([])}}),A=o!=null&&o.canEditSysDept?{form:u,editableKeys:e,onChange:(i,h)=>{a(i),i.length===1&&!Array.isArray(h)&&u.setFieldsValue({[i[0]]:h[i[0]]})},onSave:async(i,h)=>{await pe({deptId:r,deptName:n.deptName,orderNum:n.orderNum,parentId:0,[i]:h[i]}),P.success("\u4FDD\u5B58\u6210\u529F"),E(),s(),c()}}:void 0;return l?d(O,{spinning:y,children:[t(F,{column:b,editable:A,dataSource:n,columns:[{title:"\u72B6\u6001",dataIndex:"status",key:"status",valueType:"select",valueEnum:B},{title:"\u6392\u5E8F",dataIndex:"orderNum",key:"orderNum",valueType:"digit"},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createTime",key:"createTime",valueType:"dateTime",editable:!1,hideInSearch:!0}]}),t(w,{}),t(F,{column:b,editable:A,dataSource:n,columns:[{title:"\u90E8\u95E8\u540D\u79F0",dataIndex:"deptName",key:"deptName",valueType:"text"},{title:"\u4E0A\u7EA7\u90E8\u95E8",dataIndex:"parentId",key:"parentId",valueType:"treeSelect",fieldProps:{treeData:p,dropdownMatchSelectWidth:250,fieldNames:{label:"deptName",value:"deptId"}}}]}),t(w,{}),t(F,{column:b,editable:A,dataSource:n,columns:[{title:"\u8D1F\u8D23\u4EBA",dataIndex:"leader",key:"leader",valueType:"text"},{title:"\u8054\u7CFB\u7535\u8BDD",dataIndex:"phone",key:"phone",valueType:"text"},{title:"\u90AE\u7BB1",dataIndex:"email",key:"email",valueType:"text"}]})]}):t(M,{description:"\u70B9\u51FB\u9009\u62E9\u5DE6\u4FA7\u90E8\u95E8\u9879\u67E5\u770B\u8BE6\u60C5"})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Pe=e=>d(T,{children:[t(v,{color:"rgb(148 163 184)",children:e.orderNum}),d(ne,{children:[e.deptName,t(v,{color:e.status===S.ENABLE?"success":"error",children:e.status===S.ENABLE?"\u542F\u7528\u4E2D":"\u5DF2\u7981\u7528"})]})]}),Te=()=>{var p;const[e,a]=D.exports.useState([]),[o,u]=D.exports.useState({}),{data:s,isFetching:c}=be(o,{onSuccess:n=>{a(n)}}),r=Fe(),l=(e==null?void 0:e.length)!==0&&(e==null?void 0:e.length)===((p=s==null?void 0:s.allParentIds)==null?void 0:p.length);return d(T,{children:[d("div",{className:"flex justify-between items-center",children:[t(I,{size:"small",className:"my-2",icon:l?t(ae,{}):t(se,{}),onClick:()=>a(l?[]:s==null?void 0:s.allParentIds),children:l?"\u5168\u90E8\u6298\u53E0":"\u5168\u90E8\u5C55\u5F00"}),d(ue,{onFinish:async n=>u(n),children:[t(m,{name:"deptName",label:"\u90E8\u95E8\u540D\u79F0"}),t(re,{name:"status",label:"\u72B6\u6001",valueEnum:B})]})]}),s!=null&&s.treeData?t(O,{spinning:c,children:t("div",{className:"h-[calc(100vh-270px)]",children:t(oe,{blockNode:!0,showLine:{showLeafIcon:!1},titleRender:Pe,treeData:s.treeData,expandedKeys:e,onExpand:a,fieldNames:{title:"deptName",key:"deptId"},onSelect:(n,{selected:y,node:{key:E}})=>{!y||r(E,s.map.get(E).deptName)}})})}):t(M,{})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const We=()=>t(ce,{children:d(f,{ghost:!0,gutter:24,children:[t(f,{title:"\u90E8\u95E8\u5217\u8868",colSpan:"500px",extra:t(Se,{}),children:t(Te,{})}),t(f,{title:"\u90E8\u95E8\u8BE6\u60C5",extra:t(Ie,{}),children:t(Be,{})})]})});export{We as default};
