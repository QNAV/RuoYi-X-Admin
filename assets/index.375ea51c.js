import{b5 as be,j as y,a as l,aV as Z,r as F,a7 as M,aR as he,l as q,bU as Ne,z as ge,_ as Ce,cb as X,h as ye,b3 as H,aH as k,cV as Fe,g as $,F as W,aL as Re,a$ as we,bY as Te,bK as xe,n as Pe,p as z,D as m,U as Ie,aT as _e,a6 as Ee,d1 as Ve,c5 as De,d2 as Be,cW as $e,aI as ke}from"./index.8f1c6cac.js";import{B as Ae}from"./index.182ea047.js";import{c as Oe}from"./common.3b9362bd.js";import{C as Ke,a as Se,b as je,c as Ge,d as Le,e as Me,f as pe,g as Ye,h as qe,i as Xe,j as He,k as We,l as ze,m as Je,n as Qe,o as Ue,p as Ze,q as en,r as nn,s as an,t as rn,u as tn,v as on,G as ln,w as un}from"./GenService.e7c40af3.js";import{G as dn,u as sn}from"./useMutation.68745c0a.js";import{P as J}from"./index.3b70e101.js";import{P as G}from"./index.f8dae27b.js";import{P as cn}from"./Table.39616be6.js";import"./RouteContext.dd810695.js";import"./index.98fb7196.js";import"./index.c821283e.js";/* empty css              */import"./Tree.050e6fe1.js";import"./unstated-next.543c3371.js";var mn=["onTableChange","maxLength","formItemProps","recordCreatorProps","rowKey","controlled","defaultValue","onChange","editableFormRef"],vn=["record","position","creatorButtonText","newRecordType","parentKey","style"],ee=M.createContext(void 0);function ne(e){var c=e.children,h=e.record,R=e.position,t=e.newRecordType,f=e.parentKey,N=F.exports.useContext(ee);return M.cloneElement(c,l(l({},c.props),{},{onClick:function(){var v=Pe(z().mark(function C(V){var T,_,b,B;return z().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(T=(_=c.props).onClick)===null||T===void 0?void 0:T.call(_,V);case 2:if(B=a.sent,B!==!1){a.next=5;break}return a.abrupt("return");case 5:N==null||(b=N.current)===null||b===void 0||b.addEditRecord(h,{position:R,newRecordType:t,parentKey:f});case 6:case"end":return a.stop()}},C)}));function g(C){return v.apply(this,arguments)}return g}()}))}function Q(e){var c,h,R=he(),t=e.onTableChange,f=e.maxLength;e.formItemProps;var N=e.recordCreatorProps,v=e.rowKey;e.controlled;var g=e.defaultValue;e.onChange;var C=e.editableFormRef,V=q(e,mn),T=Ne(e.value),_=F.exports.useRef(),b=F.exports.useRef();F.exports.useImperativeHandle(V.actionRef,function(){return _.current});var B=ge(function(){return e.value||g||[]},{value:e.value,onChange:e.onChange}),A=Ce(B,2),a=A[0],ie=A[1],x=M.useMemo(function(){return typeof v=="function"?v:function(d,n){return d[v]||n}},[v]),p=function(n){if(typeof n=="number"&&!e.name){if(n>=a.length)return n;var i=a&&a[n];return x==null?void 0:x(i,n)}if((typeof n=="string"||n>=a.length)&&e.name){var r=a.findIndex(function(o,u){var s;return(x==null||(s=x(o,u))===null||s===void 0?void 0:s.toString())===(n==null?void 0:n.toString())});return r}return n};F.exports.useImperativeHandle(C,function(){var d=function(r){var o,u;if(r==null)throw new Error("rowIndex is required");var s=p(r),w=[e.name,(o=s==null?void 0:s.toString())!==null&&o!==void 0?o:""].flat(1).filter(Boolean);return(u=b.current)===null||u===void 0?void 0:u.getFieldValue(w)},n=function(){var r,o=[e.name].flat(1).filter(Boolean);if(Array.isArray(o)&&o.length===0){var u,s=(u=b.current)===null||u===void 0?void 0:u.getFieldsValue();return Array.isArray(s)?s:Object.keys(s).map(function(w){return s[w]})}return(r=b.current)===null||r===void 0?void 0:r.getFieldValue(o)};return l(l({},b.current),{},{getRowData:d,getRowsData:n,setRowData:function(r,o){var u,s,w,S;if(r==null)throw new Error("rowIndex is required");var j=p(r),me=[e.name,(u=j==null?void 0:j.toString())!==null&&u!==void 0?u:""].flat(1).filter(Boolean),ve=((s=b.current)===null||s===void 0||(w=s.getFieldsValue)===null||w===void 0?void 0:w.call(s))||{},fe=X(ve,me,l(l({},d(r)),o||{}));return(S=b.current)===null||S===void 0?void 0:S.setFieldsValue(fe)}})}),F.exports.useEffect(function(){!e.controlled||a.forEach(function(d,n){var i;(i=b.current)===null||i===void 0||i.setFieldsValue(ye({},x(d,n),d))},{})},[a,e.controlled]),F.exports.useEffect(function(){if(e.name){var d;b.current=e==null||(d=e.editable)===null||d===void 0?void 0:d.form}},[(c=e.editable)===null||c===void 0?void 0:c.form,e.name]);var P=N||{},re=P.record,O=P.position,te=P.creatorButtonText,oe=P.newRecordType,le=P.parentKey,ue=P.style,de=q(P,vn),Y=O==="top",D=F.exports.useMemo(function(){return f&&f<=(a==null?void 0:a.length)?!1:N!==!1&&y(ne,{record:H(re,a==null?void 0:a.length,a)||{},position:O,parentKey:H(le,a==null?void 0:a.length,a),newRecordType:oe,children:y(k,l(l({type:"dashed",style:l({display:"block",margin:"10px 0",width:"100%"},ue),icon:y(Fe,{})},de),{},{children:te||R.getMessage("editableTable.action.add","\u6DFB\u52A0\u4E00\u884C\u6570\u636E")}))})},[N,f,a==null?void 0:a.length]),se=F.exports.useMemo(function(){return D?Y?{components:{header:{wrapper:function(n){var i,r=n.className,o=n.children;return $("thead",{className:r,children:[o,$("tr",{style:{position:"relative"},children:[y("td",{colSpan:0,style:{visibility:"hidden"},children:D}),y("td",{style:{position:"absolute",left:0,width:"100%"},colSpan:(i=V.columns)===null||i===void 0?void 0:i.length,children:D})]})]})}}}}:{tableViewRender:function(n,i){var r,o;return $(W,{children:[(r=(o=e.tableViewRender)===null||o===void 0?void 0:o.call(e,n,i))!==null&&r!==void 0?r:i,D]})}}:{}},[Y,D]),K=l({},e.editable),ce=Re(function(d,n){var i,r,o;if((i=e.editable)===null||i===void 0||(r=i.onValuesChange)===null||r===void 0||r.call(i,d,n),(o=e.onValuesChange)===null||o===void 0||o.call(e,n,d),e.controlled){var u;e==null||(u=e.onChange)===null||u===void 0||u.call(e,n)}});return((e==null?void 0:e.onValuesChange)||((h=e.editable)===null||h===void 0?void 0:h.onValuesChange)||e.controlled&&(e==null?void 0:e.onChange))&&(K.onValuesChange=ce),$(W,{children:[y(ee.Provider,{value:_,children:y(cn,l(l(l({search:!1,options:!1,pagination:!1,rowKey:v,revalidateOnFocus:!1},V),se),{},{tableLayout:"fixed",actionRef:_,onChange:t,editable:l(l({},K),{},{formProps:l({formRef:b},K.formProps)}),dataSource:a,onDataSourceChange:function(n){if(ie(n),e.name&&O==="top"){var i,r=X({},[e.name].flat(1).filter(Boolean),n);(i=b.current)===null||i===void 0||i.setFieldsValue(r)}}}))}),e.name?y(we,{name:[e.name],children:function(n){var i,r,o=Te(n,[e.name].flat(1)),u=o==null?void 0:o.find(function(s,w){return!xe(s,T==null?void 0:T[w])});return u&&T&&(e==null||(i=e.editable)===null||i===void 0||(r=i.onValuesChange)===null||r===void 0||r.call(i,u,o)),null}}):null]})}function ae(e){var c=be.useFormInstance();return e.name?y(Z.Item,l(l({style:{maxWidth:"100%"}},e==null?void 0:e.formItemProps),{},{name:e.name,children:y(Q,l(l({},e),{},{editable:l(l({},e.editable),{},{form:c})}))})):y(Q,l({},e))}ae.RecordCreator=ne;var L="/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/tool/gen-edit/components/DescBase.tsx";const fn=({dataSource:e,handleEdit:c})=>{const h={onSave:async(R,t)=>{const f=R;await c({[f]:t[f]})}};return m(Ie,{children:[m(J,{dataSource:e,columns:[Ke,Se,je,Ge,Oe],editable:h},void 0,!1,{fileName:L,lineNumber:36,columnNumber:7},void 0),m(_e,{},void 0,!1,{fileName:L,lineNumber:42,columnNumber:7},void 0),m(J,{columns:[Le,Me,pe,Ye,qe,Xe,...(e==null?void 0:e.genType)===dn.ZIP?[]:[He]],dataSource:e,editable:h},void 0,!1,{fileName:L,lineNumber:44,columnNumber:7},void 0)]},void 0,!0)};var I="/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/tool/gen-edit/components/EditableTableField.tsx";const bn=({dataSource:e,handleEdit:c,loading:h=!1})=>{const[R]=Z.useForm(),[t,f]=F.exports.useState([]),N=(t==null?void 0:t.length)>0;return m(ae,{toolbar:{actions:N?[m(k,{onClick:()=>f([]),icon:m(Ee,{},void 0,!1,{fileName:I,lineNumber:37,columnNumber:85},void 0),children:"\u53D6\u6D88\u7F16\u8F91"},"cancelEdit",!1,{fileName:I,lineNumber:37,columnNumber:15},void 0),m(k,{type:"primary",loading:h,icon:m(Ve,{},void 0,!1,{fileName:I,lineNumber:44,columnNumber:23},void 0),onClick:async()=>{const v=await R.validateFields();await c({columns:Object.keys(v).map(g=>({...v[g],columnId:Number(g)}))}),f([])},children:"\u4FDD\u5B58"},"edit",!1,{fileName:I,lineNumber:40,columnNumber:15},void 0)]:[m(k,{icon:m(De,{},void 0,!1,{fileName:I,lineNumber:62,columnNumber:23},void 0),type:"primary",onClick:()=>{e&&f(e==null?void 0:e.map(v=>{var g,C;return(C=(g=v==null?void 0:v.columnId)==null?void 0:g.toString())!=null?C:""}))},children:"\u7F16\u8F91"},"edit",!1,{fileName:I,lineNumber:61,columnNumber:15},void 0)]},rowKey:"columnId",ghost:!0,size:"small",scroll:{x:"max-content"},columns:[We,ze,Je,Qe,Ue,Ze,en,nn,an,rn,tn,on],value:e,recordCreatorProps:!1,editable:{form:R,editableKeys:t}},void 0,!1,{fileName:I,lineNumber:33,columnNumber:5},void 0)};var E="/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/tool/gen-edit/index.tsx";const U={BASE_INFO:"\u57FA\u672C\u4FE1\u606F",FIELD_INFO:"\u5B57\u6BB5\u4FE1\u606F"},Vn=()=>{var g;const e=Be(),c=Number((g=e==null?void 0:e.tableId)!=null?g:"0"),[h,R]=F.exports.useState("BASE_INFO"),{data:t,refresh:f}=$e(async()=>await ln({tableId:c}),{ready:c>0,refreshDeps:[c]}),{mutateAsync:N,isLoading:v}=sn(async C=>{await un({tableId:c,businessName:t.info.businessName,functionName:t.info.functionName,className:t.info.className,functionAuthor:t.info.functionAuthor,moduleName:t.info.moduleName,packageName:t.info.packageName,tableComment:t.info.tableComment,tableName:t.info.tableName,columns:t.rows,...C})},{onSuccess:()=>{f(),ke.success("\u4FDD\u5B58\u6210\u529F")}});return m(Ae,{children:m(G,{tabs:{activeKey:h,onChange:C=>{R(C)}},children:[m(G.TabPane,{tab:U.BASE_INFO,children:m(fn,{dataSource:t==null?void 0:t.info,handleEdit:N},void 0,!1,{fileName:E,lineNumber:78,columnNumber:11},void 0)},"BASE_INFO",!1,{fileName:E,lineNumber:77,columnNumber:9},void 0),m(G.TabPane,{tab:U.FIELD_INFO,children:m(bn,{dataSource:t==null?void 0:t.rows,handleEdit:N,loading:v},void 0,!1,{fileName:E,lineNumber:82,columnNumber:11},void 0)},"FIELD_INFO",!1,{fileName:E,lineNumber:81,columnNumber:9},void 0)]},void 0,!0,{fileName:E,lineNumber:69,columnNumber:7},void 0)},void 0,!1,{fileName:E,lineNumber:68,columnNumber:5},void 0)};export{Vn as default};
