import{aY as X,aj as z,c9 as E,ca as L,cb as R,r as P,am as O,b9 as A,j as u,af as M,d as t,aA as C,c1 as Z,a_ as q,aF as J,aH as w,cc as U,aZ as $,h as F,cd as ee,ce as te,ay as ae,cf as se,cg as B,ch as V,aG as S,ci as re,cj as oe,ck as ne,cl as ce,cm as ie,v as le,cn as j,av as de,bi as I}from"./index-7f681476.js";import{a as ue,u as pe}from"./utils-e8f2fb88.js";import{u as he}from"./index-cc04e692.js";import{u as me}from"./useMutation.esm-7d696c9c.js";import{P as ge}from"./index-13c38efa.js";import{P as fe}from"./index-12a23fbc.js";import{P as D}from"./index-7c403b4b.js";import{P as ye}from"./index-48038fd1.js";import{u as De}from"./useRequest-04edb49c.js";import{P as T}from"./index-45ecf108.js";import{P as Pe}from"./index-d28aff72.js";import{T as k}from"./index-c9548b83.js";import"./Skeleton-a1e70e2d.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Q="systemDept",b=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/dept/model/index.ts/atomDeptDetails",ue({open:!1,deptId:0,deptName:""}));b.debugLabel="atomDeptDetails";const _=()=>X(b),be=()=>{const e=z(b);return(a,r)=>{e({open:!0,deptId:a,deptName:r})}},Ie=()=>pe(b),G=[Q,"list"],Te=(e,a)=>{const r=E(G,async()=>{const o=await L(e),n=R(o,{id:"deptId",pId:"parentId",rootPId:null});return{map:o.reduce((s,i)=>s.set(i.deptId,i),new Map),treeData:n,allParentIds:Array.from(o.reduce((s,i)=>s.add(i.parentId),new Set))}},{onSuccess:o=>{a.onSuccess(o.allParentIds)}});return P.exports.useEffect(()=>{r.refetch()},[e]),r},K=()=>{const e=O();return()=>e.invalidateQueries(G)},Y=[Q,"options"],H=()=>E(Y,async()=>{const e=await L({});return R(e,{id:"deptId",pId:"parentId",rootPId:null})}),W=()=>{const e=O();return()=>e.invalidateQueries(Y)};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const xe=()=>{var d;const e=P.exports.useRef(),[a,{toggle:r}]=he(),{data:o,refetch:n}=H(),{data:s}=A("sys_normal_disable"),{mutate:i,isLoading:g}=me(async()=>{var p;const c=await((p=e.current)==null?void 0:p.validateFields());await U(c)},{onSuccess:()=>{var c;w.success("新建成功"),n(),r(),(c=e.current)==null||c.resetFields()}});return u(M,{accessible:!0,children:[t(C,{type:"primary",icon:t(Z,{}),onClick:r,children:"新建"}),t(q,{title:"新建部门",okText:"提交",open:a,onCancel:r,onOk:()=>i(),okButtonProps:{loading:g},children:u(J,{submitter:!1,formRef:e,grid:!0,rowProps:{gutter:[16,0]},children:[t(ge,{name:"parentId",label:"上级部门",rules:[{required:!0,message:"请选择上级部门"}],fieldProps:{treeData:o!=null?o:[],fieldNames:{label:"deptName",value:"deptId"}}}),t(D,{name:"deptName",label:"部门名称",rules:[{required:!0}],colProps:{span:12}}),t(fe,{name:"orderNum",label:"显示排序",initialValue:0,rules:[{required:!0}],colProps:{span:12}}),t(D,{name:"leader",label:"负责人",colProps:{span:12}}),t(D,{name:"phone",label:"联系电话",colProps:{span:12}}),t(D,{name:"email",label:"邮箱",colProps:{span:12}}),t(ye.Group,{name:"status",label:"状态",valueEnum:(d=s==null?void 0:s.mapData)!=null?d:{},initialValue:s==null?void 0:s.defaultValue,colProps:{span:12}})]})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Ae=()=>{const{deptId:e,deptName:a,open:r}=_(),o=Ie(),n=K(),s=W();return t(M,{accessible:r,children:t(C,{danger:!0,ghost:!0,icon:t($,{}),onClick:()=>{q.confirm({title:"删除确认",content:u(F,{children:["确定删除部门",t(ee.Text,{code:!0,children:a}),"吗？"]}),onOk:async()=>{await te({deptId:e}),w.success("删除成功"),o(),n(),s()}})},children:"删除"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const x={xs:1,sm:1,md:1,lg:1,xl:2},Ce=()=>{var y;const[e,a]=P.exports.useState([]),[r]=ae.useForm(),o=K(),n=W(),{deptId:s,open:i}=_(),{data:g}=H(),{data:d}=A("sys_normal_disable"),{data:c,loading:p,refresh:h}=De(async()=>{var v;const{ancestors:l,...m}=await se({deptId:s}),N=(v=l==null?void 0:l.split(","))!=null?v:[];return{...m,ancestors:Number(N[N.length-1])}},{ready:i&&s>0,refreshDeps:[s],onSuccess:()=>{a([])}}),f={form:r,editableKeys:e,onChange:(l,m)=>{a(l),l.length===1&&!Array.isArray(m)&&r.setFieldsValue({[l[0]]:m[l[0]]})},onSave:async(l,m)=>{await re({deptId:s,deptName:c.deptName,orderNum:c.orderNum,parentId:0,[l]:m[l]}),w.success("保存成功"),h(),o(),n()}};return i?u(V,{spinning:p,children:[t(T,{column:x,editable:f,dataSource:c,columns:[{title:"状态",dataIndex:"status",key:"status",valueType:"select",valueEnum:(y=d==null?void 0:d.mapData)!=null?y:{}},{title:"排序",dataIndex:"orderNum",key:"orderNum",valueType:"digit"},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime"}]}),t(S,{}),t(T,{column:x,editable:f,dataSource:c,columns:[{title:"部门名称",dataIndex:"deptName",key:"deptName",valueType:"text"},{title:"上级部门",dataIndex:"parentId",key:"parentId",valueType:"treeSelect",fieldProps:{treeData:g,dropdownMatchSelectWidth:250,fieldNames:{label:"deptName",value:"deptId"}}}]}),t(S,{}),t(T,{column:x,editable:f,dataSource:c,columns:[{title:"负责人",dataIndex:"leader",key:"leader",valueType:"text"},{title:"联系电话",dataIndex:"phone",key:"phone",valueType:"text"},{title:"邮箱",dataIndex:"email",key:"email",valueType:"text"}]})]}):t(B,{description:"点击选择左侧部门项查看详情"})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const we=e=>u(F,{children:[t(k,{color:"rgb(148 163 184)",children:e.orderNum}),u(le,{children:[e.deptName,t(k,{color:e.status===j.ENABLE?"success":"error",children:e.status===j.ENABLE?"启用中":"已禁用"})]})]}),Fe=()=>{var c,p;const[e,a]=P.exports.useState([]),[r,o]=P.exports.useState({}),{data:n}=A("sys_normal_disable"),{data:s,isFetching:i}=Te(r,{onSuccess:h=>{a(h)}}),g=be(),d=(e==null?void 0:e.length)!==0&&(e==null?void 0:e.length)===((c=s==null?void 0:s.allParentIds)==null?void 0:c.length);return u(F,{children:[u("div",{className:"flex justify-between items-center",children:[t(C,{size:"small",className:"my-2",icon:d?t(oe,{}):t(ne,{}),onClick:()=>a(d?[]:s==null?void 0:s.allParentIds),children:d?"全部折叠":"全部展开"}),u(ce,{onFinish:async h=>o(h),children:[t(D,{name:"deptName",label:"部门名称"}),t(Pe,{name:"status",label:"状态",valueEnum:(p=n==null?void 0:n.mapData)!=null?p:{},initialValue:n==null?void 0:n.defaultValue})]})]}),s!=null&&s.treeData?t(V,{spinning:i,children:t("div",{className:"h-[calc(100vh-270px)]",children:t(ie,{blockNode:!0,showLine:{showLeafIcon:!1},titleRender:we,treeData:s.treeData,expandedKeys:e,onExpand:a,fieldNames:{title:"deptName",key:"deptId"},onSelect:(h,{selected:f,node:{key:y}})=>{!f||g(y,s.map.get(y).deptName)}})})}):t(B,{})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Qe=()=>t(de,{children:u(I,{ghost:!0,gutter:16,children:[t(I,{title:"部门列表",colSpan:"500px",extra:t(xe,{}),children:t(Fe,{})}),t(I,{title:"部门详情",extra:t(Ae,{}),children:t(Ce,{})})]})});export{Qe as default};
