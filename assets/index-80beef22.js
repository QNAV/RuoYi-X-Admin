import{j as a,P as X,v as Y,R as $,a1 as R,a2 as j,a3 as k,a4 as L,a5 as I,a as u,A as E,Z,d as J,a6 as U,y as _,F as x,a7 as ee,a8 as te,a9 as ae,aa as M,ab as se,ac as re,B as oe,n as T}from"./index-b5eebe28.js";import{e as ne,k as ce,g as le,r as P,bg as N,aH as ie,V as de,M as ue,ai as q,aL as w,B as pe,b8 as me,b9 as he,a$ as ge,bp as C,ah as ye}from"./antd-f7a9cbdb.js";import{a as fe,u as De}from"./utils-2835fcdf.js";import{u as Pe}from"./index-942a5fdd.js";import{u as B}from"./useMutation-cb32f323.js";import{P as be}from"./index-f6ff2bbf.js";import{P as Se}from"./index-b2d143af.js";import{P as D}from"./index-843b2515.js";import{u as Te}from"./useRequest-238e95e7.js";import{P as A}from"./index-b65ca6ac.js";import{P as Ae}from"./index-ddc152a2.js";import"./@icon-park/react-8ab893b5.js";import"./@wangeditor/editor-2b25ac2d.js";var ve=["fieldProps","request","params","proFieldProps"],Ie=function(t,o){var r=t.fieldProps,l=t.request,s=t.params,n=t.proFieldProps,c=ce(t,ve);return a(X,le({valueType:"treeSelect",fieldProps:r,ref:o,request:l,params:s,filedConfig:{customLightMode:!0},proFieldProps:n},c))},xe=ne.forwardRef(Ie);const Ne=xe;globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const O="systemDept",b=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/dept/model/index.ts/atomDeptDetails",fe({open:!1,deptId:0,deptName:""}));b.debugLabel="atomDeptDetails";const Q=()=>Y(b),Fe=()=>{const e=$(b);return(t,o)=>{e({open:!0,deptId:t,deptName:o})}},we=()=>De(b),V=[O,"list"],Ce=(e,t)=>{const o=R(V,async()=>{const r=await j(e);return{treeData:k(r,{id:"deptId",pId:"parentId",rootPId:null}),map:r.reduce((s,n)=>s.set(n.deptId,n),new Map),allParentIds:Array.from(r.reduce((s,n)=>s.add(n.parentId),new Set))}},{onSuccess:r=>{t.onSuccess(r.allParentIds)}});return P.useEffect(()=>{o.refetch()},[e]),o},K=()=>{const e=L();return()=>e.invalidateQueries(V)},W=[O,"options"],z=()=>R(W,async()=>{const e=await j({});return k(e,{id:"deptId",pId:"parentId",rootPId:null})}),G=()=>{const e=L();return()=>e.invalidateQueries(W)};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Re=()=>{const{message:e}=N.useApp(),t=P.useRef(),[o,{toggle:r}]=Pe(),{data:l,refetch:s}=z(),{defaultValueSysNormalDisable:n,valueEnumSysNormalDisable:c}=I(),{mutate:p,isLoading:m}=B(async()=>{var h;const i=await((h=t.current)==null?void 0:h.validateFields());await U(i)},{onSuccess:async()=>{var i;r(),(i=t.current)==null||i.resetFields(),s(),e.success("新增成功")}});return u(E,{accessKey:"system:dept:add",children:[a(Z,{onClick:r}),a(ie,{title:"新增部门",okText:"提交",open:o,onCancel:r,onOk:()=>p(),okButtonProps:{loading:m},children:u(J,{submitter:!1,formRef:t,grid:!0,rowProps:{gutter:[16,0]},children:[a(Ne,{name:"parentId",label:"上级部门",rules:[{required:!0,message:"请选择上级部门"}],fieldProps:{treeData:l??[],fieldNames:{label:"deptName",value:"deptId"}}}),a(D,{name:"deptName",label:"部门名称",rules:[{required:!0}],colProps:{span:12}}),a(be,{name:"orderNum",label:"显示排序",initialValue:0,rules:[{required:!0}],colProps:{span:12}}),a(D,{name:"leader",label:"负责人",colProps:{span:12}}),a(D,{name:"phone",label:"联系电话",colProps:{span:12}}),a(D,{name:"email",label:"邮箱",colProps:{span:12}}),a(Se.Group,{name:"status",label:"状态",valueEnum:c,initialValue:n,colProps:{span:12}})]})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const je=()=>{const{deptId:e,deptName:t,open:o}=Q(),r=we(),l=K(),s=G(),{message:n,modal:c}=N.useApp();return a(E,{accessKey:"system:dept:remove",children:a(_,{disabled:!o,type:"primary",size:"middle",onClick:()=>{c.confirm({title:"删除确认",content:u(x,{children:["确定删除部门",a(de.Text,{code:!0,children:t}),"吗？"]}),onOk:async()=>{await ee({deptId:e}),await Promise.all([r(),l(),s()]),n.success("删除成功")}})}})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const v={xs:1,sm:1,md:1,lg:1,xl:2},ke=()=>{const e=K(),t=G(),{message:o}=N.useApp(),{deptId:r,open:l}=Q(),{data:s}=z(),{valueEnumSysNormalDisable:n}=I(),{data:c,loading:p,refresh:m}=Te(async()=>{const{ancestors:d,...y}=await te({deptId:r}),f=(d==null?void 0:d.split(","))??[];return{...y,ancestors:Number(f[f.length-1])}},{ready:l&&r>0,refreshDeps:[r],onSuccess:()=>{F([])}}),{mutateAsync:i}=B(se,{onSuccess:async()=>{m(),await Promise.all([e(),t()]),o.success("保存成功")}}),h=ae(),[g]=ue.useForm(),[H,F]=P.useState([]),S=h("system:dept:edit")?{form:g,editableKeys:H,onChange:(d,y)=>{if(F(d),d.length>0){const[f]=d;g.setFieldsValue({[f]:y[f]})}},onSave:async(d,y)=>{await i({deptId:r,deptName:c.deptName,orderNum:c.orderNum,parentId:c.parentId,[d]:y[d]})}}:void 0;return l?u(q,{spinning:p,children:[a(A,{column:v,editable:S,dataSource:c,columns:[{title:"状态",dataIndex:"status",key:"status",valueType:"select",valueEnum:n},{title:"排序",dataIndex:"orderNum",key:"orderNum",valueType:"digit"},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",editable:!1}]}),a(w,{}),a(A,{column:v,editable:S,dataSource:c,columns:[{title:"部门名称",dataIndex:"deptName",key:"deptName",valueType:"text"},{title:"上级部门",dataIndex:"parentId",key:"parentId",valueType:"treeSelect",fieldProps:{treeData:s,dropdownMatchSelectWidth:250,fieldNames:{label:"deptName",value:"deptId"}}}]}),a(w,{}),a(A,{column:v,editable:S,dataSource:c,columns:[{title:"负责人",dataIndex:"leader",key:"leader",valueType:"text"},{title:"联系电话",dataIndex:"phone",key:"phone",valueType:"text"},{title:"邮箱",dataIndex:"email",key:"email",valueType:"text"}]})]}):a(M,{description:"点击选择左侧部门项查看详情"})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Le=e=>u(x,{children:[a(C,{color:"rgb(148 163 184)",children:e.orderNum}),u(ye,{children:[e.deptName,a(C,{color:e.status==="NORMAL"?"success":"error",children:e.status==="NORMAL"?"启用中":"已禁用"})]})]}),Ee=()=>{var m;const[e,t]=P.useState([]),[o,r]=P.useState({}),{valueEnumSysNormalDisable:l}=I(),{data:s,isFetching:n}=Ce(o,{onSuccess:i=>{t(i)}}),c=Fe(),p=(e==null?void 0:e.length)!==0&&(e==null?void 0:e.length)===((m=s==null?void 0:s.allParentIds)==null?void 0:m.length);return u(x,{children:[u("div",{className:"flex justify-between items-center",children:[a(pe,{size:"small",className:"my-2",icon:p?a(me,{}):a(he,{}),onClick:()=>t(p?[]:s==null?void 0:s.allParentIds),children:p?"全部折叠":"全部展开"}),u(re,{onFinish:async i=>r(i),children:[a(D,{name:"deptName",label:"部门名称"}),a(Ae,{name:"status",label:"状态",valueEnum:l})]})]}),a(q,{spinning:n,children:s!=null&&s.treeData.length?a(ge,{blockNode:!0,showLine:{showLeafIcon:!1},titleRender:Le,treeData:s.treeData,expandedKeys:e,onExpand:t,height:700,fieldNames:{title:"deptName",key:"deptId"},onSelect:(i,{selected:h,node:{key:g}})=>{h&&c(g,s.map.get(g).deptName)}}):a(M,{})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const $e=()=>a(oe,{children:u(T,{ghost:!0,gutter:[16,16],wrap:!0,children:[a(T,{title:"部门列表",colSpan:{xxl:8,xl:12,lg:14,md:24,sm:24,xs:24},extra:a(Re,{}),children:a(Ee,{})}),a(T,{title:"部门详情",colSpan:{xxl:16,xl:12,lg:10,md:24,sm:24,xs:24},className:"h-full",extra:a(je,{}),children:a(ke,{})})]})});export{$e as default};
