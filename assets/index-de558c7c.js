import{a,j as I,F as A,r as T}from"./jsx-runtime-f6344dff.js";import{c2 as g,aw as f,ai as w,a9 as p,cq as R,bh as q,bS as M,ca as B,W as E,bk as x,aC as U}from"./index-a97495ec.js";import{e as k}from"./index-fd3a1dc3.js";import{b as _}from"./index-50e8979f.js";import{a as L,b as V}from"./index-fd298a71.js";import{_ as D,$ as K,a0 as S,a1 as O,a2 as F}from"./vanilla-b6611f9a.js";import{u as v}from"./useMutation.esm-9d03bfaf.js";import{m as N,i as C}from"./index-08a2e909.js";import{u as X}from"./index-d3065d17.js";import"./utils.esm-ba37751a.js";import"./mutation.esm-1a12604b.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const y=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/roleAuth/model/index.ts/atomMainTable",L(void 0));y.debugLabel="atomMainTable";const P=()=>V(y),Y=()=>_(y);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const j=({userId:e,userName:t,isBatch:u,disabled:r})=>{const l=u?"批量取消授权":"取消授权",i=g(),n=Number(i.roleId),s=P(),{mutateAsync:d,isLoading:m}=v(async()=>{Array.isArray(e)?await D({roleId:n,userIds:e}):await K({roleId:n,userId:e})},{onSuccess:()=>{var o;s==null||s.reload(),(o=s==null?void 0:s.clearSelected)==null||o.call(s),f.success("取消授权成功")}});return a(w,{accessible:!0,children:a(p,{type:"link",danger:!0,disabled:r,icon:a(R,{}),onClick:()=>{q.confirm({title:"取消授权",content:I(A,{children:["确定取消授权用户",a(M.Text,{code:!0,children:t}),"吗？"]}),onOk:()=>d(),okButtonProps:{loading:m}})},children:l})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Q=()=>{const e=g(),t=Number(e.roleId),[u,{toggle:r}]=X(),l=T.useRef(),[i,n]=T.useState([]),s=P(),{isLoading:d,mutate:m}=v(()=>S({roleId:t,userIds:i}),{onSuccess:()=>{var o,h,b;(o=l.current)==null||o.reload(),(b=(h=l.current)==null?void 0:h.clearSelected)==null||b.call(h),s==null||s.reload(),r(),f.success("授权成功")}}),{data:c}=k("sys_common_status");return I(A,{children:[a(p,{type:"primary",icon:a(B,{}),onClick:()=>{var o;(o=l.current)==null||o.reload(),r()},children:"授权用户"}),a(E,{open:u,title:"授权用户",placement:"left",onClose:r,width:850,footer:a(p,{type:"primary",disabled:i.length===0,loading:d,onClick:()=>m(),children:"提交"}),footerStyle:{textAlign:"right"},children:a(x,{ghost:!0,rowKey:"userId",actionRef:l,columns:[{dataIndex:"userName",key:"userName",title:"用户名称",valueType:"text"},{dataIndex:"nickName",key:"nickName",title:"用户昵称",valueType:"text",hideInSearch:!0},{dataIndex:"email",title:"邮箱",valueType:"text",hideInSearch:!0,formItemProps:{rules:[{required:!0,message:"请输入邮箱"},{pattern:N,message:"邮箱格式错误"}]}},{dataIndex:"phoneNumber",key:"phoneNumber",title:"手机号码",valueType:"text",copyable:!0},{title:"状态",dataIndex:"status",key:"status",valueType:"select",valueEnum:(c==null?void 0:c.valueEnum)??{},formItemProps:{initialValue:c==null?void 0:c.defaultValue,required:!0,rules:[{required:!0,message:"请选择状态"}]}},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",editable:!1,hideInSearch:!0,sorter:!0}],tableAlertRender:!1,rowSelection:{onChange:o=>{n(o)}},request:(...o)=>O(C(...o))})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const W=({selectedRows:e})=>a(j,{userId:e.map(t=>t.userId),userName:e.map(t=>t.userName).join(","),isBatch:!0,disabled:e.length===0}),$=()=>{const e=g(),t=Number(e.roleId),u=Y(),{data:r}=k("sys_common_status");return a(x,{rowKey:"userId",actionRef:u,params:{roleId:t},columns:[{dataIndex:"userName",key:"userName",title:"用户名称",valueType:"text"},{dataIndex:"nickName",key:"nickName",title:"用户昵称",valueType:"text",hideInSearch:!0},{dataIndex:"email",title:"邮箱",valueType:"text",hideInSearch:!0,formItemProps:{rules:[{required:!0,message:"请输入邮箱"},{pattern:N,message:"邮箱格式错误"}]}},{dataIndex:"phoneNumber",key:"phoneNumber",title:"手机号码",valueType:"text",copyable:!0},{title:"状态",dataIndex:"status",key:"status",valueType:"select",valueEnum:(r==null?void 0:r.valueEnum)??{},formItemProps:{initialValue:r==null?void 0:r.defaultValue,required:!0,rules:[{required:!0,message:"请选择状态"}]}},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",editable:!1,hideInSearch:!0,sorter:!0},{title:"操作",dataIndex:"option",valueType:"option",render:(l,i)=>a(j,{userId:i.userId,userName:i.userName})}],request:(...l)=>F(C(...l)),tableAlertRender:W,toolbar:{actions:[a(Q,{},"DrawerTableAuth")]}})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const le=()=>a(U,{children:a($,{})});export{le as default};
