import{aX as W,aj as H,c8 as E,c9 as L,ca as R,r as P,al as O,b8 as A,j as u,af as M,d as t,az as C,c0 as Z,aZ as q,aE as J,aG as w,cb as U,aY as $,k as F,cc as ee,cd as te,ax as ae,ce as se,cf as B,cg as V,aF as j,ch as re,ci as oe,cj as ne,ck as ce,cl as ie,w as le,cm as v,au as de,bh as I}from"./index-4bcc3c59.js";import{a as ue,u as pe}from"./utils-cfd88001.js";import{u as he}from"./index-ad878fb2.js";import{u as me}from"./useMutation.esm-92311925.js";import{P as ge}from"./index-e6ee3085.js";import{P as fe}from"./index-0ef8c337.js";import{P as y}from"./index-32640d42.js";import{P as De}from"./index-b5172dc2.js";import{u as ye}from"./useRequest-5864723d.js";import{P as T}from"./index-bc9e8011.js";import{P as Pe}from"./index-64dc4e71.js";import{T as k}from"./index-072bf097.js";import"./Skeleton-03b042db.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Q="systemDept",b=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/dept/model/index.ts/atomDeptDetails",ue({open:!1,deptId:0,deptName:""}));b.debugLabel="atomDeptDetails";const _=()=>W(b),be=()=>{const e=H(b);return(a,r)=>{e({open:!0,deptId:a,deptName:r})}},Ie=()=>pe(b),G=[Q,"list"],Te=(e,a)=>{const r=E(G,async()=>{const o=await L(e),n=R(o,{id:"deptId",pId:"parentId",rootPId:null});return{map:o.reduce((s,i)=>s.set(i.deptId,i),new Map),treeData:n,allParentIds:Array.from(o.reduce((s,i)=>s.add(i.parentId),new Set))}},{onSuccess:o=>{a.onSuccess(o.allParentIds)}});return P.exports.useEffect(()=>{r.refetch()},[e]),r},K=()=>{const e=O();return()=>e.invalidateQueries(G)},X=[Q,"options"],Y=()=>E(X,async()=>{const e=await L({});return R(e,{id:"deptId",pId:"parentId",rootPId:null})}),z=()=>{const e=O();return()=>e.invalidateQueries(X)};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const xe=()=>{var d;const e=P.exports.useRef(),[a,{toggle:r}]=he(),{data:o,refetch:n}=Y(),{data:s}=A("sys_normal_disable"),{mutate:i,isLoading:g}=me(async()=>{var p;const c=await((p=e.current)==null?void 0:p.validateFields());await U(c)},{onSuccess:()=>{var c;w.success("新建成功"),n(),r(),(c=e.current)==null||c.resetFields()}});return u(M,{accessible:!0,children:[t(C,{type:"primary",icon:t(Z,{}),onClick:r,children:"新建"}),t(q,{title:"新建部门",okText:"提交",open:a,onCancel:r,onOk:()=>i(),okButtonProps:{loading:g},children:u(J,{submitter:!1,formRef:e,grid:!0,rowProps:{gutter:[16,0]},children:[t(ge,{name:"parentId",label:"上级部门",rules:[{required:!0,message:"请选择上级部门"}],fieldProps:{treeData:o!=null?o:[],fieldNames:{label:"deptName",value:"deptId"}}}),t(y,{name:"deptName",label:"部门名称",rules:[{required:!0}],colProps:{span:12}}),t(fe,{name:"orderNum",label:"显示排序",initialValue:0,rules:[{required:!0}],colProps:{span:12}}),t(y,{name:"leader",label:"负责人",colProps:{span:12}}),t(y,{name:"phone",label:"联系电话",colProps:{span:12}}),t(y,{name:"email",label:"邮箱",colProps:{span:12}}),t(De.Group,{name:"status",label:"状态",valueEnum:(d=s==null?void 0:s.mapData)!=null?d:{},initialValue:s==null?void 0:s.defaultValue,colProps:{span:12}})]})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Ae=()=>{const{deptId:e,deptName:a,open:r}=_(),o=Ie(),n=K(),s=z();return t(M,{accessible:r,children:t(C,{danger:!0,ghost:!0,icon:t($,{}),onClick:()=>{q.confirm({title:"删除确认",content:u(F,{children:["确定删除部门",t(ee.Text,{code:!0,children:a}),"吗？"]}),onOk:async()=>{await te({deptId:e}),w.success("删除成功"),o(),n(),s()}})},children:"删除"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const x={xs:1,sm:1,md:1,lg:1,xl:2},Ce=()=>{var D;const[e,a]=P.exports.useState([]),[r]=ae.useForm(),o=K(),n=z(),{deptId:s,open:i}=_(),{data:g}=Y(),{data:d}=A("sys_normal_disable"),{data:c,loading:p,refresh:h}=ye(async()=>{var S;const{ancestors:l,...m}=await se({deptId:s}),N=(S=l==null?void 0:l.split(","))!=null?S:[];return{...m,ancestors:Number(N[N.length-1])}},{ready:i&&s>0,refreshDeps:[s],onSuccess:()=>{a([])}}),f={form:r,editableKeys:e,onChange:(l,m)=>{a(l),l.length===1&&!Array.isArray(m)&&r.setFieldsValue({[l[0]]:m[l[0]]})},onSave:async(l,m)=>{await re({deptId:s,deptName:c.deptName,orderNum:c.orderNum,parentId:0,[l]:m[l]}),w.success("保存成功"),h(),o(),n()}};return i?u(V,{spinning:p,children:[t(T,{column:x,editable:f,dataSource:c,columns:[{title:"状态",dataIndex:"status",key:"status",valueType:"select",valueEnum:(D=d==null?void 0:d.mapData)!=null?D:{}},{title:"排序",dataIndex:"orderNum",key:"orderNum",valueType:"digit"},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime"}]}),t(j,{}),t(T,{column:x,editable:f,dataSource:c,columns:[{title:"部门名称",dataIndex:"deptName",key:"deptName",valueType:"text"},{title:"上级部门",dataIndex:"parentId",key:"parentId",valueType:"treeSelect",fieldProps:{treeData:g,dropdownMatchSelectWidth:250,fieldNames:{label:"deptName",value:"deptId"}}}]}),t(j,{}),t(T,{column:x,editable:f,dataSource:c,columns:[{title:"负责人",dataIndex:"leader",key:"leader",valueType:"text"},{title:"联系电话",dataIndex:"phone",key:"phone",valueType:"text"},{title:"邮箱",dataIndex:"email",key:"email",valueType:"text"}]})]}):t(B,{description:"点击选择左侧部门项查看详情"})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const we=e=>u(F,{children:[t(k,{color:"rgb(148 163 184)",children:e.orderNum}),u(le,{children:[e.deptName,t(k,{color:e.status===v.ENABLE?"success":"error",children:e.status===v.ENABLE?"启用中":"已禁用"})]})]}),Fe=()=>{var c,p;const[e,a]=P.exports.useState([]),[r,o]=P.exports.useState({}),{data:n}=A("sys_normal_disable"),{data:s,isFetching:i}=Te(r,{onSuccess:h=>{a(h)}}),g=be(),d=(e==null?void 0:e.length)!==0&&(e==null?void 0:e.length)===((c=s==null?void 0:s.allParentIds)==null?void 0:c.length);return u(F,{children:[u("div",{className:"flex justify-between items-center",children:[t(C,{size:"small",className:"my-2",icon:d?t(oe,{}):t(ne,{}),onClick:()=>a(d?[]:s==null?void 0:s.allParentIds),children:d?"全部折叠":"全部展开"}),u(ce,{onFinish:async h=>o(h),children:[t(y,{name:"deptName",label:"部门名称"}),t(Pe,{name:"status",label:"状态",valueEnum:(p=n==null?void 0:n.mapData)!=null?p:{},initialValue:n==null?void 0:n.defaultValue})]})]}),s!=null&&s.treeData?t(V,{spinning:i,children:t("div",{className:"h-[calc(100vh-270px)]",children:t(ie,{blockNode:!0,showLine:{showLeafIcon:!1},titleRender:we,treeData:s.treeData,expandedKeys:e,onExpand:a,fieldNames:{title:"deptName",key:"deptId"},onSelect:(h,{selected:f,node:{key:D}})=>{!f||g(D,s.map.get(D).deptName)}})})}):t(B,{})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Qe=()=>t(de,{children:u(I,{ghost:!0,gutter:16,children:[t(I,{title:"部门列表",colSpan:"500px",extra:t(xe,{}),children:t(Fe,{})}),t(I,{title:"部门详情",extra:t(Ae,{}),children:t(Ce,{})})]})});export{Qe as default};
