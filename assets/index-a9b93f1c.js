import{b as c,j as t,F as y,e as n,f as j,g as x,L as P,h as L}from"./antdProComponents-adac7b3f.js";import{r as k,a as u,C as T,u as M,b as O,c as N,s as v,S as f}from"./index-3a0ef4a4.js";import{bm as g,aG as F,bo as I,bp as R,bq as A,bi as B,br as q,ai as z,aI as G,r as b,a0 as U}from"./antd-aee96f72.js";import{u as J}from"./useRequest-7829beda.js";import"./iconPark-395d73b8.js";import"./wangEditor-93aafe29.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const H=()=>{const{message:e}=g.useApp();return c("div",{className:"flex flex-col justify-center items-center",children:[t(F,{plain:!0,children:t("span",{className:"text-sm font-normal text-neutral-400",children:"其他登录方式"})}),t("div",{onClick:()=>{e.info("敬请期待")},className:"flex justify-center items-center cursor-pointer rounded-full h-[40px] w-[40px] border-solid border border-gray-300",children:t(I,{style:{fontSize:"20px",color:"#00ac84"}})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const _=()=>{const{message:e}=g.useApp();return c(y,{children:[t(n,{fieldProps:{maxLength:11,size:"large",prefix:t(R,{})},name:"phoneNumber",placeholder:"请输入手机号",rules:[{required:!0,message:"请输入手机号"},{pattern:k,message:"手机号格式错误"}]}),t(j,{fieldProps:{size:"large",prefix:t(A,{})},captchaProps:{size:"large"},placeholder:"请输入验证码",captchaTextRender:(a,h)=>a?`${h} 获取验证码`:"获取验证码",name:"smsCode",rules:[{required:!0,message:"请输入验证码"}],onGetCaptcha:async()=>(e.info("敬请期待"),Promise.reject(new Error("敬请期待")))})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const $=({captchaImageSrc:e,onCaptchaImageClick:a})=>c(y,{children:[t(n,{name:"username",fieldProps:{size:"large",prefix:t(B,{})},placeholder:"admin",initialValue:"admin",rules:[{required:!0,message:"请输入用户名"}]}),t(n.Password,{name:"password",fieldProps:{size:"large",prefix:t(A,{})},placeholder:"admin123",initialValue:"admin123",rules:[{required:!0,message:"请输入密码"}]}),c(x,{children:[t(n,{width:160,name:"code",placeholder:"请输入验证码",fieldProps:{size:"large",prefix:t(q,{})},rules:[{required:!0,message:"请输入验证码"}]}),t("div",{className:"h-[40px] w-[135px] rounded-md cursor-pointer border border-solid border-gray-300",children:e?t(z,{src:`data:image/png;base64,${e}`,preview:!1,height:40,width:135,alt:"图片验证码",onClick:a,className:"rounded-md"}):t(G.Button,{active:!0,block:!0,size:"large"})})]})]});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const D=(e={})=>u({path:"/captchaImage",method:"GET",secure:!0,skipErrorHandler:!1,...e});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const K=(e,a={})=>u({path:"/login",method:"POST",body:e,secure:!0,type:T.Json,skipErrorHandler:!1,...a});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const V=(e,a={})=>u({path:"/smsLogin",method:"POST",body:e,secure:!0,type:T.Json,skipErrorHandler:!1,...a});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const ae=()=>{const[e,a]=b.useState("USERNAME"),h=M(),C=O(),[l]=N(),{data:i,run:d}=J(()=>D({secure:!1})),p=async(s,r)=>{v(s?f.LOCAL_STORAGE:f.SESSION_STORAGE,`Bearer ${r}`),await h(),C(l.get("redirect")??"/")},w=async(s,r)=>{const{token:o}=await V(r);await p(s,o)},{message:m}=g.useApp(),E=async(s,r)=>{if(!i){m.error("请先获取图片验证码");return}const{token:o}=await K({...r,uuid:i.uuid},{secure:!1});await p(s,o)},S=async s=>{try{const{autoLogin:r,...o}=s;if(e==="MOBILE"){await w(r,o);return}if(e==="USERNAME"){await E(r,o);return}}catch{e==="USERNAME"&&d()}};return b.useEffect(()=>{l.get("msg")&&m.error(l.get("msg"))},[]),t("div",{className:"h-[100vh]",children:c(P,{backgroundImageUrl:"https://gw.alipayobjects.com/zos/rmsportal/FfdJeJRQWjEeGTpqgBKj.png",logo:"https://github.githubassets.com/images/modules/logos_page/Octocat.png",title:"RuoYi X Admin",subTitle:"若依后台管理系统",actions:t(H,{}),onFinish:S,children:[t(U,{centered:!0,activeKey:e,onChange:s=>a(s),items:[{label:"账号密码登录",key:"USERNAME"},{label:"手机号登录",key:"MOBILE"}]}),e==="USERNAME"&&t($,{captchaImageSrc:i==null?void 0:i.img,onCaptchaImageClick:d}),e==="MOBILE"&&t(_,{}),t(L,{name:"autoLogin",children:"自动登录"})]})})};export{ae as default};
