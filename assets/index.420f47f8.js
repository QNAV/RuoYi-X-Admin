import{aw as $,a7 as H,a as e,b4 as J,a6 as K,r as m,j as c,at as N,b6 as U,b7 as X,aA as Z,b8 as M,bl as _,F as S,aJ as x,aG as A,aC as T,b9 as ee,bc as ue,b0 as P,aB as L,bi as p,bm as te,S as ae,bn as se,bo as re,bd as ne,be as oe,bf as le,bg as ie,D as ce,M as de,bh as Fe,b1 as v}from"./index.0ca811aa.js";import{B as me}from"./index.23aa3c63.js";import{A as V}from"./index.ef0bc55f.js";import{P as pe}from"./index.5d2b6703.js";import{P as Ee}from"./index.94112488.js";import{u as G,b as R,M as F,E as k,a as he,Y as g,c as O}from"./useMutation.esm.76d24b2c.js";import{c as w}from"./keepAlive.b7d2e670.js";import{useShowCreateModal as j,useHideCreateModal as Ce,useValueCreateModal as Be,useValueSelectedMenuData as q,useQueryMenuOptions as ye,useReFetchMenuList as W,useDeleteMenu as Y,useReFetchMenuOptions as De,useStateSelectedMenuData as be,useResetSelectedMenuData as Ae,useQueryMenuList as Me}from"./index.a8a5258a.js";import{S as fe,a as Se,b as ge}from"./SysMenuService.bdc84bb4.js";import{E as z}from"./index.c3f357da.js";import{u as xe}from"./useRequest.338c194f.js";import"./utils.esm.9c17378e.js";import"./tree.10029c20.js";import"./useQuery.esm.b5e7d152.js";var Pe=["fieldProps","request","params","proFieldProps"],ve=function(u,o){var l=u.fieldProps,s=u.request,a=u.params,i=u.proFieldProps,E=H(u,Pe);return e(J,K({valueType:"cascader",fieldProps:l,ref:o,request:s,params:a,filedConfig:{customLightMode:!0},proFieldProps:i},E))};const Ie=$.forwardRef(ve),Ne=(t,u)=>{const o=[0];if(u===0)return o;const l=s=>{const a=t[s.toString()];!a||((a==null?void 0:a.parentId)!==void 0&&l(a.parentId),a.menuType!==F.F&&o.push(s))};return l(u),o},Te=()=>{var h,C;const t=w(),u=m.exports.useRef(),o=j(),l=Ce(),s=Be(),{selectedMenuId:a}=q(),{data:i,refetch:E}=ye(),y=W(),{isLoading:D,mutate:n}=G(async()=>{var d,B;const r=await((B=(d=u.current)==null?void 0:d.validateFieldsReturnFormatValue)==null?void 0:B.call(d));!r||await fe(r)},{onSuccess:async()=>{var r;await Promise.all([E(),y()]),l(),(r=u==null?void 0:u.current)==null||r.resetFields(),T.success("\u65B0\u5EFA\u6210\u529F")}});return m.exports.useEffect(()=>{var r;s&&(i==null?void 0:i.map)&&((r=u==null?void 0:u.current)==null?void 0:r.setFieldsValue)&&u.current.setFieldsValue({parentId:Ne(i.map,a)})},[s,(h=u==null?void 0:u.current)==null?void 0:h.setFieldsValue]),c(V,{accessible:t.canAddSysMenu,children:[e(N,{type:"primary",onClick:o,icon:e(U,{}),children:"\u65B0\u5EFA"}),e(X,{open:s,onCancel:l,title:"\u65B0\u5EFA\u83DC\u5355",width:515,okText:"\u63D0\u4EA4",onOk:()=>n(),okButtonProps:{loading:D},children:c(Z,{submitter:!1,formRef:u,children:[e(Ie,{name:"parentId",label:"\u7236\u7EA7\u83DC\u5355",fieldProps:{options:(C=i==null?void 0:i.options)!=null?C:[],fieldNames:{label:"menuName",value:"menuId",children:"children"},changeOnSelect:!0},rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u7236\u7EA7\u83DC\u5355"}],transform:r=>({parentId:r[r.length-1]})}),e(M.Group,{name:"menuType",label:"\u83DC\u5355\u7C7B\u578B",valueEnum:R,rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u83DC\u5355\u7C7B\u578B"}]}),e(_,{name:["menuType"],children:({menuType:r})=>r?c(S,{children:[c(x,{children:[e(A,{name:"menuName",label:"\u83DC\u5355\u540D\u79F0",width:"sm",rules:[{required:!0}]}),e(pe,{name:"orderNum",label:"\u663E\u793A\u6392\u5E8F",tooltip:"\u9ED8\u8BA4\u6570\u503C\u4E3A0\uFF0C\u6570\u503C\u8D8A\u5927\u6392\u5E8F\u8D8A\u9760\u540E\uFF0C\u6570\u503C\u76F8\u7B49\u6309\u7167\u521B\u5EFA\u65F6\u95F4\u5148\u540E\u6392\u5E8F",rules:[{required:!0}],width:"sm",initialValue:0})]}),r!==F.F&&c(S,{children:[c(x,{children:[e(M.Group,{tooltip:"\u9009\u62E9\u505C\u7528\u5219\u8DEF\u7531\u5C06\u4E0D\u4F1A\u51FA\u73B0\u5728\u4FA7\u8FB9\u680F\uFF0C\u4E5F\u4E0D\u80FD\u88AB\u8BBF\u95EE",name:"status",label:"\u83DC\u5355\u72B6\u6001",valueEnum:k,required:!0,initialValue:he.ENABLE}),e(M.Group,{name:"visible",label:"\u83DC\u5355\u662F\u5426\u663E\u793A",valueEnum:g,required:!0,initialValue:O.YES,tooltip:"\u9009\u62E9\u5426\u5219\u8DEF\u7531\u5C06\u4E0D\u4F1A\u51FA\u73B0\u5728\u4FA7\u8FB9\u680F\uFF0C\u4F46\u4ECD\u7136\u53EF\u4EE5\u8BBF\u95EE"}),e(M.Group,{name:"isFrame",label:"\u662F\u5426\u5916\u94FE",valueEnum:g,required:!0,initialValue:O.NO,tooltip:"\u9009\u62E9\u662F\u5916\u94FE\u5219\u8DEF\u7531\u5730\u5740\u9700\u8981\u4EE5`http(s)://`\u5F00\u5934"})]}),c(x,{children:[e(A,{name:"icon",label:"\u83DC\u5355\u56FE\u6807",width:"sm",tooltip:"https://ant.design/components/icon-cn/"}),e(A,{width:"sm",name:"path",label:"\u8DEF\u7531\u5730\u5740",tooltip:"\u8BBF\u95EE\u7684\u8DEF\u7531\u5730\u5740\uFF0C\u5982\uFF1A`user`\uFF0C\u5982\u5916\u7F51\u5730\u5740\u9700\u5185\u94FE\u8BBF\u95EE\u5219\u4EE5`http(s)://`\u5F00\u5934",rules:[{required:!0}]})]})]}),r===F.C&&e(A,{name:"queryParam",label:"\u8DEF\u7531\u53C2\u6570",tooltip:'\u8BBF\u95EE\u8DEF\u7531\u7684\u9ED8\u8BA4\u4F20\u9012\u53C2\u6570\uFF0C\u5982\uFF1A{"id": 1, "name": "ry"}'}),r!==F.M&&e(A,{name:"perms",label:"\u6743\u9650\u6807\u8BC6"})]}):null}),e(Ee,{name:"remark",label:"\u5907\u6CE8"})]})})]})},ke=()=>{const t=w(),{hasSelected:u,selectedMenuId:o,selectedMenuName:l}=q(),{mutate:s,isLoading:a}=Y();return e(V,{accessible:u&&t.canRemoveSysMenu,children:e(N,{icon:e(ee,{}),loading:a,danger:!0,onClick:()=>s({menuId:o,menuName:l}),children:"\u5220\u9664"})})},I={xs:1,sm:1,md:1,lg:1,xl:2},we=t=>m.exports.useMemo(()=>{const u=[];return t?(t!==F.F&&u.push({title:"\u72B6\u6001",dataIndex:"status",key:"status",valueType:"radio",valueEnum:k},{title:"\u662F\u5426\u663E\u793A",dataIndex:"visible",key:"visible",valueType:"radio",valueEnum:g,tooltip:"\u9009\u62E9\u5426\u5219\u8DEF\u7531\u5C06\u4E0D\u4F1A\u51FA\u73B0\u5728\u4FA7\u8FB9\u680F\uFF0C\u4F46\u4ECD\u7136\u53EF\u4EE5\u8BBF\u95EE"},{title:"\u662F\u5426\u5916\u94FE",dataIndex:"isFrame",key:"isFrame",valueType:"radio",valueEnum:g,tooltip:"\u9009\u62E9\u662F\u5916\u94FE\u5219\u8DEF\u7531\u5730\u5740\u9700\u8981\u4EE5`http(s)://`\u5F00\u5934"},{title:"\u56FE\u6807",dataIndex:"icon",key:"icon",valueType:"text",tooltip:"https://ant.design/components/icon-cn/"},{title:"\u8DEF\u7531\u5730\u5740",dataIndex:"path",key:"path",valueType:"text",tooltip:"\u8BBF\u95EE\u7684\u8DEF\u7531\u5730\u5740\uFF0C\u5982\uFF1A`user`\uFF0C\u5982\u5916\u7F51\u5730\u5740\u9700\u5185\u94FE\u8BBF\u95EE\u5219\u4EE5`http(s)://`\u5F00\u5934"},{title:"\u8DEF\u7531\u53C2\u6570",dataIndex:"queryParam",key:"queryParam",valueType:"code",tooltip:'\u8BBF\u95EE\u8DEF\u7531\u7684\u9ED8\u8BA4\u4F20\u9012\u53C2\u6570\uFF0C\u5982\uFF1A{"id": 1, "name": "ry"}'}),t!==F.M&&u.push({title:"\u6743\u9650\u6807\u8BC6",dataIndex:"perms",key:"perms",valueType:"text",copyable:!0}),u):[]},[t]),qe=()=>{const t=w(),u=W(),o=De(),{hasSelected:l,selectedMenuId:s}=q(),{data:a,loading:i,refresh:E}=xe(async()=>await Se({menuId:s}),{ready:l,refreshDeps:[s]}),{mutateAsync:y}=G(ge,{onSuccess:()=>{E(),u(),o(),T.success("\u4FDD\u5B58\u6210\u529F")}}),D=we(a==null?void 0:a.menuType),n=t.canEditSysMenu?{onSave:async(h,C)=>{const{menuType:r,orderNum:d,menuName:B,menuId:b}=C;await y({menuId:b,menuType:r,orderNum:d,menuName:B,[h]:C[h]})}}:void 0;return s===0?e(z,{description:"\u70B9\u51FB\u9009\u62E9\u5DE6\u4FA7\u83DC\u5355\u9879\u67E5\u770B\u8BE6\u60C5"}):c(ue,{spinning:i,children:[e(P,{columns:[{title:"\u7C7B\u578B",dataIndex:"menuType",key:"menuType",valueType:"select",valueEnum:R,editable:!1},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createTime",key:"createTime",valueType:"dateTime",editable:!1}],dataSource:a,column:I}),e(L,{}),e(P,{columns:[{title:"\u540D\u79F0",dataIndex:"menuName",key:"menuName",valueType:"text"},{title:"\u663E\u793A\u987A\u5E8F",dataIndex:"orderNum",key:"orderNum",valueType:"digit",tooltip:"\u9ED8\u8BA4\u6570\u503C\u4E3A0\uFF0C\u6570\u503C\u8D8A\u5927\u6392\u5E8F\u8D8A\u9760\u540E\uFF0C\u6570\u503C\u76F8\u7B49\u6309\u7167\u521B\u5EFA\u65F6\u95F4\u5148\u540E\u6392\u5E8F"},{title:"\u5907\u6CE8",dataIndex:"remark",key:"remark",valueType:"textarea",hideInSearch:!0}],dataSource:a,editable:n,column:I}),e(L,{}),e(P,{columns:D,dataSource:a,editable:n,column:I})]})},Le=t=>c(S,{children:[e(p,{color:"rgb(148 163 184)",children:t.orderNum}),(t==null?void 0:t.icon)&&e(te,{name:t.icon,className:"mr-1"}),e(p,{color:f[t.menuType],style:{margin:"0 0 2px 0"},children:t.menuName}),(t==null?void 0:t.perms)&&e(p,{style:{margin:"0 0 2px 2px"},children:c(ae,{size:"small",children:[t.perms,e(se,{style:{color:"#1890ff"},onClick:u=>{re(t.perms),T.success("\u590D\u5236\u6210\u529F"),u.stopPropagation()}})]})})]}),Oe=()=>c("div",{className:"mb-2",children:["\u6807\u7B7E\u542B\u4E49\uFF1A",e(p,{color:"rgb(148 163 184)",children:"\u663E\u793A\u987A\u5E8F"}),e(p,{color:f[F.M],children:"\u76EE\u5F55"}),e(p,{color:f[F.C],children:"\u83DC\u5355"}),e(p,{color:f[F.F],children:"\u6309\u94AE"}),e(p,{children:"\u6743\u9650\u6807\u8BC6"})]}),f={M:"blue",C:"green",F:"red"},Ve=()=>{var B;const[t,u]=m.exports.useState({}),[o,l]=m.exports.useState(0),[s,a]=m.exports.useState([]),[i,E]=be(),y=Ae(),D=j(),{data:n,refetch:h}=Me(t),{mutate:C}=Y(),r=(b,{node:{key:Q}})=>{l(Q)},d=(s==null?void 0:s.length)!==0&&(s==null?void 0:s.length)===((B=n==null?void 0:n.parentIds)==null?void 0:B.length);return m.exports.useEffect(()=>{h()},[t]),m.exports.useEffect(()=>{o>0?E({hasSelected:!0,selectedMenuId:o,selectedMenuName:n.map.get(o).menuName}):y()},[o]),c(S,{children:[e(Oe,{}),c("div",{className:"flex justify-between items-center",children:[e(N,{size:"small",className:"my-2",icon:d?e(ne,{}):e(oe,{}),onClick:()=>a(d?[]:n==null?void 0:n.parentIds),children:d?"\u5168\u90E8\u6298\u53E0":"\u5168\u90E8\u5C55\u5F00"}),c(le,{onFinish:async b=>{l(0),a([]),u(b)},children:[e(A,{name:"menuName",label:"\u83DC\u5355\u540D\u79F0"}),e(ie,{name:"status",label:"\u72B6\u6001",valueEnum:k})]})]}),e(ce,{overlay:e(de,{items:[{label:"\u65B0\u5EFA",key:"create",onClick:()=>D()},{label:"\u5728\u6839\u76EE\u5F55\u4E0B\u65B0\u5EFA",key:"create",onClick:()=>{y(),D()}},{label:"\u5220\u9664",key:"delete",danger:!0,disabled:!i.hasSelected,onClick:()=>C({menuId:i.selectedMenuId,menuName:i.selectedMenuName})}]}),trigger:["contextMenu"],children:e("div",{className:"max-h-[60vh] overflow-auto",children:n!=null&&n.treeData.length?e(Fe,{blockNode:!0,selectedKeys:[o],onSelect:r,expandedKeys:s,titleRender:Le,onExpand:a,showLine:{showLeafIcon:!1},fieldNames:{title:"menuName",key:"menuId",children:"children"},treeData:n==null?void 0:n.treeData,onRightClick:({node:{key:b}})=>l(b)}):e(z,{})})})]})},_e=()=>e(me,{children:c(v,{ghost:!0,gutter:24,children:[e(v,{title:"\u83DC\u5355\u5217\u8868",colSpan:"550px",extra:e(Te,{}),children:e(Ve,{})}),e(v,{title:"\u83DC\u5355\u8BE6\u60C5",extra:e(ke,{}),children:e(qe,{})})]})});export{_e as default};
