import{af as J,ag as U,c2 as L,r as y,aj as O,j as d,b3 as M,d as t,aK as x,b_ as Z,b5 as V,aP as $,aR as C,b4 as ee,k as w,c3 as te,aI as ae,c4 as q,c5 as B,aQ as k,c6 as se,c7 as re,c8 as oe,c9 as ne,w as ce,ca as E,aF as ie,bh as I}from"./index-c1e79eac.js";import{b as S,d as F}from"./index-79c92d7c.js";import{u as Q,i as _,j as le,k as de,l as ue,m as pe}from"./System-b2753a68.js";import{a as he,u as me}from"./utils-43a92cc6.js";import{u as ge}from"./index-ac2301e3.js";import{u as fe}from"./useMutation.esm-db7dfe63.js";import{P as De}from"./index-e2c34d08.js";import{P as ye}from"./index-846d298c.js";import{P as D}from"./index-cd920aef.js";import{P as Pe}from"./index-ed572c8c.js";import{u as be}from"./useRequest-b4998106.js";import{P as T}from"./index-78e3242e.js";import{P as Ie}from"./index-0451323f.js";import{T as R}from"./index-c781738a.js";import"./utils.esm-bf1583a2.js";import"./Skeleton-219c248f.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const K="systemDept",P=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/dept/model/index.ts/atomDeptDetails",he({open:!1,deptId:0,deptName:""}));P.debugLabel="atomDeptDetails";const G=()=>J(P),Te=()=>{const e=U(P);return(a,c)=>{e({open:!0,deptId:a,deptName:c})}},Ae=()=>me(P),W=[K,"list"],xe=(e,a)=>{const c=Q(W,async()=>{const o=await _(e),n=L(o,{id:"deptId",pId:"parentId",rootPId:null});return{map:o.reduce((s,r)=>s.set(r.deptId,r),new Map),treeData:n,allParentIds:Array.from(o.reduce((s,r)=>s.add(r.parentId),new Set))}},{onSuccess:o=>{a.onSuccess(o.allParentIds)}});return y.exports.useEffect(()=>{c.refetch()},[e]),c},X=()=>{const e=O();return()=>e.invalidateQueries(W)},Y=[K,"options"],z=()=>Q(Y,async()=>{const e=await _({});return L(e,{id:"deptId",pId:"parentId",rootPId:null})}),H=()=>{const e=O();return()=>e.invalidateQueries(Y)};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Ce=()=>{var u;const{canAddSysDept:e}=S(),a=y.exports.useRef(),[c,{toggle:o}]=ge(),{data:n,refetch:s}=z(),{data:r}=F("sys_normal_disable"),{mutate:h,isLoading:m}=fe(async()=>{var p;const i=await((p=a.current)==null?void 0:p.validateFields());await le(i)},{onSuccess:()=>{var i;C.success("新建成功"),s(),o(),(i=a.current)==null||i.resetFields()}});return d(M,{accessible:e,children:[t(x,{type:"primary",icon:t(Z,{}),onClick:o,children:"新建"}),t(V,{title:"新建部门",okText:"提交",open:c,onCancel:o,onOk:()=>h(),okButtonProps:{loading:m},children:d($,{submitter:!1,formRef:a,grid:!0,rowProps:{gutter:[16,0]},children:[t(De,{name:"parentId",label:"上级部门",rules:[{required:!0,message:"请选择上级部门"}],fieldProps:{treeData:n!=null?n:[],fieldNames:{label:"deptName",value:"deptId"}}}),t(D,{name:"deptName",label:"部门名称",rules:[{required:!0}],colProps:{span:12}}),t(ye,{name:"orderNum",label:"显示排序",initialValue:0,rules:[{required:!0}],colProps:{span:12}}),t(D,{name:"leader",label:"负责人",colProps:{span:12}}),t(D,{name:"phone",label:"联系电话",colProps:{span:12}}),t(D,{name:"email",label:"邮箱",colProps:{span:12}}),t(Pe.Group,{name:"status",label:"状态",valueEnum:(u=r==null?void 0:r.mapData)!=null?u:{},initialValue:r==null?void 0:r.defaultValue,colProps:{span:12}})]})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const we=()=>{const{canRemoveSysDept:e}=S(),{deptId:a,deptName:c,open:o}=G(),n=Ae(),s=X(),r=H();return t(M,{accessible:o&&e,children:t(x,{danger:!0,ghost:!0,icon:t(ee,{}),onClick:()=>{V.confirm({title:"删除确认",content:d(w,{children:["确定删除部门",t(te.Text,{code:!0,children:c}),"吗？"]}),onOk:async()=>{await de({deptId:a}),C.success("删除成功"),n(),s(),r()}})},children:"删除"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const A={xs:1,sm:1,md:1,lg:1,xl:2},Se=()=>{var N;const[e,a]=y.exports.useState([]),c=S(),[o]=ae.useForm(),n=X(),s=H(),{deptId:r,open:h}=G(),{data:m}=z(),{data:u}=F("sys_normal_disable"),{data:i,loading:p,refresh:b}=be(async()=>{var j;const{ancestors:l,...f}=await ue({deptId:r}),v=(j=l==null?void 0:l.split(","))!=null?j:[];return{...f,ancestors:Number(v[v.length-1])}},{ready:h&&r>0,refreshDeps:[r],onSuccess:()=>{a([])}}),g=c!=null&&c.canEditSysDept?{form:o,editableKeys:e,onChange:(l,f)=>{a(l),l.length===1&&!Array.isArray(f)&&o.setFieldsValue({[l[0]]:f[l[0]]})},onSave:async(l,f)=>{await pe({deptId:r,deptName:i.deptName,orderNum:i.orderNum,parentId:0,[l]:f[l]}),C.success("保存成功"),b(),n(),s()}}:void 0;return h?d(B,{spinning:p,children:[t(T,{column:A,editable:g,dataSource:i,columns:[{title:"状态",dataIndex:"status",key:"status",valueType:"select",valueEnum:(N=u==null?void 0:u.mapData)!=null?N:{}},{title:"排序",dataIndex:"orderNum",key:"orderNum",valueType:"digit"},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime"}]}),t(k,{}),t(T,{column:A,editable:g,dataSource:i,columns:[{title:"部门名称",dataIndex:"deptName",key:"deptName",valueType:"text"},{title:"上级部门",dataIndex:"parentId",key:"parentId",valueType:"treeSelect",fieldProps:{treeData:m,dropdownMatchSelectWidth:250,fieldNames:{label:"deptName",value:"deptId"}}}]}),t(k,{}),t(T,{column:A,editable:g,dataSource:i,columns:[{title:"负责人",dataIndex:"leader",key:"leader",valueType:"text"},{title:"联系电话",dataIndex:"phone",key:"phone",valueType:"text"},{title:"邮箱",dataIndex:"email",key:"email",valueType:"text"}]})]}):t(q,{description:"点击选择左侧部门项查看详情"})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Fe=e=>d(w,{children:[t(R,{color:"rgb(148 163 184)",children:e.orderNum}),d(ce,{children:[e.deptName,t(R,{color:e.status===E.ENABLE?"success":"error",children:e.status===E.ENABLE?"启用中":"已禁用"})]})]}),Ne=()=>{var u,i;const[e,a]=y.exports.useState([]),[c,o]=y.exports.useState({}),{data:n}=F("sys_normal_disable"),{data:s,isFetching:r}=xe(c,{onSuccess:p=>{a(p)}}),h=Te(),m=(e==null?void 0:e.length)!==0&&(e==null?void 0:e.length)===((u=s==null?void 0:s.allParentIds)==null?void 0:u.length);return d(w,{children:[d("div",{className:"flex justify-between items-center",children:[t(x,{size:"small",className:"my-2",icon:m?t(se,{}):t(re,{}),onClick:()=>a(m?[]:s==null?void 0:s.allParentIds),children:m?"全部折叠":"全部展开"}),d(oe,{onFinish:async p=>o(p),children:[t(D,{name:"deptName",label:"部门名称"}),t(Ie,{name:"status",label:"状态",valueEnum:(i=n==null?void 0:n.mapData)!=null?i:{},initialValue:n==null?void 0:n.defaultValue})]})]}),s!=null&&s.treeData?t(B,{spinning:r,children:t("div",{className:"h-[calc(100vh-270px)]",children:t(ne,{blockNode:!0,showLine:{showLeafIcon:!1},titleRender:Fe,treeData:s.treeData,expandedKeys:e,onExpand:a,fieldNames:{title:"deptName",key:"deptId"},onSelect:(p,{selected:b,node:{key:g}})=>{!b||h(g,s.map.get(g).deptName)}})})}):t(q,{})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Xe=()=>t(ie,{children:d(I,{ghost:!0,gutter:16,children:[t(I,{title:"部门列表",colSpan:"500px",extra:t(Ce,{}),children:t(Ne,{})}),t(I,{title:"部门详情",extra:t(we,{}),children:t(Se,{})})]})});export{Xe as default};
