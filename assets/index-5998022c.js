import{j as s}from"./antdProComponents-1965180d.js";import{az as B,aA as v,K as w,A as p,e as I,f as S,h as M,aB as P,l as R,b as U,aC as j,aD as O,d as L,m as E,i as F,aE as N,B as K}from"./index-2c084e82.js";import{be as h,B as d,b4 as D,bo as $,r as f,b5 as y,ay as b,bp as C,bl as T,ad as H}from"./antd-6bc2bb7d.js";import{u}from"./useMutation-f0283657.js";import{u as A}from"./index-28715962.js";import{u as _}from"./useRequest-cc46c8cb.js";import"./iconPark-3c306205.js";import"./wangEditor-f607bedb.js";import"./tslib.es6-3c43c0a4.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const q=({ossId:e})=>{const{message:t}=h.useApp(),{isLoading:a,mutate:i}=u(async()=>{const{data:c,headers:o}=await B({ossId:e},{format:"blob"}),n=new Blob([c],{type:"application/octet-stream"});n instanceof Blob?(v.saveAs(n,decodeURIComponent(o["download-filename"])),t.success("下载成功")):t.error("下载失败")},{onSuccess:()=>{}});return s.jsx(d,{type:"link",icon:s.jsx(D,{}),loading:a,onClick:()=>{i()},children:"下载"})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const G=({configKey:e,configValue:t,onFinish:a})=>{const{modal:i}=h.useApp(),{mutate:c,isLoading:o}=u(w,{onSuccess:()=>{a()}}),n=()=>{i.confirm({title:"操作确认",content:`确定${t?"停用":"启用"}"预览列表图片"配置吗？`,okButtonProps:{loading:o},onOk:()=>c({configKey:e,configValue:`${!t}`})})};return s.jsx(p,{accessKey:"system:oss:edit",children:s.jsxs(d,{danger:!0,type:"primary",ghost:!0,onClick:n,children:["预览开关：",t?"启用":"停用"]})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const g=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/oss/model/index.ts/atomMainTableActions",I(void 0));g.debugLabel="atomMainTableActions";const V=()=>M(g),X=()=>S(g);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const k=({ossIds:e,batch:t,disabled:a})=>{const{message:i,modal:c}=h.useApp(),o=V(),{mutate:n,isLoading:l}=u(P,{onSuccess:()=>{var m;o==null||o.reload(),(m=o==null?void 0:o.clearSelected)==null||m.call(o),i.success("删除成功")}}),r=()=>{c.confirm({title:"删除用户",content:`确定删除OSS对象存储编号为 ${e.join(",")} 的数据吗？`,onOk:()=>n({ossIds:e}),okButtonProps:{loading:l}})};return s.jsx(p,{accessKey:"system:oss:remove",children:s.jsx(R,{batch:t,disabled:a,onClick:r})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Y=()=>{const e=U();return s.jsx(d,{icon:s.jsx($,{}),type:"primary",ghost:!0,onClick:()=>{e("/system/oss-config")},children:"配置管理"})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const{Dragger:z}=T,W=async e=>{const{data:{code:t,msg:a}}=await j({file:e});return t!==200?Promise.reject(new Error(a)):a},J=()=>{const[e,{toggle:t}]=A(),[a,i]=f.useState([]),{message:c,modal:o}=h.useApp(),{mutate:n,isLoading:l}=u(W,{onSuccess:r=>{t(),o.info({title:"导入结果",content:r})},onError:()=>{c.error("导入失败")}});return s.jsxs(p,{accessKey:"system:oss:upload",children:[s.jsx(d,{type:"primary",icon:s.jsx(y,{}),onClick:t,children:"上传文件"}),s.jsx(b,{title:"上传文件",open:e,onCancel:t,okText:"提交",onOk:()=>n(a[0].originFileObj),okButtonProps:{loading:l},children:s.jsxs(z,{accept:".xlsx, .xls, .doc, .docx, .ppt, .pptx, .txt, .pdf",maxCount:1,beforeUpload:()=>!1,onChange:r=>i(r.fileList),fileList:a,onRemove:()=>i([]),children:[s.jsx("p",{className:"ant-upload-drag-icon",children:s.jsx(C,{})}),s.jsx("p",{className:"ant-upload-text",children:"点击或拖拽文件到此区域上传"}),s.jsx("p",{className:"ant-upload-text",children:"请上传大小不超过5MB格式为doc/xls/ppt/txt/pdf的文件"})]})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const{Dragger:Q}=T,Z=async e=>{const{data:{code:t,msg:a}}=await j({file:e});return t!==200?Promise.reject(new Error(a)):a},ee=()=>{const[e,{toggle:t}]=A(),[a,i]=f.useState([]),{message:c,modal:o}=h.useApp(),{mutate:n,isLoading:l}=u(Z,{onSuccess:r=>{t(),o.info({title:"导入结果",content:r})},onError:()=>{c.error("导入失败")}});return s.jsxs(p,{accessKey:"system:oss:upload",children:[s.jsx(d,{type:"primary",icon:s.jsx(y,{}),onClick:t,children:"上传图片"}),s.jsx(b,{title:"上传图片",open:e,onCancel:t,okText:"提交",onOk:()=>n(a[0].originFileObj),okButtonProps:{loading:l},children:s.jsxs(Q,{accept:".png, .jpg, .jpeg, .docx",maxCount:1,beforeUpload:()=>!1,onChange:r=>i(r.fileList),fileList:a,onRemove:()=>i([]),children:[s.jsx("p",{className:"ant-upload-drag-icon",children:s.jsx(C,{})}),s.jsx("p",{className:"ant-upload-text",children:"点击或拖拽文件到此区域上传"}),s.jsx("p",{className:"ant-upload-text",children:"请上传大小不超过5MB格式为png/jpg/jpeg的文件"})]})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const te=e=>[{title:"对象存储主键",dataIndex:"ossId",key:"ossId",valueType:"text",hideInSearch:!0},{title:"文件名",dataIndex:"fileName",key:"fileName",valueType:"text"},{title:"原名",dataIndex:"originalName",key:"originalName",valueType:"text"},{title:"文件后缀名",dataIndex:"fileSuffix",key:"fileSuffix",valueType:"text"},{title:"文件展示",dataIndex:"url",key:"url",valueType:"text",render:(t,a)=>["png","jpg","jpeg"].includes(a.fileSuffix)&&e?s.jsx(H,{src:a.url,width:100,height:100}):a.url},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",hideInSearch:!0,sorter:!0},{title:"上传人",dataIndex:"createBy",key:"createBy",valueType:"text"},{title:"服务商",dataIndex:"service",key:"service",valueType:"text",sorter:!0},{title:"创建时间",dataIndex:"dateTimeRange",key:"dateTimeRange",valueType:"dateTimeRange",hideInTable:!0},{title:"操作",dataIndex:"action",valueType:"option",render:(t,a)=>s.jsxs(s.Fragment,{children:[s.jsx(q,{ossId:a.ossId}),s.jsx(k,{ossIds:[a.ossId]})]})}],se=({selectedRowKeys:e})=>s.jsx(k,{disabled:e.length===0,batch:!0,ossIds:e}),x="sys.oss.previewListResource",ae=()=>{const e=X(),{data:t,refresh:a}=_(async()=>{const{data:{msg:c}}=await O({configKey:x});return c==="true"}),i=te(!!t);return s.jsx(L,{rowKey:"ossId",actionRef:e,columns:i,request:async(...c)=>{const{dateTimeRange:o,...n}=E(...c);return F(o)&&(n.beginCreateTime=o[0],n.endCreateTime=o[1]),await N(n)},toolbar:{actions:[s.jsx(J,{},"ButtonUploadFile"),s.jsx(ee,{},"ButtonUploadImg"),s.jsx(G,{configKey:x,configValue:!!t,onFinish:()=>{a()}},"ButtonPreviewConfig"),s.jsx(Y,{},"ButtonToConfigPage")]},tableAlertOptionRender:se})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const pe=()=>s.jsx(K,{children:s.jsx(ae,{})});export{pe as default};
