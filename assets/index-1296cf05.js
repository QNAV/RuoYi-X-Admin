import{j as s,B as Se,b as f,i as X,v as Ie,F as E,l as Re,q as Te,k as I}from"./antdProComponents-6d1fcf7e.js";import{e as xe,h as ee,f as ve,F as Ae,Q as te,aQ as De,aR as be,aS as se,aT as ae,aU as oe,U as ke,aV as we,g as T,V as Ke,A as b,L as Me,aW as Ee,b as je,aX as Pe,l as Fe,aY as Ne,Z as Be,aZ as Le,a_ as ze,a$ as Oe,_ as z,b0 as qe,b1 as Ve,b2 as Qe,B as Ue}from"./index-a86b6c11.js";import{r as c,bm as j,B as D,bi as Ge,F as Xe,aa as O,aG as Ye,a9 as L,bg as We,aK as $e,be as Ze,bf as He,ad as ne,a$ as le}from"./antd-2eaa2d43.js";import{u as q}from"./useMutation-d4b1dbbc.js";import{a as Je,u as _e}from"./utils-9116f136.js";import{i as Y,u as et}from"./useRequest-b2664e19.js";import{f as tt,e as re}from"./tslib.es6-3c43c0a4.js";import"./iconPark-5401014c.js";import"./wangEditor-6b8c9df0.js";var M=new Set,R,W={xs:0,sm:576,md:768,lg:992,xl:1200};function B(){var e,t,o=R;if(ce(),o!==R)try{for(var a=re(M),n=a.next();!n.done;n=a.next()){var i=n.value;i()}}catch(u){e={error:u}}finally{try{n&&!n.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}}var K=!1;function ce(){var e,t,o=window.innerWidth,a={},n=!1;try{for(var i=re(Object.keys(W)),u=i.next();!u.done;u=i.next()){var d=u.value;a[d]=o>=W[d],a[d]!==R[d]&&(n=!0)}}catch(y){e={error:y}}finally{try{u&&!u.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}n&&(R=a)}function st(){Y&&!K&&(R={},ce(),window.addEventListener("resize",B),K=!0);var e=tt(c.useState(R),2),t=e[0],o=e[1];return c.useEffect(function(){if(Y){K||window.addEventListener("resize",B);var a=function(){o(R)};return M.add(a),function(){M.delete(a),M.size===0&&(window.removeEventListener("resize",B),K=!1)}}},[]),t}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const V=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/role/model/index.ts/atomRoleListActions",xe(void 0));V.debugLabel="atomRoleListActions";const Q=()=>ee(V),at=()=>ve(V),P=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/role/model/index.ts/atomRoleDetails",Je({open:!1}));P.debugLabel="atomRoleDetails";const ot=()=>_e(P),nt=()=>{const e=Ae(P);return t=>{e({open:!0,roleId:t})}},x=()=>ee(P),ie="sysRole",ue=[ie,"details"],he=e=>{const{roleId:t}=x(),o=te(ue,()=>De({roleId:t}),{onSuccess:e,enabled:!1});return c.useEffect(()=>{t&&o.refetch()},[t]),o},de=[ie,"tree"],lt=e=>{const{roleId:t}=x(),o=te(de,async()=>{const{menus:a,checkedKeys:n}=await be({roleId:t});return{treeData:a,selectedMenuIds:n,selectedTreeData:se(a,n),allMenuIds:ae(a),allExpandedKeys:oe(a)}},{onSuccess:a=>{e(a.selectedTreeData)},enabled:!1});return c.useEffect(()=>{t&&o.refetch()},[t]),o},me=e=>{const t=ke(),{message:o}=j.useApp();return q(async a=>{const n=t.getQueryData(ue),i=t.getQueryData(de);await we({roleId:n.roleId,roleKey:n.roleKey,roleName:n.roleName,roleSort:n.roleSort,status:n.status,menuIds:i.selectedMenuIds,menuCheckStrictly:"NO",deptCheckStrictly:"NO",...a})},{onSuccess:async()=>{e(),o.success("保存成功")}})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const $=[{required:!0,message:"请输入角色名称"}],[,rt,ct,it]=T({title:"角色名称",dataIndex:"roleName",descriptions:{valueType:"text",formItemProps:{rules:$}},form:{valueType:"text",formItemProps:{rules:$}},meta:{valueType:"text"}}),[,ut]=T({title:"角色编号",dataIndex:"roleId",descriptions:{valueType:"text"}}),Z="控制器中定义的权限字符，如：@PreAuthorize(`@ss.hasRole('admin')`)",H=[{required:!0,message:"请输入权限字符"}],[,ht,dt,mt]=T({title:"权限字符",dataIndex:"roleKey",descriptions:{valueType:"text",tooltip:Z,formItemProps:{rules:H}},form:{valueType:"text",tooltip:Z,formItemProps:{rules:H}},meta:{valueType:"text"}}),pt="NORMAL",U=()=>{const{valueEnumSysNormalDisable:e}=Ke();return T({title:"状态",dataIndex:"status",valueEnum:e,table:{valueType:"select"},form:{initialValue:pt,valueType:"radio",colProps:{span:12}},meta:{valueType:"select"}})},J=[{required:!0,message:"请输入显示排序"}],[,ft,gt]=T({title:"显示排序",dataIndex:"roleSort",descriptions:{valueType:"digit",formItemProps:{initialValue:0,rules:J}},form:{valueType:"digit",formItemProps:{initialValue:0,rules:J},colProps:{span:12}}}),[,yt,Ct]=T({title:"备注",dataIndex:"remark",descriptions:{valueType:"textarea"},form:{valueType:"textarea"}}),[,St]=T({title:"创建时间",dataIndex:"createTime",descriptions:{valueType:"dateTime"}}),It=()=>{const[,,,e]=U();return{title:it,subTitle:e,description:mt}},Rt=()=>{const[,,e]=U();return[ct,dt,e,gt,Ct]},Tt=[ut,St],xt=()=>{const[,e]=U();return[e,ft,rt,ht,yt]};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const vt=()=>{const e=c.useRef(),t=Q(),o=Rt(),{message:a}=j.useApp();return s(b,{accessKey:"system:role:add",children:s(Se,{title:"新增角色",trigger:s(Me,{}),formRef:e,onFinish:async i=>{var u;return await Ee({...i,menuIds:[],menuCheckStrictly:"NO",deptCheckStrictly:"NO"}),t==null||t.reload(),(u=e.current)==null||u.resetFields(),a.success("新增成功"),!0},width:500,modalProps:{okText:"提交"},grid:!0,colProps:{span:24},layoutType:"ModalForm",columns:o})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const At=()=>{const e=je(),{roleId:t,open:o}=x();return s(b,{accessKey:"system:user:edit",children:s(D,{type:"primary",onClick:()=>e(Pe("/system/role-auth/:roleId",{roleId:t.toString()})),icon:s(Ge,{}),disabled:!o,children:"分配用户"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Dt=()=>{const e=Q(),t=ot(),{roleId:o,open:a}=x(),{message:n,modal:i}=j.useApp(),{isLoading:u,mutateAsync:d}=q(Ne,{onSuccess:()=>{var g;e==null||e.reload(),(g=e==null?void 0:e.clearSelected)==null||g.call(e),t(),n.success("删除成功")}});return s(b,{accessKey:"system:role:remove",children:s(Fe,{type:"primary",size:"middle",disabled:!a,onClick:()=>i.confirm({title:"操作确认",content:`确定删除角色编号为 ${o} 的角色吗？`,onOk:()=>d({roleIds:[o]}),okButtonProps:{loading:u}})})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const bt=()=>{const[e,t]=c.useState([]),[o]=Xe.useForm(),a=xt(),n=Q(),{data:i,isFetching:u,refetch:d}=he(()=>{t([]),o.resetFields()}),{mutateAsync:y}=me(()=>{d(),n==null||n.reload()}),C=Be()("system:role:edit")?{form:o,editableKeys:e,onChange:(m,S)=>{if(t(m),m.length>0){const l=m[0];o.setFieldsValue({[l]:S[l]})}},onSave:async(m,S)=>{await y({[m]:S[m]})}}:void 0;return f(O,{spinning:u,children:[s(X,{column:2,columns:Tt,dataSource:i}),s(Ye,{}),s(X,{column:2,columns:a,dataSource:i,editable:C})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const kt=()=>{const e=at(),t=nt(),o=It();return s(Ie,{ghost:!0,rowKey:"roleId",actionRef:e,metas:o,tableAlertRender:!1,rowSelection:{type:"radio",onSelect:({roleId:a})=>t(a)},search:{filterType:"light"},pagination:{defaultPageSize:10,defaultCurrent:1,showSizeChanger:!0},request:a=>Le(a)})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const wt=()=>{const[e,t]=c.useState([]),[o,a]=c.useState(!1),[n,i]=c.useState([]),[u,d]=c.useState([]),[y,g]=c.useState(!1),[C,m]=c.useState(!0),{message:S}=j.useApp(),[l,k]=c.useState(),w=c.useRef(),{open:F,roleId:v}=x(),{valueEnumSysDataScope:p}=ze(),{refetch:pe}=he(({dataScope:h})=>{var A;k(h),(A=w.current)==null||A.setFieldsValue({dataScope:h})}),{loading:fe,refresh:ge,data:r}=et(async()=>{const{depts:h,checkedKeys:A}=await Oe(v);return{treeData:h,selectedMenuIds:A,selectedTreeData:se(h,A),allMenuIds:ae(h),allExpandedKeys:oe(h)}},{ready:F,refreshDeps:[v],onSuccess:h=>{a(!1),d(h.selectedTreeData)}}),{isLoading:G,mutate:ye}=q(async()=>{await qe({roleId:v,dataScope:l,deptIds:e})},{onSuccess:()=>{ge(),pe(),S.success("保存成功")}}),N=n.length===(r==null?void 0:r.allExpandedKeys.length),Ce=h=>{if(h||C){t((r==null?void 0:r.allMenuIds)??[]);return}t([])};return c.useEffect(()=>{if((r==null?void 0:r.allMenuIds.length)===e.length){g(!0),m(!1);return}if(e.length===0){g(!1),m(!1);return}m(!0)},[r==null?void 0:r.allMenuIds,e]),f(E,{children:[f("header",{className:"flex justify-between items-start flex-wrap",children:[s(Re,{formRef:w,submitter:!1,layout:"horizontal",children:s(Te,{name:"dataScope",label:"数据权限范围",valueEnum:p,fieldProps:{onChange:h=>{k(h)}},readonly:!o})}),s(b,{accessKey:"system:role:edit",children:o?f(L,{children:[s(D,{loading:G,onClick:()=>{a(!1),d((r==null?void 0:r.selectedTreeData)??[])},children:"取消编辑"}),s(D,{type:"primary",ghost:!0,icon:s(We,{}),loading:G,onClick:()=>ye(),children:"保存"})]}):s(D,{type:"primary",ghost:!0,icon:s($e,{}),onClick:()=>{a(!0),t((r==null?void 0:r.selectedMenuIds)??[]),d((r==null?void 0:r.treeData)??[])},children:"编辑数据权限"})})]}),l==="CUSTOM"&&f(E,{children:[f(L,{wrap:!0,className:"my-2",children:[u.length>0&&s(D,{size:"small",icon:N?s(Ze,{}):s(He,{}),onClick:()=>i(N?[]:r.allExpandedKeys),children:N?"全部折叠":"全部展开"}),o&&s(ne,{indeterminate:C,onChange:h=>Ce(h.target.checked),checked:y,children:"全选/全不选"})]}),s(O,{spinning:fe,children:u.length>0?s(le,{blockNode:!0,showLine:{showLeafIcon:!1},checkable:o,checkStrictly:!0,fieldNames:{title:"label",key:"id"},checkedKeys:e,treeData:u,expandedKeys:n,onExpand:h=>i(h),onCheck:h=>{t(h.checked)}}):s(z,{description:"暂未分配数据权限"})})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Kt=()=>{const[e,t]=c.useState([]),[o,a]=c.useState(!1),[n,i]=c.useState([]),[u,d]=c.useState([]),[y,g]=c.useState(!1),[C,m]=c.useState(!0),{isFetching:S,data:l,refetch:k}=lt(p=>{a(!1),d(p)}),{isLoading:w,mutate:F}=me(()=>{k()}),v=p=>{if(p||C){t((l==null?void 0:l.allMenuIds)??[]);return}t([])};return c.useEffect(()=>{if((l==null?void 0:l.allMenuIds.length)===e.length){g(!0),m(!1);return}if(e.length===0){g(!1),m(!1);return}m(!0)},[l==null?void 0:l.allMenuIds,e]),f(E,{children:[f("header",{className:"flex justify-between items-end mb-2",children:[s(Ve,{expanded:n.length===(l==null?void 0:l.allExpandedKeys.length),onChange:p=>{i(p?(l==null?void 0:l.allExpandedKeys)??[]:[])}}),s(b,{accessKey:"system:role:edit",children:s(Qe,{editable:o,loading:w,onCancel:()=>{a(!1),d((l==null?void 0:l.selectedTreeData)??[])},onSave:()=>F({menuIds:e}),onStartEdit:()=>{a(!0),t((l==null?void 0:l.selectedMenuIds)??[]),d((l==null?void 0:l.treeData)??[])}})})]}),f(O,{spinning:S,children:[s("div",{className:"pl-1 mb-1",children:o&&s(ne,{indeterminate:C,onChange:p=>v(p.target.checked),checked:y,children:"全选/全不选"})}),u.length>0?s(le,{blockNode:!0,showLine:{showLeafIcon:!1},checkable:o,checkStrictly:!0,fieldNames:{title:"label",key:"id"},checkedKeys:e,treeData:u,expandedKeys:n,onExpand:p=>i(p),onCheck:p=>{t(p.checked)},height:500}):s(z,{description:"暂未分配菜单权限"})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const _={list:{xxl:7,xl:10,lg:13,md:24,sm:24,xs:24},details:{xxl:17,xl:14,lg:11,md:24,sm:24,xs:24}},Ot=()=>{const{xl:e}=st(),{open:t}=x();return s(Ue,{children:f(I,{ghost:!0,gutter:[16,16],wrap:!0,children:[s(I,{title:"角色列表",colSpan:_.list,extra:s(vt,{}),children:s(kt,{})}),s(I,{split:"horizontal",title:"角色详情",colSpan:_.details,extra:f(L,{children:[s(Dt,{}),s(At,{})]}),className:"h-full",children:t?f(E,{children:[s(I,{children:s(bt,{})}),f(I,{split:e?"vertical":"horizontal",children:[s(I,{children:s(Kt,{})}),s(I,{children:s(wt,{})})]})]}):s(z,{description:"点击选择左侧角色查看详情"})})]})})};export{Ot as default};
