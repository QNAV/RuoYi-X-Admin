import{aD as K,O as X,j as u,aE as H,_ as J,r as m,g as c,af as R,ag as k,aA as Z,ai as U,W as ee,az as f,aX as _,aY as ue,F as x,a5 as P,$ as M,aZ as p,a_ as T,a$ as O,Y as w,ah as te,aJ as G,aK as ae,au as v,X as L,aQ as E,b0 as se,aR as re,b1 as ne,aL as oe,aM as le,aN as ce,aO as ie,b2 as de,b3 as he,aP as Fe,I as pe,ax as I}from"./index.571436fe.js";import{a as N,c as j}from"./index.6d4fa0a5.js";import{useShowCreateModal as W,useHideCreateModal as me,useValueCreateModal as Ee,useValueSelectedMenuData as q,useQueryMenuOptions as Ce,useReFetchMenuList as Y,useDeleteMenu as Q,useReFetchMenuOptions as ge,useStateSelectedMenuData as ye,useResetSelectedMenuData as Be,useQueryMenuList as Ae}from"./index.03d88b26.js";import{S as De,a as Me,b as fe}from"./SysMenuService.bea43a22.js";import{P as be}from"./index.059cdfd5.js";import{P as xe}from"./index.d59cc900.js";import{u as z}from"./useMutation.esm.e4f37aff.js";import{u as Te}from"./useRequest.c7b36630.js";import{l as Pe}from"./index.c24ea793.js";import"./useQuery.esm.fdf5e819.js";import"./utils.esm.4a49e06f.js";import"./SysLoginService.fb430cd0.js";import"./utils.ece672c2.js";var ve=["fieldProps","request","params","proFieldProps"],Ie=function(t,a){var o=t.fieldProps,r=t.request,s=t.params,i=t.proFieldProps,d=X(t,ve);return u(H,J({valueType:"cascader",fieldProps:o,ref:a,request:r,params:s,filedConfig:{customLightMode:!0},proFieldProps:i},d))};const Se=K.forwardRef(Ie);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ke=(e,t)=>{const a=[0];if(t===0)return a;const o=r=>{const s=e.get(r);!s||((s==null?void 0:s.parentId)!==void 0&&o(s.parentId),s.menuType!==p.F&&a.push(r))};return o(t),a},we=()=>{var C,A;const e=N(),t=m.exports.useRef(),a=W(),o=me(),r=Ee(),{selectedMenuId:s}=q(),{data:i}=j("sys_normal_disable"),{data:d,refetch:y}=Ce(),B=Y(),{isLoading:F,mutate:l}=z(async()=>{var h,g;const n=await((g=(h=t.current)==null?void 0:h.validateFieldsReturnFormatValue)==null?void 0:g.call(h));!n||await De(n)},{onSuccess:async()=>{var n;await Promise.all([y(),B()]),o(),(n=t==null?void 0:t.current)==null||n.resetFields(),w.success("\u65B0\u5EFA\u6210\u529F")}});return m.exports.useEffect(()=>{var n;r&&(d==null?void 0:d.map)&&((n=t==null?void 0:t.current)==null?void 0:n.setFieldsValue)&&t.current.setFieldsValue({parentId:ke(d.map,s)})},[r,(C=t==null?void 0:t.current)==null?void 0:C.setFieldsValue]),c(R,{accessible:e.canAddSysMenu,children:[u(k,{type:"primary",onClick:a,icon:u(Z,{}),children:"\u65B0\u5EFA"}),u(U,{open:r,onCancel:o,title:"\u65B0\u5EFA\u83DC\u5355",width:515,okText:"\u63D0\u4EA4",onOk:()=>l(),okButtonProps:{loading:F},children:c(ee,{submitter:!1,formRef:t,children:[u(Se,{name:"parentId",label:"\u7236\u7EA7\u83DC\u5355",fieldProps:{options:(A=d==null?void 0:d.options)!=null?A:[],fieldNames:{label:"menuName",value:"menuId",children:"children"},changeOnSelect:!0},rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u7236\u7EA7\u83DC\u5355"}],transform:n=>({parentId:n[n.length-1]})}),u(f.Group,{name:"menuType",label:"\u83DC\u5355\u7C7B\u578B",valueEnum:_,rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u83DC\u5355\u7C7B\u578B"}]}),u(ue,{name:["menuType"],children:({menuType:n})=>{var h;return n?c(x,{children:[c(P,{children:[u(M,{name:"menuName",label:"\u83DC\u5355\u540D\u79F0",width:"sm",rules:[{required:!0}]}),u(be,{name:"orderNum",label:"\u663E\u793A\u6392\u5E8F",tooltip:"\u9ED8\u8BA4\u6570\u503C\u4E3A0\uFF0C\u6570\u503C\u8D8A\u5927\u6392\u5E8F\u8D8A\u9760\u540E\uFF0C\u6570\u503C\u76F8\u7B49\u6309\u7167\u521B\u5EFA\u65F6\u95F4\u5148\u540E\u6392\u5E8F",rules:[{required:!0}],width:"sm",initialValue:0})]}),n!==p.F&&c(x,{children:[c(P,{children:[u(f.Group,{tooltip:"\u9009\u62E9\u505C\u7528\u5219\u8DEF\u7531\u5C06\u4E0D\u4F1A\u51FA\u73B0\u5728\u4FA7\u8FB9\u680F\uFF0C\u4E5F\u4E0D\u80FD\u88AB\u8BBF\u95EE",name:"status",label:"\u83DC\u5355\u72B6\u6001",required:!0,valueEnum:(h=i==null?void 0:i.mapData)!=null?h:{},initialValue:i==null?void 0:i.defaultValue}),u(f.Group,{name:"visible",label:"\u83DC\u5355\u662F\u5426\u663E\u793A",valueEnum:T,required:!0,initialValue:O.YES,tooltip:"\u9009\u62E9\u5426\u5219\u8DEF\u7531\u5C06\u4E0D\u4F1A\u51FA\u73B0\u5728\u4FA7\u8FB9\u680F\uFF0C\u4F46\u4ECD\u7136\u53EF\u4EE5\u8BBF\u95EE"}),u(f.Group,{name:"isFrame",label:"\u662F\u5426\u5916\u94FE",valueEnum:T,required:!0,initialValue:O.NO,tooltip:"\u9009\u62E9\u662F\u5916\u94FE\u5219\u8DEF\u7531\u5730\u5740\u9700\u8981\u4EE5`http(s)://`\u5F00\u5934"})]}),c(P,{children:[u(M,{name:"icon",label:"\u83DC\u5355\u56FE\u6807",width:"sm",tooltip:"https://ant.design/components/icon-cn/"}),u(M,{width:"sm",name:"path",label:"\u8DEF\u7531\u5730\u5740",tooltip:"\u8BBF\u95EE\u7684\u8DEF\u7531\u5730\u5740\uFF0C\u5982\uFF1A`user`\uFF0C\u5982\u5916\u7F51\u5730\u5740\u9700\u5185\u94FE\u8BBF\u95EE\u5219\u4EE5`http(s)://`\u5F00\u5934",rules:[{required:!0}]})]})]}),n===p.C&&u(M,{name:"queryParam",label:"\u8DEF\u7531\u53C2\u6570",tooltip:'\u8BBF\u95EE\u8DEF\u7531\u7684\u9ED8\u8BA4\u4F20\u9012\u53C2\u6570\uFF0C\u5982\uFF1A{"id": 1, "name": "ry"}'}),n!==p.M&&u(M,{name:"perms",label:"\u6743\u9650\u6807\u8BC6"})]}):null}}),u(xe,{name:"remark",label:"\u5907\u6CE8"})]})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ne=()=>{const e=N(),{hasSelected:t,selectedMenuId:a,selectedMenuName:o}=q(),{mutate:r,isLoading:s}=Q();return u(R,{accessible:t&&e.canRemoveSysMenu,children:u(k,{icon:u(te,{}),loading:s,danger:!0,onClick:()=>r({menuId:a,menuName:o}),children:"\u5220\u9664"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const S={xs:1,sm:1,md:1,lg:1,xl:2},je=e=>{const{data:t}=j("sys_normal_disable");return m.exports.useMemo(()=>{var o;const a=[];return e?(e!==p.F&&a.push({title:"\u72B6\u6001",dataIndex:"status",key:"status",valueType:"select",valueEnum:(o=t==null?void 0:t.mapData)!=null?o:{}},{title:"\u662F\u5426\u663E\u793A",dataIndex:"visible",key:"visible",valueType:"radio",valueEnum:T,tooltip:"\u9009\u62E9\u5426\u5219\u8DEF\u7531\u5C06\u4E0D\u4F1A\u51FA\u73B0\u5728\u4FA7\u8FB9\u680F\uFF0C\u4F46\u4ECD\u7136\u53EF\u4EE5\u8BBF\u95EE"},{title:"\u662F\u5426\u5916\u94FE",dataIndex:"isFrame",key:"isFrame",valueType:"radio",valueEnum:T,tooltip:"\u9009\u62E9\u662F\u5916\u94FE\u5219\u8DEF\u7531\u5730\u5740\u9700\u8981\u4EE5`http(s)://`\u5F00\u5934"},{title:"\u56FE\u6807",dataIndex:"icon",key:"icon",valueType:"text",tooltip:"https://ant.design/components/icon-cn/"},{title:"\u8DEF\u7531\u5730\u5740",dataIndex:"path",key:"path",valueType:"text",tooltip:"\u8BBF\u95EE\u7684\u8DEF\u7531\u5730\u5740\uFF0C\u5982\uFF1A`user`\uFF0C\u5982\u5916\u7F51\u5730\u5740\u9700\u5185\u94FE\u8BBF\u95EE\u5219\u4EE5`http(s)://`\u5F00\u5934"}),e===p.C&&a.push({title:"\u8DEF\u7531\u53C2\u6570",dataIndex:"queryParam",key:"queryParam",valueType:"code",tooltip:'\u8BBF\u95EE\u8DEF\u7531\u7684\u9ED8\u8BA4\u4F20\u9012\u53C2\u6570\uFF0C\u5982\uFF1A{"id": 1, "name": "ry"}'}),e!==p.M&&a.push({title:"\u6743\u9650\u6807\u8BC6",dataIndex:"perms",key:"perms",valueType:"text",copyable:!0}),a):[]},[e])},qe=()=>{const e=N(),t=Y(),a=ge(),{hasSelected:o,selectedMenuId:r}=q(),{data:s,loading:i,refresh:d}=Te(async()=>await Me({menuId:r}),{ready:o,refreshDeps:[r]}),{mutateAsync:y}=z(fe,{onSuccess:()=>{d(),t(),a(),w.success("\u4FDD\u5B58\u6210\u529F")}}),B=je(s==null?void 0:s.menuType),F=e.canEditSysMenu?{onSave:async(l,C)=>{const{menuType:A,orderNum:n,menuName:h,menuId:g}=C;await y({menuId:g,menuType:A,orderNum:n,menuName:h,[l]:C[l]})}}:void 0;return r===0?u(G,{description:"\u70B9\u51FB\u9009\u62E9\u5DE6\u4FA7\u83DC\u5355\u9879\u67E5\u770B\u8BE6\u60C5"}):c(ae,{spinning:i,children:[u(v,{columns:[{title:"\u7C7B\u578B",dataIndex:"menuType",key:"menuType",valueType:"select",valueEnum:_,editable:!1},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createTime",key:"createTime",valueType:"dateTime",editable:!1,hideInSearch:!0}],dataSource:s,column:S}),u(L,{}),u(v,{columns:[{title:"\u540D\u79F0",dataIndex:"menuName",key:"menuName",valueType:"text"},{title:"\u6392\u5E8F",dataIndex:"orderNum",key:"orderNum",valueType:"digit"},{title:"\u5907\u6CE8",dataIndex:"remark",key:"remark",valueType:"textarea",hideInSearch:!0}],dataSource:s,editable:F,column:S}),u(L,{}),u(v,{columns:B,dataSource:s,editable:F,column:S})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ve=e=>c(x,{children:[u(E,{color:"rgb(148 163 184)",children:e.orderNum}),(e==null?void 0:e.icon)&&u(se,{name:e.icon,className:"mr-1"}),u(E,{color:b[e.menuType],style:{margin:"0 0 2px 0"},children:e.menuName}),(e==null?void 0:e.perms)&&u(E,{style:{margin:"0 0 2px 2px"},children:c(re,{size:"small",children:[e.perms,u("div",{onClick:t=>{t.stopPropagation()},children:u(Pe.CopyToClipboard,{text:e.perms,onCopy:(t,a)=>{a&&w.success("\u590D\u5236\u6210\u529F")},children:u(ne,{style:{color:"#1890ff"}})})})]})})]});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Oe=()=>c("div",{className:"mb-2",children:["\u6807\u7B7E\u542B\u4E49\uFF1A",u(E,{color:"rgb(148 163 184)",children:"\u663E\u793A\u987A\u5E8F"}),u(E,{color:b[p.M],children:"\u76EE\u5F55"}),u(E,{color:b[p.C],children:"\u83DC\u5355"}),u(E,{color:b[p.F],children:"\u6309\u94AE"}),u(E,{children:"\u6743\u9650\u6807\u8BC6"})]});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const b={M:"blue",C:"green",F:"red"},Le=()=>{var g,V;const[e,t]=m.exports.useState({}),[a,o]=m.exports.useState(0),[r,s]=m.exports.useState([]),[i,d]=ye(),y=Be(),B=W(),{data:F}=j("sys_normal_disable"),{data:l,refetch:C}=Ae(e,D=>{s(D)}),{mutate:A}=Q(),n=(D,{node:{key:$}})=>{o($)},h=(r==null?void 0:r.length)!==0&&(r==null?void 0:r.length)===((g=l==null?void 0:l.parentIds)==null?void 0:g.length);return m.exports.useEffect(()=>{C()},[e]),m.exports.useEffect(()=>{a>0?d({hasSelected:!0,selectedMenuId:a,selectedMenuName:l.map.get(a).menuName}):y()},[a]),c(x,{children:[u(Oe,{}),c("div",{className:"flex justify-between items-center",children:[u(k,{size:"small",className:"my-2",icon:h?u(oe,{}):u(le,{}),onClick:()=>s(h?[]:l==null?void 0:l.parentIds),children:h?"\u5168\u90E8\u6298\u53E0":"\u5168\u90E8\u5C55\u5F00"}),c(ce,{onFinish:async D=>{o(0),s([]),t(D)},children:[u(M,{name:"menuName",label:"\u83DC\u5355\u540D\u79F0"}),u(ie,{name:"status",label:"\u72B6\u6001",valueEnum:(V=F==null?void 0:F.mapData)!=null?V:{},initialValue:F==null?void 0:F.defaultValue})]})]}),u(de,{overlay:u(he,{items:[{label:"\u65B0\u5EFA",key:"create",onClick:()=>B()},{label:"\u5728\u6839\u76EE\u5F55\u4E0B\u65B0\u5EFA",key:"create",onClick:()=>{y(),B()}},{label:"\u5220\u9664",key:"delete",danger:!0,disabled:!i.hasSelected,onClick:()=>A({menuId:i.selectedMenuId,menuName:i.selectedMenuName})}]}),trigger:["contextMenu"],children:u("div",{className:"h-[calc(100vh-310px)] overflow-auto",children:l!=null&&l.treeData.length?u(Fe,{blockNode:!0,selectedKeys:[a],onSelect:n,expandedKeys:r,titleRender:Ve,onExpand:s,showLine:{showLeafIcon:!1},fieldNames:{title:"menuName",key:"menuId",children:"children"},treeData:l==null?void 0:l.treeData,onRightClick:({node:{key:D}})=>o(D)}):u(G,{})})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ue=()=>u(pe,{children:c(I,{ghost:!0,gutter:24,children:[u(I,{title:"\u83DC\u5355\u5217\u8868",colSpan:"550px",extra:u(we,{}),children:u(Le,{})}),u(I,{title:"\u83DC\u5355\u8BE6\u60C5",extra:u(Ne,{}),children:u(qe,{})})]})});export{Ue as default};
