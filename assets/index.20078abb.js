import{j as F,F as f,a as s,a$ as d,aA as p,ba as I,r as N,bI as y,as as c,bJ as h,bK as E,bo as g,bL as B,b0 as C,aB as T}from"./index.ce63faa1.js";import{B as D}from"./index.9966879f.js";import{c as P}from"./common.a258db69.js";import{C as O,a as w,b as A,c as k,d as v,e as G,f as x,g as _,h as L,i as j,j as R,k as q,l as J,m as K,n as M,o as Q,p as z,q as S,r as Z,s as $,t as H,u as U,v as V,G as W,w as X}from"./GenService.340ca3bc.js";import{G as Y,u as ee}from"./useMutation.esm.4eab8cdd.js";import{u as ae}from"./useRequest.cab55b08.js";import"./utils.esm.bbb5c808.js";const se=({dataSource:a,handleEdit:n})=>{const l={onSave:async(u,e)=>{const t=u;await n({[t]:e[t]})}};return F(f,{children:[s(d,{dataSource:a,columns:[O,w,A,k,P],editable:l}),s(p,{}),s(d,{columns:[v,G,x,_,L,j,...(a==null?void 0:a.genType)===Y.ZIP?[]:[R]],dataSource:a,editable:l})]})},ne=({dataSource:a,handleEdit:n,loading:l=!1})=>{const[u]=I.useForm(),[e,t]=N.exports.useState([]),m=(e==null?void 0:e.length)>0;return s(y,{toolbar:{actions:m?[s(c,{onClick:()=>t([]),icon:s(h,{}),children:"\u53D6\u6D88\u7F16\u8F91"},"cancelEdit"),s(c,{type:"primary",loading:l,icon:s(E,{}),onClick:async()=>{const o=await u.validateFields();await n({columns:Object.keys(o).map(i=>({...o[i],columnId:Number(i)}))}),t([])},children:"\u4FDD\u5B58"},"edit")]:[s(c,{icon:s(g,{}),type:"primary",onClick:()=>{a&&t(a==null?void 0:a.map(o=>{var i,r;return(r=(i=o==null?void 0:o.columnId)==null?void 0:i.toString())!=null?r:""}))},children:"\u7F16\u8F91"},"edit")]},rowKey:"columnId",ghost:!0,size:"small",scroll:{x:"max-content"},columns:[q,J,K,M,Q,z,S,Z,$,H,U,V],value:a,recordCreatorProps:!1,editable:{form:u,editableKeys:e}})},b={BASE_INFO:"\u57FA\u672C\u4FE1\u606F",FIELD_INFO:"\u5B57\u6BB5\u4FE1\u606F"},ce=()=>{var i;const a=B(),n=Number((i=a==null?void 0:a.tableId)!=null?i:"0"),[l,u]=N.exports.useState("BASE_INFO"),{data:e,refresh:t}=ae(async()=>await W({tableId:n}),{ready:n>0,refreshDeps:[n]}),{mutateAsync:m,isLoading:o}=ee(async r=>{await X({tableId:n,businessName:e.info.businessName,functionName:e.info.functionName,className:e.info.className,functionAuthor:e.info.functionAuthor,moduleName:e.info.moduleName,packageName:e.info.packageName,tableComment:e.info.tableComment,tableName:e.info.tableName,columns:e.rows,...r})},{onSuccess:()=>{t(),T.success("\u4FDD\u5B58\u6210\u529F")}});return s(D,{children:F(C,{tabs:{activeKey:l,onChange:r=>{u(r)}},children:[s(C.TabPane,{tab:b.BASE_INFO,children:s(se,{dataSource:e==null?void 0:e.info,handleEdit:m})},"BASE_INFO"),s(C.TabPane,{tab:b.FIELD_INFO,children:s(ne,{dataSource:e==null?void 0:e.rows,handleEdit:m,loading:o})},"FIELD_INFO")]})})};export{ce as default};
