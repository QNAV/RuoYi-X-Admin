import{Q as D,X as I,V as $,aj as R,ci as P,r as g,a4 as B,ad as W,cj as J,ck as z,cl as L,cm as Z,b as u,al as F,j as a,s as ee,ae as te,cn as ae,co as se,cp as oe,ag as re,Y as f,ao as ce,ap as ne,cq as ie,cr as U,a0 as le,cs as de,ct as ue,cu as he,$ as me,cv as pe,C as ge,f as V,cw as ye,a1 as be,cx as we,N as fe,I as Ae,aE as Te,aJ as Pe,a2 as xe,a3 as Ce,cy as Se,q as Ie,O as Re,B as ke}from"./index-211d5ee6.js";import{a as O,u as q}from"./utils-7c09a1a9.js";import{u as A}from"./useRequest-a85710d3.js";import{u as T}from"./useMutation-00b4f79f.js";import{P as p}from"./index-99e98c6b.js";import{P as Me}from"./index-56ceb77e.js";import{P as v}from"./index-e95b77aa.js";import{P as je}from"./index-f6f4af06.js";import{P as ve}from"./index-ab12e15e.js";import{u as Ee}from"./index-e9b4a4ab.js";import{U as Ne}from"./index-48eea6d3.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const E=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomMainTableActions",D(void 0));E.debugLabel="atomMainTableActions";const K=()=>I(E),De=()=>$(E),N=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomSelectedDeptId",D(0));N.debugLabel="atomSelectedDeptId";const Be=()=>I(N),Le=()=>R(N),k=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomResetPwdModal",O({open:!1}));k.debugLabel="atomResetPwdModal";const Fe=()=>{const e=R(k);return t=>{e({open:!0,record:t})}},Ue=()=>q(k),Ve=()=>I(k),x=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomAddOrEditModal",O({open:!1,actionType:"add"}));x.debugLabel="atomAddOrEditModal";const Oe=()=>{const e=R(x);return()=>{e({open:!0,actionType:"add"})}},qe=()=>{const e=R(x);return t=>{e({open:!0,actionType:"edit",userId:t})}},Ke=()=>q(x),Xe=()=>I(x);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ye=()=>{const{message:e}=P.useApp(),t=g.useRef(),r=K(),{open:c,actionType:o,userId:s}=Xe(),l=Ke(),i=()=>{var n;o==="edit"&&((n=t.current)==null||n.resetFields()),l()},{valueEnumSysNormalDisable:C,defaultValueSysNormalDisable:w}=B(),{valueEnumSysUserSex:M,defaultValueSysUserSex:j}=W(),{data:y}=A(async()=>{const{posts:n,roles:d}=await J();return{posts:n.reduce((m,b)=>m.set(b.postId,b.postName),new Map),roles:d.reduce((m,b)=>m.set(b.roleId,b.roleName),new Map)}}),{data:h}=A(async()=>{const{data:n}=await z({configKey:"sys.user.initPassword"});return n.msg}),{data:S}=A(()=>L({deptQuery:{}})),[,Y]=g.useTransition();A(async()=>{const{postIds:n,roleIds:d,user:m}=await Z({userId:s});return{...m,postIds:n,roleIds:d}},{ready:c&&o==="edit"&&!!s,onSuccess:n=>{Y(()=>{var d;(d=t.current)==null||d.setFieldsValue(n)})},refreshDeps:[s]});const{isLoading:H,mutateAsync:G}=T(async()=>{var d,m;const n=await((m=(d=t.current)==null?void 0:d.validateFieldsReturnFormatValue)==null?void 0:m.call(d));if(o==="add"){const{roleIds:b=[],postIds:Q=[],..._}=n;await ae({roleIds:b,postIds:Q,..._})}else await se({userId:s,...n})},{onSuccess:()=>{var n;l(),r==null||r.reload(),(n=t.current)==null||n.resetFields(),e.success(o==="add"?"新增成功":"编辑成功")}});return u(F,{title:o==="add"?"新增用户":"编辑用户",formRef:t,grid:!0,colProps:{span:12},modalProps:{okText:"提交",onCancel:i,confirmLoading:H},width:600,open:c,onFinish:()=>G(),children:[a(p,{name:"nickName",label:"用户昵称",rules:[{required:!0}]}),a(Me,{name:"deptId",label:"归属部门",fieldProps:{treeData:S??[],fieldNames:{value:"id"}}}),a(p,{name:"phoneNumber",label:"手机号码",rules:[{pattern:ee,message:"手机号码格式错误"}],fieldProps:{maxLength:11}}),a(p,{name:"email",label:"邮箱",rules:[{pattern:te,message:"邮箱格式错误"}]}),o==="add"&&a(p,{name:"userName",label:"用户名称",rules:[{required:!0}]}),o==="add"&&a(p.Password,{name:"password",label:"用户密码",rules:[{required:!0}],initialValue:h}),a(v,{name:"sex",label:"用户性别",valueEnum:M,initialValue:j}),a(je.Group,{name:"status",label:"状态",valueEnum:C,initialValue:w,rules:[{required:!0}]}),a(v,{name:"postIds",label:"岗位",valueEnum:(y==null?void 0:y.posts)??{},mode:"multiple",colProps:{span:24}}),a(v,{name:"roleIds",label:"角色",valueEnum:(y==null?void 0:y.roles)??{},mode:"multiple",colProps:{span:24}}),a(ve,{name:"remark",label:"备注",colProps:{span:24}})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const He=()=>{const{message:e}=P.useApp(),t=g.useRef(),r=Ue(),{open:c,record:o}=Ve();return g.useEffect(()=>{var s;if(c){(s=t.current)==null||s.resetFields();const l=setTimeout(()=>{var i;(i=t.current)==null||i.setFieldsValue({userName:o.userName}),clearTimeout(l)},0)}},[c]),u(F,{title:"重置密码",open:c,formRef:t,modalProps:{onCancel:r},width:500,onFinish:async({password:s})=>{await oe({...o,password:s}),e.success("重置密码成功")},children:[a(p,{name:"userName",label:"用户名称",readonly:!0}),a(p.Password,{required:!0,name:"password",label:"新密码",rules:[{required:!0,message:"请输入新密码"},{pattern:re,message:"密码长度应在6-20之间，只能包含字母、数字和下划线"}]}),a(p.Password,{required:!0,name:"confirmPassword",label:"确认密码",rules:[{required:!0,message:"请输入确认密码"},({getFieldsValue:s})=>({validator(l,i){return!i||s().password===i?Promise.resolve():Promise.reject(new Error("两次输入的密码不一致"))}})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ge=()=>{const e=Oe();return a(f,{accessKey:"system:user:add",children:a(ce,{onClick:e})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Qe=({userId:e})=>{const t=qe();return a(f,{accessKey:"system:user:edit",children:a(ne,{onClick:()=>t(e)})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const _e=({searchParams:e})=>{const{message:t}=P.useApp(),{isLoading:r,mutate:c}=T(async()=>{const o=await ie(e,{format:"blob"});await U(o.data,`user_${new Date().getTime()}.xlsx`)},{onSuccess:()=>{t.success("导出成功")}});return a(f,{accessKey:"system:user:export",children:a(le,{loading:r,onClick:()=>c()})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const{Dragger:$e}=Ne,We=()=>{const[e,{toggle:t}]=Ee(),[r,c]=g.useState(!1),[o,s]=g.useState([]),{message:l,modal:i}=P.useApp(),{mutate:C,isLoading:w}=T(async()=>{const{data:{code:h,msg:S}}=await de({updateSupport:r},{file:o[0].originFileObj});if(h!==200){l.error(S);return}t(),i.info({title:"导入结果",content:S})}),{mutate:M,isLoading:j}=T(async()=>{const{data:h}=await ue();await U(h,`user_template_${new Date().getTime()}.xlsx`)});return u(f,{accessKey:"system:user:import",children:[a(he,{onClick:t}),u(me,{title:"导入用户",open:e,onCancel:t,onOk:()=>C(),okButtonProps:{loading:w},children:[u($e,{accept:".xlsx, .xls",maxCount:1,beforeUpload:()=>!1,onChange:h=>s(h.fileList),fileList:o,onRemove:()=>s([]),children:[a("p",{className:"ant-upload-drag-icon",children:a(pe,{})}),a("p",{className:"ant-upload-text",children:"点击或拖拽文件到此区域上传"})]}),u("div",{className:"flex flex-col items-center pt-2",children:[a(ge,{checked:r,onChange:h=>{c(h.target.checked)},children:"是否更新已经存在的用户数据"}),u("div",{children:[a("span",{children:"仅允许导入xls、xlsx格式文件"}),a(V,{type:"link",onClick:()=>M(),loading:j,children:"下载模板"})]})]})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const X=({userIds:e,batch:t,disabled:r})=>{const{message:c,modal:o}=P.useApp(),s=K(),{mutate:l,isLoading:i}=T(ye,{onSuccess:()=>{var w;s==null||s.reload(),(w=s==null?void 0:s.clearSelected)==null||w.call(s),c.success("删除成功")}});return a(f,{accessKey:"system:user:remove",children:a(be,{batch:t,disabled:r,onClick:()=>{o.confirm({title:"删除用户",content:`确定删除用户编号为 ${e.join(",")} 的数据吗？`,onOk:()=>l({userIds:e}),okButtonProps:{loading:i}})}})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Je=({record:e})=>{const t=Fe();return a(f,{accessKey:"system:user:resetPwd",children:a(V,{type:"link",danger:!0,icon:a(we,{}),onClick:()=>t(e),children:"重置密码"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ze=()=>{const[e,t]=g.useState(""),r=Le(),{data:c,loading:o}=A(()=>L({deptQuery:{deptName:e}}),{refreshDeps:[e],debounceWait:500});return u(fe,{spinning:o,children:[a(Ae.Search,{allowClear:!0,placeholder:"请输入部门名称",className:"mb-3",onSearch:s=>{t(s)}}),!c||c.length===0?a(Te,{}):a(Pe,{treeData:c,defaultExpandAll:!0,fieldNames:{title:"label",key:"id"},onSelect:(s,{node:{key:l}})=>{r(l)},blockNode:!0})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ze=()=>{const{valueEnumSysNormalDisable:e}=B();return[{dataIndex:"userId",key:"userId",title:"用户编号",valueType:"text",hideInSearch:!0},{dataIndex:"userName",key:"userName",title:"用户名称",valueType:"text"},{dataIndex:"nickName",key:"nickName",title:"用户昵称",valueType:"text",hideInSearch:!0},{dataIndex:["dept","deptName"],key:"deptDeptName",title:"部门名称",valueType:"text",hideInSearch:!0},{dataIndex:"phoneNumber",key:"phoneNumber",title:"手机号码",valueType:"text",copyable:!0},{title:"状态",dataIndex:"status",key:"status",valueType:"select",valueEnum:e},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",hideInSearch:!0,sorter:!0},{title:"操作",valueType:"option",render:(t,r)=>r.userId===1?null:u(Ie,{children:[a(Qe,{userId:r.userId}),a(X,{userIds:[r.userId]}),a(Je,{record:r})]}),fixed:"right",width:300},{title:"创建时间",dataIndex:"createTimeRange",key:"createTimeRange",valueType:"dateTimeRange",hideInTable:!0}]},et=({selectedRows:e})=>a(X,{disabled:e.length===0,batch:!0,userIds:e.map(t=>t.userId)}),tt=(e,t)=>u("div",{className:"flex gap-4",children:[a(Re,{className:"w-80",children:a(ze,{})}),a("div",{className:"overflow-auto w-full",children:t})]}),at=()=>{const e=De(),[t,r]=g.useState({}),c=Ze(),o=Be(),s=o>0?{deptId:o}:{};return a(xe,{rowKey:"userId",actionRef:e,columns:c,params:s,request:async(...l)=>{const i=Ce(...l);return r(i),await Se(i)},toolbar:{actions:[a(_e,{searchParams:t},"ButtonExport"),a(We,{},"ButtonImport"),a(Ge,{},"ButtonAdd")]},tableRender:tt,tableAlertOptionRender:et})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const pt=()=>u(ke,{children:[a(at,{}),a(Ye,{}),a(He,{})]});export{pt as default};
