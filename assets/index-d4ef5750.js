import{b as h,F as v,j as s,i as m,w as T,k as b}from"./antdProComponents-6fa50338.js";import{bk as I,bl as x,Z as g,A as k,I as N,bm as f,bn as E,ad as A,B as C}from"./index-dffabdf2.js";import{aG as F,F as S,r as p,B as d,aL as B,bg as j,aK as w,bm as D}from"./antd-5b22be5a.js";import{g as O,a as P}from"./Tool-56bf8fd9.js";import{u as Q}from"./useRequest-f9345e2b.js";import{u as L}from"./useMutation-dd6321b2.js";import"./iconPark-f28c66b3.js";import"./wangEditor-77edb64d.js";import"./tslib.es6-3c43c0a4.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const _=({dataSource:e,handleEdit:a})=>{const{valueEnumSysGenType:i}=I(),{valueEnumSysTplCategory:o}=x(),t=g()("tool:gen:edit")?{onSave:async(r,u)=>{const n=r;await a({[n]:u[n]})}}:void 0;return h(v,{children:[s(m,{dataSource:e,columns:[{title:"表名称",dataIndex:"tableName",key:"tableName",valueType:"text"},{title:"表描述",dataIndex:"tableComment",key:"tableComment",valueType:"text"},{title:"实体名称",dataIndex:"className",key:"className",valueType:"text",hideInSearch:!0},{title:"作者",dataIndex:"functionAuthor",key:"functionAuthor",valueType:"text"},{title:"备注",dataIndex:"remark",key:"remark",valueType:"textarea",hideInSearch:!0}],editable:t}),s(F,{}),s(m,{columns:[{title:"生成模版",dataIndex:"tplCategory",key:"tplCategory",valueType:"select",valueEnum:o},{title:"生成包路径",dataIndex:"packageName",key:"packageName",valueType:"text"},{title:"生成模块名",dataIndex:"moduleName",key:"moduleName",valueType:"text"},{title:"生成业务名",dataIndex:"businessName",key:"businessName",valueType:"text"},{title:"生成功能名",dataIndex:"functionName",key:"functionName",valueType:"text"},{title:"生成代码方式",dataIndex:"genType",key:"genType",valueType:"select",valueEnum:i},...(e==null?void 0:e.genType)==="ZIP"?[]:[{title:"自定义路径",dataIndex:"genPath",key:"genPath",valueType:"text"}]],dataSource:e,editable:t})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const q=()=>{const{valueEnumSysYesNo:e}=N(),{valueEnumSysQueryType:a}=f(),{valueEnumSysJavaType:i}=E();return[{title:"序号",dataIndex:"sort",valueType:"indexBorder",editable:!1},{title:"字段名称",dataIndex:"columnName",key:"columnName",valueType:"text",editable:!1,ellipsis:!0},{title:"字段描述",dataIndex:"columnComment",key:"columnComment",valueType:"text"},{title:"物理类型",dataIndex:"columnType",key:"columnType",valueType:"text",editable:!1,ellipsis:!0},{title:"JAVA类型",dataIndex:"javaType",key:"javaType",valueType:"select",valueEnum:i},{title:"JAVA属性",dataIndex:"javaField",key:"javaField",valueType:"text"},{title:"插入",dataIndex:"isInsert",key:"isInsert",valueType:"radioButton",valueEnum:e},{title:"编辑",dataIndex:"isEdit",key:"isEdit",valueType:"radioButton",valueEnum:e},{title:"列表",dataIndex:"isList",key:"isList",valueType:"radioButton",valueEnum:e},{title:"查询",dataIndex:"isQuery",key:"isQuery",valueType:"radioButton",valueEnum:e},{title:"必填",dataIndex:"isRequired",key:"isRequired",valueType:"radioButton",valueEnum:e},{title:"查询方式",dataIndex:"queryType",key:"queryType",valueType:"select",valueEnum:a}]},G=({dataSource:e,handleEdit:a,loading:i=!1})=>{const[o]=S.useForm(),[l,t]=p.useState([]),r=(l==null?void 0:l.length)>0,u=q();return s(T,{toolbar:{actions:r?[s(d,{onClick:()=>t([]),icon:s(B,{}),children:"取消编辑"},"cancelEdit"),s(d,{type:"primary",loading:i,icon:s(j,{}),onClick:async()=>{const n=await o.validateFields();await a({columns:Object.keys(n).map(c=>({...n[c],columnId:Number(c)}))}),t([])},children:"保存"},"edit")]:[s(k,{accessKey:"tool:gen:edit",children:s(d,{icon:s(w,{}),type:"primary",onClick:()=>{t(e.map(n=>n.columnId.toString()))},children:"编辑"})},"edit")]},rowKey:"columnId",ghost:!0,size:"small",scroll:{x:"max-content"},columns:u,value:e,recordCreatorProps:!1,editable:{form:o,editableKeys:l}})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const y={BASE_INFO:"基本信息",FIELD_INFO:"字段信息"},H=()=>{const e=A(),a=Number((e==null?void 0:e.tableId)??"0"),{message:i}=D.useApp(),[o,l]=p.useState("BASE_INFO"),{data:t,refresh:r}=Q(()=>O({tableId:a}),{ready:a>0,refreshDeps:[a]}),{mutateAsync:u,isLoading:n}=L(async c=>{await P({tableId:a,businessName:t.info.businessName,functionName:t.info.functionName,className:t.info.className,functionAuthor:t.info.functionAuthor,moduleName:t.info.moduleName,packageName:t.info.packageName,tableComment:t.info.tableComment,tableName:t.info.tableName,columns:t.rows,...c})},{onSuccess:()=>{r(),i.success("保存成功")}});return s(C,{children:s(b,{tabs:{items:[{label:y.BASE_INFO,key:"BASE_INFO",children:s(_,{dataSource:t==null?void 0:t.info,handleEdit:u})},{label:y.FIELD_INFO,key:"FIELD_INFO",children:s(G,{dataSource:t==null?void 0:t.rows,handleEdit:u,loading:n})}],activeKey:o,onChange:c=>{l(c)}}})})};export{H as default};
