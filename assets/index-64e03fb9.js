import{e as X,a as Y,j as a,P as J,d as $,a2 as U,an as Z,ay as R,az as j,aA as k,r as P,aB as E,A as N,a8 as v,b as u,a3 as L,au as _,aC as ee,o as te,aD as ae,a6 as se,p as x,aE as re,aF as oe,aG as ne,aH as ce,F as le,aI as M,O,D as w,aJ as ie,f as de,aK as ue,aL as pe,aM as me,aN as he,aO as ge,B as ye,Q as T}from"./index-9b04425e.js";import{a as fe,u as De}from"./utils-cdbd9712.js";import{u as Pe}from"./index-1bfa8f9d.js";import{u as q}from"./useMutation-4d311f48.js";import{P as be}from"./index-039a11a9.js";import{P as Se}from"./index-8285b044.js";import{P as D}from"./index-9f931991.js";import{u as Te}from"./useRequest-9131ff3a.js";import{P as A}from"./index-39ca5a84.js";import{P as Ae}from"./index-46636d24.js";import{T as C}from"./index-6cf04428.js";var Ie=["fieldProps","request","params","proFieldProps"],Ne=function(t,o){var r=t.fieldProps,l=t.request,s=t.params,n=t.proFieldProps,c=Y(t,Ie);return a(J,$({valueType:"treeSelect",fieldProps:r,ref:o,request:l,params:s,filedConfig:{customLightMode:!0},proFieldProps:n},c))},ve=X.forwardRef(Ne);const xe=ve;globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const B="systemDept",b=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/dept/model/index.ts/atomDeptDetails",fe({open:!1,deptId:0,deptName:""}));b.debugLabel="atomDeptDetails";const Q=()=>U(b),Fe=()=>{const e=Z(b);return(t,o)=>{e({open:!0,deptId:t,deptName:o})}},we=()=>De(b),K=[B,"list"],Ce=(e,t)=>{const o=R(K,async()=>{const r=await j(e);return{treeData:k(r,{id:"deptId",pId:"parentId",rootPId:null}),map:r.reduce((s,n)=>s.set(n.deptId,n),new Map),allParentIds:Array.from(r.reduce((s,n)=>s.add(n.parentId),new Set))}},{onSuccess:r=>{t.onSuccess(r.allParentIds)}});return P.useEffect(()=>{o.refetch()},[e]),o},V=()=>{const e=E();return()=>e.invalidateQueries(K)},W=[B,"options"],z=()=>R(W,async()=>{const e=await j({});return k(e,{id:"deptId",pId:"parentId",rootPId:null})}),G=()=>{const e=E();return()=>e.invalidateQueries(W)};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Re=()=>{const{message:e}=N.useApp(),t=P.useRef(),[o,{toggle:r}]=Pe(),{data:l,refetch:s}=z(),{defaultValueSysNormalDisable:n,valueEnumSysNormalDisable:c}=v(),{mutate:p,isLoading:m}=q(async()=>{var h;const i=await((h=t.current)==null?void 0:h.validateFields());await ae(i)},{onSuccess:async()=>{var i;r(),(i=t.current)==null||i.resetFields(),s(),e.success("新增成功")}});return u(L,{accessKey:"system:dept:add",children:[a(_,{onClick:r}),a(ee,{title:"新增部门",okText:"提交",open:o,onCancel:r,onOk:()=>p(),okButtonProps:{loading:m},children:u(te,{submitter:!1,formRef:t,grid:!0,rowProps:{gutter:[16,0]},children:[a(xe,{name:"parentId",label:"上级部门",rules:[{required:!0,message:"请选择上级部门"}],fieldProps:{treeData:l??[],fieldNames:{label:"deptName",value:"deptId"}}}),a(D,{name:"deptName",label:"部门名称",rules:[{required:!0}],colProps:{span:12}}),a(be,{name:"orderNum",label:"显示排序",initialValue:0,rules:[{required:!0}],colProps:{span:12}}),a(D,{name:"leader",label:"负责人",colProps:{span:12}}),a(D,{name:"phone",label:"联系电话",colProps:{span:12}}),a(D,{name:"email",label:"邮箱",colProps:{span:12}}),a(Se.Group,{name:"status",label:"状态",valueEnum:c,initialValue:n,colProps:{span:12}})]})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const je=()=>{const{deptId:e,deptName:t,open:o}=Q(),r=we(),l=V(),s=G(),{message:n,modal:c}=N.useApp();return a(L,{accessKey:"system:dept:remove",children:a(se,{disabled:!o,type:"primary",size:"middle",onClick:()=>{c.confirm({title:"删除确认",content:u(x,{children:["确定删除部门",a(re.Text,{code:!0,children:t}),"吗？"]}),onOk:async()=>{await oe({deptId:e}),await Promise.all([r(),l(),s()]),n.success("删除成功")}})}})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const I={xs:1,sm:1,md:1,lg:1,xl:2},ke=()=>{const e=V(),t=G(),{message:o}=N.useApp(),{deptId:r,open:l}=Q(),{data:s}=z(),{valueEnumSysNormalDisable:n}=v(),{data:c,loading:p,refresh:m}=Te(async()=>{const{ancestors:d,...y}=await ne({deptId:r}),f=(d==null?void 0:d.split(","))??[];return{...y,ancestors:Number(f[f.length-1])}},{ready:l&&r>0,refreshDeps:[r],onSuccess:()=>{F([])}}),{mutateAsync:i}=q(ie,{onSuccess:async()=>{m(),await Promise.all([e(),t()]),o.success("保存成功")}}),h=ce(),[g]=le.useForm(),[H,F]=P.useState([]),S=h("system:dept:edit")?{form:g,editableKeys:H,onChange:(d,y)=>{if(F(d),d.length>0){const[f]=d;g.setFieldsValue({[f]:y[f]})}},onSave:async(d,y)=>{await i({deptId:r,deptName:c.deptName,orderNum:c.orderNum,parentId:c.parentId,[d]:y[d]})}}:void 0;return l?u(O,{spinning:p,children:[a(A,{column:I,editable:S,dataSource:c,columns:[{title:"状态",dataIndex:"status",key:"status",valueType:"select",valueEnum:n},{title:"排序",dataIndex:"orderNum",key:"orderNum",valueType:"digit"},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",editable:!1}]}),a(w,{}),a(A,{column:I,editable:S,dataSource:c,columns:[{title:"部门名称",dataIndex:"deptName",key:"deptName",valueType:"text"},{title:"上级部门",dataIndex:"parentId",key:"parentId",valueType:"treeSelect",fieldProps:{treeData:s,dropdownMatchSelectWidth:250,fieldNames:{label:"deptName",value:"deptId"}}}]}),a(w,{}),a(A,{column:I,editable:S,dataSource:c,columns:[{title:"负责人",dataIndex:"leader",key:"leader",valueType:"text"},{title:"联系电话",dataIndex:"phone",key:"phone",valueType:"text"},{title:"邮箱",dataIndex:"email",key:"email",valueType:"text"}]})]}):a(M,{description:"点击选择左侧部门项查看详情"})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ee=e=>u(x,{children:[a(C,{color:"rgb(148 163 184)",children:e.orderNum}),u(ge,{children:[e.deptName,a(C,{color:e.status==="NORMAL"?"success":"error",children:e.status==="NORMAL"?"启用中":"已禁用"})]})]}),Le=()=>{var m;const[e,t]=P.useState([]),[o,r]=P.useState({}),{valueEnumSysNormalDisable:l}=v(),{data:s,isFetching:n}=Ce(o,{onSuccess:i=>{t(i)}}),c=Fe(),p=(e==null?void 0:e.length)!==0&&(e==null?void 0:e.length)===((m=s==null?void 0:s.allParentIds)==null?void 0:m.length);return u(x,{children:[u("div",{className:"flex justify-between items-center",children:[a(de,{size:"small",className:"my-2",icon:p?a(ue,{}):a(pe,{}),onClick:()=>t(p?[]:s==null?void 0:s.allParentIds),children:p?"全部折叠":"全部展开"}),u(me,{onFinish:async i=>r(i),children:[a(D,{name:"deptName",label:"部门名称"}),a(Ae,{name:"status",label:"状态",valueEnum:l})]})]}),a(O,{spinning:n,children:s!=null&&s.treeData.length?a(he,{blockNode:!0,showLine:{showLeafIcon:!1},titleRender:Ee,treeData:s.treeData,expandedKeys:e,onExpand:t,height:700,fieldNames:{title:"deptName",key:"deptId"},onSelect:(i,{selected:h,node:{key:g}})=>{h&&c(g,s.map.get(g).deptName)}}):a(M,{})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Xe=()=>a(ye,{children:u(T,{ghost:!0,gutter:[16,16],wrap:!0,children:[a(T,{title:"部门列表",colSpan:{xxl:8,xl:12,lg:14,md:24,sm:24,xs:24},extra:a(Re,{}),children:a(Le,{})}),a(T,{title:"部门详情",colSpan:{xxl:16,xl:12,lg:10,md:24,sm:24,xs:24},className:"h-full",extra:a(je,{}),children:a(ke,{})})]})});export{Xe as default};
