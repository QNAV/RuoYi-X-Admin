import{c as p,f as b,b as y,g as K,h as Q,d as G}from"./tslib.es6-3c43c0a4.js";import{r as m}from"./antd-5b22be5a.js";import{x as X,y as Y}from"./antdProComponents-6fa50338.js";var Z=function(e){return function(n,r){var t=m.useRef(!1);e(function(){return function(){t.current=!1}},[]),e(function(){if(!t.current)t.current=!0;else return n()},r)}},x=function(e){return typeof e=="function"},I=!1;const D=I;function C(e){D&&(x(e)||console.error("useMemoizedFn expected parameter is a function, got ".concat(typeof e)));var n=m.useRef(e);n.current=m.useMemo(function(){return e},[e]);var r=m.useRef();return r.current||(r.current=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return n.current.apply(this,t)}),r.current}const j=Z(m.useEffect);var V=function(e,n){var r=n.manual,t=n.ready,i=t===void 0?!0:t,a=n.defaultParams,o=a===void 0?[]:a,c=n.refreshDeps,s=c===void 0?[]:c,u=n.refreshDepsAction,v=m.useRef(!1);return v.current=!1,j(function(){!r&&i&&(v.current=!0,e.run.apply(e,p([],b(o),!1)))},[i]),j(function(){v.current||r||(v.current=!0,u?u():e.refresh())},p([],b(s),!1)),{onBefore:function(){if(!i)return{stopNow:!0}}}};V.onInit=function(e){var n=e.ready,r=n===void 0?!0:n,t=e.manual;return{loading:!t&&r}};const k=V;function ee(e,n){if(e===n)return!0;for(var r=0;r<e.length;r++)if(!Object.is(e[r],n[r]))return!1;return!0}function q(e,n){var r=m.useRef({deps:n,obj:void 0,initialized:!1}).current;return(r.initialized===!1||!ee(r.deps,n))&&(r.deps=n,r.obj=e(),r.initialized=!0),r.obj}function J(e){var n=m.useRef(e);return n.current=e,n}var ne=function(e){D&&(x(e)||console.error("useUnmount expected parameter is a function, got ".concat(typeof e)));var n=J(e);m.useEffect(function(){return function(){n.current()}},[])};const H=ne;var $=new Map,re=function(e,n,r){var t=$.get(e);t!=null&&t.timer&&clearTimeout(t.timer);var i=void 0;n>-1&&(i=setTimeout(function(){$.delete(e)},n)),$.set(e,y(y({},r),{timer:i}))},te=function(e){return $.get(e)},F=new Map,ue=function(e){return F.get(e)},ie=function(e,n){F.set(e,n),n.then(function(r){return F.delete(e),r}).catch(function(){F.delete(e)})},w={},ae=function(e,n){w[e]&&w[e].forEach(function(r){return r(n)})},L=function(e,n){return w[e]||(w[e]=[]),w[e].push(n),function(){var t=w[e].indexOf(n);w[e].splice(t,1)}},oe=function(e,n){var r=n.cacheKey,t=n.cacheTime,i=t===void 0?5*60*1e3:t,a=n.staleTime,o=a===void 0?0:a,c=n.setCache,s=n.getCache,u=m.useRef(),v=m.useRef(),d=function(f,l){c?c(l):re(f,i,l),ae(f,l.data)},h=function(f,l){return l===void 0&&(l=[]),s?s(l):te(f)};return q(function(){if(r){var f=h(r);f&&Object.hasOwnProperty.call(f,"data")&&(e.state.data=f.data,e.state.params=f.params,(o===-1||new Date().getTime()-f.time<=o)&&(e.state.loading=!1)),u.current=L(r,function(l){e.setState({data:l})})}},[]),H(function(){var f;(f=u.current)===null||f===void 0||f.call(u)}),r?{onBefore:function(f){var l=h(r,f);return!l||!Object.hasOwnProperty.call(l,"data")?{}:o===-1||new Date().getTime()-l.time<=o?{loading:!1,data:l==null?void 0:l.data,error:void 0,returnNow:!0}:{data:l==null?void 0:l.data,error:void 0}},onRequest:function(f,l){var g=ue(r);return g&&g!==v.current?{servicePromise:g}:(g=f.apply(void 0,p([],b(l),!1)),v.current=g,ie(r,g),{servicePromise:g})},onSuccess:function(f,l){var g;r&&((g=u.current)===null||g===void 0||g.call(u),d(r,{data:f,params:l,time:new Date().getTime()}),u.current=L(r,function(S){e.setState({data:S})}))},onMutate:function(f){var l;r&&((l=u.current)===null||l===void 0||l.call(u),d(r,{data:f,params:e.state.params,time:new Date().getTime()}),u.current=L(r,function(g){e.setState({data:g})}))}}:{}};const se=oe;var ce=function(e,n){var r=n.debounceWait,t=n.debounceLeading,i=n.debounceTrailing,a=n.debounceMaxWait,o=m.useRef(),c=m.useMemo(function(){var s={};return t!==void 0&&(s.leading=t),i!==void 0&&(s.trailing=i),a!==void 0&&(s.maxWait=a),s},[t,i,a]);return m.useEffect(function(){if(r){var s=e.runAsync.bind(e);return o.current=X(function(u){u()},r,c),e.runAsync=function(){for(var u=[],v=0;v<arguments.length;v++)u[v]=arguments[v];return new Promise(function(d,h){var f;(f=o.current)===null||f===void 0||f.call(o,function(){s.apply(void 0,p([],b(u),!1)).then(d).catch(h)})})},function(){var u;(u=o.current)===null||u===void 0||u.cancel(),e.runAsync=s}}},[r,c]),r?{onCancel:function(){var s;(s=o.current)===null||s===void 0||s.cancel()}}:{}};const fe=ce;var le=function(e,n){var r=n.loadingDelay,t=n.ready,i=m.useRef();if(!r)return{};var a=function(){i.current&&clearTimeout(i.current)};return{onBefore:function(){return a(),t!==!1&&(i.current=setTimeout(function(){e.setState({loading:!0})},r)),{loading:!1}},onFinally:function(){a()},onCancel:function(){a()}}};const de=le;var ve=!!(typeof window<"u"&&window.document&&window.document.createElement);const M=ve;function N(){return M?document.visibilityState!=="hidden":!0}var A=[];function me(e){return A.push(e),function(){var r=A.indexOf(e);A.splice(r,1)}}if(M){var he=function(){if(N())for(var e=0;e<A.length;e++){var n=A[e];n()}};window.addEventListener("visibilitychange",he,!1)}var ge=function(e,n){var r=n.pollingInterval,t=n.pollingWhenHidden,i=t===void 0?!0:t,a=n.pollingErrorRetryCount,o=a===void 0?-1:a,c=m.useRef(),s=m.useRef(),u=m.useRef(0),v=function(){var d;c.current&&clearTimeout(c.current),(d=s.current)===null||d===void 0||d.call(s)};return j(function(){r||v()},[r]),r?{onBefore:function(){v()},onError:function(){u.current+=1},onSuccess:function(){u.current=0},onFinally:function(){o===-1||o!==-1&&u.current<=o?c.current=setTimeout(function(){!i&&!N()?s.current=me(function(){e.refresh()}):e.refresh()},r):u.current=0},onCancel:function(){v()}}:{}};const pe=ge;function be(e,n){var r=!1;return function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];r||(r=!0,e.apply(void 0,p([],b(t),!1)),setTimeout(function(){r=!1},n))}}function ye(){return M&&typeof navigator.onLine<"u"?navigator.onLine:!0}var E=[];function Pe(e){return E.push(e),function(){var r=E.indexOf(e);r>-1&&E.splice(r,1)}}if(M){var z=function(){if(!(!N()||!ye()))for(var e=0;e<E.length;e++){var n=E[e];n()}};window.addEventListener("visibilitychange",z,!1),window.addEventListener("focus",z,!1)}var Re=function(e,n){var r=n.refreshOnWindowFocus,t=n.focusTimespan,i=t===void 0?5e3:t,a=m.useRef(),o=function(){var c;(c=a.current)===null||c===void 0||c.call(a)};return m.useEffect(function(){if(r){var c=be(e.refresh.bind(e),i);a.current=Pe(function(){c()})}return function(){o()}},[r,i]),H(function(){o()}),{}};const we=Re;var Ce=function(e,n){var r=n.retryInterval,t=n.retryCount,i=m.useRef(),a=m.useRef(0),o=m.useRef(!1);return t?{onBefore:function(){o.current||(a.current=0),o.current=!1,i.current&&clearTimeout(i.current)},onSuccess:function(){a.current=0},onError:function(){if(a.current+=1,t===-1||a.current<=t){var c=r??Math.min(1e3*Math.pow(2,a.current),3e4);i.current=setTimeout(function(){o.current=!0,e.refresh()},c)}else a.current=0},onCancel:function(){a.current=0,i.current&&clearTimeout(i.current)}}:{}};const Te=Ce;var Ae=function(e,n){var r=n.throttleWait,t=n.throttleLeading,i=n.throttleTrailing,a=m.useRef(),o={};return t!==void 0&&(o.leading=t),i!==void 0&&(o.trailing=i),m.useEffect(function(){if(r){var c=e.runAsync.bind(e);return a.current=Y(function(s){s()},r,o),e.runAsync=function(){for(var s=[],u=0;u<arguments.length;u++)s[u]=arguments[u];return new Promise(function(v,d){var h;(h=a.current)===null||h===void 0||h.call(a,function(){c.apply(void 0,p([],b(s),!1)).then(v).catch(d)})})},function(){var s;e.runAsync=c,(s=a.current)===null||s===void 0||s.cancel()}}},[r,t,i]),r?{onCancel:function(){var c;(c=a.current)===null||c===void 0||c.cancel()}}:{}};const Ee=Ae;var Se=function(e){D&&(x(e)||console.error('useMount: parameter `fn` expected to be a function, but got "'.concat(typeof e,'".'))),m.useEffect(function(){e==null||e()},[])};const Oe=Se;var $e=function(){var e=b(m.useState({}),2),n=e[1];return m.useCallback(function(){return n({})},[])};const Fe=$e;var xe=function(){function e(n,r,t,i){i===void 0&&(i={}),this.serviceRef=n,this.options=r,this.subscribe=t,this.initState=i,this.count=0,this.state={loading:!1,params:void 0,data:void 0,error:void 0},this.state=y(y(y({},this.state),{loading:!r.manual}),i)}return e.prototype.setState=function(n){n===void 0&&(n={}),this.state=y(y({},this.state),n),this.subscribe()},e.prototype.runPluginHandler=function(n){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];var i=this.pluginImpls.map(function(a){var o;return(o=a[n])===null||o===void 0?void 0:o.call.apply(o,p([a],b(r),!1))}).filter(Boolean);return Object.assign.apply(Object,p([{}],b(i),!1))},e.prototype.runAsync=function(){for(var n,r,t,i,a,o,c,s,u,v,d=[],h=0;h<arguments.length;h++)d[h]=arguments[h];return K(this,void 0,void 0,function(){var f,l,g,S,W,_,B,O,P,R,U;return Q(this,function(T){switch(T.label){case 0:if(this.count+=1,f=this.count,l=this.runPluginHandler("onBefore",d),g=l.stopNow,S=g===void 0?!1:g,W=l.returnNow,_=W===void 0?!1:W,B=G(l,["stopNow","returnNow"]),S)return[2,new Promise(function(){})];if(this.setState(y({loading:!0,params:d},B)),_)return[2,Promise.resolve(B.data)];(r=(n=this.options).onBefore)===null||r===void 0||r.call(n,d),T.label=1;case 1:return T.trys.push([1,3,,4]),O=this.runPluginHandler("onRequest",this.serviceRef.current,d).servicePromise,O||(O=(U=this.serviceRef).current.apply(U,p([],b(d),!1))),[4,O];case 2:return P=T.sent(),f!==this.count?[2,new Promise(function(){})]:(this.setState({data:P,error:void 0,loading:!1}),(i=(t=this.options).onSuccess)===null||i===void 0||i.call(t,P,d),this.runPluginHandler("onSuccess",P,d),(o=(a=this.options).onFinally)===null||o===void 0||o.call(a,d,P,void 0),f===this.count&&this.runPluginHandler("onFinally",d,P,void 0),[2,P]);case 3:if(R=T.sent(),f!==this.count)return[2,new Promise(function(){})];throw this.setState({error:R,loading:!1}),(s=(c=this.options).onError)===null||s===void 0||s.call(c,R,d),this.runPluginHandler("onError",R,d),(v=(u=this.options).onFinally)===null||v===void 0||v.call(u,d,void 0,R),f===this.count&&this.runPluginHandler("onFinally",d,void 0,R),R;case 4:return[2]}})})},e.prototype.run=function(){for(var n=this,r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];this.runAsync.apply(this,p([],b(r),!1)).catch(function(i){n.options.onError||console.error(i)})},e.prototype.cancel=function(){this.count+=1,this.setState({loading:!1}),this.runPluginHandler("onCancel")},e.prototype.refresh=function(){this.run.apply(this,p([],b(this.state.params||[]),!1))},e.prototype.refreshAsync=function(){return this.runAsync.apply(this,p([],b(this.state.params||[]),!1))},e.prototype.mutate=function(n){var r=x(n)?n(this.state.data):n;this.runPluginHandler("onMutate",r),this.setState({data:r})},e}();const De=xe;function Me(e,n,r){n===void 0&&(n={}),r===void 0&&(r=[]);var t=n.manual,i=t===void 0?!1:t,a=G(n,["manual"]);D&&n.defaultParams&&!Array.isArray(n.defaultParams)&&console.warn("expected defaultParams is array, got ".concat(typeof n.defaultParams));var o=y({manual:i},a),c=J(e),s=Fe(),u=q(function(){var v=r.map(function(d){var h;return(h=d==null?void 0:d.onInit)===null||h===void 0?void 0:h.call(d,o)}).filter(Boolean);return new De(c,o,s,Object.assign.apply(Object,p([{}],b(v),!1)))},[]);return u.options=o,u.pluginImpls=r.map(function(v){return v(u,o)}),Oe(function(){if(!i){var v=u.state.params||n.defaultParams||[];u.run.apply(u,p([],b(v),!1))}}),H(function(){u.cancel()}),{loading:u.state.loading,data:u.state.data,error:u.state.error,params:u.state.params||[],cancel:C(u.cancel.bind(u)),refresh:C(u.refresh.bind(u)),refreshAsync:C(u.refreshAsync.bind(u)),run:C(u.run.bind(u)),runAsync:C(u.runAsync.bind(u)),mutate:C(u.mutate.bind(u))}}function je(e,n,r){return Me(e,n,p(p([],b(r||[]),!1),[fe,de,pe,we,Ee,k,se,Te],!1))}export{M as i,je as u};
