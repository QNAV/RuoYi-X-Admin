import{b as d,j as t,l as z,m as $,e as b,n as H,o as J,F as T,i as S,p as U,q as Z,k as N}from"./antdProComponents-6fa50338.js";import{h as _,F as ee,Q as R,R as k,T as j,U as E,V as x,A as L,L as te,W as se,l as ae,X as oe,Y as re,Z as ne,_ as B,$ as ce,B as le}from"./index-dffabdf2.js";import{r as f,bm as v,aC as ie,J as de,F as ue,aa as M,aG as C,B as pe,be as he,bf as me,a$ as ge,bv as F,a9 as ye}from"./antd-5b22be5a.js";import{a as De,u as be}from"./utils-300c3bed.js";import{u as fe}from"./index-be96fd30.js";import{u as O}from"./useMutation-dd6321b2.js";import{u as Ae}from"./useRequest-f9345e2b.js";import"./iconPark-f28c66b3.js";import"./wangEditor-77edb64d.js";import"./tslib.es6-3c43c0a4.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const q="systemDept",A=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/dept/model/index.ts/atomDeptDetails",De({open:!1,deptId:0,deptName:""}));A.debugLabel="atomDeptDetails";const Q=()=>_(A),Ie=()=>{const e=ee(A);return(s,r)=>{e({open:!0,deptId:s,deptName:r})}},Se=()=>be(A),V=[q,"list"],Ne=(e,s)=>{const r=R(V,async()=>{const o=await k(e);return{treeData:j(o,{id:"deptId",pId:"parentId",rootPId:null}),map:o.reduce((a,n)=>a.set(n.deptId,n),new Map),allParentIds:Array.from(o.reduce((a,n)=>a.add(n.parentId),new Set))}},{onSuccess:o=>{s.onSuccess(o.allParentIds)}});return f.useEffect(()=>{r.refetch()},[e]),r},K=()=>{const e=E();return()=>e.invalidateQueries(V)},W=[q,"options"],G=()=>R(W,async()=>{const e=await k({});return j(e,{id:"deptId",pId:"parentId",rootPId:null})}),X=()=>{const e=E();return()=>e.invalidateQueries(W)};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const Pe=()=>{const{message:e}=v.useApp(),s=f.useRef(),[r,{toggle:o}]=fe(),{data:u,refetch:a}=G(),{defaultValueSysNormalDisable:n,valueEnumSysNormalDisable:c}=x(),{mutate:p,isLoading:h}=O(async()=>{var m;const l=await((m=s.current)==null?void 0:m.validateFields());await se(l)},{onSuccess:async()=>{var l;o(),(l=s.current)==null||l.resetFields(),a(),e.success("新增成功")}});return d(L,{accessKey:"system:dept:add",children:[t(te,{onClick:o}),t(ie,{title:"新增部门",okText:"提交",open:r,onCancel:o,onOk:()=>p(),okButtonProps:{loading:h},children:d(z,{submitter:!1,formRef:s,grid:!0,rowProps:{gutter:[16,0]},children:[t($,{name:"parentId",label:"上级部门",rules:[{required:!0,message:"请选择上级部门"}],fieldProps:{treeData:u??[],fieldNames:{label:"deptName",value:"deptId"}}}),t(b,{name:"deptName",label:"部门名称",rules:[{required:!0}],colProps:{span:12}}),t(H,{name:"orderNum",label:"显示排序",initialValue:0,rules:[{required:!0}],colProps:{span:12}}),t(b,{name:"leader",label:"负责人",colProps:{span:12}}),t(b,{name:"phone",label:"联系电话",colProps:{span:12}}),t(b,{name:"email",label:"邮箱",colProps:{span:12}}),t(J.Group,{name:"status",label:"状态",valueEnum:c,initialValue:n,colProps:{span:12}})]})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const Te=()=>{const{deptId:e,deptName:s,open:r}=Q(),o=Se(),u=K(),a=X(),{message:n,modal:c}=v.useApp();return t(L,{accessKey:"system:dept:remove",children:t(ae,{disabled:!r,type:"primary",size:"middle",onClick:()=>{c.confirm({title:"删除确认",content:d(T,{children:["确定删除部门",t(de.Text,{code:!0,children:s}),"吗？"]}),onOk:async()=>{await oe({deptId:e}),await Promise.all([o(),u(),a()]),n.success("删除成功")}})}})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const P={xs:1,sm:1,md:1,lg:1,xl:2},xe=()=>{const e=K(),s=X(),{message:r}=v.useApp(),{deptId:o,open:u}=Q(),{data:a}=G(),{valueEnumSysNormalDisable:n}=x(),{data:c,loading:p,refresh:h}=Ae(async()=>{const{ancestors:i,...y}=await re({deptId:o}),D=(i==null?void 0:i.split(","))??[];return{...y,ancestors:Number(D[D.length-1])}},{ready:u&&o>0,refreshDeps:[o],onSuccess:()=>{w([])}}),{mutateAsync:l}=O(ce,{onSuccess:async()=>{h(),await Promise.all([e(),s()]),r.success("保存成功")}}),m=ne(),[g]=ue.useForm(),[Y,w]=f.useState([]),I=m("system:dept:edit")?{form:g,editableKeys:Y,onChange:(i,y)=>{if(w(i),i.length>0){const[D]=i;g.setFieldsValue({[D]:y[D]})}},onSave:async(i,y)=>{await l({deptId:o,deptName:c.deptName,orderNum:c.orderNum,parentId:c.parentId,[i]:y[i]})}}:void 0;return u?d(M,{spinning:p,children:[t(S,{column:P,editable:I,dataSource:c,columns:[{title:"状态",dataIndex:"status",key:"status",valueType:"select",valueEnum:n},{title:"排序",dataIndex:"orderNum",key:"orderNum",valueType:"digit"},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",editable:!1}]}),t(C,{}),t(S,{column:P,editable:I,dataSource:c,columns:[{title:"部门名称",dataIndex:"deptName",key:"deptName",valueType:"text"},{title:"上级部门",dataIndex:"parentId",key:"parentId",valueType:"treeSelect",fieldProps:{treeData:a,dropdownMatchSelectWidth:250,fieldNames:{label:"deptName",value:"deptId"}}}]}),t(C,{}),t(S,{column:P,editable:I,dataSource:c,columns:[{title:"负责人",dataIndex:"leader",key:"leader",valueType:"text"},{title:"联系电话",dataIndex:"phone",key:"phone",valueType:"text"},{title:"邮箱",dataIndex:"email",key:"email",valueType:"text"}]})]}):t(B,{description:"点击选择左侧部门项查看详情"})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const ve=e=>d(T,{children:[t(F,{color:"rgb(148 163 184)",children:e.orderNum}),d(ye,{children:[e.deptName,t(F,{color:e.status==="NORMAL"?"success":"error",children:e.status==="NORMAL"?"启用中":"已禁用"})]})]}),we=()=>{var h;const[e,s]=f.useState([]),[r,o]=f.useState({}),{valueEnumSysNormalDisable:u}=x(),{data:a,isFetching:n}=Ne(r,{onSuccess:l=>{s(l)}}),c=Ie(),p=(e==null?void 0:e.length)!==0&&(e==null?void 0:e.length)===((h=a==null?void 0:a.allParentIds)==null?void 0:h.length);return d(T,{children:[d("div",{className:"flex justify-between items-center",children:[t(pe,{size:"small",className:"my-2",icon:p?t(he,{}):t(me,{}),onClick:()=>s(p?[]:a==null?void 0:a.allParentIds),children:p?"全部折叠":"全部展开"}),d(U,{onFinish:async l=>o(l),children:[t(b,{name:"deptName",label:"部门名称"}),t(Z,{name:"status",label:"状态",valueEnum:u})]})]}),t(M,{spinning:n,children:a!=null&&a.treeData.length?t(ge,{blockNode:!0,showLine:{showLeafIcon:!1},titleRender:ve,treeData:a.treeData,expandedKeys:e,onExpand:s,height:700,fieldNames:{title:"deptName",key:"deptId"},onSelect:(l,{selected:m,node:{key:g}})=>{m&&c(g,a.map.get(g).deptName)}}):t(B,{})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const qe=()=>t(le,{children:d(N,{ghost:!0,gutter:[16,16],wrap:!0,children:[t(N,{title:"部门列表",colSpan:{xxl:8,xl:12,lg:14,md:24,sm:24,xs:24},extra:t(Pe,{}),children:t(we,{})}),t(N,{title:"部门详情",colSpan:{xxl:16,xl:12,lg:10,md:24,sm:24,xs:24},className:"h-full",extra:t(Te,{}),children:t(xe,{})})]})});export{qe as default};
