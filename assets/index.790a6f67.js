import{aP as $,W as z,j as a,aQ as J,_ as U,ai as T,aj as g,aM as Z,w as C,q as I,ak as ee,al as L,e as d,F as q,am as te,bJ as ae,an as y,s as V,v as B,g as j,r as b,aH as W,a2 as m,a4 as se,aD as oe,b4 as S,aL as re,ap as ue,bK as ce,$ as ne,bL as ie,a$ as le,b0 as de,bM as he,b5 as me,aq as pe,ar as ge,as as be,O as Ce}from"./index.81083d84.js";import{e as f,j as x,a as ye}from"./index.f96d154a.js";import{b as Ae}from"./index.08fe5c8b.js";import{a as X,u as Y}from"./utils.eb113b90.js";import{T as Te,a as fe}from"./index.63a1eab6.js";import{u as M}from"./useMutation.esm.df12e81c.js";import{f as Fe}from"./SysConfigService.26c1e045.js";import{e as _,W as Pe}from"./SysDeptService.04df45d0.js";import{P as we}from"./index.3dff4c9d.js";import{u as E}from"./useRequest.354d8fca.js";import{u as Se}from"./index.6f3c5b64.js";import"./useQuery.esm.b461aa08.js";import"./utils.esm.2a5188fb.js";var Ee=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],Be=$.forwardRef(function(e,t){var o=e.fieldProps,s=e.unCheckedChildren,r=e.checkedChildren,n=e.proFieldProps,u=z(e,Ee);return a(J,U({valueType:"switch",fieldProps:U({unCheckedChildren:s,checkedChildren:r},o),ref:t,valuePropName:"checked",proFieldProps:n,filedConfig:{valuePropName:"checked",ignoreWidth:!0}},u))});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const je=({record:e})=>{const{canEditSysUser:t}=f(),o=Je();return a(T,{accessible:t,children:a(g,{type:"link",icon:a(Z,{}),onClick:()=>o(e),children:"\u7F16\u8F91"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};async function Me(e,t){return C("/system/user/",{method:"GET",params:{...e},...t||{}})}async function Re(e,t){return C("/system/user/add",{method:"POST",headers:{"Content-Type":"application/json"},data:e,...t||{}})}async function ke(e,t){return C("/system/user/export",{method:"POST",headers:{"Content-Type":"application/json"},data:e,...t||{}})}async function xe(e){return C("/system/user/importTemplate",{method:"POST",...e||{}})}async function Ie(e,t){return C("/system/user/list",{method:"POST",headers:{"Content-Type":"application/json"},data:e,...t||{}})}async function Ne(e,t){return C("/system/user/remove",{method:"POST",params:{...e},...t||{}})}async function De(e,t){return C("/system/user/resetPwd",{method:"POST",headers:{"Content-Type":"application/json"},data:e,...t||{}})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const H=({userId:e,userName:t,isBatch:o,disabled:s})=>{const r=o?"\u6279\u91CF\u5220\u9664":"\u5220\u9664",{canRemoveSysUser:n}=f(),u=K(),{mutateAsync:h,isLoading:F}=M(A=>Ne({userIds:A}),{onSuccess:()=>{var A;u==null||u.reload(),(A=u==null?void 0:u.clearSelected)==null||A.call(u),I.success("\u5220\u9664\u6210\u529F")}});return a(T,{accessible:n,children:a(g,{type:"link",danger:!0,disabled:s,icon:a(ee,{}),onClick:()=>{L.confirm({title:"\u5220\u9664\u7528\u6237",content:d(q,{children:["\u786E\u5B9A\u5220\u9664\u7528\u6237",a(te.Text,{code:!0,children:t}),"\u5417\uFF1F"]}),onOk:()=>h(e),okButtonProps:{loading:F}})},children:r})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ve=({record:e})=>{const{canResetSysUserPwd:t}=f(),o=Ge();return a(T,{accessible:t,children:a(g,{type:"link",danger:!0,icon:a(ae,{}),onClick:()=>o(e),children:"\u91CD\u7F6E\u5BC6\u7801"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const[Oe,Pt,wt]=y({dataIndex:"userId",key:"userId",title:"\u7528\u6237\u7F16\u53F7",valueType:"text",editable:!1,hideInSearch:!0}),[Ue]=y({dataIndex:"userName",key:"userName",title:"\u7528\u6237\u540D\u79F0",valueType:"text"}),[Le]=y({dataIndex:"nickName",key:"nickName",title:"\u7528\u6237\u6635\u79F0",valueType:"text",hideInSearch:!0}),[qe]=y({dataIndex:["dept","deptName"],key:"deptDeptName",title:"\u90E8\u95E8\u540D\u79F0",valueType:"text",hideInSearch:!0}),[Ve]=y({dataIndex:"phoneNumber",key:"phoneNumber",title:"\u624B\u673A\u53F7\u7801",valueType:"text"},{table:{copyable:!0}}),We=()=>{const{data:e}=x("sys_normal_disable");return y({title:"\u72B6\u6001",dataIndex:"status",key:"status",valueType:"select",valueEnum:e!=null?e:{}})},Xe=y({title:"\u64CD\u4F5C",valueType:"option",render:(e,t)=>d(q,{children:[a(je,{record:t}),a(H,{userId:t.userId,userName:t.userName}),a(ve,{record:t})]})},{table:{fixed:"right",width:300}}),Ye=()=>[Oe,Ue,Le,qe,Ve,We(),Te,Xe,fe];globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const N=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomMainTableActions",V(void 0));N.debugLabel="atomMainTableActions";const K=()=>B(N),_e=()=>Ae(N),D=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomSelectedDeptId",V(0));D.debugLabel="atomSelectedDeptId";const He=()=>B(D),Ke=()=>j(D),R=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomResetPwdModal",X({open:!1}));R.debugLabel="atomResetPwdModal";const Ge=()=>{const e=j(R);return t=>{e({open:!0,record:t})}},Qe=()=>Y(R),$e=()=>B(R),w=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomAddOrEditModal",X({open:!1,actionType:"add"}));w.debugLabel="atomAddOrEditModal";const ze=()=>{const e=j(w);return()=>{e({open:!0,actionType:"add"})}},Je=()=>{const e=j(w);return t=>{e({open:!0,actionType:"edit",record:t})}},Ze=()=>Y(w),et=()=>B(w);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const tt=()=>{var v,O;const e=b.exports.useRef(),t=K(),o=Ze(),{open:s,actionType:r,record:n}=et(),u=ye(),{data:h}=x("sys_normal_disable"),{data:F}=x("sys_user_sex"),{data:p}=E(async()=>{const{posts:c,roles:i}=await Me({userId:u.data.userInfo.user.userId});return{posts:c.reduce((l,P)=>({...l,[P.postId]:P.postName}),{}),roles:i.reduce((l,P)=>({...l,[P.roleId]:P.roleName}),{})}}),{data:A}=E(async()=>(await Fe({configKey:"sys.user.initPassword"},{skipErrorHandler:!0})).data.msg),{data:k}=E(()=>_({}),{}),{isLoading:G,mutateAsync:Q}=M(async()=>{var i,l;const c=await((l=(i=e.current)==null?void 0:i.validateFieldsReturnFormatValue)==null?void 0:l.call(i));await Re(c)},{onSuccess:()=>{t==null||t.reload(),I.success(r==="add"?"\u65B0\u589E\u6210\u529F":"\u7F16\u8F91\u6210\u529F")}});return b.exports.useEffect(()=>{var c;if(s&&r==="edit"){const i=setTimeout(()=>{var l;(l=e.current)==null||l.setFieldsValue(n),clearTimeout(i)},0)}!s&&r==="edit"&&((c=e.current)==null||c.resetFields())},[s]),d(W,{title:r==="add"?"\u65B0\u589E\u7528\u6237":"\u7F16\u8F91\u7528\u6237",formRef:e,grid:!0,colProps:{span:12},modalProps:{okText:"\u63D0\u4EA4",onCancel:o,confirmLoading:G},width:600,open:s,onFinish:()=>Q(),children:[a(m,{name:"nickName",label:"\u7528\u6237\u6635\u79F0",rules:[{required:!0}]}),a(Pe,{name:"deptId",label:"\u5F52\u5C5E\u90E8\u95E8",fieldProps:{treeData:k!=null?k:[],fieldNames:{value:"id"}}}),a(m,{name:"phoneNumber",label:"\u624B\u673A\u53F7\u7801",rules:[{pattern:se,message:"\u624B\u673A\u53F7\u7801\u683C\u5F0F\u9519\u8BEF"}],fieldProps:{maxLength:11}}),a(m,{name:"email",label:"\u90AE\u7BB1",rules:[{pattern:oe,message:"\u90AE\u7BB1\u683C\u5F0F\u9519\u8BEF"}]}),r==="add"&&a(m,{name:"userName",label:"\u7528\u6237\u540D\u79F0",rules:[{required:!0}]}),r==="add"&&a(m.Password,{name:"password",label:"\u7528\u6237\u5BC6\u7801",rules:[{required:!0}],initialValue:A}),a(S,{name:"sex",label:"\u7528\u6237\u6027\u522B",valueEnum:F!=null?F:{}}),a(S,{name:"status",label:"\u72B6\u6001",valueEnum:h!=null?h:{},rules:[{required:!0}]}),a(S,{name:"postIds",label:"\u5C97\u4F4D",valueEnum:(v=p==null?void 0:p.posts)!=null?v:{},mode:"multiple",transform:c=>{let i=c;return Array.isArray(c)&&(i=c.map(l=>Number(l))),{postIds:i}}}),a(S,{name:"userType",label:"\u89D2\u8272",valueEnum:(O=p==null?void 0:p.roles)!=null?O:{},mode:"multiple",transform:c=>{let i=c;return Array.isArray(c)&&(i=c.map(l=>Number(l))),{roleIds:i}}}),a(we,{name:"remark",label:"\u5907\u6CE8",colProps:{span:24}})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const at=()=>{const e=Qe(),t=b.exports.useRef(),{open:o,record:s}=$e();return b.exports.useEffect(()=>{var r;if(o){(r=t.current)==null||r.resetFields();const n=setTimeout(()=>{var u;(u=t.current)==null||u.setFieldsValue({userName:s.userName}),clearTimeout(n)},0)}},[o]),d(W,{title:"\u91CD\u7F6E\u5BC6\u7801",open:o,modalProps:{onCancel:e},onFinish:async({password:r})=>{await De({...s,password:r})},children:[a(m,{name:"userName",label:"\u7528\u6237\u540D\u79F0",readonly:!0}),a(m.Password,{required:!0,name:"password",label:"\u65B0\u5BC6\u7801"}),a(m.Password,{required:!0,name:"confirmPassword",label:"\u786E\u8BA4\u5BC6\u7801"})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const st=()=>{const{canAddSysUser:e}=f(),t=ze();return a(T,{accessible:e,children:a(g,{type:"primary",icon:a(re,{}),onClick:t,children:"\u65B0\u589E"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ot=({searchParams:e})=>{const{canExportSysUser:t}=f(),{isLoading:o,mutate:s}=M(()=>ke(e),{onSuccess:()=>{I.success("\u5BFC\u51FA\u6210\u529F")}});return a(T,{accessible:t,children:a(g,{icon:a(ue,{}),loading:o,onClick:()=>s(),children:"\u5BFC\u51FA"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const rt=()=>{const{canImportSysUser:e}=f(),t=b.exports.useRef(),[o,{toggle:s}]=Se(),{mutate:r,isLoading:n}=M(xe);return d(T,{accessible:e,children:[a(g,{icon:a(ce,{}),onClick:s,children:"\u5BFC\u5165"}),d(L,{title:"\u5BFC\u5165\u7528\u6237",open:o,onCancel:s,children:[a("div",{className:"text-right",children:a(g,{type:"link",onClick:r,loading:n,children:"\u4E0B\u8F7D\u6A21\u677F"})}),d(ne,{layout:"horizontal",submitter:!1,formRef:t,children:[a(Be,{name:"isCover",label:"\u662F\u5426\u66F4\u65B0\u5DF2\u7ECF\u5B58\u5728\u7684\u7528\u6237\u6570\u636E"}),a(ie,{name:"list"})]})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ut=()=>{const[e,t]=b.exports.useState(""),o=Ke(),{data:s,loading:r}=E(()=>_({deptName:e}),{refreshDeps:[e]});return s?d(de,{spinning:r,children:[a(he.Search,{allowClear:!0,placeholder:"\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0",className:"mb-3",onSearch:n=>{t(n)}}),a(me,{treeData:s,defaultExpandAll:!0,fieldNames:{title:"label",key:"id"},onSelect:(n,{node:{key:u}})=>{o(u)}})]}):a(le,{})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ct=({selectedRows:e})=>d(be,{children:[d("span",{children:["\u5DF2\u9009\u62E9 ",e.length," \u9879"]}),a(H,{disabled:e.length===0,isBatch:!0,userId:e.map(t=>t.userId).join(","),userName:e.map(t=>t.userName).join(",")})]}),nt=(e,t)=>d("div",{className:"flex gap-4 w-full",children:[a("div",{className:"bg-white p-4",children:a(ut,{})}),a("div",{className:"overflow-auto w-full",children:t})]}),it=()=>{const e=_e(),[t,o]=b.exports.useState({}),s=He(),r=s>0?{deptId:s}:{},n=Ye();return a(pe,{rowKey:"userId",actionRef:e,columns:n,params:r,rowSelection:{alwaysShowAlert:!0},tableAlertRender:ct,request:async(...u)=>{const h=ge(...u);return o(h),await Ie(h)},toolbar:{actions:[a(ot,{searchParams:t},"ButtonExport"),a(rt,{},"ButtonImport"),a(st,{},"ButtonAdd")]},tableRender:nt})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const St=()=>d(Ce,{children:[a(it,{}),a(tt,{}),a(at,{})]});export{St as default};
