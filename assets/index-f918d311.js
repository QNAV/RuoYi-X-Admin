import{ad as w,af as M,ci as y,aR as I,d as a,b3 as q,aK as g,cM as B,b5 as _,j as f,k as x,c3 as D,r as T,b_ as U,G as V,b7 as k,bf as v,b8 as N,aF as K}from"./index-324581e1.js";import{b as L,d as P}from"./index-0faee625.js";import{a as E}from"./index-8805c201.js";import{Z as S,_ as O,$ as F,a0 as X,a1 as Y}from"./System-c33174c5.js";import{u as j}from"./useMutation.esm-34ecafff.js";import{u as G}from"./index-8810ee74.js";import"./utils.esm-d0713da8.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const b=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/roleAuth/model/index.ts/atomMainTable",w(void 0));b.debugLabel="atomMainTable";const C=()=>M(b),Q=()=>E(b);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const R=({userId:e,userName:t,isBatch:n,disabled:s})=>{const l=n?"批量取消授权":"取消授权",i=y(),u=Number(i.roleId),{canEditSysRole:h}=L(),o=C(),{mutateAsync:m,isLoading:c}=j(async()=>{Array.isArray(e)?await S({roleId:u,userIds:e}):await O({roleId:u,userId:e})},{onSuccess:()=>{var r;o==null||o.reload(),(r=o==null?void 0:o.clearSelected)==null||r.call(o),I.success("取消授权成功")}});return a(q,{accessible:h,children:a(g,{type:"link",danger:!0,disabled:s,icon:a(B,{}),onClick:()=>{_.confirm({title:"取消授权",content:f(x,{children:["确定取消授权用户",a(D.Text,{code:!0,children:t}),"吗？"]}),onOk:()=>m(),okButtonProps:{loading:c}})},children:l})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Z=()=>{var p;const e=y(),t=Number(e.roleId),[n,{toggle:s}]=G(),l=T.exports.useRef(),[i,u]=T.exports.useState([]),h=C(),{isLoading:o,mutate:m}=j(()=>F({roleId:t,userIds:i}),{onSuccess:()=>{var r,d,A;(r=l.current)==null||r.reload(),(A=(d=l.current)==null?void 0:d.clearSelected)==null||A.call(d),h==null||h.reload(),s(),I.success("授权成功")}}),{data:c}=P("sys_common_status");return f(x,{children:[a(g,{type:"primary",icon:a(U,{}),onClick:()=>{var r;(r=l.current)==null||r.reload(),s()},children:"授权用户"}),a(V,{open:n,title:"授权用户",placement:"left",onClose:s,width:850,footer:a(g,{type:"primary",disabled:i.length===0,loading:o,onClick:()=>m(),children:"提交"}),footerStyle:{textAlign:"right"},children:a(k,{ghost:!0,rowKey:"userId",actionRef:l,columns:[{dataIndex:"userName",key:"userName",title:"用户名称",valueType:"text"},{dataIndex:"nickName",key:"nickName",title:"用户昵称",valueType:"text",hideInSearch:!0},{dataIndex:"email",title:"邮箱",valueType:"text",hideInSearch:!0,formItemProps:{rules:[{required:!0,message:"请输入邮箱"},{pattern:v,message:"邮箱格式错误"}]}},{dataIndex:"phoneNumber",key:"phoneNumber",title:"手机号码",valueType:"text",copyable:!0},{title:"状态",dataIndex:"status",key:"status",valueType:"select",valueEnum:(p=c==null?void 0:c.mapData)!=null?p:{},formItemProps:{initialValue:c==null?void 0:c.defaultValue,required:!0,rules:[{required:!0,message:"请选择状态"}]}},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",editable:!1,hideInSearch:!0,sorter:!0}],tableAlertRender:!1,rowSelection:{onChange:r=>{u(r)}},request:(...r)=>X(N(...r))})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const $=({selectedRows:e})=>a(R,{userId:e.map(t=>t.userId),userName:e.map(t=>t.userName).join(","),isBatch:!0,disabled:e.length===0}),z=()=>{var l;const e=y(),t=Number(e.roleId),n=Q(),{data:s}=P("sys_common_status");return a(k,{rowKey:"userId",actionRef:n,params:{roleId:t},columns:[{dataIndex:"userName",key:"userName",title:"用户名称",valueType:"text"},{dataIndex:"nickName",key:"nickName",title:"用户昵称",valueType:"text",hideInSearch:!0},{dataIndex:"email",title:"邮箱",valueType:"text",hideInSearch:!0,formItemProps:{rules:[{required:!0,message:"请输入邮箱"},{pattern:v,message:"邮箱格式错误"}]}},{dataIndex:"phoneNumber",key:"phoneNumber",title:"手机号码",valueType:"text",copyable:!0},{title:"状态",dataIndex:"status",key:"status",valueType:"select",valueEnum:(l=s==null?void 0:s.mapData)!=null?l:{},formItemProps:{initialValue:s==null?void 0:s.defaultValue,required:!0,rules:[{required:!0,message:"请选择状态"}]}},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",editable:!1,hideInSearch:!0,sorter:!0},{title:"操作",dataIndex:"option",valueType:"option",render:(i,u)=>a(R,{userId:u.userId,userName:u.userName})}],request:(...i)=>Y(N(...i)),tableAlertRender:$,toolbar:{actions:[a(Z,{},"DrawerTableAuth")]}})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const re=()=>a(K,{children:a(z,{})});export{re as default};
