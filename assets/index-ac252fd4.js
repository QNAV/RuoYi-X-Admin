import{R as G,j as s,r as w,a as d,F as K}from"./jsx-runtime-5957e344.js";import{a0 as $,a$ as Q,_ as S,bI as E,bJ as C,aH as I,c0 as x,ee as z,ef as J,eg as N,eh as Z,aE as m,cs as F,b8 as ee,c1 as te,b5 as R,ei as se,ej as ae,ek as oe,c3 as re,a_ as b,dH as ce,bB as ie,el as le,c9 as ne,em as de,dB as ue,bM as D,b3 as he,en as me,bL as pe,eo as ge,bl as be,aZ as Pe,cM as fe,cR as we,bP as ye,bQ as Ae,ep as Te,aU as Ce}from"./index-c0caad45.js";import{a as Ie}from"./index-77a386b3.js";import{a as B,u as L}from"./utils-2d03aa42.js";import{u as y}from"./useRequest-c238576c.js";import{u as M}from"./useMutation.esm-7503ef7a.js";import{P as h}from"./index-428f4577.js";import{P as Re}from"./index-fc1dacef.js";import{P as T}from"./index-7f5c5ca9.js";import{P as Me}from"./index-209812a1.js";import{u as ke}from"./index-4a857fdb.js";import{P as xe}from"./index-c7303494.js";import"./routes-73769f85.js";import"./mutation.esm-e13a8f7e.js";import"./index-dc4b308a.js";var ve=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],je=G.forwardRef(function(e,t){var o=e.fieldProps,r=e.unCheckedChildren,a=e.checkedChildren,l=e.proFieldProps,c=$(e,ve);return s(Q,S({valueType:"switch",fieldProps:S({unCheckedChildren:r,checkedChildren:a},o),ref:t,valuePropName:"checked",proFieldProps:l,filedConfig:{valuePropName:"checked",ignoreWidth:!0}},c))});const Se=je;globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const v=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomMainTableActions",E(void 0));v.debugLabel="atomMainTableActions";const O=()=>C(v),Ee=()=>Ie(v),j=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomSelectedDeptId",E(0));j.debugLabel="atomSelectedDeptId";const Ne=()=>C(j),Fe=()=>I(j),k=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomResetPwdModal",B({open:!1}));k.debugLabel="atomResetPwdModal";const De=()=>{const e=I(k);return t=>{e({open:!0,record:t})}},Be=()=>L(k),Le=()=>C(k),A=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomAddOrEditModal",B({open:!1,actionType:"add",userId:0}));A.debugLabel="atomAddOrEditModal";const Oe=()=>{const e=I(A);return()=>{e({open:!0,actionType:"add",userId:0})}},_e=()=>{const e=I(A);return t=>{e({open:!0,actionType:"edit",userId:t})}},qe=()=>L(A),Ue=()=>C(A);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ve=()=>{const e=w.exports.useRef(),t=O(),{open:o,actionType:r,userId:a}=Ue(),l=qe(),c=()=>{var i;r==="edit"&&((i=e.current)==null||i.resetFields()),l()},{data:p}=x("sys_normal_disable"),{data:P}=x("sys_user_sex"),{data:f}=y(async()=>{const{posts:i,roles:n}=await z({});return{posts:i.reduce((u,g)=>u.set(g.postId,g.postName),new Map),roles:n.reduce((u,g)=>u.set(g.roleId,g.roleName),new Map)}}),{data:q}=y(async()=>(await J({configKey:"sys.user.initPassword"})).data.msg),{data:U}=y(()=>N({}),{}),{data:V}=y(async()=>{const{postIds:i,roleIds:n,user:u}=await Z({userId:a});return{...u,postIds:i,roleIds:n}},{ready:o&&r==="edit"&&a>0,onSuccess:i=>{var n;(n=e.current)==null||n.setFieldsValue(i)},refreshDeps:[a]}),{isLoading:X,mutateAsync:Y}=M(async()=>{var n,u;const i=await((u=(n=e.current)==null?void 0:n.validateFieldsReturnFormatValue)==null?void 0:u.call(n));if(r==="add"){const{roleIds:g=[],postIds:H=[],...W}=i;await se({roleIds:g,postIds:H,...W})}else await ae({...V,...i,userId:a})},{onSuccess:()=>{var i;l(),t==null||t.reload(),(i=e.current)==null||i.resetFields(),R.success(r==="add"?"新增成功":"编辑成功")}});return s(m,{accessible:!0,children:d(F,{title:r==="add"?"新增用户":"编辑用户",formRef:e,grid:!0,colProps:{span:12},modalProps:{okText:"提交",onCancel:c,confirmLoading:X},width:600,open:o,onFinish:()=>Y(),children:[s(h,{name:"nickName",label:"用户昵称",rules:[{required:!0}]}),s(Re,{name:"deptId",label:"归属部门",fieldProps:{treeData:U??[],fieldNames:{value:"id"}}}),s(h,{name:"phoneNumber",label:"手机号码",rules:[{pattern:ee,message:"手机号码格式错误"}],fieldProps:{maxLength:11}}),s(h,{name:"email",label:"邮箱",rules:[{pattern:te,message:"邮箱格式错误"}]}),r==="add"&&s(h,{name:"userName",label:"用户名称",rules:[{required:!0}]}),r==="add"&&s(h.Password,{name:"password",label:"用户密码",rules:[{required:!0}],initialValue:q}),s(T,{name:"sex",label:"用户性别",valueEnum:(P==null?void 0:P.valueEnum)??{}}),s(T,{name:"status",label:"状态",valueEnum:(p==null?void 0:p.valueEnum)??{},rules:[{required:!0}]}),s(T,{name:"postIds",label:"岗位",valueEnum:(f==null?void 0:f.posts)??{},mode:"multiple",colProps:{span:24}}),s(T,{name:"roleIds",label:"角色",valueEnum:(f==null?void 0:f.roles)??{},mode:"multiple",colProps:{span:24}}),s(Me,{name:"remark",label:"备注",colProps:{span:24}})]})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Xe=()=>{const e=w.exports.useRef(),t=Be(),{open:o,record:r}=Le();return w.exports.useEffect(()=>{var a;if(o){(a=e.current)==null||a.resetFields();const l=setTimeout(()=>{var c;(c=e.current)==null||c.setFieldsValue({userName:r.userName}),clearTimeout(l)},0)}},[o]),s(m,{accessible:!0,children:d(F,{title:"重置密码",open:o,formRef:e,modalProps:{onCancel:t},width:500,onFinish:async({password:a})=>{await oe({...r,password:a}),R.success("重置密码成功")},children:[s(h,{name:"userName",label:"用户名称",readonly:!0}),s(h.Password,{required:!0,name:"password",label:"新密码",rules:[{required:!0,message:"请输入新密码"},{pattern:re,message:"密码长度应在6-20之间，只能包含字母、数字和下划线"}]}),s(h.Password,{required:!0,name:"confirmPassword",label:"确认密码",rules:[{required:!0,message:"请输入确认密码"},({getFieldsValue:a})=>({validator(l,c){return!c||a().password===c?Promise.resolve():Promise.reject(new Error("两次输入的密码不一致"))}})]})]})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ye=()=>{const e=Oe();return s(m,{accessible:!0,children:s(b,{type:"primary",icon:s(ce,{}),onClick:e,children:"新增"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const He=({userId:e})=>{const t=_e();return s(m,{accessible:!0,children:s(b,{type:"link",icon:s(ie,{}),onClick:()=>t(e),children:"编辑"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const We=({searchParams:e})=>{const{isLoading:t,mutate:o}=M(()=>le(e),{onSuccess:()=>{R.success("导出成功")}});return s(m,{accessible:!0,children:s(b,{icon:s(ne,{}),loading:t,onClick:()=>o(),children:"导出"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ge=()=>{const e=w.exports.useRef(),[t,{toggle:o}]=ke(),{mutate:r,isLoading:a}=M(()=>de());return d(m,{accessible:!0,children:[s(b,{icon:s(ue,{}),onClick:o,children:"导入"}),d(D,{title:"导入用户",open:t,onCancel:o,children:[s("div",{className:"text-right",children:s(b,{type:"link",onClick:()=>r(),loading:a,children:"下载模板"})}),d(he,{layout:"horizontal",submitter:!1,formRef:e,children:[s(Se,{name:"isCover",label:"是否更新已经存在的用户数据"}),s(xe,{name:"list"})]})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const _=({userId:e,isBatch:t,disabled:o})=>{const r=t?"批量删除":"删除",a=O(),{mutateAsync:l,isLoading:c}=M(()=>me({userIds:e}),{onSuccess:()=>{var P;a==null||a.reload(),(P=a==null?void 0:a.clearSelected)==null||P.call(a),R.success("删除成功")}});return s(m,{accessible:!0,children:s(b,{type:"link",danger:!0,disabled:o,icon:s(pe,{}),onClick:()=>{D.confirm({title:"删除用户",content:`确定删除用户编号为 ${e} 的数据吗？`,onOk:()=>l(),okButtonProps:{loading:c}})},children:r})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ke=({record:e})=>{const t=De();return s(m,{accessible:!0,children:s(b,{type:"link",danger:!0,icon:s(ge,{}),onClick:()=>t(e),children:"重置密码"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const $e=()=>{const[e,t]=w.exports.useState(""),o=Fe(),{data:r,loading:a}=y(()=>N({deptName:e}),{refreshDeps:[e],debounceWait:500});return d(be,{spinning:a,children:[s(Pe.Search,{allowClear:!0,placeholder:"请输入部门名称",className:"mb-3",onSearch:l=>{t(l)}}),!r||r.length===0?s(fe,{}):s(we,{treeData:r,defaultExpandAll:!0,fieldNames:{title:"label",key:"id"},onSelect:(l,{node:{key:c}})=>{o(c)},blockNode:!0})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Qe=()=>{const{data:e}=x("sys_normal_disable");return[{dataIndex:"userId",key:"userId",title:"用户编号",valueType:"text",hideInSearch:!0},{dataIndex:"userName",key:"userName",title:"用户名称",valueType:"text"},{dataIndex:"nickName",key:"nickName",title:"用户昵称",valueType:"text",hideInSearch:!0},{dataIndex:["dept","deptName"],key:"deptDeptName",title:"部门名称",valueType:"text",hideInSearch:!0},{dataIndex:"phoneNumber",key:"phoneNumber",title:"手机号码",valueType:"text",copyable:!0},{title:"状态",dataIndex:"status",key:"status",valueType:"select",valueEnum:(e==null?void 0:e.valueEnum)??{}},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",hideInSearch:!0,sorter:!0},{title:"操作",valueType:"option",render:(t,o)=>o.userId===1?null:d(K,{children:[s(He,{userId:o.userId}),s(_,{userId:o.userId}),s(Ke,{record:o})]}),fixed:"right",width:300},{title:"创建时间",dataIndex:"createTimeRange",key:"createTimeRange",valueType:"dateTimeRange",hideInTable:!0}]},ze=({selectedRows:e})=>s(_,{disabled:e.length===0,isBatch:!0,userId:e.map(t=>t.userId).join(",")}),Je=(e,t)=>d("div",{className:"flex gap-4",children:[s("div",{className:"bg-white p-4",children:s($e,{})}),s("div",{className:"overflow-auto w-full",children:t})]}),Ze=()=>{const e=Ee(),[t,o]=w.exports.useState({}),r=Qe(),a=Ne(),l=a>0?{deptId:a}:{};return s(ye,{rowKey:"userId",actionRef:e,columns:r,params:l,request:async(...c)=>{const p=Ae(...c);return o(p),await Te(p)},toolbar:{actions:[s(We,{searchParams:t},"ButtonExport"),s(Ge,{},"ButtonImport"),s(Ye,{},"ButtonAdd")]},tableRender:Je,tableAlertOptionRender:ze})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const gt=()=>d(Ce,{children:[s(Ze,{}),s(Ve,{}),s(Xe,{})]});export{gt as default};
