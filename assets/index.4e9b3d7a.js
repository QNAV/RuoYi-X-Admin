import{ao as U,l as Y,j as e,a as Z,R as q,H as R,J as O,cG as ee,r as h,g as c,aE as te,aT as b,a1 as V,c2 as se,F as A,cf as re,cH as ae}from"./index.ef912f72.js";import{B as oe}from"./index.fa2a799d.js";import{A as _,P as ue}from"./index.5e3cc60b.js";import{u as ne,E as j,a as g}from"./useMutation.esm.393173fd.js";import{c as C}from"./keepAlive.1e0d4c88.js";import{S as ie,a as le,b as ce,c as de,d as pe,e as me}from"./SysDeptService.9231117d.js";import{p as De}from"./tree.d2667444.js";import{u as M}from"./useQuery.esm.ed8bbf81.js";import{u as Ee}from"./index.fade9bf7.js";import{B as x,b as Q,S as he}from"./index.9ade6068.js";import{M as H,L as Pe,T as fe}from"./Tree.729caba6.js";import{P as Fe,a as ye,F as Se,D as L,X as w}from"./index.0e0f914a.js";import{P as Be}from"./index.12367437.js";import{P as E}from"./index.0f91907b.js";import{T as k,P as y}from"./index.1dc5c0a1.js";import{C as ge,a as be,b as Ae}from"./common.58c02837.js";import{E as $}from"./index.febb701a.js";import{u as Ce}from"./useRequest.29ee2580.js";import{P as S}from"./index.da8a1964.js";import{P as xe}from"./index.d91e4716.js";/* empty css              */import"./RouteContext.b1a35a93.js";import"./utils.esm.902822bd.js";import"./PortalWrapper.57172c6f.js";import"./index.43860d72.js";import"./index.f2a942ca.js";/* empty css              */import"./Skeleton.7a4221ec.js";var Ie=["fieldProps","request","params","proFieldProps"],Ne=function(r,a){var t=r.fieldProps,n=r.request,u=r.params,l=r.proFieldProps,d=Y(r,Ie);return e(Fe,Z({valueType:"treeSelect",fieldProps:t,ref:a,request:n,params:u,filedConfig:{customLightMode:!0},proFieldProps:l},d))},Te=U.forwardRef(Ne);const ve=Te,f="systemDept",I=q({key:`${f}AtomDeptDetails`,default:{visible:!1,deptId:0,deptName:""}}),G=()=>R(I),Le=()=>O(I),K=()=>ee(I),W=q({key:`${f}AtomSearchDeptListParams`,default:{}}),z=()=>R(W),we=()=>O(W),N=[f,"list"],J=()=>{const s=z();return M(N,async()=>{const r=await ie(s),a=De(r,{id:"deptId",pId:"parentId",rootPId:null});return{data:r,treeData:a,allParentIds:r.map(t=>t.parentId)}})},ke=[f,"treeData"],X=()=>M(ke,async()=>await le({})),qe=()=>{const s=we(),r=z(),a=J();return h.exports.useEffect(()=>{a.refetch()},[r]),t=>{s(t)}},Re=()=>{const s=C(),r=h.exports.useRef(),[a,{toggle:t}]=Ee(),{data:n,refetch:u}=X(),{mutate:l,isLoading:d}=ne(async()=>{var i;const p=await((i=r.current)==null?void 0:i.validateFields());await ce(p)},{onSuccess:()=>{var p;b.success("\u65B0\u5EFA\u6210\u529F"),u(),t(),(p=r.current)==null||p.resetFields()}});return c(_,{accessible:s.canAddSysDept,children:[e(x,{type:"primary",icon:e(te,{}),onClick:t,children:"\u65B0\u5EFA"}),e(H,{title:"\u65B0\u5EFA\u90E8\u95E8",okText:"\u63D0\u4EA4",open:a,onCancel:t,onOk:()=>l(),okButtonProps:{loading:d},children:c(ye,{submitter:!1,formRef:r,grid:!0,rowProps:{gutter:[16,0]},children:[e(ve,{name:"parentId",label:"\u4E0A\u7EA7\u90E8\u95E8",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u4E0A\u7EA7\u90E8\u95E8"}],fieldProps:{treeData:n!=null?n:[],fieldNames:{value:"id"}}}),e(E,{name:"deptName",label:"\u90E8\u95E8\u540D\u79F0",rules:[{required:!0}],colProps:{span:12}}),e(Be,{name:"orderNum",label:"\u663E\u793A\u6392\u5E8F",initialValue:0,rules:[{required:!0}],colProps:{span:12}}),e(E,{name:"leader",label:"\u8D1F\u8D23\u4EBA",colProps:{span:12}}),e(E,{name:"phone",label:"\u8054\u7CFB\u7535\u8BDD",colProps:{span:12}}),e(E,{name:"email",label:"\u90AE\u7BB1",colProps:{span:12}}),e(ue.Group,{name:"status",label:"\u72B6\u6001",valueEnum:j,initialValue:g.ENABLE,colProps:{span:12}})]})})]})},Oe=()=>{const s=C(),r=V(),{deptId:a,deptName:t,visible:n}=G(),u=K(),l=()=>{H.confirm({title:"\u5220\u9664\u786E\u8BA4",content:c(A,{children:["\u786E\u5B9A\u5BF9",e(k.Text,{code:!0,children:t}),"\u8FDB\u884C",e(k.Text,{code:!0,children:"\u5220\u9664"}),"\u64CD\u4F5C\u5417\uFF1F"]}),onOk:async()=>{await de({deptId:a}),b.success("\u5220\u9664\u6210\u529F"),u(),r.invalidateQueries(N)}})};return e(_,{accessible:s.canRemoveSysDept,children:e(x,{danger:!0,ghost:!0,icon:e(se,{}),disabled:!n,onClick:l,children:"\u5220\u9664"})})},Ve={title:"\u90E8\u95E8\u540D\u79F0",dataIndex:"deptName",key:"deptName",valueType:"text"},_e={title:"\u8D1F\u8D23\u4EBA",dataIndex:"leader",key:"leader",valueType:"text"},je={title:"\u8054\u7CFB\u7535\u8BDD",dataIndex:"phone",key:"phone",valueType:"text"},Me={title:"\u90AE\u7BB1",dataIndex:"email",key:"email",valueType:"text"},Qe=(s=[])=>({title:"\u4E0A\u7EA7\u90E8\u95E8",dataIndex:"parentId",key:"parentId",valueType:"treeSelect",fieldProps:{treeData:s,dropdownMatchSelectWidth:250,fieldNames:{value:"id"}}}),B={xs:1,sm:1,md:1,lg:1,xl:2},He=()=>{const[s,r]=h.exports.useState([]),a=C(),[t]=Se.useForm(),n=V(),{deptId:u,visible:l}=G(),{data:d}=X(),p=Qe(d),{data:i,loading:P,refreshAsync:F}=Ce(async()=>{var v;const{ancestors:o,...D}=await pe({deptId:u}),T=(v=o==null?void 0:o.split(","))!=null?v:[];return{...D,ancestors:Number(T[T.length-1])}},{ready:l&&u>0,refreshDeps:[u],onSuccess:()=>{r([])}}),m=a!=null&&a.canEditSysDept?{form:t,editableKeys:s,onChange:(o,D)=>{r(o),o.length===1&&!Array.isArray(D)&&t.setFieldsValue({[o[0]]:D[o[0]]})},onSave:async(o,D)=>{await me({deptId:u,deptName:i.deptName,orderNum:i.orderNum,parentId:0,[o]:D[o]}),await Promise.all([n.invalidateQueries(N),F()]),b.success("\u4FDD\u5B58\u6210\u529F")}}:void 0;return l?c(Q,{spinning:P,children:[e(S,{column:B,editable:m,dataSource:i,columns:[ge,be,Ae]}),e(L,{}),e(S,{column:B,editable:m,dataSource:i,columns:[Ve,p]}),e(L,{}),e(S,{column:B,editable:m,dataSource:i,columns:[_e,je,Me]})]}):e($,{description:"\u70B9\u51FB\u9009\u62E9\u5DE6\u4FA7\u90E8\u95E8\u9879\u67E5\u770B\u8BE6\u60C5"})},$e=s=>c(A,{children:[e(w,{color:"rgb(148 163 184)",children:s.orderNum}),c(he,{children:[s.deptName,e(w,{color:s.status===g.ENABLE?"success":"error",children:s.status===g.ENABLE?"\u542F\u7528\u4E2D":"\u5DF2\u7981\u7528"})]})]}),Ge=()=>{var p,i;const[s,r]=h.exports.useState([]),a=qe(),{data:t,isFetching:n}=J(),u=Le(),l=K(),d=(s==null?void 0:s.length)!==0&&(s==null?void 0:s.length)===((p=t==null?void 0:t.allParentIds)==null?void 0:p.length);return h.exports.useEffect(()=>{t!=null&&t.allParentIds&&r(t.allParentIds)},[t==null?void 0:t.allParentIds]),c(A,{children:[c("div",{className:"flex justify-between items-center",children:[e(x,{size:"small",className:"my-2",icon:d?e(re,{}):e(ae,{}),onClick:()=>r(d?[]:t==null?void 0:t.allParentIds),children:d?"\u5168\u90E8\u6298\u53E0":"\u5168\u90E8\u5C55\u5F00"}),c(Pe,{onFinish:async P=>{a(P)},children:[e(E,{name:"deptName",label:"\u90E8\u95E8\u540D\u79F0"}),e(xe,{name:"status",label:"\u72B6\u6001",valueEnum:j})]})]}),t!=null&&t.treeData?e(Q,{spinning:n,children:e(fe,{blockNode:!0,showLine:{showLeafIcon:!1},titleRender:$e,treeData:(i=t==null?void 0:t.treeData)!=null?i:[],expandedKeys:s,onExpand:r,fieldNames:{title:"deptName",key:"deptId",children:"children"},onSelect:(P,{selected:F,node:{key:m}})=>{if(F){u({visible:!0,deptId:m,deptName:t.data.find(o=>o.deptId===m).deptName});return}l()}})}):e($,{})]})},yt=()=>e(oe,{children:c(y,{ghost:!0,gutter:24,children:[e(y,{title:"\u90E8\u95E8\u5217\u8868",colSpan:"500px",extra:e(Re,{}),children:e(Ge,{})}),e(y,{title:"\u90E8\u95E8\u8BE6\u60C5",extra:e(Oe,{}),children:e(He,{})})]})});export{yt as default};
