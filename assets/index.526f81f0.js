import{v as H,g as Z,aX as j,r as g,n as L,e as l,ai as R,j as t,aj as S,aL as _,al as v,$ as J,a2 as D,aI as U,ao as O,aY as C,q as P,ak as ee,F as B,am as te,aZ as se,a_ as k,a$ as M,aC as F,a0 as w,b0 as ae,b1 as re,b2 as oe,b3 as ue,b4 as ne,b5 as x,as as ce,O as ie,aG as f}from"./index.0317b1cc.js";import{e as I}from"./index.11709832.js";import{S as q,W as le,a as de,b as pe,c as he,d as me}from"./SysDeptService.993cfd45.js";import{a as De,u as ge}from"./utils.6e1fff90.js";import{u as Q}from"./useQuery.esm.5d2f091c.js";import{P as Ee}from"./index.974176f5.js";import{u as Ae}from"./index.1eec4fea.js";import{u as be}from"./useMutation.esm.5e23f19c.js";import{c as Fe,d as fe,e as ye,f as Ce,g as Se,h as Pe,i as Be}from"./index.456879d5.js";import{u as Ie}from"./useRequest.df8faf9f.js";import"./utils.esm.a92d667f.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const V="systemDept",A=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/dept/model/index.ts/AtomDeptDetails",De({open:!1,deptId:0,deptName:""}));A.debugLabel="AtomDeptDetails";const W=()=>H(A),Ne=()=>{const e=Z(A);return(s,u)=>{e({open:!0,deptId:s,deptName:u})}},Te=()=>ge(A),G=[V,"list"],we=(e,s)=>{const u=Q(G,async()=>{const r=await q(e),a=j(r,{id:"deptId",pId:"parentId",rootPId:null});return{map:r.reduce((n,o)=>n.set(o.deptId,o),new Map),treeData:a,allParentIds:Array.from(r.reduce((n,o)=>n.add(o.parentId),new Set))}},{onSuccess:r=>{s.onSuccess(r.allParentIds)}});return g.exports.useEffect(()=>{u.refetch()},[e]),u},K=()=>{const e=L();return()=>e.invalidateQueries(G)},X=[V,"options"],Y=()=>Q(X,async()=>{const e=await q({});return j(e,{id:"deptId",pId:"parentId",rootPId:null})}),$=()=>{const e=L();return()=>e.invalidateQueries(X)};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const xe=()=>{const e=I(),s=g.exports.useRef(),[u,{toggle:r}]=Ae(),{data:a,refetch:n}=Y(),{mutate:o,isLoading:i}=be(async()=>{var p;const d=await((p=s.current)==null?void 0:p.validateFields());await de(d)},{onSuccess:()=>{var d;P.success("\u65B0\u5EFA\u6210\u529F"),n(),r(),(d=s.current)==null||d.resetFields()}});return l(R,{accessible:e.canAddSysDept,children:[t(S,{type:"primary",icon:t(_,{}),onClick:r,children:"\u65B0\u5EFA"}),t(v,{title:"\u65B0\u5EFA\u90E8\u95E8",okText:"\u63D0\u4EA4",open:u,onCancel:r,onOk:()=>o(),okButtonProps:{loading:i},children:l(J,{submitter:!1,formRef:s,grid:!0,rowProps:{gutter:[16,0]},children:[t(le,{name:"parentId",label:"\u4E0A\u7EA7\u90E8\u95E8",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u4E0A\u7EA7\u90E8\u95E8"}],fieldProps:{treeData:a!=null?a:[],fieldNames:{label:"deptName",value:"deptId"}}}),t(D,{name:"deptName",label:"\u90E8\u95E8\u540D\u79F0",rules:[{required:!0}],colProps:{span:12}}),t(Ee,{name:"orderNum",label:"\u663E\u793A\u6392\u5E8F",initialValue:0,rules:[{required:!0}],colProps:{span:12}}),t(D,{name:"leader",label:"\u8D1F\u8D23\u4EBA",colProps:{span:12}}),t(D,{name:"phone",label:"\u8054\u7CFB\u7535\u8BDD",colProps:{span:12}}),t(D,{name:"email",label:"\u90AE\u7BB1",colProps:{span:12}}),t(U.Group,{name:"status",label:"\u72B6\u6001",valueEnum:O,initialValue:C.ENABLE,colProps:{span:12}})]})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const je=()=>{const e=I(),{deptId:s,deptName:u,open:r}=W(),a=Te(),n=K(),o=$(),i=()=>{v.confirm({title:"\u5220\u9664\u786E\u8BA4",content:l(B,{children:["\u786E\u5B9A\u5220\u9664\u90E8\u95E8",t(te.Text,{code:!0,children:u}),"\u5417\uFF1F"]}),onOk:async()=>{await pe({deptId:s}),P.success("\u5220\u9664\u6210\u529F"),a(),n(),o()}})};return t(R,{accessible:r&&e.canRemoveSysDept,children:t(S,{danger:!0,ghost:!0,icon:t(ee,{}),onClick:i,children:"\u5220\u9664"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const y={xs:1,sm:1,md:1,lg:1,xl:2},Le=()=>{const[e,s]=g.exports.useState([]),u=I(),[r]=se.useForm(),a=K(),n=$(),{deptId:o,open:i}=W(),{data:d}=Y(),p=Be(d),{data:h,loading:E,refresh:z}=Ie(async()=>{var T;const{ancestors:c,...m}=await he({deptId:o}),N=(T=c==null?void 0:c.split(","))!=null?T:[];return{...m,ancestors:Number(N[N.length-1])}},{ready:i&&o>0,refreshDeps:[o],onSuccess:()=>{s([])}}),b=u!=null&&u.canEditSysDept?{form:r,editableKeys:e,onChange:(c,m)=>{s(c),c.length===1&&!Array.isArray(m)&&r.setFieldsValue({[c[0]]:m[c[0]]})},onSave:async(c,m)=>{await me({deptId:o,deptName:h.deptName,orderNum:h.orderNum,parentId:0,[c]:m[c]}),P.success("\u4FDD\u5B58\u6210\u529F"),z(),a(),n()}}:void 0;return i?l(M,{spinning:E,children:[t(F,{column:y,editable:b,dataSource:h,columns:[Fe,fe,{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createTime",key:"createTime",valueType:"dateTime",editable:!1,hideInSearch:!0,sorter:!0}]}),t(w,{}),t(F,{column:y,editable:b,dataSource:h,columns:[ye,p]}),t(w,{}),t(F,{column:y,editable:b,dataSource:h,columns:[Ce,Se,Pe]})]}):t(k,{description:"\u70B9\u51FB\u9009\u62E9\u5DE6\u4FA7\u90E8\u95E8\u9879\u67E5\u770B\u8BE6\u60C5"})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const Re=e=>l(B,{children:[t(x,{color:"rgb(148 163 184)",children:e.orderNum}),l(ce,{children:[e.deptName,t(x,{color:e.status===C.ENABLE?"success":"error",children:e.status===C.ENABLE?"\u542F\u7528\u4E2D":"\u5DF2\u7981\u7528"})]})]}),ve=()=>{var d;const[e,s]=g.exports.useState([]),[u,r]=g.exports.useState({}),{data:a,isFetching:n}=we(u,{onSuccess:p=>{s(p)}}),o=Ne(),i=(e==null?void 0:e.length)!==0&&(e==null?void 0:e.length)===((d=a==null?void 0:a.allParentIds)==null?void 0:d.length);return l(B,{children:[l("div",{className:"flex justify-between items-center",children:[t(S,{size:"small",className:"my-2",icon:i?t(ae,{}):t(re,{}),onClick:()=>s(i?[]:a==null?void 0:a.allParentIds),children:i?"\u5168\u90E8\u6298\u53E0":"\u5168\u90E8\u5C55\u5F00"}),l(oe,{onFinish:async p=>r(p),children:[t(D,{name:"deptName",label:"\u90E8\u95E8\u540D\u79F0"}),t(ue,{name:"status",label:"\u72B6\u6001",valueEnum:O})]})]}),a!=null&&a.treeData?t(M,{spinning:n,children:t("div",{className:"h-[calc(100vh-270px)]",children:t(ne,{blockNode:!0,showLine:{showLeafIcon:!1},titleRender:Re,treeData:a.treeData,expandedKeys:e,onExpand:s,fieldNames:{title:"deptName",key:"deptId"},onSelect:(p,{selected:h,node:{key:E}})=>{!h||o(E,a.map.get(E).deptName)}})})}):t(k,{})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const $e=()=>t(ie,{children:l(f,{ghost:!0,gutter:24,children:[t(f,{title:"\u90E8\u95E8\u5217\u8868",colSpan:"500px",extra:t(xe,{}),children:t(ve,{})}),t(f,{title:"\u90E8\u95E8\u8BE6\u60C5",extra:t(je,{}),children:t(Le,{})})]})});export{$e as default};
