import{I as b,a as c,j as a,J as T,K as C,e as I,L as N,M as A,d as j,N as k,O as U,Q as q,B as E,n as m}from"./index-b5eebe28.js";import{bg as y,a6 as D,a7 as g,aC as P,bn as L,bo as M,aL as S,r as w,B,a8 as F}from"./antd-f7a9cbdb.js";import{u as v}from"./useMutation-cb32f323.js";import{P as f}from"./index-b65ca6ac.js";import{P as p}from"./index-843b2515.js";import"./@icon-park/react-8ab893b5.js";import"./@wangeditor/editor-2b25ac2d.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const O="https://test-ryx-admin-api.p.quicknav.cn/api/sys/profile/update-avatar",K=[{dataIndex:"userName",key:"userName",title:"用户名称",valueType:"text"},{dataIndex:"deptName",key:"deptName",title:"所属部门",valueType:"text"},{dataIndex:"roleName",key:"roleName",title:"所属角色",valueType:"text"},{dataIndex:"createTime",key:"createTime",title:"创建时间",valueType:"text"}],Q=()=>{const{valueEnumSysUserSex:e}=C();return[{dataIndex:"nickName",key:"nickName",title:"用户昵称",valueType:"text",formItemProps:{rules:[{required:!0,message:"请输入用户昵称"}]}},{dataIndex:"phoneNumber",key:"phoneNumber",title:"手机号码",valueType:"text",fieldProps:{maxLength:11},formItemProps:{rules:[{required:!0,message:"请输入手机号"},{pattern:I,message:"手机号格式错误"}]}},{dataIndex:"email",key:"email",title:"邮箱",valueType:"text",formItemProps:{rules:[{required:!0,message:"请输入邮箱"},{pattern:N,message:"邮箱格式错误"}]}},{dataIndex:"sex",key:"sex",title:"性别",valueType:"radio",valueEnum:e}]},R=()=>{var t,h;const{data:e,refetch:s}=b(),u=Q(),{message:i}=y.useApp(),{mutate:l,mutateAsync:r}=v(A,{onSuccess:()=>{s(),i.success("保存成功")}}),n={onSave:async(o,d)=>{await r({[o]:d[o]})}};return c(D,{align:"middle",children:[a(g,{span:4,children:c("div",{className:"w-[100px] relative m-auto",children:[a(P,{src:((h=(t=e==null?void 0:e.userInfo)==null?void 0:t.user)==null?void 0:h.avatar)??"Avatar",size:100}),a(L,{maxCount:1,showUploadList:!1,name:"avatarfile",accept:"image/jpeg,image/png",action:O,headers:{Authorization:T()},onChange:o=>{if(o.file.status!=="done")return;const{code:d,msg:x}=o.file.response;if(d!==200){i.error(x);return}l({avatar:o.file.response.data})},children:a(P,{icon:a(M,{}),className:"absolute bottom-0 right-0 bg-blue-500 cursor-pointer"})})]})}),c(g,{span:20,children:[a(f,{columns:K,dataSource:{userName:e==null?void 0:e.userInfo.user.userName,createTime:e==null?void 0:e.userInfo.user.createTime,deptName:e==null?void 0:e.userInfo.user.dept.deptName,roleName:e==null?void 0:e.userInfo.user.roles.map(o=>o.roleName).join("/")}}),a(S,{}),a(f,{columns:u,dataSource:e==null?void 0:e.userInfo.user,editable:n})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const z=()=>{const e=w.useRef(),s=q(),{message:u}=y.useApp(),{mutate:i,isLoading:l}=v(async()=>{var n;const r=await((n=e==null?void 0:e.current)==null?void 0:n.validateFields());await U(r)},{onSuccess:()=>{u.success("密码修改成功，即将自动退出登录并跳转至登录页面");const r=setTimeout(async()=>{await s(),clearTimeout(r)},1500)}});return c(j,{formRef:e,submitter:!1,children:[a(p.Password,{allowClear:!0,name:"oldPassword",label:"旧密码",rules:[{required:!0}],width:"md"}),a(p.Password,{allowClear:!0,name:"newPassword",label:"新密码",width:"md",rules:[{required:!0},{pattern:k,message:"长度在6-20之间，只能包含字母、数字和下划线"},({getFieldValue:r})=>({validator(n,t){return!t||t!==r("oldPassword")?Promise.resolve():Promise.reject(new Error("新旧密码不能相同"))}})]}),a(p.Password,{allowClear:!0,name:"confirmPassword",label:"确认密码",width:"md",rules:[{required:!0},({getFieldValue:r})=>({validator(n,t){return!t||r("newPassword")===t?Promise.resolve():Promise.reject(new Error("两次密码输入不一致"))}})]}),a(B,{type:"primary",loading:l,onClick:()=>i(),children:"更新密码"})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const X=()=>{const[e,s]=w.useState("PASSWORD");return a(E,{title:"个人中心",children:c(m,{ghost:!0,direction:"column",gutter:[0,16],children:[a(m,{children:a(R,{})}),a(m,{children:a(F,{activeKey:e,onChange:u=>s(u),items:[{label:"安全设置",key:"PASSWORD",children:a(z,{})}]})})]})})};export{X as default};
