import{av as Q,a6 as H,a as e,b3 as K,a5 as J,r as p,j as i,as as N,b5 as U,b6 as X,az as Z,b7 as f,bk as _,F as S,aI as g,aF as M,aB as k,b8 as ee,bb as ue,a$ as x,aA as q,bh as E,bl as te,S as se,bm as ae,bn as re,bc as ne,bd as oe,be as le,bf as ce,D as ie,M as de,bg as Fe,b0 as v}from"./index.11f23607.js";import{B as me}from"./index.4722553d.js";import{A as L}from"./index.caae580b.js";import{P as pe}from"./index.9b5188c9.js";import{P as Ee}from"./index.40c37dbb.js";import{b as V,Y as P,u as R,M as F,E as j,a as he,c as O}from"./useMutation.esm.f3aa9111.js";import{a as T}from"./keepAlive.c14f8edb.js";import{useShowCreateModal as G,useHideCreateModal as Ce,useValueCreateModal as be,useValueSelectedMenuData as w,useQueryMenuOptions as Be,useReFetchMenuList as W,useDeleteMenu as Y,useReFetchMenuOptions as De,useStateSelectedMenuData as ye,useResetSelectedMenuData as Me,useQueryMenuList as fe}from"./index.63a6b48e.js";import{S as Ae,a as Se,b as Pe}from"./SysMenuService.f6a18e89.js";import{b as ge,a as xe,c as ve,C as Ie}from"./common.29231d98.js";import{E as z}from"./index.98a04e6e.js";import{u as Ne}from"./useRequest.691a72a4.js";import"./utils.esm.24df5bad.js";import"./tree.ddfbe215.js";import"./useQuery.esm.6f86a17b.js";var ke=["fieldProps","request","params","proFieldProps"],Te=function(u,o){var l=u.fieldProps,a=u.request,s=u.params,c=u.proFieldProps,h=H(u,ke);return e(K,J({valueType:"cascader",fieldProps:l,ref:o,request:a,params:s,filedConfig:{customLightMode:!0},proFieldProps:c},h))};const we=Q.forwardRef(Te),qe={title:"\u662F\u5426\u663E\u793A",dataIndex:"visible",key:"visible",valueType:"radio",valueEnum:P,tooltip:"\u9009\u62E9\u5426\u5219\u8DEF\u7531\u5C06\u4E0D\u4F1A\u51FA\u73B0\u5728\u4FA7\u8FB9\u680F\uFF0C\u4F46\u4ECD\u7136\u53EF\u4EE5\u8BBF\u95EE"},Oe={title:"\u662F\u5426\u5916\u94FE",dataIndex:"isFrame",key:"isFrame",valueType:"radio",valueEnum:P,tooltip:"\u9009\u62E9\u662F\u5916\u94FE\u5219\u8DEF\u7531\u5730\u5740\u9700\u8981\u4EE5`http(s)://`\u5F00\u5934"},Le={title:"\u56FE\u6807",dataIndex:"icon",key:"icon",valueType:"text",tooltip:"https://ant.design/components/icon-cn/"},Ve={title:"\u8DEF\u7531\u5730\u5740",dataIndex:"path",key:"path",valueType:"text",tooltip:"\u8BBF\u95EE\u7684\u8DEF\u7531\u5730\u5740\uFF0C\u5982\uFF1A`user`\uFF0C\u5982\u5916\u7F51\u5730\u5740\u9700\u5185\u94FE\u8BBF\u95EE\u5219\u4EE5`http(s)://`\u5F00\u5934"},Re={title:"\u8DEF\u7531\u53C2\u6570",dataIndex:"queryParam",key:"queryParam",valueType:"code",tooltip:'\u8BBF\u95EE\u8DEF\u7531\u7684\u9ED8\u8BA4\u4F20\u9012\u53C2\u6570\uFF0C\u5982\uFF1A{"id": 1, "name": "ry"}'},je={title:"\u6743\u9650\u6807\u8BC6",dataIndex:"perms",key:"perms",valueType:"text",copyable:!0},Ge={title:"\u7C7B\u578B",dataIndex:"menuType",key:"menuType",valueType:"select",valueEnum:V,editable:!1},We={title:"\u540D\u79F0",dataIndex:"menuName",key:"menuName",valueType:"text"},Ye=(t,u)=>{const o=[0];if(u===0)return o;const l=a=>{const s=t.get(a);!s||((s==null?void 0:s.parentId)!==void 0&&l(s.parentId),s.menuType!==F.F&&o.push(a))};return l(u),o},ze=()=>{var C,b;const t=T(),u=p.exports.useRef(),o=G(),l=Ce(),a=be(),{selectedMenuId:s}=w(),{data:c,refetch:h}=Be(),D=W(),{isLoading:y,mutate:n}=R(async()=>{var d,B;const r=await((B=(d=u.current)==null?void 0:d.validateFieldsReturnFormatValue)==null?void 0:B.call(d));!r||await Ae(r)},{onSuccess:async()=>{var r;await Promise.all([h(),D()]),l(),(r=u==null?void 0:u.current)==null||r.resetFields(),k.success("\u65B0\u5EFA\u6210\u529F")}});return p.exports.useEffect(()=>{var r;a&&(c==null?void 0:c.map)&&((r=u==null?void 0:u.current)==null?void 0:r.setFieldsValue)&&u.current.setFieldsValue({parentId:Ye(c.map,s)})},[a,(C=u==null?void 0:u.current)==null?void 0:C.setFieldsValue]),i(L,{accessible:t.canAddSysMenu,children:[e(N,{type:"primary",onClick:o,icon:e(U,{}),children:"\u65B0\u5EFA"}),e(X,{open:a,onCancel:l,title:"\u65B0\u5EFA\u83DC\u5355",width:515,okText:"\u63D0\u4EA4",onOk:()=>n(),okButtonProps:{loading:y},children:i(Z,{submitter:!1,formRef:u,children:[e(we,{name:"parentId",label:"\u7236\u7EA7\u83DC\u5355",fieldProps:{options:(b=c==null?void 0:c.options)!=null?b:[],fieldNames:{label:"menuName",value:"menuId",children:"children"},changeOnSelect:!0},rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u7236\u7EA7\u83DC\u5355"}],transform:r=>({parentId:r[r.length-1]})}),e(f.Group,{name:"menuType",label:"\u83DC\u5355\u7C7B\u578B",valueEnum:V,rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u83DC\u5355\u7C7B\u578B"}]}),e(_,{name:["menuType"],children:({menuType:r})=>r?i(S,{children:[i(g,{children:[e(M,{name:"menuName",label:"\u83DC\u5355\u540D\u79F0",width:"sm",rules:[{required:!0}]}),e(pe,{name:"orderNum",label:"\u663E\u793A\u6392\u5E8F",tooltip:"\u9ED8\u8BA4\u6570\u503C\u4E3A0\uFF0C\u6570\u503C\u8D8A\u5927\u6392\u5E8F\u8D8A\u9760\u540E\uFF0C\u6570\u503C\u76F8\u7B49\u6309\u7167\u521B\u5EFA\u65F6\u95F4\u5148\u540E\u6392\u5E8F",rules:[{required:!0}],width:"sm",initialValue:0})]}),r!==F.F&&i(S,{children:[i(g,{children:[e(f.Group,{tooltip:"\u9009\u62E9\u505C\u7528\u5219\u8DEF\u7531\u5C06\u4E0D\u4F1A\u51FA\u73B0\u5728\u4FA7\u8FB9\u680F\uFF0C\u4E5F\u4E0D\u80FD\u88AB\u8BBF\u95EE",name:"status",label:"\u83DC\u5355\u72B6\u6001",valueEnum:j,required:!0,initialValue:he.ENABLE}),e(f.Group,{name:"visible",label:"\u83DC\u5355\u662F\u5426\u663E\u793A",valueEnum:P,required:!0,initialValue:O.YES,tooltip:"\u9009\u62E9\u5426\u5219\u8DEF\u7531\u5C06\u4E0D\u4F1A\u51FA\u73B0\u5728\u4FA7\u8FB9\u680F\uFF0C\u4F46\u4ECD\u7136\u53EF\u4EE5\u8BBF\u95EE"}),e(f.Group,{name:"isFrame",label:"\u662F\u5426\u5916\u94FE",valueEnum:P,required:!0,initialValue:O.NO,tooltip:"\u9009\u62E9\u662F\u5916\u94FE\u5219\u8DEF\u7531\u5730\u5740\u9700\u8981\u4EE5`http(s)://`\u5F00\u5934"})]}),i(g,{children:[e(M,{name:"icon",label:"\u83DC\u5355\u56FE\u6807",width:"sm",tooltip:"https://ant.design/components/icon-cn/"}),e(M,{width:"sm",name:"path",label:"\u8DEF\u7531\u5730\u5740",tooltip:"\u8BBF\u95EE\u7684\u8DEF\u7531\u5730\u5740\uFF0C\u5982\uFF1A`user`\uFF0C\u5982\u5916\u7F51\u5730\u5740\u9700\u5185\u94FE\u8BBF\u95EE\u5219\u4EE5`http(s)://`\u5F00\u5934",rules:[{required:!0}]})]})]}),r===F.C&&e(M,{name:"queryParam",label:"\u8DEF\u7531\u53C2\u6570",tooltip:'\u8BBF\u95EE\u8DEF\u7531\u7684\u9ED8\u8BA4\u4F20\u9012\u53C2\u6570\uFF0C\u5982\uFF1A{"id": 1, "name": "ry"}'}),r!==F.M&&e(M,{name:"perms",label:"\u6743\u9650\u6807\u8BC6"})]}):null}),e(Ee,{name:"remark",label:"\u5907\u6CE8"})]})})]})},$e=()=>{const t=T(),{hasSelected:u,selectedMenuId:o,selectedMenuName:l}=w(),{mutate:a,isLoading:s}=Y();return e(L,{accessible:u&&t.canRemoveSysMenu,children:e(N,{icon:e(ee,{}),loading:s,danger:!0,onClick:()=>a({menuId:o,menuName:l}),children:"\u5220\u9664"})})},I={xs:1,sm:1,md:1,lg:1,xl:2},Qe=t=>p.exports.useMemo(()=>{const u=[];return t?(t!==F.F&&u.push(Ie,qe,Oe,Le,Ve),t===F.C&&u.push(Re),t!==F.M&&u.push(je),u):[]},[t]),He=()=>{const t=T(),u=W(),o=De(),{hasSelected:l,selectedMenuId:a}=w(),{data:s,loading:c,refresh:h}=Ne(async()=>await Se({menuId:a}),{ready:l,refreshDeps:[a]}),{mutateAsync:D}=R(Pe,{onSuccess:()=>{h(),u(),o(),k.success("\u4FDD\u5B58\u6210\u529F")}}),y=Qe(s==null?void 0:s.menuType),n=t.canEditSysMenu?{onSave:async(C,b)=>{const{menuType:r,orderNum:d,menuName:B,menuId:m}=b;await D({menuId:m,menuType:r,orderNum:d,menuName:B,[C]:b[C]})}}:void 0;return a===0?e(z,{description:"\u70B9\u51FB\u9009\u62E9\u5DE6\u4FA7\u83DC\u5355\u9879\u67E5\u770B\u8BE6\u60C5"}):i(ue,{spinning:c,children:[e(x,{columns:[Ge,ge],dataSource:s,column:I}),e(q,{}),e(x,{columns:[We,xe,ve],dataSource:s,editable:n,column:I}),e(q,{}),e(x,{columns:y,dataSource:s,editable:n,column:I})]})},Ke=t=>i(S,{children:[e(E,{color:"rgb(148 163 184)",children:t.orderNum}),(t==null?void 0:t.icon)&&e(te,{name:t.icon,className:"mr-1"}),e(E,{color:A[t.menuType],style:{margin:"0 0 2px 0"},children:t.menuName}),(t==null?void 0:t.perms)&&e(E,{style:{margin:"0 0 2px 2px"},children:i(se,{size:"small",children:[t.perms,e(ae,{style:{color:"#1890ff"},onClick:u=>{re(t.perms),k.success("\u590D\u5236\u6210\u529F"),u.stopPropagation()}})]})})]}),Je=()=>i("div",{className:"mb-2",children:["\u6807\u7B7E\u542B\u4E49\uFF1A",e(E,{color:"rgb(148 163 184)",children:"\u663E\u793A\u987A\u5E8F"}),e(E,{color:A[F.M],children:"\u76EE\u5F55"}),e(E,{color:A[F.C],children:"\u83DC\u5355"}),e(E,{color:A[F.F],children:"\u6309\u94AE"}),e(E,{children:"\u6743\u9650\u6807\u8BC6"})]}),A={M:"blue",C:"green",F:"red"},Ue=()=>{var B;const[t,u]=p.exports.useState({}),[o,l]=p.exports.useState(0),[a,s]=p.exports.useState([]),[c,h]=ye(),D=Me(),y=G(),{data:n,refetch:C}=fe(t,m=>{s(m)}),{mutate:b}=Y(),r=(m,{node:{key:$}})=>{l($)},d=(a==null?void 0:a.length)!==0&&(a==null?void 0:a.length)===((B=n==null?void 0:n.parentIds)==null?void 0:B.length);return p.exports.useEffect(()=>{C()},[t]),p.exports.useEffect(()=>{o>0?h({hasSelected:!0,selectedMenuId:o,selectedMenuName:n.map.get(o).menuName}):D()},[o]),i(S,{children:[e(Je,{}),i("div",{className:"flex justify-between items-center",children:[e(N,{size:"small",className:"my-2",icon:d?e(ne,{}):e(oe,{}),onClick:()=>s(d?[]:n==null?void 0:n.parentIds),children:d?"\u5168\u90E8\u6298\u53E0":"\u5168\u90E8\u5C55\u5F00"}),i(le,{onFinish:async m=>{l(0),s([]),u(m)},children:[e(M,{name:"menuName",label:"\u83DC\u5355\u540D\u79F0"}),e(ce,{name:"status",label:"\u72B6\u6001",valueEnum:j})]})]}),e(ie,{overlay:e(de,{items:[{label:"\u65B0\u5EFA",key:"create",onClick:()=>y()},{label:"\u5728\u6839\u76EE\u5F55\u4E0B\u65B0\u5EFA",key:"create",onClick:()=>{D(),y()}},{label:"\u5220\u9664",key:"delete",danger:!0,disabled:!c.hasSelected,onClick:()=>b({menuId:c.selectedMenuId,menuName:c.selectedMenuName})}]}),trigger:["contextMenu"],children:e("div",{className:"h-[calc(100vh-310px)] overflow-auto",children:n!=null&&n.treeData.length?e(Fe,{blockNode:!0,selectedKeys:[o],onSelect:r,expandedKeys:a,titleRender:Ke,onExpand:s,showLine:{showLeafIcon:!1},fieldNames:{title:"menuName",key:"menuId",children:"children"},treeData:n==null?void 0:n.treeData,onRightClick:({node:{key:m}})=>l(m)}):e(z,{})})})]})},Fu=()=>e(me,{children:i(v,{ghost:!0,gutter:24,children:[e(v,{title:"\u83DC\u5355\u5217\u8868",colSpan:"550px",extra:e(ze,{}),children:e(Ue,{})}),e(v,{title:"\u83DC\u5355\u8BE6\u60C5",extra:e($e,{}),children:e(He,{})})]})});export{Fu as default};
