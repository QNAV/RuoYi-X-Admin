import{A as d,bC as B,bD as I,j as a,f as u,bE as w,au as S,a3 as g,b as l,a0 as U,a1 as M,a2 as P,bF as R,a6 as L,E as O,bG as E,r as b,bH as C,aE as T,bI as x,bJ as A,bK as F,X as N,a7 as K,N as D,bL as $,v as H,p as G,B as X}from"./index-8e79839f.js";import{u as p}from"./useMutation-25c2b1ea.js";import{u as j}from"./index-8564c2c8.js";import{U as k}from"./index-432b5e1a.js";import{u as _}from"./useRequest-39bbbc00.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const q=({ossId:e})=>{const{message:t}=d.useApp(),{isLoading:o,mutate:n}=p(async()=>{const{data:i,headers:s}=await B({ossId:e},{format:"blob"}),c=new Blob([i],{type:"application/octet-stream"});c instanceof Blob?(I.saveAs(c,decodeURIComponent(s["download-filename"])),t.success("下载成功")):t.error("下载失败")},{onSuccess:()=>{}});return a(u,{type:"link",icon:a(w,{}),loading:o,onClick:()=>{n()},children:"下载"})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const V=({configKey:e,configValue:t,onFinish:o})=>{const{modal:n}=d.useApp(),{mutate:i,isLoading:s}=p(S,{onSuccess:()=>{o()}});return a(g,{accessKey:"system:oss:edit",children:l(u,{danger:!0,type:"primary",ghost:!0,onClick:()=>{n.confirm({title:"操作确认",content:`确定${t?"停用":"启用"}"预览列表图片"配置吗？`,okButtonProps:{loading:s},onOk:()=>i({configKey:e,configValue:`${!t}`})})},children:["预览开关：",t?"启用":"停用"]})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const m=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/oss/model/index.ts/atomMainTableActions",U(void 0));m.debugLabel="atomMainTableActions";const Y=()=>P(m),J=()=>M(m);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const v=({ossIds:e,batch:t,disabled:o})=>{const{message:n,modal:i}=d.useApp(),s=Y(),{mutate:c,isLoading:h}=p(R,{onSuccess:()=>{var f;s==null||s.reload(),(f=s==null?void 0:s.clearSelected)==null||f.call(s),n.success("删除成功")}});return a(g,{accessKey:"system:oss:remove",children:a(L,{batch:t,disabled:o,onClick:()=>{i.confirm({title:"删除用户",content:`确定删除OSS对象存储编号为 ${e.join(",")} 的数据吗？`,onOk:()=>c({ossIds:e}),okButtonProps:{loading:h}})}})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const W=()=>{const e=O();return a(u,{icon:a(E,{}),type:"primary",ghost:!0,onClick:()=>{e("/system/oss-config")},children:"配置管理"})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const{Dragger:z}=k,Q=async e=>{const{data:{code:t,msg:o}}=await A({file:e});return t!==200?Promise.reject(new Error(o)):o},Z=()=>{const[e,{toggle:t}]=j(),[o,n]=b.useState([]),{message:i,modal:s}=d.useApp(),{mutate:c,isLoading:h}=p(Q,{onSuccess:r=>{t(),s.info({title:"导入结果",content:r})},onError:()=>{i.error("导入失败")}});return l(g,{accessKey:"system:oss:upload",children:[a(u,{type:"primary",icon:a(C,{}),onClick:t,children:"上传文件"}),a(T,{title:"上传文件",open:e,onCancel:t,okText:"提交",onOk:()=>c(o[0].originFileObj),okButtonProps:{loading:h},children:l(z,{accept:".xlsx, .xls, .doc, .docx, .ppt, .pptx, .txt, .pdf",maxCount:1,beforeUpload:()=>!1,onChange:r=>n(r.fileList),fileList:o,onRemove:()=>n([]),children:[a("p",{className:"ant-upload-drag-icon",children:a(x,{})}),a("p",{className:"ant-upload-text",children:"点击或拖拽文件到此区域上传"}),a("p",{className:"ant-upload-text",children:"请上传大小不超过5MB格式为doc/xls/ppt/txt/pdf的文件"})]})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const{Dragger:ee}=k,te=async e=>{const{data:{code:t,msg:o}}=await A({file:e});return t!==200?Promise.reject(new Error(o)):o},ae=()=>{const[e,{toggle:t}]=j(),[o,n]=b.useState([]),{message:i,modal:s}=d.useApp(),{mutate:c,isLoading:h}=p(te,{onSuccess:r=>{t(),s.info({title:"导入结果",content:r})},onError:()=>{i.error("导入失败")}});return l(g,{accessKey:"system:oss:upload",children:[a(u,{type:"primary",icon:a(C,{}),onClick:t,children:"上传图片"}),a(T,{title:"上传图片",open:e,onCancel:t,okText:"提交",onOk:()=>c(o[0].originFileObj),okButtonProps:{loading:h},children:l(ee,{accept:".png, .jpg, .jpeg, .docx",maxCount:1,beforeUpload:()=>!1,onChange:r=>n(r.fileList),fileList:o,onRemove:()=>n([]),children:[a("p",{className:"ant-upload-drag-icon",children:a(x,{})}),a("p",{className:"ant-upload-text",children:"点击或拖拽文件到此区域上传"}),a("p",{className:"ant-upload-text",children:"请上传大小不超过5MB格式为png/jpg/jpeg的文件"})]})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const oe=e=>[{title:"对象存储主键",dataIndex:"ossId",key:"ossId",valueType:"text",hideInSearch:!0},{title:"文件名",dataIndex:"fileName",key:"fileName",valueType:"text"},{title:"原名",dataIndex:"originalName",key:"originalName",valueType:"text"},{title:"文件后缀名",dataIndex:"fileSuffix",key:"fileSuffix",valueType:"text"},{title:"文件展示",dataIndex:"url",key:"url",valueType:"text",render:(t,o)=>["png","jpg","jpeg"].includes(o.fileSuffix)&&e?a(H,{src:o.url,width:100,height:100}):o.url},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",hideInSearch:!0,sorter:!0},{title:"上传人",dataIndex:"createBy",key:"createBy",valueType:"text"},{title:"服务商",dataIndex:"service",key:"service",valueType:"text",sorter:!0},{title:"创建时间",dataIndex:"dateTimeRange",key:"dateTimeRange",valueType:"dateTimeRange",hideInTable:!0},{title:"操作",dataIndex:"action",valueType:"option",render:(t,o)=>l(G,{children:[a(q,{ossId:o.ossId}),a(v,{ossIds:[o.ossId]})]})}],se=({selectedRowKeys:e})=>a(v,{disabled:e.length===0,batch:!0,ossIds:e}),y="sys.oss.previewListResource",ne=()=>{const e=J(),{data:t,refresh:o}=_(async()=>{const{data:{msg:i}}=await F({configKey:y});return i==="true"}),n=oe(!!t);return a(N,{rowKey:"ossId",actionRef:e,columns:n,request:async(...i)=>{const{dateTimeRange:s,...c}=K(...i);return D(s)&&(c.beginCreateTime=s[0],c.endCreateTime=s[1]),await $(c)},toolbar:{actions:[a(Z,{},"ButtonUploadFile"),a(ae,{},"ButtonUploadImg"),a(V,{configKey:y,configValue:!!t,onFinish:()=>{o()}},"ButtonPreviewConfig"),a(W,{},"ButtonToConfigPage")]},tableAlertOptionRender:se})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const de=()=>a(X,{children:a(ne,{})});export{de as default};
