import{r as F,a as e,R as C,g as I,h as R,aD as S,aB as B,j as i,as as p,b5 as v,b6 as D,az as E,aF as l,b7 as U,bp as O,bE as w,b8 as M,F as j,b9 as _,aV as q,bb as L,bF as V,bg as W,b0 as f}from"./index.852b862f.js";import{B as $}from"./index.90f5fc8f.js";import{C as z,b as G,d as K}from"./common.c668022f.js";import{c as h}from"./keepAlive.6d87fd4a.js";import{u as H,c as J}from"./useInitActionType.56becec4.js";import{u as Q}from"./useRowClick.c4c12e35.js";import{A as y}from"./index.8ed95d62.js";import{u as X}from"./index.7502a6c8.js";import{u as N}from"./useMutation.esm.f0374fb2.js";import{E as Y}from"./index.2b85951d.js";import{e as Z}from"./SysDeptService.a526afd0.js";import{u as ee}from"./useRequest.a4d5d321.js";import"./utils.esm.d5be3ad6.js";const te=t=>F.exports.cloneElement(e("div",{onClick:s=>{s.stopPropagation()},children:t.children}),t),se={dataIndex:"userId",key:"userId",title:"\u7528\u6237\u7F16\u53F7",valueType:"text",editable:!1,hideInSearch:!0},ae={dataIndex:"userName",key:"userName",title:"\u7528\u6237\u540D\u79F0",valueType:"text"},re={dataIndex:"nickName",key:"nickName",title:"\u7528\u6237\u6635\u79F0",valueType:"text",hideInSearch:!0},ue={dataIndex:["dept","deptName"],key:"deptDeptName",title:"\u90E8\u95E8\u540D\u79F0",valueType:"text",hideInSearch:!0},ne={dataIndex:"phoneNumber",key:"phoneNumber",title:"\u624B\u673A\u53F7\u7801",valueType:"text"},g="systemUser",k=C({key:`${g}AtomMainTableActions`,default:void 0}),T=()=>I(k),oe=()=>H(k),A=C({key:`${g}AtomSelectedDeptId`,default:0}),ce=()=>I(A),le=()=>R(A);async function ie(t,s){return S("/system/user/add",{method:"POST",headers:{"Content-Type":"application/json"},data:t,...s||{}})}async function de(t,s){return S("/system/user/list",{method:"POST",headers:{"Content-Type":"application/json"},data:t,...s||{}})}async function me(t,s){return S("/system/user/remove",{method:"POST",params:{...t},...s||{}})}const pe=()=>{const t=h(),[s,{toggle:a}]=X(),n=F.exports.useRef(),o=T(),{isLoading:u,mutate:r}=N(async()=>{var c,d;const b=await((d=(c=n.current)==null?void 0:c.validateFieldsReturnFormatValue)==null?void 0:d.call(c));await ie(b)},{onSuccess:()=>{o==null||o.reload(),B.success("\u6DFB\u52A0\u6210\u529F")}});return i(y,{accessible:t.canAddSysUser,children:[e(p,{type:"primary",icon:e(v,{}),onClick:a,children:"\u65B0\u589E"}),e(D,{title:"\u6DFB\u52A0\u7528\u6237",open:s,onCancel:a,confirmLoading:u,okText:"\u63D0\u4EA4",onOk:()=>r(),children:i(E,{submitter:!1,formRef:n,grid:!0,colProps:{span:12},children:[e(l,{name:"nickName",label:"\u7528\u6237\u6635\u79F0",rules:[{required:!0}]}),e(l,{name:"phoneNumber",label:"\u624B\u673A\u53F7\u7801"}),e(l,{name:"email",label:"\u90AE\u7BB1"}),e(l,{name:"userName",label:"\u7528\u6237\u540D\u79F0",rules:[{required:!0}]}),e(l.Password,{name:"password",label:"\u7528\u6237\u5BC6\u7801",rules:[{required:!0}]}),e(U.Group,{name:"status",label:"\u72B6\u6001"})]})})]})},he=()=>{const t=h();return e(y,{accessible:t.canExportSysUser,children:e(p,{icon:e(O,{}),children:"\u5BFC\u51FA"})})},ye=()=>{const t=h();return e(y,{accessible:t.canImportSysUser,children:e(p,{icon:e(w,{}),children:"\u5BFC\u5165"})})},P=({userId:t,userName:s,isBatch:a,disabled:n})=>{const o=a?"\u6279\u91CF\u5220\u9664":"\u5220\u9664",u=h(),r=T(),{mutateAsync:b,isLoading:c}=N(async m=>{await me({userIds:m})},{onSuccess:()=>{var m;r==null||r.reload(),(m=r==null?void 0:r.clearSelected)==null||m.call(r),B.success("\u5220\u9664\u6210\u529F")}}),d=()=>{D.confirm({title:"\u5220\u9664\u7528\u6237",content:i(j,{children:["\u786E\u5B9A\u5220\u9664\u7528\u6237",e(_.Text,{code:!0,children:s}),"\u5417\uFF1F"]}),onOk:async()=>b(t),okButtonProps:{loading:c}})};return e(y,{accessible:u.canRemoveSysUser,children:e(p,{type:"link",danger:!0,disabled:n,icon:e(M,{}),onClick:d,children:o})})},be=[se,ae,re,ue,ne,z,G,K,{title:"\u64CD\u4F5C",valueType:"option",width:200,render:(t,s)=>e(te,{children:e(P,{userId:s.userId,userName:s.userName})})}],x="userId",fe=({selectedRows:t})=>{const s=t.length===0;return e(P,{disabled:s,isBatch:!0,userId:t.map(a=>a.userId).join(","),userName:t.map(a=>a.userName).join(",")})},Fe=()=>{const t=oe(),s=ce(),a=s>0?{deptId:s}:{},{rowSelection:n,onClick:o}=Q(x);return e(q,{rowKey:x,actionRef:t,columns:be,params:a,search:{span:{xs:24,sm:24,md:12,lg:12,xl:12,xxl:6}},onRow:u=>({onClick:()=>o(u)}),rowSelection:n,tableAlertOptionRender:fe,request:(...u)=>de(J(...u)),toolbar:{actions:[e(he,{},"ButtonExport"),e(ye,{},"ButtonImport"),e(pe,{},"ButtonAdd")]}})},Se=()=>{const[t,s]=F.exports.useState(""),a=le(),{data:n,loading:o}=ee(()=>Z({deptName:t}),{refreshDeps:[t]});return n?i(L,{spinning:o,children:[e(V.Search,{allowClear:!0,placeholder:"\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0",className:"mb-3",onSearch:u=>{s(u)}}),e(W,{treeData:n,defaultExpandAll:!0,fieldNames:{title:"label",key:"id"},onSelect:(u,{node:{key:r}})=>{a(r)}})]}):e(Y,{})},Ee=()=>e($,{children:i(f,{ghost:!0,gutter:24,children:[e(f,{colSpan:"300px",className:"h-full",children:e(Se,{})}),e(f,{ghost:!0,className:"h-full",children:e(Fe,{})})]})});export{Ee as default};
