import{R as G,a,r as w,j as d,F as K}from"./jsx-runtime-f6344dff.js";import{k as $,aI as z,_ as x,ai as m,bL as E,aw as C,a9 as b,c8 as Q,b9 as J,bs as Z,c5 as ee,bg as N,aM as te,bf as ae,co as se,aX as oe,aH as re,bR as ce,bV as ie,bj as ne,aC as le}from"./index-015dcaaa.js";import{e as v}from"./index-758a896a.js";import{b as de}from"./index-dcec50f9.js";import{a as F,b as I,u as R}from"./index-8e574cbc.js";import{a as D,u as B}from"./utils-f714d812.js";import{a3 as ue,a4 as he,a5 as L,a6 as me,a7 as pe,a8 as ge,a9 as be,aa as fe,ab as Pe,ac as we,ad as ye}from"./vanilla-74082e55.js";import{h as Ae,m as Te,n as Ce,i as Ie}from"./index-3d8204b8.js";import{u as y}from"./useRequest-5bfd3be9.js";import{u as k}from"./useMutation.esm-f8681d30.js";import{P as h}from"./index-73cef862.js";import{P as Re}from"./index-f2a951df.js";import{P as T}from"./index-0add3084.js";import{P as ke}from"./index-4b484312.js";import{u as Me}from"./index-d3065d17.js";import{P as ve}from"./index-c61ac730.js";import"./utils.esm-0d150205.js";import"./mutation.esm-7f23d645.js";import"./index-821f0d72.js";var Se=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],je=G.forwardRef(function(e,t){var o=e.fieldProps,r=e.unCheckedChildren,s=e.checkedChildren,n=e.proFieldProps,i=$(e,Se);return a(z,x({valueType:"switch",fieldProps:x({unCheckedChildren:r,checkedChildren:s},o),ref:t,valuePropName:"checked",proFieldProps:n,filedConfig:{valuePropName:"checked",ignoreWidth:!0}},i))});const xe=je;globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const S=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomMainTableActions",F(void 0));S.debugLabel="atomMainTableActions";const O=()=>I(S),Ee=()=>de(S),j=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomSelectedDeptId",F(0));j.debugLabel="atomSelectedDeptId";const Ne=()=>I(j),Fe=()=>R(j),M=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomResetPwdModal",D({open:!1}));M.debugLabel="atomResetPwdModal";const De=()=>{const e=R(M);return t=>{e({open:!0,record:t})}},Be=()=>B(M),Le=()=>I(M),A=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomAddOrEditModal",D({open:!1,actionType:"add",userId:0}));A.debugLabel="atomAddOrEditModal";const Oe=()=>{const e=R(A);return()=>{e({open:!0,actionType:"add",userId:0})}},Ve=()=>{const e=R(A);return t=>{e({open:!0,actionType:"edit",userId:t})}},qe=()=>B(A),_e=()=>I(A);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ue=()=>{const e=w.useRef(),t=O(),{open:o,actionType:r,userId:s}=_e(),n=qe(),i=()=>{var c;r==="edit"&&((c=e.current)==null||c.resetFields()),n()},{data:p}=v("sys_normal_disable"),{data:f}=v("sys_user_sex"),{data:P}=y(async()=>{const{posts:c,roles:l}=await ue({});return{posts:c.reduce((u,g)=>u.set(g.postId,g.postName),new Map),roles:l.reduce((u,g)=>u.set(g.roleId,g.roleName),new Map)}}),{data:q}=y(async()=>{const{data:c}=await he({configKey:"sys.user.initPassword"});return c.msg}),{data:_}=y(()=>L({}),{}),{data:U}=y(async()=>{const{postIds:c,roleIds:l,user:u}=await me({userId:s});return{...u,postIds:c,roleIds:l}},{ready:o&&r==="edit"&&s>0,onSuccess:c=>{var l;(l=e.current)==null||l.setFieldsValue(c)},refreshDeps:[s]}),{isLoading:X,mutateAsync:Y}=k(async()=>{var l,u;const c=await((u=(l=e.current)==null?void 0:l.validateFieldsReturnFormatValue)==null?void 0:u.call(l));if(r==="add"){const{roleIds:g=[],postIds:H=[],...W}=c;await pe({roleIds:g,postIds:H,...W})}else await ge({...U,...c,userId:s})},{onSuccess:()=>{var c;n(),t==null||t.reload(),(c=e.current)==null||c.resetFields(),C.success(r==="add"?"新增成功":"编辑成功")}});return a(m,{accessible:!0,children:d(E,{title:r==="add"?"新增用户":"编辑用户",formRef:e,grid:!0,colProps:{span:12},modalProps:{okText:"提交",onCancel:i,confirmLoading:X},width:600,open:o,onFinish:()=>Y(),children:[a(h,{name:"nickName",label:"用户昵称",rules:[{required:!0}]}),a(Re,{name:"deptId",label:"归属部门",fieldProps:{treeData:_??[],fieldNames:{value:"id"}}}),a(h,{name:"phoneNumber",label:"手机号码",rules:[{pattern:Ae,message:"手机号码格式错误"}],fieldProps:{maxLength:11}}),a(h,{name:"email",label:"邮箱",rules:[{pattern:Te,message:"邮箱格式错误"}]}),r==="add"&&a(h,{name:"userName",label:"用户名称",rules:[{required:!0}]}),r==="add"&&a(h.Password,{name:"password",label:"用户密码",rules:[{required:!0}],initialValue:q}),a(T,{name:"sex",label:"用户性别",valueEnum:(f==null?void 0:f.valueEnum)??{}}),a(T,{name:"status",label:"状态",valueEnum:(p==null?void 0:p.valueEnum)??{},rules:[{required:!0}]}),a(T,{name:"postIds",label:"岗位",valueEnum:(P==null?void 0:P.posts)??{},mode:"multiple",colProps:{span:24}}),a(T,{name:"roleIds",label:"角色",valueEnum:(P==null?void 0:P.roles)??{},mode:"multiple",colProps:{span:24}}),a(ke,{name:"remark",label:"备注",colProps:{span:24}})]})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Xe=()=>{const e=w.useRef(),t=Be(),{open:o,record:r}=Le();return w.useEffect(()=>{var s;if(o){(s=e.current)==null||s.resetFields();const n=setTimeout(()=>{var i;(i=e.current)==null||i.setFieldsValue({userName:r.userName}),clearTimeout(n)},0)}},[o]),a(m,{accessible:!0,children:d(E,{title:"重置密码",open:o,formRef:e,modalProps:{onCancel:t},width:500,onFinish:async({password:s})=>{await be({...r,password:s}),C.success("重置密码成功")},children:[a(h,{name:"userName",label:"用户名称",readonly:!0}),a(h.Password,{required:!0,name:"password",label:"新密码",rules:[{required:!0,message:"请输入新密码"},{pattern:Ce,message:"密码长度应在6-20之间，只能包含字母、数字和下划线"}]}),a(h.Password,{required:!0,name:"confirmPassword",label:"确认密码",rules:[{required:!0,message:"请输入确认密码"},({getFieldsValue:s})=>({validator(n,i){return!i||s().password===i?Promise.resolve():Promise.reject(new Error("两次输入的密码不一致"))}})]})]})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ye=()=>{const e=Oe();return a(m,{accessible:!0,children:a(b,{type:"primary",icon:a(Q,{}),onClick:e,children:"新增"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const He=({userId:e})=>{const t=Ve();return a(m,{accessible:!0,children:a(b,{type:"link",icon:a(J,{}),onClick:()=>t(e),children:"编辑"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const We=({searchParams:e})=>{const{isLoading:t,mutate:o}=k(()=>fe(e),{onSuccess:()=>{C.success("导出成功")}});return a(m,{accessible:!0,children:a(b,{icon:a(Z,{}),loading:t,onClick:()=>o(),children:"导出"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ge=()=>{const e=w.useRef(),[t,{toggle:o}]=Me(),{mutate:r,isLoading:s}=k(()=>Pe());return d(m,{accessible:!0,children:[a(b,{icon:a(ee,{}),onClick:o,children:"导入"}),d(N,{title:"导入用户",open:t,onCancel:o,children:[a("div",{className:"text-right",children:a(b,{type:"link",onClick:()=>r(),loading:s,children:"下载模板"})}),d(te,{layout:"horizontal",submitter:!1,formRef:e,children:[a(xe,{name:"isCover",label:"是否更新已经存在的用户数据"}),a(ve,{name:"list"})]})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const V=({userId:e,isBatch:t,disabled:o})=>{const r=t?"批量删除":"删除",s=O(),{mutateAsync:n,isLoading:i}=k(()=>we({userIds:e}),{onSuccess:()=>{var f;s==null||s.reload(),(f=s==null?void 0:s.clearSelected)==null||f.call(s),C.success("删除成功")}});return a(m,{accessible:!0,children:a(b,{type:"link",danger:!0,disabled:o,icon:a(ae,{}),onClick:()=>{N.confirm({title:"删除用户",content:`确定删除用户编号为 ${e} 的数据吗？`,onOk:()=>n(),okButtonProps:{loading:i}})},children:r})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ke=({record:e})=>{const t=De();return a(m,{accessible:!0,children:a(b,{type:"link",danger:!0,icon:a(se,{}),onClick:()=>t(e),children:"重置密码"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const $e=()=>{const[e,t]=w.useState(""),o=Fe(),{data:r,loading:s}=y(()=>L({deptName:e}),{refreshDeps:[e],debounceWait:500});return d(oe,{spinning:s,children:[a(re.Search,{allowClear:!0,placeholder:"请输入部门名称",className:"mb-3",onSearch:n=>{t(n)}}),!r||r.length===0?a(ce,{}):a(ie,{treeData:r,defaultExpandAll:!0,fieldNames:{title:"label",key:"id"},onSelect:(n,{node:{key:i}})=>{o(i)},blockNode:!0})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ze=()=>{const{data:e}=v("sys_normal_disable");return[{dataIndex:"userId",key:"userId",title:"用户编号",valueType:"text",hideInSearch:!0},{dataIndex:"userName",key:"userName",title:"用户名称",valueType:"text"},{dataIndex:"nickName",key:"nickName",title:"用户昵称",valueType:"text",hideInSearch:!0},{dataIndex:["dept","deptName"],key:"deptDeptName",title:"部门名称",valueType:"text",hideInSearch:!0},{dataIndex:"phoneNumber",key:"phoneNumber",title:"手机号码",valueType:"text",copyable:!0},{title:"状态",dataIndex:"status",key:"status",valueType:"select",valueEnum:(e==null?void 0:e.valueEnum)??{}},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",hideInSearch:!0,sorter:!0},{title:"操作",valueType:"option",render:(t,o)=>o.userId===1?null:d(K,{children:[a(He,{userId:o.userId}),a(V,{userId:o.userId}),a(Ke,{record:o})]}),fixed:"right",width:300},{title:"创建时间",dataIndex:"createTimeRange",key:"createTimeRange",valueType:"dateTimeRange",hideInTable:!0}]},Qe=({selectedRows:e})=>a(V,{disabled:e.length===0,isBatch:!0,userId:e.map(t=>t.userId).join(",")}),Je=(e,t)=>d("div",{className:"flex gap-4",children:[a("div",{className:"bg-white p-4",children:a($e,{})}),a("div",{className:"overflow-auto w-full",children:t})]}),Ze=()=>{const e=Ee(),[t,o]=w.useState({}),r=ze(),s=Ne(),n=s>0?{deptId:s}:{};return a(ne,{rowKey:"userId",actionRef:e,columns:r,params:n,request:async(...i)=>{const p=Ie(...i);return o(p),await ye(p)},toolbar:{actions:[a(We,{searchParams:t},"ButtonExport"),a(Ge,{},"ButtonImport"),a(Ye,{},"ButtonAdd")]},tableRender:Je,tableAlertOptionRender:Qe})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const wt=()=>d(le,{children:[a(Ze,{}),a(Ue,{}),a(Xe,{})]});export{wt as default};
