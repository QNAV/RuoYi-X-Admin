import{R as W,k as Y,r as m,co as z,d as t,aB as J,_ as q,cI as V,cJ as U,cK as X,cL as $,cg as B,j as c,ch as Z,cM as L,aG as D,b9 as j,cN as g,cO as O,aH as E,cP as ee,cQ as te,cR as ae,cS as se,a_ as re,aF as oe,cT as ne,h as I,aN as A,cU as le,cV as ce,cW as ie,v as ue,cX as de,aA as he,cj as me,ck as pe,cl as ge,cY as ye,cm as fe,av as Me,bi as w}from"./index-e7c41863.js";import{useShowModalAdd as _,useAtomValueSelectedMenuData as R,useDeleteMenu as G,useReFetchMenuList as Q,useReFetchMenuOptions as be,useHideModalAdd as xe,useAtomValueModalAdd as Ce,useQueryMenuOptions as Te,useAtomStateSelectedMenuData as Pe,useResetSelectedMenuData as ve,useQueryMenuList as Se}from"./index-e0b6d530.js";import{u as Fe}from"./useRequest-baba476b.js";import{u as H}from"./useMutation.esm-0b851c2a.js";import{P as k}from"./index-b36f36b7.js";import{P as S}from"./index-1a35f117.js";import{P as C}from"./index-f9b4df9c.js";import{P as Ie}from"./index-1431d0f4.js";import{P as Ae}from"./index-95442da0.js";import{T as y}from"./index-87749e14.js";import{l as we}from"./index-71d031a7.js";import{P as ke}from"./index-30704ef6.js";import"./utils-71378904.js";import"./Skeleton-469e4005.js";var Ne=["fieldProps","request","params","proFieldProps"],je=function(a,r){var n=a.fieldProps,o=a.request,i=a.params,p=a.proFieldProps,f=Y(a,Ne),u=m.exports.useContext(z);return t(J,q({valueType:"cascader",fieldProps:q({getPopupContainer:u.getPopupContainer},n),ref:r,request:o,params:i,filedConfig:{customLightMode:!0},proFieldProps:p},f))};const Ee=W.forwardRef(je);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Re=()=>{const e=_();return t(V,{accessKey:"system:menu:add",children:t(U,{onClick:e})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const qe=()=>{const{hasSelected:e,selectedMenuId:a,selectedMenuName:r}=R(),n=G();return t(V,{accessKey:"system:menu:remove",children:t(X,{disabled:!e,onClick:()=>n({menuId:a,menuName:r})})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const N={xs:1,sm:1,md:1,lg:1,xl:2},De=e=>{const{data:a}=j("sys_normal_disable"),{data:r}=j("sys_show_hide");return m.exports.useMemo(()=>{var o,i;const n=[];return e?(e!==g.F&&n.push({title:"状态",dataIndex:"status",key:"status",valueType:"select",valueEnum:(o=a==null?void 0:a.valueEnum)!=null?o:{}},{title:"是否显示",dataIndex:"visible",key:"visible",valueType:"radio",valueEnum:(i=r==null?void 0:r.valueEnum)!=null?i:{},tooltip:"选择否则路由将不会出现在侧边栏，但仍然可以访问"},{title:"是否外链",dataIndex:"isFrame",key:"isFrame",valueType:"radio",valueEnum:O,tooltip:"选择是外链则路由地址需要以`http(s)://`开头"},{title:"图标",dataIndex:"icon",key:"icon",valueType:"text",tooltip:"https://ant.design/components/icon-cn/"},{title:"路由地址",dataIndex:"path",key:"path",valueType:"text",tooltip:"访问的路由地址，如：`user`，如外网地址需内链访问则以`http(s)://`开头"}),e===g.C&&n.push({title:"路由参数",dataIndex:"queryParam",key:"queryParam",valueType:"code",tooltip:'访问路由的默认传递参数，如：{"id": 1, "name": "ry"}'}),e!==g.M&&n.push({title:"权限标识",dataIndex:"perms",key:"perms",valueType:"text",copyable:!0}),n):[]},[e])},Ve=()=>{const e=Q(),a=be(),{hasSelected:r,selectedMenuId:n}=R(),{data:o,loading:i,refresh:p}=Fe(async()=>await $({menuId:n}),{ready:r,refreshDeps:[n]}),{mutateAsync:f}=H(ee,{onSuccess:()=>{p(),e(),a(),E.success("保存成功")}}),u=De(o==null?void 0:o.menuType),M={onSave:async(d,l)=>{const{menuType:T,orderNum:P,menuName:b,menuId:s}=l;await f({menuId:s,menuType:T,orderNum:P,menuName:b,[d]:l[d]})}};return n===0?t(B,{description:"点击选择左侧菜单项查看详情"}):c(Z,{spinning:i,children:[t(k,{columns:[{title:"类型",dataIndex:"menuType",key:"menuType",valueType:"select",valueEnum:L},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime"}],dataSource:o,column:N}),t(D,{}),t(k,{columns:[{title:"名称",dataIndex:"menuName",key:"menuName",valueType:"text"},{title:"排序",dataIndex:"orderNum",key:"orderNum",valueType:"digit"},{title:"备注",dataIndex:"remark",key:"remark",valueType:"textarea"}],dataSource:o,editable:M,column:N}),t(D,{}),t(k,{columns:u,dataSource:o,editable:M,column:N})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Be=()=>{var b;const e=m.exports.useRef(),a=xe(),r=Ce(),{selectedMenuId:n}=R(),{valueEnumSysNormalDisable:o,defaultValueSysNormalDisable:i}=te(),{valueEnumSysShowHide:p,defaultValueSysShowHide:f}=ae(),{data:u,refetch:M}=Te(),d=Q(),{isLoading:l,mutate:T}=H(async()=>{var h,v;const s=await((v=(h=e.current)==null?void 0:h.validateFieldsReturnFormatValue)==null?void 0:v.call(h));!s||await ce(s)},{onSuccess:async()=>{var s;await Promise.all([M(),d()]),a(),(s=e.current)==null||s.resetFields(),E.success("新建成功")}}),[,P]=m.exports.useTransition();return m.exports.useEffect(()=>{!r||P(()=>{var s,h;(h=e.current)==null||h.setFieldsValue({parentId:se((s=u==null?void 0:u.map)!=null?s:new Map,n)})})},[r]),t(re,{open:r,onCancel:a,title:"新建菜单",width:515,onOk:()=>T(),okButtonProps:{loading:l},children:c(oe,{submitter:!1,formRef:e,children:[t(Ee,{name:"parentId",label:"父级菜单",fieldProps:{options:(b=u==null?void 0:u.options)!=null?b:[],fieldNames:{label:"menuName",value:"menuId",children:"children"},changeOnSelect:!0},rules:[{required:!0}],transform:s=>({parentId:s[s.length-1]})}),t(S.Group,{name:"menuType",label:"菜单类型",valueEnum:L,rules:[{required:!0}]}),t(ne,{name:["menuType"],children:({menuType:s})=>s?c(I,{children:[c(A,{children:[t(C,{name:"menuName",label:"菜单名称",width:"sm",rules:[{required:!0}]}),t(Ie,{name:"orderNum",label:"显示排序",tooltip:"默认数值为0，数值越大排序越靠后，数值相等按照创建时间先后排序",rules:[{required:!0}],width:"sm",initialValue:0})]}),s!==g.F&&c(I,{children:[c(A,{children:[t(S.Group,{tooltip:"选择停用则路由将不会出现在侧边栏，也不能被访问",name:"status",label:"菜单状态",required:!0,valueEnum:o,initialValue:i}),t(S.Group,{name:"visible",label:"菜单是否显示",valueEnum:p,required:!0,initialValue:f,tooltip:"选择否则路由将不会出现在侧边栏，但仍然可以访问"}),t(S.Group,{name:"isFrame",label:"是否外链",valueEnum:O,required:!0,initialValue:le.NO,tooltip:"选择是外链则路由地址需要以`http(s)://`开头"})]}),c(A,{children:[t(C,{name:"icon",label:"菜单图标",width:"sm",tooltip:"https://ant.design/components/icon-cn/"}),t(C,{width:"sm",name:"path",label:"路由地址",tooltip:"访问的路由地址，如：`user`，如外网地址需内链访问则以`http(s)://`开头",rules:[{required:!0}]})]})]}),s===g.C&&t(C,{name:"queryParam",label:"路由参数",tooltip:'访问路由的默认传递参数，如：{"id": 1, "name": "ry"}'}),s!==g.M&&t(C,{name:"perms",label:"权限标识"})]}):null}),t(Ae,{name:"remark",label:"备注"})]})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Le=()=>c("div",{className:"mb-2",children:["标签含义：",t(y,{color:"rgb(148 163 184)",children:"显示顺序"}),t(y,{color:F[g.M],children:"目录"}),t(y,{color:F[g.C],children:"菜单"}),t(y,{color:F[g.F],children:"按钮"}),t(y,{children:"权限标识"})]});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Oe=e=>c(I,{children:[t(y,{color:"rgb(148 163 184)",children:e.orderNum}),(e==null?void 0:e.icon)&&t(ie,{name:e.icon,className:"mr-1"}),t(y,{color:F[e.menuType],style:{margin:"0 0 2px 0"},children:e.menuName}),(e==null?void 0:e.perms)&&t(y,{style:{margin:"0 0 2px 2px"},children:c(ue,{size:"small",children:[e.perms,t("div",{onClick:a=>{a.stopPropagation()},children:t(we.CopyToClipboard,{text:e.perms,onCopy:async(a,r)=>{r&&E.success("复制成功")},children:t(de,{style:{color:"#1890ff"}})})})]})})]});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const F={M:"blue",C:"green",F:"red"},_e=()=>{var h,v;const[e,a]=m.exports.useState({}),[r,n]=m.exports.useState(0),[o,i]=m.exports.useState([]),[p,f]=Pe(),u=ve(),M=_(),{data:d}=j("sys_normal_disable"),{data:l,refetch:T}=Se(e,x=>{i(x)}),P=G(),b=(x,{node:{key:K}})=>{n(K)},s=(o==null?void 0:o.length)!==0&&(o==null?void 0:o.length)===((h=l==null?void 0:l.parentIds)==null?void 0:h.length);return m.exports.useEffect(()=>{T()},[e]),m.exports.useEffect(()=>{r>0?f({hasSelected:!0,selectedMenuId:r,selectedMenuName:l.map.get(r).menuName}):u()},[r]),c(I,{children:[t(Le,{}),c("div",{className:"flex justify-between items-center",children:[t(he,{size:"small",className:"my-2",icon:s?t(me,{}):t(pe,{}),onClick:()=>i(s?[]:l==null?void 0:l.parentIds),children:s?"全部折叠":"全部展开"}),c(ge,{onFinish:async x=>{n(0),i([]),a(x)},children:[t(C,{name:"menuName",label:"菜单名称"}),t(ke,{name:"status",label:"状态",valueEnum:(v=d==null?void 0:d.valueEnum)!=null?v:{},initialValue:d==null?void 0:d.defaultValue})]})]}),t(ye,{menu:{items:[{label:"新建",key:"create",onClick:()=>M()},{label:"在根目录下新建",key:"createBase",onClick:()=>{u(),M()}},{label:"删除",key:"delete",danger:!0,disabled:!p.hasSelected,onClick:()=>P({menuId:p.selectedMenuId,menuName:p.selectedMenuName})}]},trigger:["contextMenu"],children:l!=null&&l.treeData.length?t(fe,{blockNode:!0,selectedKeys:[r],onSelect:b,expandedKeys:o,titleRender:Oe,onExpand:i,showLine:{showLeafIcon:!1},fieldNames:{title:"menuName",key:"menuId",children:"children"},height:700,treeData:l==null?void 0:l.treeData,onRightClick:({node:{key:x}})=>n(x)}):t(B,{})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const at=()=>c(Me,{children:[c(w,{ghost:!0,gutter:[16,16],wrap:!0,children:[t(w,{title:"菜单列表",colSpan:{xxl:8,xl:12,lg:14,md:24,sm:24,xs:24},extra:t(Re,{}),children:t(_e,{})}),t(w,{title:"菜单详情",extra:t(qe,{}),colSpan:{xxl:16,xl:12,lg:10,md:24,sm:24,xs:24},className:"h-full",children:t(Ve,{})})]}),t(Be,{})]});export{at as default};
