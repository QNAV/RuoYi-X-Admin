import{j as a,b as h,F as C}from"./antdProComponents-adac7b3f.js";import{e as B,f as M,h as f,F as R,A as d,l as P,aA as N,b as D,G as L,a8 as w,d as x,m as I,B as O}from"./index-3a0ef4a4.js";import{a as K,u as G}from"./utils-a67a12c8.js";import{b as E,c as H,d as q,e as F,f as X,h as Y,i as _}from"./Tool-8446c058.js";import{bm as u,B as m,bA as $,r as A,bB as V,aC as v,bC as W,bD as z,aa as J,a0 as U,aw as Q}from"./antd-aee96f72.js";import{u as b}from"./useMutation-8cb3539a.js";import{u as Z}from"./index-7a4aa1a2.js";import{u as ee}from"./useRequest-7829beda.js";import{H as te}from"./highlight-b66d7291.js";import{l as ae}from"./index-4c9e704e.js";import"./iconPark-395d73b8.js";import"./wangEditor-93aafe29.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const y=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/tool/gen/model/index.ts/atomMainTableActions",B(void 0));y.debugLabel="atomMainTableActions";const oe=()=>M(y),S=()=>f(y),T=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/tool/gen/model/index.ts/atomSelectedTableId",K({open:!1}));T.debugLabel="atomSelectedTableId";const se=()=>f(T),ie=()=>{const e=R(T);return t=>{e({open:!0,previewId:t})}},ce=()=>G(T);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const k=({tableIds:e,batch:t=!1,disabled:s=!1})=>{const{message:n,modal:l}=u.useApp(),o=S(),{mutate:i,isLoading:r}=b(E,{onSuccess:()=>{var c;o==null||o.reload(),(c=o==null?void 0:o.clearSelected)==null||c.call(o),n.success("删除成功")}});return a(d,{accessKey:"tool:gen:remove",children:a(P,{batch:t,disabled:s,onClick:()=>{l.confirm({title:"删除代码",content:`确定删除 表ID ${e.join(",")} 生成的代码吗？`,okButtonProps:{loading:r},onOk:()=>i({tableIds:e})})}})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ne=async e=>{const{data:t}=await H({tables:e},{format:"blob"});N.saveAs(new Blob([t],{type:"application/zip"}),`ruoyi_${new Date().getTime()}`)},j=({tableName:e,batch:t=!1,disabled:s=!1})=>{const n=t?"批量下载":"下载",{message:l}=u.useApp(),{isLoading:o,mutate:i}=b(ne,{onSuccess:()=>{l.success("下载成功")}});return a(d,{accessKey:"tool:gen:query",children:a(m,{loading:o,onClick:()=>i(e),type:"link",icon:a($,{}),disabled:s,children:n})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const le=({tableId:e})=>{const t=D();return a(d,{accessKey:"tool:gen:edit",children:a(L,{onClick:()=>t(`/tool/gen-edit/${e}`)})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const re=[{title:"序号",dataIndex:"index",key:"index",valueType:"indexBorder"},{title:"表名称",dataIndex:"tableName",key:"tableName",valueType:"text"},{title:"表描述",dataIndex:"tableComment",key:"tableComment",valueType:"text"},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",hideInSearch:!0,sorter:!0},{title:"更新时间",dataIndex:"updateTime",key:"updateTime",valueType:"dateTime",hideInSearch:!0,sorter:!0},{title:"创建时间",dataIndex:"createTimeRange",key:"createTimeRange",valueType:"dateTimeRange",hideInTable:!0}],he=()=>{const e=A.useRef(),t=S(),[s,{toggle:n}]=Z(),[l,o]=A.useState([]),{message:i}=u.useApp(),{mutate:r,isLoading:g}=b(F,{onSuccess:()=>{var c,p;t==null||t.reload(),n(),i.success("导入成功"),(p=(c=e.current)==null?void 0:c.clearSelected)==null||p.call(c)}});return h(w,{accessible:!0,children:[a(m,{type:"primary",onClick:n,icon:a(V,{}),children:"导入"}),a(v,{open:s,onCancel:n,title:"导入表结构",onOk:()=>r({tables:l}),width:900,okText:"提交",confirmLoading:g,okButtonProps:{disabled:l.length===0},children:a(x,{ghost:!0,actionRef:e,columns:re,rowKey:"tableName",search:{filterType:"light"},rowSelection:{alwaysShowAlert:!0,onChange:c=>{o(c)}},tableAlertOptionRender:!1,options:!1,request:(...c)=>q(I(...c))})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const de=({tableId:e})=>{const t=ie();return a(d,{accessKey:"tool:gen:preview",children:a(m,{onClick:()=>t(e),type:"link",icon:a(W,{}),children:"预览"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ue=({tableName:e})=>{const{message:t}=u.useApp(),{isLoading:s,mutate:n}=b(X,{onSuccess:()=>{t.success("同步成功")}});return a(d,{accessKey:"tool:gen:code",children:a(m,{loading:s,type:"link",icon:a(z,{}),onClick:()=>n({tableName:e}),children:"同步"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const me=()=>{const e=ce(),{open:t,previewId:s}=se(),{message:n}=u.useApp(),{data:l,loading:o}=ee(async()=>{const i=await Y({tableId:s});return Object.keys(i).map(r=>({key:r,content:i[r],highlightContent:te.highlightAuto(i[r]).value}))},{ready:t&&!!s,refreshDeps:[s]});return a(w,{accessible:!0,children:a(v,{open:t,onCancel:e,width:"90%",footer:!1,title:"预览代码",bodyStyle:{height:"700px"},children:a(J,{spinning:o,children:a(U,{tabPosition:"left",items:(l==null?void 0:l.map(({key:i,content:r,highlightContent:g})=>({key:i,label:i,children:h("div",{className:"relative",children:[a(ae.CopyToClipboard,{text:r,onCopy:(c,p)=>{p&&n.success("复制成功")},children:a(m,{icon:a(Q,{}),type:"link",className:"absolute top-[-5px] right-2",children:"复制代码"})}),a("pre",{children:a("code",{children:a("div",{className:"h-[650px] overflow-auto",dangerouslySetInnerHTML:{__html:g}})})})]})})))??[]})})})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ge=[{title:"序号",dataIndex:"index",key:"index",valueType:"indexBorder"},{title:"表名称",dataIndex:"tableName",key:"tableName",valueType:"text"},{title:"表描述",dataIndex:"tableComment",key:"tableComment",valueType:"text"},{title:"实体名称",dataIndex:"className",key:"className",valueType:"text",hideInSearch:!0},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",hideInSearch:!0,sorter:!1},{title:"更新时间",dataIndex:"updateTime",key:"updateTime",valueType:"dateTime",hideInSearch:!0,sorter:!0},{title:"创建时间",dataIndex:"createTimeRange",key:"createTimeRange",valueType:"dateTimeRange",hideInTable:!0},{title:"操作",valueType:"option",render:(e,t)=>h(C,{children:[a(de,{tableId:t.tableId}),a(le,{tableId:t.tableId}),a(ue,{tableName:t.tableName}),a(j,{tableName:t.tableName}),a(k,{tableIds:[t.tableId]})]})}],pe=({selectedRows:e,selectedRowKeys:t})=>h(C,{children:[a(k,{tableIds:t,batch:!0,disabled:t.length===0}),a(j,{tableName:e.map(({tableName:s})=>s).join(","),batch:!0,disabled:t.length===0})]}),je=()=>{const e=oe();return h(O,{children:[a(x,{rowKey:"tableId",actionRef:e,tableAlertOptionRender:pe,columns:ge,toolbar:{actions:[a(he,{},"ButtonImport")]},request:(...t)=>_(I(...t))}),a(me,{})]})};export{je as default};
