import{j as s,K as H,B as R,I as X,p as Y}from"./antdProComponents-e22c8f35.js";import{A as x,G as _,b7 as G,l as q,g as i,r as Q,x as W,b8 as $,Q as M,b9 as z,V as J,aD as Z,z as ee,ba as v,w as te,e as k,h as T,f as se,F as C,bb as ae,bc as oe,bd as re,be as ne,L as ce,j as le,bf as ie,k as E,bg as de,bh as ue,bi as me,_ as he,d as pe,m as ge,i as xe,bj as Ie,B as be}from"./index-745cf65f.js";import{b9 as I,B as N,r as p,aH as fe,ak as Te,ba as Ce,ai as ye,ad as je,a_ as we}from"./antd-1f44218c.js";import{u as f}from"./useMutation-4e59d89d.js";import{u as w}from"./useRequest-d94dba80.js";import{a as F,u as B}from"./utils-2019c567.js";import{u as Ae}from"./index-634f5765.js";import"./iconPark-b877fbca.js";import"./wangEditor-efc1ec1c.js";import"./tslib.es6-59680bf8.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Pe=({userId:e})=>{const t=tt();return s.jsx(x,{accessKey:"system:user:edit",children:s.jsx(_,{onClick:()=>t(e)})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const D=({userIds:e,batch:t,disabled:a})=>{const{message:r,modal:n}=I.useApp(),o=P(),{mutate:d,isLoading:l}=f(G,{onSuccess:()=>{var m;o==null||o.reload(),(m=o==null?void 0:o.clearSelected)==null||m.call(o),r.success("删除成功")}}),u=()=>{n.confirm({title:"删除用户",content:`确定删除用户编号为 ${e.join(",")} 的数据吗？`,onOk:()=>d({userIds:e}),okButtonProps:{loading:l}})};return s.jsx(x,{accessKey:"system:user:remove",children:s.jsx(q,{batch:t,disabled:a,onClick:u})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Se=({record:e})=>{const t=ze();return s.jsx(x,{accessKey:"system:user:resetPwd",children:s.jsx(N,{type:"link",danger:!0,icon:s.jsx(H,{}),onClick:()=>t(e),children:"重置密码"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const[Re]=i({title:"用户编号",dataIndex:"userId",table:{valueType:"text",hideInSearch:!0}}),[Me,,U]=i({title:"用户名称",dataIndex:"userName",table:{valueType:"text"},form:{valueType:"text",formItemProps:{rules:[{required:!0}]}}}),[ve,,ke]=i({title:"用户昵称",dataIndex:"nickName",table:{valueType:"text",hideInSearch:!0},form:{valueType:"text"}}),[Ee]=i({title:"部门名称",dataIndex:["dept","deptName"],table:{valueType:"text",hideInSearch:!0}}),[Ne,,Fe]=i({title:"手机号码",dataIndex:"phoneNumber",table:{valueType:"text",copyable:!0},form:{valueType:"text",formItemProps:{rules:[{pattern:Q,message:"手机号码格式不正确"}]},fieldProps:{maxLength:11}}}),Be="NORMAL",L=()=>{const{valueEnumSysNormalDisable:e}=J();return i({title:"状态",dataIndex:"status",valueEnum:e,table:{valueType:"select"},form:{initialValue:Be,valueType:"radio"}})},[De]=i({title:"创建时间",dataIndex:"createTime",table:{valueType:"dateTime",hideInSearch:!0,sorter:!0}}),[Ue]=i({title:"创建时间",dataIndex:"createTimeRange",table:{valueType:"dateTimeRange",hideInTable:!0}}),O=(e=!1)=>{const{data:t}=M(["sysConfigGetConfigKeySkipErrorHandler","sys.user.initPassword"],async()=>{const{data:a}=await Z({configKey:"sys.user.initPassword"});return a.msg});return i({title:"用户密码",dataIndex:"password",form:{valueType:"password",initialValue:e?t:void 0,formItemProps:{rules:[{required:!0},{pattern:ee,message:"密码长度应在6-20之间，只能包含字母、数字和下划线"}]}}})},Le=()=>{const{data:e=[]}=w(()=>v({}));return i({title:"归属部门",dataIndex:"deptId",form:{valueType:"treeSelect",fieldProps:{treeData:e,fieldNames:{value:"id"}}}})},[,,Oe]=i({title:"邮箱",dataIndex:"email",form:{valueType:"text",formItemProps:{rules:[{pattern:W,message:"邮箱格式错误"}]}}}),Ve="UNKNOWN",Ke=()=>{const{valueEnumSysUserSex:e}=te();return i({title:"用户性别",dataIndex:"sex",valueEnum:e,form:{valueType:"radio",initialValue:Ve}})},He=e=>i({title:"岗位",dataIndex:"postIds",valueEnum:e,form:{valueType:"select",fieldProps:{mode:"multiple"},colProps:{span:24}}}),Xe=e=>i({title:"角色",dataIndex:"roleIds",valueEnum:e,form:{valueType:"select",fieldProps:{mode:"multiple"},colProps:{span:24}}}),[,,Ye]=i({title:"备注",dataIndex:"remark",form:{valueType:"textarea",colProps:{span:24}}}),_e=()=>{const[,,e]=O();return[$(U,{readonly:!0}),e]},Ge=()=>{const[e]=L();return[Re,Me,ve,Ee,Ne,e,De,Ue,{title:"操作",valueType:"option",render:(t,a)=>a.userId===1?null:s.jsxs(s.Fragment,{children:[s.jsx(Pe,{userId:a.userId}),s.jsx(D,{userIds:[a.userId]}),s.jsx(Se,{record:a})]}),fixed:"right",width:260}]},qe=e=>{const{data:t}=M(["sysUserGetInfo"],async()=>{const{posts:u,roles:m}=await z();return{posts:u.reduce((g,c)=>g.set(c.postId,c.postName),new Map),roles:m.reduce((g,c)=>g.set(c.roleId,c.roleName),new Map)}}),[,,a]=Le(),[,,r]=O(!0),[,,n]=Ke(),[,,o]=L(),[,,d]=He((t==null?void 0:t.posts)??{}),[,,l]=Xe((t==null?void 0:t.roles)??{});return[ke,a,Fe,Oe,...e==="add"?[U,r]:[],n,o,d,l,Ye]};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const A=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomMainTableActions",k(void 0));A.debugLabel="atomMainTableActions";const P=()=>T(A),Qe=()=>se(A),S=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomSelectedDeptId",k(0));S.debugLabel="atomSelectedDeptId";const We=()=>T(S),$e=()=>C(S),y=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomResetPwdModal",F({open:!1}));y.debugLabel="atomResetPwdModal";const ze=()=>{const e=C(y);return t=>{e({open:!0,record:t})}},Je=()=>B(y),Ze=()=>T(y),b=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomAddOrEditModal",F({open:!1,actionType:"add"}));b.debugLabel="atomAddOrEditModal";const et=()=>{const e=C(b);return()=>{e({open:!0,actionType:"add"})}},tt=()=>{const e=C(b);return t=>{e({open:!0,actionType:"edit",userId:t})}},st=()=>B(b),at=()=>T(b);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ot=()=>{const{message:e}=I.useApp(),t=p.useRef(),a=P(),{open:r,actionType:n,userId:o}=at(),d=st(),l=()=>{var c;n==="edit"&&((c=t.current)==null||c.resetFields()),d()},[,u]=p.useTransition();w(async()=>{const{postIds:c,roleIds:h,user:j}=await ae({userId:o});return{...j,postIds:c,roleIds:h}},{ready:r&&n==="edit"&&!!o,onSuccess:c=>{u(()=>{var h;(h=t.current)==null||h.setFieldsValue(c)})},refreshDeps:[r]});const m=async c=>{var h;if(n==="add"){const{roleIds:j=[],postIds:V=[],...K}=c;await oe({roleIds:j,postIds:V,...K})}else await re({userId:o,...c});a==null||a.reload(),(h=t.current)==null||h.resetFields(),d(),e.success(n==="add"?"新增成功":"编辑成功")},g=qe(n);return s.jsx(R,{layoutType:"ModalForm",title:n==="add"?"新增用户":"编辑用户",formRef:t,grid:!0,colProps:{span:12},modalProps:{okText:"提交",onCancel:l},width:600,open:r,onFinish:m,columns:g})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const rt=()=>{const{message:e}=I.useApp(),t=p.useRef(),a=_e(),r=Je(),{open:n,record:o}=Ze(),[,d]=p.useTransition(),l=P(),u=async({password:m})=>{await ne({...o,password:m}),l==null||l.reload(),r(),e.success("重置密码成功")};return p.useEffect(()=>{n&&o&&d(()=>{var m;(m=t.current)==null||m.setFieldsValue({userName:o.userName,password:""})})},[n]),s.jsx(R,{title:"重置密码",layoutType:"ModalForm",columns:a,width:500,formRef:t,open:n,modalProps:{okText:"提交",onCancel:r},onFinish:u})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const nt=()=>{const e=et();return s.jsx(x,{accessKey:"system:user:add",children:s.jsx(ce,{onClick:e})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ct=async e=>{const{data:t}=await ie(e,{format:"blob"});await E(t,`user_${new Date().getTime()}.xlsx`)},lt=({searchParams:e})=>{const{message:t}=I.useApp(),{isLoading:a,mutate:r}=f(ct,{onSuccess:()=>{t.success("导出成功")}});return s.jsx(x,{accessKey:"system:user:export",children:s.jsx(le,{loading:a,onClick:()=>r(e)})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const{Dragger:it}=Ce,dt=async()=>{const{data:e}=await ue({format:"blob"});await E(e,`user_template_${new Date().getTime()}.xlsx`)},ut=async({updateSupport:e,file:t})=>{const{data:{code:a,msg:r}}=await me({updateSupport:e},{file:t});return a!==200?Promise.reject(new Error(r)):r},mt=()=>{const[e,{toggle:t}]=Ae(),[a,r]=p.useState(!1),[n,o]=p.useState([]),{message:d,modal:l}=I.useApp(),{mutate:u,isLoading:m}=f(ut,{onSuccess:h=>{t(),l.info({title:"导入结果",content:h})},onError:()=>{d.error("导入失败")}}),{mutate:g,isLoading:c}=f(dt);return s.jsxs(x,{accessKey:"system:user:import",children:[s.jsx(de,{onClick:t}),s.jsxs(fe,{title:"导入用户",open:e,onCancel:t,onOk:()=>u({updateSupport:a,file:n[0].originFileObj}),okButtonProps:{loading:m},children:[s.jsxs(it,{accept:".xlsx, .xls",maxCount:1,beforeUpload:()=>!1,onChange:h=>o(h.fileList),fileList:n,onRemove:()=>o([]),children:[s.jsx("p",{className:"ant-upload-drag-icon",children:s.jsx(X,{})}),s.jsx("p",{className:"ant-upload-text",children:"点击或拖拽文件到此区域上传"})]}),s.jsxs("div",{className:"flex flex-col items-center pt-2",children:[s.jsx(Te,{checked:a,onChange:h=>{r(h.target.checked)},children:"是否更新已经存在的用户数据"}),s.jsxs("div",{children:[s.jsx("span",{children:"仅允许导入xls、xlsx格式文件"}),s.jsx(N,{type:"link",onClick:()=>g(),loading:c,children:"下载模板"})]})]})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ht=()=>{const[e,t]=p.useState(""),a=$e(),{data:r,loading:n}=w(()=>v({deptName:e}),{refreshDeps:[e]});return s.jsxs(ye,{spinning:n,children:[s.jsx(je.Search,{allowClear:!0,placeholder:"请输入部门名称",className:"mb-3",onSearch:o=>t(o)}),!r||r.length===0?s.jsx(he,{}):s.jsx(we,{treeData:r,defaultExpandAll:!0,fieldNames:{title:"label",key:"id"},onSelect:(o,{node:{key:d}})=>{a(d)},blockNode:!0})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const pt=({selectedRowKeys:e})=>s.jsx(D,{disabled:e.length===0,batch:!0,userIds:e}),gt=(e,t)=>s.jsxs("div",{className:"flex gap-4",children:[s.jsx(Y,{className:"w-80",children:s.jsx(ht,{})}),s.jsx("div",{className:"overflow-auto w-full",children:t})]}),xt=()=>{const e=Qe(),[t,a]=p.useState({}),r=Ge(),n=We(),o=n>0?{deptId:n}:{};return s.jsx(pe,{rowKey:"userId",actionRef:e,columns:r,params:o,request:async(...d)=>{const{createTimeRange:l,...u}=ge(...d);return xe(l)&&(u.beginCreateTime=l[0],u.endCreateTime=l[1]),a(u),await Ie(u)},toolbar:{actions:[s.jsx(lt,{searchParams:t},"ButtonExport"),s.jsx(mt,{},"ButtonImport"),s.jsx(nt,{},"ButtonAdd")]},tableRender:gt,tableAlertOptionRender:pt})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const St=()=>s.jsxs(be,{children:[s.jsx(xt,{}),s.jsx(ot,{}),s.jsx(rt,{})]});export{St as default};
