import{j as s,B as ye,c as xe,o as U,H as je,t as Ce,y as Se,S as Ie,C as Re,p as j}from"./antdProComponents-4d2f80fe.js";import{e as Te,h as J,f as ve,F as Ae,Q as _,aQ as De,aR as ke,aS as ee,aT as te,aU as se,U as be,aV as we,g as S,V as Ke,A,L as Me,aW as Ee,b as Pe,aX as Fe,l as Ne,aY as Be,Z as Le,aZ as ze,a_ as Oe,a$ as Ve,_ as B,b0 as qe,b1 as Qe,b2 as Ue,B as Xe}from"./index-82ba992b.js";import{r as c,ba as K,B as v,I as Ye,af as L,aH as Ge,ae as N,aL as We,b8 as He,ah as ae,a$ as oe}from"./antd-a78c455c.js";import{u as z}from"./useMutation-2affec20.js";import{a as $e,u as Ze}from"./utils-5ad12fb9.js";import{i as X,u as Je}from"./useRequest-c085c0e9.js";import{f as _e,e as ne}from"./tslib.es6-59680bf8.js";import"./iconPark-5ec34246.js";import"./wangEditor-0d271890.js";var w=new Set,C,Y={xs:0,sm:576,md:768,lg:992,xl:1200};function F(){var e,t,o=C;if(le(),o!==C)try{for(var a=ne(w),n=a.next();!n.done;n=a.next()){var i=n.value;i()}}catch(u){e={error:u}}finally{try{n&&!n.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}}var b=!1;function le(){var e,t,o=window.innerWidth,a={},n=!1;try{for(var i=ne(Object.keys(Y)),u=i.next();!u.done;u=i.next()){var d=u.value;a[d]=o>=Y[d],a[d]!==C[d]&&(n=!0)}}catch(f){e={error:f}}finally{try{u&&!u.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}n&&(C=a)}function et(){X&&!b&&(C={},le(),window.addEventListener("resize",F),b=!0);var e=_e(c.useState(C),2),t=e[0],o=e[1];return c.useEffect(function(){if(X){b||window.addEventListener("resize",F);var a=function(){o(C)};return w.add(a),function(){w.delete(a),w.size===0&&(window.removeEventListener("resize",F),b=!1)}}},[]),t}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const O=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/role/model/index.ts/atomRoleListActions",Te(void 0));O.debugLabel="atomRoleListActions";const V=()=>J(O),tt=()=>ve(O),M=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/role/model/index.ts/atomRoleDetails",$e({open:!1}));M.debugLabel="atomRoleDetails";const st=()=>Ze(M),at=()=>{const e=Ae(M);return t=>{e({open:!0,roleId:t})}},I=()=>J(M),re="sysRole",ce=[re,"details"],ie=e=>{const{roleId:t}=I(),o=_(ce,()=>De({roleId:t}),{onSuccess:e,enabled:!1});return c.useEffect(()=>{t&&o.refetch()},[t]),o},ue=[re,"tree"],ot=e=>{const{roleId:t}=I(),o=_(ue,async()=>{const{menus:a,checkedKeys:n}=await ke({roleId:t});return{treeData:a,selectedMenuIds:n,selectedTreeData:ee(a,n),allMenuIds:te(a),allExpandedKeys:se(a)}},{onSuccess:a=>{e(a.selectedTreeData)},enabled:!1});return c.useEffect(()=>{t&&o.refetch()},[t]),o},he=e=>{const t=be(),{message:o}=K.useApp();return z(async a=>{const n=t.getQueryData(ce),i=t.getQueryData(ue);await we({roleId:n.roleId,roleKey:n.roleKey,roleName:n.roleName,roleSort:n.roleSort,status:n.status,menuIds:i.selectedMenuIds,menuCheckStrictly:"NO",deptCheckStrictly:"NO",...a})},{onSuccess:async()=>{e(),o.success("保存成功")}})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const G=[{required:!0,message:"请输入角色名称"}],[,nt,lt,rt]=S({title:"角色名称",dataIndex:"roleName",descriptions:{valueType:"text",formItemProps:{rules:G}},form:{valueType:"text",formItemProps:{rules:G}},meta:{valueType:"text"}}),[,ct]=S({title:"角色编号",dataIndex:"roleId",descriptions:{valueType:"text"}}),W="控制器中定义的权限字符，如：@PreAuthorize(`@ss.hasRole('admin')`)",H=[{required:!0,message:"请输入权限字符"}],[,it,ut,ht]=S({title:"权限字符",dataIndex:"roleKey",descriptions:{valueType:"text",tooltip:W,formItemProps:{rules:H}},form:{valueType:"text",tooltip:W,formItemProps:{rules:H}},meta:{valueType:"text"}}),dt="NORMAL",q=()=>{const{valueEnumSysNormalDisable:e}=Ke();return S({title:"状态",dataIndex:"status",valueEnum:e,table:{valueType:"select"},form:{initialValue:dt,valueType:"radio",colProps:{span:12}},meta:{valueType:"select"}})},$=[{required:!0,message:"请输入显示排序"}],[,mt,pt]=S({title:"显示排序",dataIndex:"roleSort",descriptions:{valueType:"digit",formItemProps:{initialValue:0,rules:$}},form:{valueType:"digit",formItemProps:{initialValue:0,rules:$},colProps:{span:12}}}),[,ft,gt]=S({title:"备注",dataIndex:"remark",descriptions:{valueType:"textarea"},form:{valueType:"textarea"}}),[,yt]=S({title:"创建时间",dataIndex:"createTime",descriptions:{valueType:"dateTime"}}),xt=()=>{const[,,,e]=q();return{title:rt,subTitle:e,description:ht}},jt=()=>{const[,,e]=q();return[lt,ut,e,pt,gt]},Ct=[ct,yt],St=()=>{const[,e]=q();return[e,mt,nt,it,ft]};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const It=()=>{const e=c.useRef(),t=V(),o=jt(),{message:a}=K.useApp(),n=async i=>{var u;return await Ee({...i,menuIds:[],menuCheckStrictly:"NO",deptCheckStrictly:"NO"}),t==null||t.reload(),(u=e.current)==null||u.resetFields(),a.success("新增成功"),!0};return s.jsx(A,{accessKey:"system:role:add",children:s.jsx(ye,{title:"新增角色",trigger:s.jsx(Me,{}),formRef:e,onFinish:n,width:500,modalProps:{okText:"提交"},grid:!0,colProps:{span:24},layoutType:"ModalForm",columns:o})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Rt=()=>{const e=Pe(),{roleId:t,open:o}=I();return s.jsx(A,{accessKey:"system:user:edit",children:s.jsx(v,{type:"primary",onClick:()=>e(Fe("/system/role-auth/:roleId",{roleId:t.toString()})),icon:s.jsx(xe,{}),disabled:!o,children:"分配用户"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Tt=()=>{const e=V(),t=st(),{roleId:o,open:a}=I(),{message:n,modal:i}=K.useApp(),{isLoading:u,mutateAsync:d}=z(Be,{onSuccess:()=>{var g;e==null||e.reload(),(g=e==null?void 0:e.clearSelected)==null||g.call(e),t(),n.success("删除成功")}}),f=()=>i.confirm({title:"操作确认",content:`确定删除角色编号为 ${o} 的角色吗？`,onOk:()=>d({roleIds:[o]}),okButtonProps:{loading:u}});return s.jsx(A,{accessKey:"system:role:remove",children:s.jsx(Ne,{type:"primary",size:"middle",disabled:!a,onClick:f})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const vt=()=>{const[e,t]=c.useState([]),[o]=Ye.useForm(),a=St(),n=V(),{data:i,isFetching:u,refetch:d}=ie(()=>{t([]),o.resetFields()}),{mutateAsync:f}=he(()=>{d(),n==null||n.reload()}),y=Le()("system:role:edit")?{form:o,editableKeys:e,onChange:(m,x)=>{if(t(m),m.length>0){const l=m[0];o.setFieldsValue({[l]:x[l]})}},onSave:async(m,x)=>{await f({[m]:x[m]})}}:void 0;return s.jsxs(L,{spinning:u,children:[s.jsx(U,{column:2,columns:Ct,dataSource:i}),s.jsx(Ge,{}),s.jsx(U,{column:2,columns:a,dataSource:i,editable:y})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const At=()=>{const e=tt(),t=at(),o=xt();return s.jsx(je,{ghost:!0,rowKey:"roleId",actionRef:e,metas:o,tableAlertRender:!1,rowSelection:{type:"radio",onSelect:({roleId:a})=>t(a)},search:{filterType:"light"},pagination:{defaultPageSize:10,defaultCurrent:1,showSizeChanger:!0},request:a=>ze(a)})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Dt=()=>{const[e,t]=c.useState([]),[o,a]=c.useState(!1),[n,i]=c.useState([]),[u,d]=c.useState([]),[f,g]=c.useState(!1),[y,m]=c.useState(!0),{message:x}=K.useApp(),[l,D]=c.useState(),k=c.useRef(),{open:E,roleId:R}=I(),{valueEnumSysDataScope:p}=Oe(),{refetch:de}=ie(({dataScope:h})=>{var T;D(h),(T=k.current)==null||T.setFieldsValue({dataScope:h})}),{loading:me,refresh:pe,data:r}=Je(async()=>{const{depts:h,checkedKeys:T}=await Ve(R);return{treeData:h,selectedMenuIds:T,selectedTreeData:ee(h,T),allMenuIds:te(h),allExpandedKeys:se(h)}},{ready:E,refreshDeps:[R],onSuccess:h=>{a(!1),d(h.selectedTreeData)}}),{isLoading:Q,mutate:fe}=z(async()=>{await qe({roleId:R,dataScope:l,deptIds:e})},{onSuccess:()=>{pe(),de(),x.success("保存成功")}}),P=n.length===(r==null?void 0:r.allExpandedKeys.length),ge=h=>{if(h||y){t((r==null?void 0:r.allMenuIds)??[]);return}t([])};return c.useEffect(()=>{if((r==null?void 0:r.allMenuIds.length)===e.length){g(!0),m(!1);return}if(e.length===0){g(!1),m(!1);return}m(!0)},[r==null?void 0:r.allMenuIds,e]),s.jsxs(s.Fragment,{children:[s.jsxs("header",{className:"flex justify-between items-start flex-wrap",children:[s.jsx(Ce,{formRef:k,submitter:!1,layout:"horizontal",children:s.jsx(Se,{name:"dataScope",label:"数据权限范围",valueEnum:p,fieldProps:{onChange:h=>{D(h)}},readonly:!o})}),s.jsx(A,{accessKey:"system:role:edit",children:o?s.jsxs(N,{children:[s.jsx(v,{loading:Q,onClick:()=>{a(!1),d((r==null?void 0:r.selectedTreeData)??[])},children:"取消编辑"}),s.jsx(v,{type:"primary",ghost:!0,icon:s.jsx(Ie,{}),loading:Q,onClick:()=>fe(),children:"保存"})]}):s.jsx(v,{type:"primary",ghost:!0,icon:s.jsx(We,{}),onClick:()=>{a(!0),t((r==null?void 0:r.selectedMenuIds)??[]),d((r==null?void 0:r.treeData)??[])},children:"编辑数据权限"})})]}),l==="CUSTOM"&&s.jsxs(s.Fragment,{children:[s.jsxs(N,{wrap:!0,className:"my-2",children:[u.length>0&&s.jsx(v,{size:"small",icon:P?s.jsx(He,{}):s.jsx(Re,{}),onClick:()=>i(P?[]:r.allExpandedKeys),children:P?"全部折叠":"全部展开"}),o&&s.jsx(ae,{indeterminate:y,onChange:h=>ge(h.target.checked),checked:f,children:"全选/全不选"})]}),s.jsx(L,{spinning:me,children:u.length>0?s.jsx(oe,{blockNode:!0,showLine:{showLeafIcon:!1},checkable:o,checkStrictly:!0,fieldNames:{title:"label",key:"id"},checkedKeys:e,treeData:u,expandedKeys:n,onExpand:h=>i(h),onCheck:h=>{t(h.checked)}}):s.jsx(B,{description:"暂未分配数据权限"})})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const kt=()=>{const[e,t]=c.useState([]),[o,a]=c.useState(!1),[n,i]=c.useState([]),[u,d]=c.useState([]),[f,g]=c.useState(!1),[y,m]=c.useState(!0),{isFetching:x,data:l,refetch:D}=ot(p=>{a(!1),d(p)}),{isLoading:k,mutate:E}=he(()=>{D()}),R=p=>{if(p||y){t((l==null?void 0:l.allMenuIds)??[]);return}t([])};return c.useEffect(()=>{if((l==null?void 0:l.allMenuIds.length)===e.length){g(!0),m(!1);return}if(e.length===0){g(!1),m(!1);return}m(!0)},[l==null?void 0:l.allMenuIds,e]),s.jsxs(s.Fragment,{children:[s.jsxs("header",{className:"flex justify-between items-end mb-2",children:[s.jsx(Qe,{expanded:n.length===(l==null?void 0:l.allExpandedKeys.length),onChange:p=>{i(p?(l==null?void 0:l.allExpandedKeys)??[]:[])}}),s.jsx(A,{accessKey:"system:role:edit",children:s.jsx(Ue,{editable:o,loading:k,onCancel:()=>{a(!1),d((l==null?void 0:l.selectedTreeData)??[])},onSave:()=>E({menuIds:e}),onStartEdit:()=>{a(!0),t((l==null?void 0:l.selectedMenuIds)??[]),d((l==null?void 0:l.treeData)??[])}})})]}),s.jsxs(L,{spinning:x,children:[s.jsx("div",{className:"pl-1 mb-1",children:o&&s.jsx(ae,{indeterminate:y,onChange:p=>R(p.target.checked),checked:f,children:"全选/全不选"})}),u.length>0?s.jsx(oe,{blockNode:!0,showLine:{showLeafIcon:!1},checkable:o,checkStrictly:!0,fieldNames:{title:"label",key:"id"},checkedKeys:e,treeData:u,expandedKeys:n,onExpand:p=>i(p),onCheck:p=>{t(p.checked)},height:500}):s.jsx(B,{description:"暂未分配菜单权限"})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Z={list:{xxl:7,xl:10,lg:13,md:24,sm:24,xs:24},details:{xxl:17,xl:14,lg:11,md:24,sm:24,xs:24}},Lt=()=>{const{xl:e}=et(),{open:t}=I();return s.jsx(Xe,{children:s.jsxs(j,{ghost:!0,gutter:[16,16],wrap:!0,children:[s.jsx(j,{title:"角色列表",colSpan:Z.list,extra:s.jsx(It,{}),children:s.jsx(At,{})}),s.jsx(j,{split:"horizontal",title:"角色详情",colSpan:Z.details,extra:s.jsxs(N,{children:[s.jsx(Tt,{}),s.jsx(Rt,{})]}),className:"h-full",children:t?s.jsxs(s.Fragment,{children:[s.jsx(j,{children:s.jsx(vt,{})}),s.jsxs(j,{split:e?"vertical":"horizontal",children:[s.jsx(j,{children:s.jsx(kt,{})}),s.jsx(j,{children:s.jsx(Dt,{})})]})]}):s.jsx(B,{description:"点击选择左侧角色查看详情"})})]})})};export{Lt as default};
