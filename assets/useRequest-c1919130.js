import{r as d}from"./jsx-runtime-f6344dff.js";import{aV as z,aW as N}from"./index-0c3aa956.js";const q=t=>(e,n)=>{const r=d.useRef(!1);t(()=>()=>{r.current=!1},[]),t(()=>{if(!r.current)r.current=!0;else return e()},n)};var j=function(t,e){return j=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var u in r)Object.prototype.hasOwnProperty.call(r,u)&&(n[u]=r[u])},j(t,e)};function Se(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");j(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var B=function(){return B=Object.assign||function(e){for(var n,r=1,u=arguments.length;r<u;r++){n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},B.apply(this,arguments)};function F(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,r=Object.getOwnPropertySymbols(t);u<r.length;u++)e.indexOf(r[u])<0&&Object.prototype.propertyIsEnumerable.call(t,r[u])&&(n[r[u]]=t[r[u]]);return n}function L(t,e,n,r){function u(i){return i instanceof n?i:new n(function(s){s(i)})}return new(n||(n=Promise))(function(i,s){function l(c){try{o(r.next(c))}catch(f){s(f)}}function a(c){try{o(r.throw(c))}catch(f){s(f)}}function o(c){c.done?i(c.value):u(c.value).then(l,a)}o((r=r.apply(t,e||[])).next())})}function je(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,u,i,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(o){return function(c){return a([o,c])}}function a(o){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(n=0)),n;)try{if(r=1,u&&(i=o[0]&2?u.return:o[0]?u.throw||((i=u.return)&&i.call(u),0):u.next)&&!(i=i.call(u,o[1])).done)return i;switch(u=0,i&&(o=[o[0]&2,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return n.label++,{value:o[1],done:!1};case 5:n.label++,u=o[1],o=[0];continue;case 7:o=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(o[0]===6||o[0]===2)){n=0;continue}if(o[0]===3&&(!i||o[1]>i[0]&&o[1]<i[3])){n.label=o[1];break}if(o[0]===6&&n.label<i[1]){n.label=i[1],i=o;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(o);break}i[2]&&n.ops.pop(),n.trys.pop();continue}o=e.call(t,n)}catch(c){o=[6,c],u=0}finally{r=i=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}}function Ae(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function xe(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),u,i=[],s;try{for(;(e===void 0||e-- >0)&&!(u=r.next()).done;)i.push(u.value)}catch(l){s={error:l}}finally{try{u&&!u.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return i}function Ee(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),u=0,e=0;e<n;e++)for(var i=arguments[e],s=0,l=i.length;s<l;s++,u++)r[u]=i[s];return r}function $e(t,e,n){if(n||arguments.length===2)for(var r=0,u=e.length,i;r<u;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))}const P=t=>typeof t=="function",V=!1,x=V;function b(t){x&&(P(t)||console.error(`useMemoizedFn expected parameter is a function, got ${typeof t}`));const e=d.useRef(t);e.current=d.useMemo(()=>t,[t]);const n=d.useRef();return n.current||(n.current=function(...r){return e.current.apply(this,r)}),n.current}const A=q(d.useEffect),M=(t,{manual:e,ready:n=!0,defaultParams:r=[],refreshDeps:u=[],refreshDepsAction:i})=>{const s=d.useRef(!1);return s.current=!1,A(()=>{!e&&n&&(s.current=!0,t.run(...r))},[n]),A(()=>{s.current||e||(s.current=!0,i?i():t.refresh())},[...u]),{onBefore:()=>{if(!n)return{stopNow:!0}}}};M.onInit=({ready:t=!0,manual:e})=>({loading:!e&&t});const G=M;function J(t,e){if(t===e)return!0;for(let n=0;n<t.length;n++)if(!Object.is(t[n],e[n]))return!1;return!0}function T(t,e){const{current:n}=d.useRef({deps:e,obj:void 0,initialized:!1});return(n.initialized===!1||!J(n.deps,e))&&(n.deps=e,n.obj=t(),n.initialized=!0),n.obj}function H(t){const e=d.useRef(t);return e.current=t,e}const Q=t=>{x&&(P(t)||console.error(`useUnmount expected parameter is a function, got ${typeof t}`));const e=H(t);d.useEffect(()=>()=>{e.current()},[])},E=Q,w=new Map,X=(t,e,n)=>{const r=w.get(t);r!=null&&r.timer&&clearTimeout(r.timer);let u;e>-1&&(u=setTimeout(()=>{w.delete(t)},e)),w.set(t,Object.assign(Object.assign({},n),{timer:u}))},Y=t=>w.get(t),R=new Map,Z=t=>R.get(t),k=(t,e)=>{R.set(t,e),e.then(n=>(R.delete(t),n)).catch(()=>{R.delete(t)})},g={},W=(t,e)=>{g[t]&&g[t].forEach(n=>n(e))},S=(t,e)=>(g[t]||(g[t]=[]),g[t].push(e),function(){const r=g[t].indexOf(e);g[t].splice(r,1)}),I=(t,{cacheKey:e,cacheTime:n=5*60*1e3,staleTime:r=0,setCache:u,getCache:i})=>{const s=d.useRef(),l=d.useRef(),a=(c,f)=>{u?u(f):X(c,n,f),W(c,f.data)},o=(c,f=[])=>i?i(f):Y(c);return T(()=>{if(!e)return;const c=o(e);c&&Object.hasOwnProperty.call(c,"data")&&(t.state.data=c.data,t.state.params=c.params,(r===-1||new Date().getTime()-c.time<=r)&&(t.state.loading=!1)),s.current=S(e,f=>{t.setState({data:f})})},[]),E(()=>{var c;(c=s.current)===null||c===void 0||c.call(s)}),e?{onBefore:c=>{const f=o(e,c);return!f||!Object.hasOwnProperty.call(f,"data")?{}:r===-1||new Date().getTime()-f.time<=r?{loading:!1,data:f==null?void 0:f.data,error:void 0,returnNow:!0}:{data:f==null?void 0:f.data,error:void 0}},onRequest:(c,f)=>{let v=Z(e);return v&&v!==l.current?{servicePromise:v}:(v=c(...f),l.current=v,k(e,v),{servicePromise:v})},onSuccess:(c,f)=>{var v;e&&((v=s.current)===null||v===void 0||v.call(s),a(e,{data:c,params:f,time:new Date().getTime()}),s.current=S(e,_=>{t.setState({data:_})}))},onMutate:c=>{var f;e&&((f=s.current)===null||f===void 0||f.call(s),a(e,{data:c,params:t.state.params,time:new Date().getTime()}),s.current=S(e,v=>{t.setState({data:v})}))}}:{}},K=I,ee=(t,{debounceWait:e,debounceLeading:n,debounceTrailing:r,debounceMaxWait:u})=>{const i=d.useRef(),s=d.useMemo(()=>{const l={};return n!==void 0&&(l.leading=n),r!==void 0&&(l.trailing=r),u!==void 0&&(l.maxWait=u),l},[n,r,u]);return d.useEffect(()=>{if(e){const l=t.runAsync.bind(t);return i.current=z(a=>{a()},e,s),t.runAsync=(...a)=>new Promise((o,c)=>{var f;(f=i.current)===null||f===void 0||f.call(i,()=>{l(...a).then(o).catch(c)})}),()=>{var a;(a=i.current)===null||a===void 0||a.cancel(),t.runAsync=l}}},[e,s]),e?{onCancel:()=>{var l;(l=i.current)===null||l===void 0||l.cancel()}}:{}},te=ee,ne=(t,{loadingDelay:e})=>{const n=d.useRef();if(!e)return{};const r=()=>{n.current&&clearTimeout(n.current)};return{onBefore:()=>(r(),n.current=setTimeout(()=>{t.setState({loading:!0})},e),{loading:!1}),onFinally:()=>{r()},onCancel:()=>{r()}}},re=ne,ie=!!(typeof window<"u"&&window.document&&window.document.createElement),O=ie;function $(){return O?document.visibilityState!=="hidden":!0}const p=[];function ue(t){return p.push(t),function(){const n=p.indexOf(t);p.splice(n,1)}}if(O){const t=()=>{if($())for(let e=0;e<p.length;e++){const n=p[e];n()}};window.addEventListener("visibilitychange",t,!1)}const se=(t,{pollingInterval:e,pollingWhenHidden:n=!0,pollingErrorRetryCount:r=-1})=>{const u=d.useRef(),i=d.useRef(),s=d.useRef(0),l=()=>{var a;u.current&&clearTimeout(u.current),(a=i.current)===null||a===void 0||a.call(i)};return A(()=>{e||l()},[e]),e?{onBefore:()=>{l()},onError:()=>{s.current+=1},onSuccess:()=>{s.current=0},onFinally:()=>{r===-1||r!==-1&&s.current<=r?u.current=setTimeout(()=>{!n&&!$()?i.current=ue(()=>{t.refresh()}):t.refresh()},e):s.current=0},onCancel:()=>{l()}}:{}},oe=se;function ce(t,e){let n=!1;return(...r)=>{n||(n=!0,t(...r),setTimeout(()=>{n=!1},e))}}function ae(){return O&&typeof navigator.onLine<"u"?navigator.onLine:!0}const y=[];function le(t){return y.push(t),function(){const n=y.indexOf(t);n>-1&&y.splice(n,1)}}if(O){const t=()=>{if(!(!$()||!ae()))for(let e=0;e<y.length;e++){const n=y[e];n()}};window.addEventListener("visibilitychange",t,!1),window.addEventListener("focus",t,!1)}const fe=(t,{refreshOnWindowFocus:e,focusTimespan:n=5e3})=>{const r=d.useRef(),u=()=>{var i;(i=r.current)===null||i===void 0||i.call(r)};return d.useEffect(()=>{if(e){const i=ce(t.refresh.bind(t),n);r.current=le(()=>{i()})}return()=>{u()}},[e,n]),E(()=>{u()}),{}},de=fe,ve=(t,{retryInterval:e,retryCount:n})=>{const r=d.useRef(),u=d.useRef(0),i=d.useRef(!1);return n?{onBefore:()=>{i.current||(u.current=0),i.current=!1,r.current&&clearTimeout(r.current)},onSuccess:()=>{u.current=0},onError:()=>{if(u.current+=1,n===-1||u.current<=n){const s=e??Math.min(1e3*Math.pow(2,u.current),3e4);r.current=setTimeout(()=>{i.current=!0,t.refresh()},s)}else u.current=0},onCancel:()=>{u.current=0,r.current&&clearTimeout(r.current)}}:{}},he=ve,ge=(t,{throttleWait:e,throttleLeading:n,throttleTrailing:r})=>{const u=d.useRef(),i={};return n!==void 0&&(i.leading=n),r!==void 0&&(i.trailing=r),d.useEffect(()=>{if(e){const s=t.runAsync.bind(t);return u.current=N(l=>{l()},e,i),t.runAsync=(...l)=>new Promise((a,o)=>{var c;(c=u.current)===null||c===void 0||c.call(u,()=>{s(...l).then(a).catch(o)})}),()=>{var l;t.runAsync=s,(l=u.current)===null||l===void 0||l.cancel()}}},[e,n,r]),e?{onCancel:()=>{var s;(s=u.current)===null||s===void 0||s.cancel()}}:{}},me=ge,be=t=>{x&&(P(t)||console.error(`useMount: parameter \`fn\` expected to be a function, but got "${typeof t}".`)),d.useEffect(()=>{t==null||t()},[])},pe=be,ye=()=>{const[,t]=d.useState({});return d.useCallback(()=>t({}),[])},_e=ye;class we{constructor(e,n,r,u={}){this.serviceRef=e,this.options=n,this.subscribe=r,this.initState=u,this.count=0,this.state={loading:!1,params:void 0,data:void 0,error:void 0},this.state=Object.assign(Object.assign(Object.assign({},this.state),{loading:!n.manual}),u)}setState(e={}){this.state=Object.assign(Object.assign({},this.state),e),this.subscribe()}runPluginHandler(e,...n){const r=this.pluginImpls.map(u=>{var i;return(i=u[e])===null||i===void 0?void 0:i.call(u,...n)}).filter(Boolean);return Object.assign({},...r)}runAsync(...e){var n,r,u,i,s,l,a,o,c,f;return L(this,void 0,void 0,function*(){this.count+=1;const v=this.count,_=this.runPluginHandler("onBefore",e),{stopNow:D=!1,returnNow:U=!1}=_,C=F(_,["stopNow","returnNow"]);if(D)return new Promise(()=>{});if(this.setState(Object.assign({loading:!0,params:e},C)),U)return Promise.resolve(C.data);(r=(n=this.options).onBefore)===null||r===void 0||r.call(n,e);try{let{servicePromise:h}=this.runPluginHandler("onRequest",this.serviceRef.current,e);h||(h=this.serviceRef.current(...e));const m=yield h;return v!==this.count?new Promise(()=>{}):(this.setState({data:m,error:void 0,loading:!1}),(i=(u=this.options).onSuccess)===null||i===void 0||i.call(u,m,e),this.runPluginHandler("onSuccess",m,e),(l=(s=this.options).onFinally)===null||l===void 0||l.call(s,e,m,void 0),v===this.count&&this.runPluginHandler("onFinally",e,m,void 0),m)}catch(h){if(v!==this.count)return new Promise(()=>{});throw this.setState({error:h,loading:!1}),(o=(a=this.options).onError)===null||o===void 0||o.call(a,h,e),this.runPluginHandler("onError",h,e),(f=(c=this.options).onFinally)===null||f===void 0||f.call(c,e,void 0,h),v===this.count&&this.runPluginHandler("onFinally",e,void 0,h),h}})}run(...e){this.runAsync(...e).catch(n=>{this.options.onError||console.error(n)})}cancel(){this.count+=1,this.setState({loading:!1}),this.runPluginHandler("onCancel")}refresh(){this.run(...this.state.params||[])}refreshAsync(){return this.runAsync(...this.state.params||[])}mutate(e){const n=P(e)?e(this.state.data):e;this.runPluginHandler("onMutate",n),this.setState({data:n})}}function Re(t,e={},n=[]){const{manual:r=!1}=e,u=F(e,["manual"]),i=Object.assign({manual:r},u),s=H(t),l=_e(),a=T(()=>{const o=n.map(c=>{var f;return(f=c==null?void 0:c.onInit)===null||f===void 0?void 0:f.call(c,i)}).filter(Boolean);return new we(s,i,l,Object.assign({},...o))},[]);return a.options=i,a.pluginImpls=n.map(o=>o(a,i)),pe(()=>{if(!r){const o=a.state.params||e.defaultParams||[];a.run(...o)}}),E(()=>{a.cancel()}),{loading:a.state.loading,data:a.state.data,error:a.state.error,params:a.state.params||[],cancel:b(a.cancel.bind(a)),refresh:b(a.refresh.bind(a)),refreshAsync:b(a.refreshAsync.bind(a)),run:b(a.run.bind(a)),runAsync:b(a.runAsync.bind(a)),mutate:b(a.mutate.bind(a))}}function Ce(t,e,n){return Re(t,e,[...n||[],te,re,oe,de,me,G,K,he])}export{Ee as _,Se as a,B as b,$e as c,F as d,Ae as e,xe as f,L as g,je as h,O as i,Ce as u};
