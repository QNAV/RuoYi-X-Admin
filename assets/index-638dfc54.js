import{j as a,O as S,Q as k,T as B,V as M}from"./antdProComponents-d97761a4.js";import{e as R,f as P,h as j,F as N,A as d,l as O,aA as D,b as L,G as E,a8 as y,d as f,m as A,B as K}from"./index-7df8d6db.js";import{a as G,u as _}from"./utils-6d3e551f.js";import{b as H,c as q,d as F,e as V,f as X,h as Y,i as $}from"./Tool-894dd1b8.js";import{b6 as u,B as m,r as T,aE as C,af as z,a5 as W,az as J}from"./antd-79b0e736.js";import{u as p}from"./useMutation-6894a2eb.js";import{u as Q}from"./index-371e4e07.js";import{u as U}from"./useRequest-6b8c6b76.js";import{H as Z}from"./highlight-33f4350b.js";import{l as ee}from"./index-605ad3d8.js";import"./iconPark-31f72c99.js";import"./wangEditor-f0c73729.js";import"./tslib.es6-59680bf8.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const x=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/tool/gen/model/index.ts/atomMainTableActions",R(void 0));x.debugLabel="atomMainTableActions";const te=()=>P(x),I=()=>j(x),b=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/tool/gen/model/index.ts/atomSelectedTableId",G({open:!1}));b.debugLabel="atomSelectedTableId";const ae=()=>j(b),se=()=>{const e=N(b);return t=>{e({open:!0,previewId:t})}},oe=()=>_(b);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const v=({tableIds:e,batch:t=!1,disabled:o=!1})=>{const{message:n,modal:l}=u.useApp(),s=I(),{mutate:i,isLoading:r}=p(H,{onSuccess:()=>{var c;s==null||s.reload(),(c=s==null?void 0:s.clearSelected)==null||c.call(s),n.success("删除成功")}}),h=()=>{l.confirm({title:"删除代码",content:`确定删除 表ID ${e.join(",")} 生成的代码吗？`,okButtonProps:{loading:r},onOk:()=>i({tableIds:e})})};return a.jsx(d,{accessKey:"tool:gen:remove",children:a.jsx(O,{batch:t,disabled:o,onClick:h})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ie=async e=>{const{data:t}=await q({tables:e},{format:"blob"});D.saveAs(new Blob([t],{type:"application/zip"}),`ruoyi_${new Date().getTime()}`)},w=({tableName:e,batch:t=!1,disabled:o=!1})=>{const n=t?"批量下载":"下载",{message:l}=u.useApp(),{isLoading:s,mutate:i}=p(ie,{onSuccess:()=>{l.success("下载成功")}});return a.jsx(d,{accessKey:"tool:gen:query",children:a.jsx(m,{loading:s,onClick:()=>i(e),type:"link",icon:a.jsx(S,{}),disabled:o,children:n})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ce=({tableId:e})=>{const t=L();return a.jsx(d,{accessKey:"tool:gen:edit",children:a.jsx(E,{onClick:()=>t(`/tool/gen-edit/${e}`)})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ne=[{title:"序号",dataIndex:"index",key:"index",valueType:"indexBorder"},{title:"表名称",dataIndex:"tableName",key:"tableName",valueType:"text"},{title:"表描述",dataIndex:"tableComment",key:"tableComment",valueType:"text"},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",hideInSearch:!0,sorter:!0},{title:"更新时间",dataIndex:"updateTime",key:"updateTime",valueType:"dateTime",hideInSearch:!0,sorter:!0},{title:"创建时间",dataIndex:"createTimeRange",key:"createTimeRange",valueType:"dateTimeRange",hideInTable:!0}],le=()=>{const e=T.useRef(),t=I(),[o,{toggle:n}]=Q(),[l,s]=T.useState([]),{message:i}=u.useApp(),{mutate:r,isLoading:h}=p(V,{onSuccess:()=>{var c,g;t==null||t.reload(),n(),i.success("导入成功"),(g=(c=e.current)==null?void 0:c.clearSelected)==null||g.call(c)}});return a.jsxs(y,{accessible:!0,children:[a.jsx(m,{type:"primary",onClick:n,icon:a.jsx(k,{}),children:"导入"}),a.jsx(C,{open:o,onCancel:n,title:"导入表结构",onOk:()=>r({tables:l}),width:900,okText:"提交",confirmLoading:h,okButtonProps:{disabled:l.length===0},children:a.jsx(f,{ghost:!0,actionRef:e,columns:ne,rowKey:"tableName",search:{filterType:"light"},rowSelection:{alwaysShowAlert:!0,onChange:c=>{s(c)}},tableAlertOptionRender:!1,options:!1,request:(...c)=>F(A(...c))})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const re=({tableId:e})=>{const t=se();return a.jsx(d,{accessKey:"tool:gen:preview",children:a.jsx(m,{onClick:()=>t(e),type:"link",icon:a.jsx(B,{}),children:"预览"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const he=({tableName:e})=>{const{message:t}=u.useApp(),{isLoading:o,mutate:n}=p(X,{onSuccess:()=>{t.success("同步成功")}});return a.jsx(d,{accessKey:"tool:gen:code",children:a.jsx(m,{loading:o,type:"link",icon:a.jsx(M,{}),onClick:()=>n({tableName:e}),children:"同步"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const de=()=>{const e=oe(),{open:t,previewId:o}=ae(),{message:n}=u.useApp(),{data:l,loading:s}=U(async()=>{const i=await Y({tableId:o});return Object.keys(i).map(r=>({key:r,content:i[r],highlightContent:Z.highlightAuto(i[r]).value}))},{ready:t&&!!o,refreshDeps:[o]});return a.jsx(y,{accessible:!0,children:a.jsx(C,{open:t,onCancel:e,width:"90%",footer:!1,title:"预览代码",bodyStyle:{height:"700px"},children:a.jsx(z,{spinning:s,children:a.jsx(W,{tabPosition:"left",items:(l==null?void 0:l.map(({key:i,content:r,highlightContent:h})=>({key:i,label:i,children:a.jsxs("div",{className:"relative",children:[a.jsx(ee.CopyToClipboard,{text:r,onCopy:(c,g)=>{g&&n.success("复制成功")},children:a.jsx(m,{icon:a.jsx(J,{}),type:"link",className:"absolute top-[-5px] right-2",children:"复制代码"})}),a.jsx("pre",{children:a.jsx("code",{children:a.jsx("div",{className:"h-[650px] overflow-auto",dangerouslySetInnerHTML:{__html:h}})})})]})})))??[]})})})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ue=[{title:"序号",dataIndex:"index",key:"index",valueType:"indexBorder"},{title:"表名称",dataIndex:"tableName",key:"tableName",valueType:"text"},{title:"表描述",dataIndex:"tableComment",key:"tableComment",valueType:"text"},{title:"实体名称",dataIndex:"className",key:"className",valueType:"text",hideInSearch:!0},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",hideInSearch:!0,sorter:!1},{title:"更新时间",dataIndex:"updateTime",key:"updateTime",valueType:"dateTime",hideInSearch:!0,sorter:!0},{title:"创建时间",dataIndex:"createTimeRange",key:"createTimeRange",valueType:"dateTimeRange",hideInTable:!0},{title:"操作",valueType:"option",render:(e,t)=>a.jsxs(a.Fragment,{children:[a.jsx(re,{tableId:t.tableId}),a.jsx(ce,{tableId:t.tableId}),a.jsx(he,{tableName:t.tableName}),a.jsx(w,{tableName:t.tableName}),a.jsx(v,{tableIds:[t.tableId]})]})}],me=({selectedRows:e,selectedRowKeys:t})=>a.jsxs(a.Fragment,{children:[a.jsx(v,{tableIds:t,batch:!0,disabled:t.length===0}),a.jsx(w,{tableName:e.map(({tableName:o})=>o).join(","),batch:!0,disabled:t.length===0})]}),Se=()=>{const e=te();return a.jsxs(K,{children:[a.jsx(f,{rowKey:"tableId",actionRef:e,tableAlertOptionRender:me,columns:ue,toolbar:{actions:[a.jsx(le,{},"ButtonImport")]},request:(...t)=>$(A(...t))}),a.jsx(de,{})]})};export{Se as default};
