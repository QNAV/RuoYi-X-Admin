import{aD as te,O as se,j as s,aE as ae,_ as q,h as V,l as E,n as B,o as h,r as f,af as g,g as d,ay as W,$ as p,a1 as oe,av as ue,aO as w,Y as S,aw as re,ag as C,aA as ce,aB as ne,aj as ie,b8 as le,ai as Y,W as de,b9 as he,ah as me,bF as pe,aK as ge,bG as Fe,aJ as ye,aP as Ce,ak as Ae,al as be,F as fe,I as Te}from"./index.ca0a842c.js";import{b as F,j as M}from"./index.f37f8d7b.js";import{a as Pe}from"./index.83dcf385.js";import{a as X,u as _}from"./utils.a39c6320.js";import{f as we}from"./SysConfigService.06f0d709.js";import{f as G}from"./SysDeptService.d826bb7e.js";import{P as Ee}from"./index.9e1c0a9a.js";import{W as Be}from"./index.cf23ef53.js";import{u as T}from"./useRequest.cf5a50d4.js";import{u as I}from"./useMutation.esm.9f92fcef.js";import{u as Se}from"./index.c43299fc.js";import"./useQuery.esm.a73cc2ec.js";import"./utils.esm.b01b006b.js";var Ie=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],Re=te.forwardRef(function(e,t){var u=e.fieldProps,o=e.unCheckedChildren,r=e.checkedChildren,a=e.proFieldProps,c=se(e,Ie);return s(ae,q({valueType:"switch",fieldProps:q({unCheckedChildren:o,checkedChildren:r},u),ref:t,valuePropName:"checked",proFieldProps:a,filedConfig:{valuePropName:"checked",ignoreWidth:!0}},c))});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const x=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomMainTableActions",V(void 0));x.debugLabel="atomMainTableActions";const K=()=>E(x),je=()=>Pe(x),D=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomSelectedDeptId",V(0));D.debugLabel="atomSelectedDeptId";const ke=()=>E(D),Me=()=>B(D),R=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomResetPwdModal",X({open:!1}));R.debugLabel="atomResetPwdModal";const xe=()=>{const e=B(R);return t=>{e({open:!0,record:t})}},De=()=>_(R),ve=()=>E(R),P=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomAddOrEditModal",X({open:!1,actionType:"add",userId:0}));P.debugLabel="atomAddOrEditModal";const Ne=()=>{const e=B(P);return()=>{e({open:!0,actionType:"add",userId:0})}},Oe=()=>{const e=B(P);return t=>{e({open:!0,actionType:"edit",userId:t})}},Ue=()=>_(P),Le=()=>E(P);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};async function qe(e,t){return h("/system/user/",{method:"GET",params:{...e},...t||{}})}async function Ve(e,t){return h("/system/user/add",{method:"POST",headers:{"Content-Type":"application/json"},data:e,...t||{}})}async function We(e,t){return h("/system/user/edit",{method:"POST",headers:{"Content-Type":"application/json"},data:e,...t||{}})}async function Ye(e,t){return h("/system/user/export",{method:"POST",headers:{"Content-Type":"application/json"},data:e,...t||{}})}async function Xe(e){return h("/system/user/importTemplate",{method:"POST",...e||{}})}async function _e(e,t){return h("/system/user/info",{method:"GET",params:{...e},...t||{}})}async function Ge(e,t){return h("/system/user/list",{method:"POST",headers:{"Content-Type":"application/json"},data:e,...t||{}})}async function Ke(e,t){return h("/system/user/remove",{method:"POST",params:{...e},...t||{}})}async function He(e,t){return h("/system/user/resetPwd",{method:"POST",headers:{"Content-Type":"application/json"},data:e,...t||{}})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const $e=()=>{var N,O,U,L;const{canAddSysUser:e,canEditSysUser:t}=F(),u=f.exports.useRef(),o=K(),{open:r,actionType:a,userId:c}=Le(),i=Ue(),v=()=>{var n;a==="edit"&&((n=u.current)==null||n.resetFields()),i()},{data:A}=M("sys_normal_disable"),{data:j}=M("sys_user_sex"),{data:b}=T(async()=>{const{posts:n,roles:l}=await qe({});return{posts:n.reduce((m,y)=>m.set(y.postId,y.postName),new Map),roles:l.reduce((m,y)=>m.set(y.roleId,y.roleName),new Map)}}),{data:$}=T(async()=>(await we({configKey:"sys.user.initPassword"},{skipErrorHandler:!0})).data.msg),{data:k}=T(()=>G({}),{}),{data:z}=T(async()=>{const{postIds:n,roleIds:l,user:m}=await _e({userId:c});return{...m,postIds:n,roleIds:l}},{ready:r&&a==="edit"&&c>0,onSuccess:n=>{var l;(l=u.current)==null||l.setFieldsValue(n)},refreshDeps:[c]}),{isLoading:J,mutateAsync:Q}=I(async()=>{var l,m;const n=await((m=(l=u.current)==null?void 0:l.validateFieldsReturnFormatValue)==null?void 0:m.call(l));if(a==="add"){const{roleIds:y=[],postIds:Z=[],...ee}=n;await Ve({roleIds:y,postIds:Z,...ee})}else await We({...z,...n,userId:c})},{onSuccess:()=>{var n;i(),o==null||o.reload(),(n=u.current)==null||n.resetFields(),S.success(a==="add"?"\u65B0\u589E\u6210\u529F":"\u7F16\u8F91\u6210\u529F")}});return s(g,{accessible:e||t,children:d(W,{title:a==="add"?"\u65B0\u589E\u7528\u6237":"\u7F16\u8F91\u7528\u6237",formRef:u,grid:!0,colProps:{span:12},modalProps:{okText:"\u63D0\u4EA4",onCancel:v,confirmLoading:J},width:600,open:r,onFinish:()=>Q(),children:[s(p,{name:"nickName",label:"\u7528\u6237\u6635\u79F0",rules:[{required:!0}]}),s(Be,{name:"deptId",label:"\u5F52\u5C5E\u90E8\u95E8",fieldProps:{treeData:k!=null?k:[],fieldNames:{value:"id"}}}),s(p,{name:"phoneNumber",label:"\u624B\u673A\u53F7\u7801",rules:[{pattern:oe,message:"\u624B\u673A\u53F7\u7801\u683C\u5F0F\u9519\u8BEF"}],fieldProps:{maxLength:11}}),s(p,{name:"email",label:"\u90AE\u7BB1",rules:[{pattern:ue,message:"\u90AE\u7BB1\u683C\u5F0F\u9519\u8BEF"}]}),a==="add"&&s(p,{name:"userName",label:"\u7528\u6237\u540D\u79F0",rules:[{required:!0}]}),a==="add"&&s(p.Password,{name:"password",label:"\u7528\u6237\u5BC6\u7801",rules:[{required:!0}],initialValue:$}),s(w,{name:"sex",label:"\u7528\u6237\u6027\u522B",valueEnum:(N=j==null?void 0:j.mapData)!=null?N:{}}),s(w,{name:"status",label:"\u72B6\u6001",valueEnum:(O=A==null?void 0:A.mapData)!=null?O:{},rules:[{required:!0}]}),s(w,{name:"postIds",label:"\u5C97\u4F4D",valueEnum:(U=b==null?void 0:b.posts)!=null?U:{},mode:"multiple",colProps:{span:24}}),s(w,{name:"roleIds",label:"\u89D2\u8272",valueEnum:(L=b==null?void 0:b.roles)!=null?L:{},mode:"multiple",colProps:{span:24}}),s(Ee,{name:"remark",label:"\u5907\u6CE8",colProps:{span:24}})]})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ze=()=>{const{canResetSysUserPwd:e}=F(),t=f.exports.useRef(),u=De(),{open:o,record:r}=ve();return f.exports.useEffect(()=>{var a;if(o){(a=t.current)==null||a.resetFields();const c=setTimeout(()=>{var i;(i=t.current)==null||i.setFieldsValue({userName:r.userName}),clearTimeout(c)},0)}},[o]),s(g,{accessible:e,children:d(W,{title:"\u91CD\u7F6E\u5BC6\u7801",open:o,formRef:t,modalProps:{onCancel:u},width:500,onFinish:async({password:a})=>{await He({...r,password:a}),S.success("\u91CD\u7F6E\u5BC6\u7801\u6210\u529F")},children:[s(p,{name:"userName",label:"\u7528\u6237\u540D\u79F0",readonly:!0}),s(p.Password,{required:!0,name:"password",label:"\u65B0\u5BC6\u7801",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u65B0\u5BC6\u7801"},{pattern:re,message:"\u5BC6\u7801\u957F\u5EA6\u5E94\u57286-20\u4E4B\u95F4\uFF0C\u53EA\u80FD\u5305\u542B\u5B57\u6BCD\u3001\u6570\u5B57\u548C\u4E0B\u5212\u7EBF"}]}),s(p.Password,{required:!0,name:"confirmPassword",label:"\u786E\u8BA4\u5BC6\u7801",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u786E\u8BA4\u5BC6\u7801"},({getFieldsValue:a})=>({validator(c,i){return!i||a().password===i?Promise.resolve():Promise.reject(new Error("\u4E24\u6B21\u8F93\u5165\u7684\u5BC6\u7801\u4E0D\u4E00\u81F4"))}})]})]})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Je=()=>{const{canAddSysUser:e}=F(),t=Ne();return s(g,{accessible:e,children:s(C,{type:"primary",icon:s(ce,{}),onClick:t,children:"\u65B0\u589E"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Qe=({userId:e})=>{const{canEditSysUser:t}=F(),u=Oe();return s(g,{accessible:t,children:s(C,{type:"link",icon:s(ne,{}),onClick:()=>u(e),children:"\u7F16\u8F91"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ze=({searchParams:e})=>{const{canExportSysUser:t}=F(),{isLoading:u,mutate:o}=I(()=>Ye(e),{onSuccess:()=>{S.success("\u5BFC\u51FA\u6210\u529F")}});return s(g,{accessible:t,children:s(C,{icon:s(ie,{}),loading:u,onClick:()=>o(),children:"\u5BFC\u51FA"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const et=()=>{const{canImportSysUser:e}=F(),t=f.exports.useRef(),[u,{toggle:o}]=Se(),{mutate:r,isLoading:a}=I(Xe);return d(g,{accessible:e,children:[s(C,{icon:s(le,{}),onClick:o,children:"\u5BFC\u5165"}),d(Y,{title:"\u5BFC\u5165\u7528\u6237",open:u,onCancel:o,children:[s("div",{className:"text-right",children:s(C,{type:"link",onClick:r,loading:a,children:"\u4E0B\u8F7D\u6A21\u677F"})}),d(de,{layout:"horizontal",submitter:!1,formRef:t,children:[s(Re,{name:"isCover",label:"\u662F\u5426\u66F4\u65B0\u5DF2\u7ECF\u5B58\u5728\u7684\u7528\u6237\u6570\u636E"}),s(he,{name:"list"})]})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const H=({userId:e,isBatch:t,disabled:u})=>{const o=t?"\u6279\u91CF\u5220\u9664":"\u5220\u9664",{canRemoveSysUser:r}=F(),a=K(),{mutateAsync:c,isLoading:i}=I(()=>Ke({userIds:e}),{onSuccess:()=>{var A;a==null||a.reload(),(A=a==null?void 0:a.clearSelected)==null||A.call(a),S.success("\u5220\u9664\u6210\u529F")}});return s(g,{accessible:r,children:s(C,{type:"link",danger:!0,disabled:u,icon:s(me,{}),onClick:()=>{Y.confirm({title:"\u5220\u9664\u7528\u6237",content:`\u786E\u5B9A\u5220\u9664\u7528\u6237\u7F16\u53F7\u4E3A ${e} \u7684\u6570\u636E\u5417\uFF1F`,onOk:()=>c(),okButtonProps:{loading:i}})},children:o})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const tt=({record:e})=>{const{canResetSysUserPwd:t}=F(),u=xe();return s(g,{accessible:t,children:s(C,{type:"link",danger:!0,icon:s(pe,{}),onClick:()=>u(e),children:"\u91CD\u7F6E\u5BC6\u7801"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const st=()=>{const[e,t]=f.exports.useState(""),u=Me(),{data:o,loading:r}=T(()=>G({deptName:e}),{refreshDeps:[e],debounceWait:500});return d(ge,{spinning:r,children:[s(Fe.Search,{allowClear:!0,placeholder:"\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0",className:"mb-3",onSearch:a=>{t(a)}}),!o||o.length===0?s(ye,{}):s(Ce,{treeData:o,defaultExpandAll:!0,fieldNames:{title:"label",key:"id"},onSelect:(a,{node:{key:c}})=>{u(c)},blockNode:!0})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const at=()=>{var t;const{data:e}=M("sys_normal_disable");return[{dataIndex:"userId",key:"userId",title:"\u7528\u6237\u7F16\u53F7",valueType:"text",hideInSearch:!0},{dataIndex:"userName",key:"userName",title:"\u7528\u6237\u540D\u79F0",valueType:"text"},{dataIndex:"nickName",key:"nickName",title:"\u7528\u6237\u6635\u79F0",valueType:"text",hideInSearch:!0},{dataIndex:["dept","deptName"],key:"deptDeptName",title:"\u90E8\u95E8\u540D\u79F0",valueType:"text",hideInSearch:!0},{dataIndex:"phoneNumber",key:"phoneNumber",title:"\u624B\u673A\u53F7\u7801",valueType:"text",copyable:!0},{title:"\u72B6\u6001",dataIndex:"status",key:"status",valueType:"select",valueEnum:(t=e==null?void 0:e.mapData)!=null?t:{}},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createTime",key:"createTime",valueType:"dateTime",hideInSearch:!0,sorter:!0},{title:"\u64CD\u4F5C",valueType:"option",render:(u,o)=>o.userId===1?null:d(fe,{children:[s(Qe,{userId:o.userId}),s(H,{userId:o.userId}),s(tt,{record:o})]}),fixed:"right",width:300},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createTimeRange",key:"createTimeRange",valueType:"dateTimeRange",hideInTable:!0}]},ot=({selectedRows:e})=>s(H,{disabled:e.length===0,isBatch:!0,userId:e.map(t=>t.userId).join(",")}),ut=(e,t)=>d("div",{className:"flex gap-4",children:[s("div",{className:"bg-white p-4",children:s(st,{})}),s("div",{className:"overflow-auto w-full",children:t})]}),rt=()=>{const e=je(),[t,u]=f.exports.useState({}),o=at(),r=ke(),a=r>0?{deptId:r}:{};return s(Ae,{rowKey:"userId",actionRef:e,columns:o,params:a,request:async(...c)=>{const i=be(...c);return u(i),await Ge(i)},toolbar:{actions:[s(Ze,{searchParams:t},"ButtonExport"),s(et,{},"ButtonImport"),s(Je,{},"ButtonAdd")]},tableRender:ut,tableAlertOptionRender:ot})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const bt=()=>d(Te,{children:[s(rt,{}),s($e,{}),s(ze,{})]});export{bt as default};
