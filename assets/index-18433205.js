import{j as s,r as w,o as h,t as v,g as d,p as m}from"./antdProComponents-d97761a4.js";import{t as b,v as T,w as C,r as I,x as N,y as A,z as k,D as E,E as U,B as q}from"./index-7df8d6db.js";import{b6 as j,a1 as D,a2 as x,a4 as g,b7 as S,aH as B,r as P,B as F,a5 as L}from"./antd-79b0e736.js";import{u as f}from"./useMutation-6894a2eb.js";import"./iconPark-31f72c99.js";import"./wangEditor-f0c73729.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const M="https://ryx-admin-api.dev.quicknav.cn/api/sys/profile/update-avatar",R=[{dataIndex:"userName",key:"userName",title:"用户名称",valueType:"text"},{dataIndex:"deptName",key:"deptName",title:"所属部门",valueType:"text"},{dataIndex:"roleName",key:"roleName",title:"所属角色",valueType:"text"},{dataIndex:"createTime",key:"createTime",title:"创建时间",valueType:"text"}],z=()=>{const{valueEnumSysUserSex:e}=C();return[{dataIndex:"nickName",key:"nickName",title:"用户昵称",valueType:"text",formItemProps:{rules:[{required:!0,message:"请输入用户昵称"}]}},{dataIndex:"phoneNumber",key:"phoneNumber",title:"手机号码",valueType:"text",fieldProps:{maxLength:11},formItemProps:{rules:[{required:!0,message:"请输入手机号"},{pattern:I,message:"手机号格式错误"}]}},{dataIndex:"email",key:"email",title:"邮箱",valueType:"text",formItemProps:{rules:[{required:!0,message:"请输入邮箱"},{pattern:N,message:"邮箱格式错误"}]}},{dataIndex:"sex",key:"sex",title:"性别",valueType:"radio",valueEnum:e}]},O=()=>{var t,p;const{data:e,refetch:a}=b(),n=z(),{message:c}=j.useApp(),{mutate:i,mutateAsync:r}=f(A,{onSuccess:()=>{a(),c.success("保存成功")}}),u={onSave:async(o,l)=>{await r({[o]:l[o]})}};return s.jsxs(D,{align:"middle",children:[s.jsx(x,{span:4,children:s.jsxs("div",{className:"w-[100px] relative m-auto",children:[s.jsx(g,{src:((p=(t=e==null?void 0:e.userInfo)==null?void 0:t.user)==null?void 0:p.avatar)??"Avatar",size:100}),s.jsx(S,{maxCount:1,showUploadList:!1,name:"avatarfile",accept:"image/jpeg,image/png",action:M,headers:{Authorization:T()},onChange:o=>{if(o.file.status!=="done")return;const{code:l,msg:y}=o.file.response;if(l!==200){c.error(y);return}i({avatar:o.file.response.data})},children:s.jsx(g,{icon:s.jsx(w,{}),className:"absolute bottom-0 right-0 bg-blue-500 cursor-pointer"})})]})}),s.jsxs(x,{span:20,children:[s.jsx(h,{columns:R,dataSource:{userName:e==null?void 0:e.userInfo.user.userName,createTime:e==null?void 0:e.userInfo.user.createTime,deptName:e==null?void 0:e.userInfo.user.dept.deptName,roleName:e==null?void 0:e.userInfo.user.roles.map(o=>o.roleName).join("/")}}),s.jsx(B,{}),s.jsx(h,{columns:n,dataSource:e==null?void 0:e.userInfo.user,editable:u})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const K=()=>{const e=P.useRef(),a=U(),{message:n}=j.useApp(),{mutate:c,isLoading:i}=f(async()=>{var u;const r=await((u=e==null?void 0:e.current)==null?void 0:u.validateFields());await E(r)},{onSuccess:()=>{n.success("密码修改成功，即将自动退出登录并跳转至登录页面");const r=setTimeout(async()=>{await a(),clearTimeout(r)},1500)}});return s.jsxs(v,{formRef:e,submitter:!1,children:[s.jsx(d.Password,{allowClear:!0,name:"oldPassword",label:"旧密码",rules:[{required:!0}],width:"md"}),s.jsx(d.Password,{allowClear:!0,name:"newPassword",label:"新密码",width:"md",rules:[{required:!0},{pattern:k,message:"长度在6-20之间，只能包含字母、数字和下划线"},({getFieldValue:r})=>({validator(u,t){return!t||t!==r("oldPassword")?Promise.resolve():Promise.reject(new Error("新旧密码不能相同"))}})]}),s.jsx(d.Password,{allowClear:!0,name:"confirmPassword",label:"确认密码",width:"md",rules:[{required:!0},({getFieldValue:r})=>({validator(u,t){return!t||r("newPassword")===t?Promise.resolve():Promise.reject(new Error("两次密码输入不一致"))}})]}),s.jsx(F,{type:"primary",loading:i,onClick:()=>c(),children:"更新密码"})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const J=()=>{const[e,a]=P.useState("PASSWORD");return s.jsx(q,{title:"个人中心",children:s.jsxs(m,{ghost:!0,direction:"column",gutter:[0,16],children:[s.jsx(m,{children:s.jsx(O,{})}),s.jsx(m,{children:s.jsx(L,{activeKey:e,onChange:n=>a(n),items:[{label:"安全设置",key:"PASSWORD",children:s.jsx(K,{})}]})})]})})};export{J as default};
