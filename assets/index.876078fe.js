import{C as M,c as v,b as R}from"./common.026964d1.js";import{i as g,n as D,l as T,a as o,aA as y,b9 as w,bs as j,p as m,aJ as A,bt as N,bc as V,ba as k,j as p,F as E,bd as L,r as F,aH as q,aL as b,bb as W,a_ as H}from"./index.7e2e4aff.js";import{B as G}from"./index.0dac2af8.js";import{b as h}from"./keepAlive.a2f6a073.js";import{u as J,c as K}from"./useInitActionType.07c1d484.js";import{u as _}from"./useRowClick.c19aaf4b.js";import{A as C}from"./index.3efbd4c1.js";import{a as z,u as Q}from"./utils.81244b9b.js";import{u as f,E as U,a as X}from"./useMutation.esm.c7490ab8.js";import{P as Y}from"./index.40385f79.js";import{P as Z}from"./index.886aa1fb.js";import"./cloneDeep.5079a371.js";import"./utils.esm.6214005e.js";const $={dataIndex:"postId",key:"postId",title:"\u5C97\u4F4D\u7F16\u53F7",valueType:"text",hideInSearch:!0},tt={dataIndex:"postCode",key:"postCode",title:"\u5C97\u4F4D\u7F16\u7801",valueType:"text"},et={dataIndex:"postName",key:"postName",title:"\u5C97\u4F4D\u540D\u79F0",valueType:"text"},ot={dataIndex:"postSort",key:"postSort",title:"\u663E\u793A\u987A\u5E8F",valueType:"text",hideInSearch:!0},B=g(void 0),st=()=>J(B),O=()=>D(B),P=z({open:!1,actionType:"add"}),at=()=>{const t=T(P);return()=>t({open:!0,actionType:"add"})},nt=()=>{const t=T(P);return e=>t({open:!0,actionType:"edit",record:e})},ut=()=>Q(P),rt=()=>D(P),ct=()=>{const t=h(),e=at();return o(C,{accessible:t.canAddSysPost,children:o(y,{type:"primary",icon:o(w,{}),onClick:e,children:"\u65B0\u5EFA"})})},dt=({record:t})=>{const e=h(),a=nt();return o(C,{accessible:e.canEditSysPost,children:o(y,{type:"link",icon:o(j,{}),onClick:()=>a(t),children:"\u7F16\u8F91"})})};async function it(t,e){return m("/system/post/add",{method:"POST",headers:{"Content-Type":"application/json"},data:t,...e||{}})}async function lt(t,e){return m("/system/post/edit",{method:"POST",headers:{"Content-Type":"application/json"},data:t,...e||{}})}async function pt(t,e){return m("/system/post/export",{method:"POST",headers:{"Content-Type":"application/json"},data:t,...e||{}})}async function mt(t,e){return m("/system/post/list",{method:"POST",headers:{"Content-Type":"application/json"},data:t,...e||{}})}async function Ft(t,e){return m("/system/post/remove",{method:"POST",params:{...t},...e||{}})}const yt=({searchParams:t})=>{const e=h(),{isLoading:a,mutate:r}=f(()=>pt(t),{onSuccess:()=>{A.success("\u5BFC\u51FA\u6210\u529F")}});return o(C,{accessible:e.canExportSysPost,children:o(y,{type:"link",icon:o(N,{}),loading:a,onClick:()=>r(),children:"\u5BFC\u51FA\u5F53\u524D\u5217\u8868"})})},I=({postId:t,postName:e,isBatch:a,disabled:r})=>{const l=a?"\u6279\u91CF\u5220\u9664":"\u5220\u9664",i=h(),n=O(),{mutateAsync:u,isLoading:c}=f(async s=>{await Ft({postIds:s})},{onSuccess:()=>{var s;n==null||n.reload(),(s=n==null?void 0:n.clearSelected)==null||s.call(n),A.success("\u5220\u9664\u6210\u529F")}}),d=()=>{k.confirm({title:"\u5220\u9664\u5C97\u4F4D",content:p(E,{children:["\u786E\u5B9A\u5220\u9664\u5C97\u4F4D",o(L.Text,{code:!0,children:e}),"\u5417\uFF1F"]}),onOk:async()=>u(t),okButtonProps:{loading:c}})};return o(C,{accessible:i.canRemoveSysPost,children:o(y,{type:"link",danger:!0,disabled:r,icon:o(V,{}),onClick:d,children:l})})},ht=()=>{var d;const t=F.exports.useRef(),{open:e,actionType:a,record:r}=rt(),l=ut(),i=O(),n=()=>{var s;l(),(s=t.current)==null||s.resetFields()},{mutate:u,isLoading:c}=f(async()=>{var S;const s=await((S=t.current)==null?void 0:S.validateFields());if(!!s){if(a==="add"){await it(s);return}await lt({...s,postId:r.postId})}},{onSuccess:()=>{i==null||i.reload(),n(),A.success(a==="add"?"\u65B0\u5EFA\u6210\u529F":"\u4FDD\u5B58\u6210\u529F")}});return F.exports.useEffect(()=>{var s;a==="edit"&&r&&((s=t.current)==null?void 0:s.setFieldsValue)&&t.current.setFieldsValue(r)},[a,(d=t.current)==null?void 0:d.setFieldsValue]),o(k,{open:e,onCancel:n,okText:"\u63D0\u4EA4",okButtonProps:{loading:c},onOk:()=>u(),title:a==="add"?"\u65B0\u5EFA\u5C97\u4F4D":"\u7F16\u8F91\u5C97\u4F4D\u4FE1\u606F",children:p(q,{submitter:!1,formRef:t,children:[o(b,{name:"postName",label:"\u5C97\u4F4D\u540D\u79F0",rules:[{required:!0}]}),o(b,{name:"postCode",label:"\u5C97\u4F4D\u7F16\u7801",rules:[{required:!0}]}),o(Y,{name:"postSort",label:"\u663E\u793A\u987A\u5E8F",rules:[{required:!0}],initialValue:0}),o(W.Group,{name:"status",label:"\u72B6\u6001",valueEnum:U,initialValue:X.ENABLE}),o(Z,{name:"remark",label:"\u5907\u6CE8"})]})})},Ct=[$,tt,et,ot,M,v,R,{title:"\u64CD\u4F5C",valueType:"option",render:(t,e)=>p(E,{children:[o(dt,{record:e}),o(I,{postId:e.postId,postName:e.postName})]})}],x="postId",Mt=()=>{const[t,e]=F.exports.useState({}),a=F.exports.useRef(),r=st(),{rowSelection:l,onClick:i}=_(x);return p(G,{children:[o(H,{formRef:a,actionRef:r,rowKey:x,request:async(...u)=>{const c=K(...u);return e(c),await mt(c)},columns:Ct,toolbar:{actions:[o(ct,{},"ButtonAdd")]},rowSelection:l,onRow:u=>({onClick:()=>i(u)}),tableAlertOptionRender:({selectedRows:u})=>{const c=u.length===0;return p(E,{children:[o(I,{disabled:c,isBatch:!0,postId:u.map(d=>d.postId).join(","),postName:u.map(d=>d.postName).join(",")}),o(yt,{searchParams:t})]})}}),o(ht,{})]})};export{Mt as default};
