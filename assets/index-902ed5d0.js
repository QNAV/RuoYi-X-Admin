import{aH as q,g as z,aI as V,r as C,h as R,l as O,j as s,_ as r,d as a,aJ as Q,aK as X,y as D,z as E,aL as G,aM as U,aN as Y,u as Z,a as w,aO as ee,b as te,c as ae,aP as re,aQ as ie,aR as j,aS as ne,k as _,aT as oe,aU as se,aV as J,aW as ce,aX as le,aY as ue,aZ as de,ai as $,ax as H,a0 as he,a_ as me,a3 as ge,a$ as pe,b0 as W}from"./index-324581e1.js";import{c as fe}from"./index-0faee625.js";import{P as A}from"./index-1ac72251.js";import{S as ve}from"./Skeleton-107f2055.js";import{u as be}from"./useRequest-99d2a14c.js";import"./System-c33174c5.js";import"./utils.esm-d0713da8.js";var xe=["rules","name","phoneName","fieldProps","captchaTextRender","captchaProps"],ye=z.forwardRef(function(e,t){var i=V.useFormInstance(),v=C.exports.useState(e.countDown||60),p=R(v,2),n=p[0],b=p[1],x=C.exports.useState(!1),T=R(x,2),y=T[0],P=T[1],o=C.exports.useState(),u=R(o,2),m=u[0],F=u[1];e.rules,e.name;var N=e.phoneName,S=e.fieldProps,I=e.captchaTextRender,L=I===void 0?function(d,l){return d?"".concat(l," 秒后重新获取"):"获取验证码"}:I,B=e.captchaProps,c=O(e,xe),k=function(){var d=D(E().mark(function l(g){return E().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.prev=0,F(!0),f.next=4,c.onGetCaptcha(g);case 4:F(!1),P(!0),f.next=13;break;case 8:f.prev=8,f.t0=f.catch(0),P(!1),F(!1),console.log(f.t0);case 13:case"end":return f.stop()}},l,null,[[0,8]])}));return function(g){return d.apply(this,arguments)}}();return C.exports.useImperativeHandle(t,function(){return{startTiming:function(){return P(!0)},endTiming:function(){return P(!1)}}}),C.exports.useEffect(function(){var d=0,l=e.countDown;return y&&(d=window.setInterval(function(){b(function(g){return g<=1?(P(!1),clearInterval(d),l||60):g-1})},1e3)),function(){return clearInterval(d)}},[y]),s("div",{style:r(r({},S==null?void 0:S.style),{},{display:"flex",alignItems:"center"}),ref:t,children:[a(Q,r(r({},S),{},{style:{flex:1,transition:"width .3s",marginRight:8}})),a(X,r(r({style:{display:"block"},disabled:y,loading:m},B),{},{onClick:function(){var d=D(E().mark(function g(){var M;return E().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(h.prev=0,!N){h.next=9;break}return h.next=4,i.validateFields([N].flat(1));case 4:return M=i.getFieldValue([N].flat(1)),h.next=7,k(M);case 7:h.next=11;break;case 9:return h.next=11,k("");case 11:h.next=16;break;case 13:h.prev=13,h.t0=h.catch(0),console.log(h.t0);case 16:case"end":return h.stop()}},g,null,[[0,13]])}));function l(){return d.apply(this,arguments)}return l}(),children:L(y,n)}))]})}),Pe=q(ye);const Ce=Pe;var Se=["options","fieldProps","proFieldProps","valueEnum"],Te=z.forwardRef(function(e,t){var i=e.options,v=e.fieldProps,p=e.proFieldProps,n=e.valueEnum,b=O(e,Se);return a(G,r({ref:t,valueType:"checkbox",valueEnum:U(n,void 0),fieldProps:r({options:i},v),lightProps:r({labelFormatter:function(){return a(G,r({ref:t,valueType:"checkbox",mode:"read",valueEnum:U(n,void 0),filedConfig:{customLightMode:!0},fieldProps:r({options:i},v),proFieldProps:p},b))}},b.lightProps),proFieldProps:p},b))}),we=z.forwardRef(function(e,t){var i=e.fieldProps,v=e.children;return a(Y,r(r({ref:t},i),{},{children:v}))}),ke=q(we,{valuePropName:"checked"}),K=ke;K.Group=Te;const Fe=K;var Ne=function(t){var i;return i={},w(i,t.componentCls,{display:"flex",width:"100%",height:"100%",backgroundSize:"contain","&-notice":{display:"flex",flex:"1",alignItems:"flex-end","&-activity":{marginBlock:24,marginInline:24,paddingInline:24,paddingBlock:24,"&-title":{fontWeight:"500",fontSize:"28px"},"&-subTitle":{marginBlockStart:8,fontSize:"16px"},"&-action":{marginBlockStart:"24px"}}},"&-container":{display:"flex",flex:"1",flexDirection:"column",maxWidth:"550px",height:"100%",paddingInline:0,paddingBlock:32,overflow:"auto",background:t.colorBgContainer},"&-top":{textAlign:"center"},"&-header":{display:"flex",alignItems:"center",justifyContent:"center",height:"44px",lineHeight:"44px",a:{textDecoration:"none"}},"&-title":{position:"relative",tinsetBlockStartop:"2px",color:"@heading-color",fontWeight:"600",fontSize:"33px"},"&-logo":{width:"44px",height:"44px",marginInlineEnd:"16px",verticalAlign:"top",img:{width:"100%"}},"&-desc":{marginBlockStart:"12px",marginBlockEnd:"40px",color:t.colorTextSecondary,fontSize:t.fontSize},"&-main":{width:"328px",margin:"0 auto","&-other":{marginBlockStart:"24px",lineHeight:"22px",textAlign:"start"}}}),w(i,"@media (max-width: ".concat(t.screenMDMin),w({},t.componentCls,{flexDirection:"column-reverse",background:"none !important","&-notice":{display:"flex",flex:"none",alignItems:"flex-start",width:"100%","> div":{width:"100%"}}})),w(i,"@media (min-width: ".concat(t.screenMDMin),w({},t.componentCls,{"&-container":{paddingInline:0,paddingBlockStart:128,paddingBlockEnd:24,backgroundRepeat:"no-repeat",backgroundPosition:"center 110px",backgroundSize:"100%"}})),w(i,"@media (max-width: ".concat(t.screenSM),w({},t.componentCls,{"&-main":{width:"95%",maxWidth:"328px"}})),i};function Ie(e){return Z("LoginFormPage",function(t){var i=r(r({},t),{},{componentCls:".".concat(e)});return[Ne(i)]})}var Be=["logo","message","style","activityConfig","backgroundImageUrl","title","subTitle","actions","children"];function Ee(e){var t=e.logo,i=e.message,v=e.style,p=e.activityConfig,n=p===void 0?{}:p,b=e.backgroundImageUrl,x=e.title,T=e.subTitle,y=e.actions,P=e.children,o=O(e,Be),u=ee(),m=function(){var l,g;return o.submitter===!1||((l=o.submitter)===null||l===void 0?void 0:l.submitButtonProps)===!1?!1:r({size:"large",style:{width:"100%"}},(g=o.submitter)===null||g===void 0?void 0:g.submitButtonProps)},F=r(r({searchConfig:{submitText:u.getMessage("loginForm.submitText","登录")},render:function(l,g){return g.pop()}},o.submitter),{},{submitButtonProps:m()}),N=C.exports.useContext(te.ConfigContext),S=N.getPrefixCls("pro-form-login-page"),I=Ie(S),L=I.wrapSSR,B=I.hashId,c=function(l){return"".concat(S,"-").concat(l," ").concat(B)},k=C.exports.useMemo(function(){return t?typeof t=="string"?a("img",{src:t}):t:null},[t]);return L(s("div",{className:ae(S,B),style:r(r({},v),{},{backgroundImage:'url("'.concat(b,'")')}),children:[a("div",{className:c("notice"),children:n&&s("div",{className:c("notice-activity"),style:n.style,children:[n.title&&s("div",{className:c("notice-activity-title"),children:[" ",n.title," "]}),n.subTitle&&s("div",{className:c("notice-activity-subTitle"),children:[" ",n.subTitle," "]}),n.action&&s("div",{className:c("notice-activity-action"),children:[" ",n.action," "]})]})}),s("div",{className:c("container"),children:[s("div",{className:c("top"),children:[x||k?s("div",{className:c("header"),children:[k?a("span",{className:c("logo"),children:k}):null,x?a("span",{className:c("title"),children:x}):null]}):null,T?a("div",{className:c("desc"),children:T}):null]}),s("div",{className:c("main"),children:[s(re,r(r({isKeyPressSubmit:!0},o),{},{submitter:F,children:[i,P]})),y?a("div",{className:c("other"),children:y}):null]})]})]}))}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ae=()=>s("div",{className:"flex flex-col justify-center items-center",children:[a(ie,{plain:!0,children:a("span",{className:"text-sm font-normal text-neutral-400",children:"其他登录方式"})}),a("div",{onClick:()=>{j.info("敬请期待")},className:"flex justify-center items-center cursor-pointer rounded-full h-[40px] w-[40px] border-solid border border-gray-300",children:a(ne,{style:{fontSize:"20px",color:"#00ac84"}})})]});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const je=()=>s(_,{children:[a(A,{fieldProps:{maxLength:11,size:"large",prefix:a(oe,{})},name:"phoneNumber",placeholder:"请输入手机号",rules:[{required:!0,message:"请输入手机号"},{pattern:se,message:"手机号格式错误"}]}),a(Ce,{fieldProps:{size:"large",prefix:a(J,{})},captchaProps:{size:"large"},placeholder:"请输入验证码",captchaTextRender:(e,t)=>e?`${t} 获取验证码`:"获取验证码",name:"smsCode",rules:[{required:!0,message:"请输入验证码"}],onGetCaptcha:async()=>(j.info("敬请期待"),Promise.reject(new Error("敬请期待")))})]});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Le=({captchaImageSrc:e,onCaptchaImageClick:t})=>s(_,{children:[a(A,{name:"username",fieldProps:{size:"large",prefix:a(ce,{})},placeholder:"admin",initialValue:"admin",rules:[{required:!0,message:"请输入用户名"}]}),a(A.Password,{name:"password",fieldProps:{size:"large",prefix:a(J,{})},placeholder:"admin123",initialValue:"admin123",rules:[{required:!0,message:"请输入密码"}]}),s(le,{children:[a(A,{width:160,name:"code",placeholder:"请输入验证码",fieldProps:{size:"large",prefix:a(ue,{})},rules:[{required:!0,message:"请输入验证码"}]}),a("div",{className:"h-[40px] w-[135px] rounded-md cursor-pointer border border-solid border-gray-300",children:e?a(de,{src:`data:image/png;base64,${e}`,preview:!1,height:40,width:135,alt:"图片验证码",onClick:t,className:"rounded-md"}):a(ve.Button,{active:!0,block:!0,size:"large"})})]})]});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Me=(e={})=>$({path:"/captchaImage",method:"GET",secure:!0,...e});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Re=(e,t={})=>$({path:"/login",method:"POST",body:e,secure:!0,type:H.Json,...t});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ze=(e,t={})=>$({path:"/smsLogin",method:"POST",body:e,secure:!0,type:H.Json,...t});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const _e=()=>{const[e,t]=C.exports.useState("USERNAME"),i=fe(),v=he(),[p]=me(),{data:n,run:b}=be(()=>Me({secure:!1})),x=async(o,u)=>{var m;pe(o?W.LOCAL_STORAGE:W.SESSION_STORAGE,`Bearer ${u}`),await i(),v((m=p.get("redirect"))!=null?m:"/")},T=async(o,u)=>{const{token:m}=await ze(u);await x(o,m)},y=async(o,u)=>{if(!n){j.error("请先获取图片验证码");return}const{token:m}=await Re({...u,uuid:n.uuid},{secure:!1});await x(o,m)},P=async o=>{try{const{autoLogin:u,...m}=o;if(e==="MOBILE"){await T(u,m);return}if(e==="USERNAME"){await y(u,m);return}}catch{e==="USERNAME"&&b()}};return C.exports.useEffect(()=>{p.get("msg")&&j.error(p.get("msg"))},[]),a("div",{className:"h-[100vh]",children:s(Ee,{backgroundImageUrl:"https://gw.alipayobjects.com/zos/rmsportal/FfdJeJRQWjEeGTpqgBKj.png",logo:"https://github.githubassets.com/images/modules/logos_page/Octocat.png",title:"RuoYi X Admin",subTitle:"若依后台管理系统",actions:a(Ae,{}),onFinish:P,children:[a(ge,{centered:!0,activeKey:e,onChange:o=>t(o),items:[{label:"账号密码登录",key:"USERNAME"},{label:"手机号登录",key:"MOBILE"}]}),e==="USERNAME"&&a(Le,{captchaImageSrc:n==null?void 0:n.img,onCaptchaImageClick:b}),e==="MOBILE"&&a(je,{}),a(Fe,{name:"autoLogin",children:"自动登录"})]})})};export{_e as default};
