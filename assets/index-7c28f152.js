import{r as i,A as T,_ as f,a7 as A,p as y,d as u,a8 as I,j as a,a9 as P,aa as v,ab as N,D as j,ac as k,s as U,ad as E,ae as O,o as q,af as D,f as M,ag as S,ah as z,B as H,M as h,T as L}from"./index-cde0b745.js";import{u as x}from"./useMutation-c6d67192.js";import{U as B}from"./index-9644627d.js";import{P as w}from"./index-b4acbad9.js";import{P as p}from"./index-30f4d2f6.js";var F={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 248H728l-32.4-90.8a32.07 32.07 0 00-30.2-21.2H358.6c-13.5 0-25.6 8.5-30.1 21.2L296 248H160c-44.2 0-80 35.8-80 80v456c0 44.2 35.8 80 80 80h704c44.2 0 80-35.8 80-80V328c0-44.2-35.8-80-80-80zm8 536c0 4.4-3.6 8-8 8H160c-4.4 0-8-3.6-8-8V328c0-4.4 3.6-8 8-8h186.7l17.1-47.8 22.9-64.2h250.5l22.9 64.2 17.1 47.8H864c4.4 0 8 3.6 8 8v456zM512 384c-88.4 0-160 71.6-160 160s71.6 160 160 160 160-71.6 160-160-71.6-160-160-160zm0 256c-53 0-96-43-96-96s43-96 96-96 96 43 96 96-43 96-96 96z"}}]},name:"camera",theme:"outlined"};const R=F;var b=function(s,c){return i.createElement(T,f(f({},s),{},{ref:c,icon:R}))};b.displayName="CameraOutlined";const _=i.forwardRef(b);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const $="https://test-ryx-admin-api.p.quicknav.cn/api/sys/profile/update-avatar",K=[{dataIndex:"userName",key:"userName",title:"用户名称",valueType:"text"},{dataIndex:"deptName",key:"deptName",title:"所属部门",valueType:"text"},{dataIndex:"roleName",key:"roleName",title:"所属角色",valueType:"text"},{dataIndex:"createTime",key:"createTime",title:"创建时间",valueType:"text"}],Q=()=>{const{valueEnumSysUserSex:e}=k();return[{dataIndex:"nickName",key:"nickName",title:"用户昵称",valueType:"text",formItemProps:{rules:[{required:!0,message:"请输入用户昵称"}]}},{dataIndex:"phoneNumber",key:"phoneNumber",title:"手机号码",valueType:"text",fieldProps:{maxLength:11},formItemProps:{rules:[{required:!0,message:"请输入手机号"},{pattern:U,message:"手机号格式错误"}]}},{dataIndex:"email",key:"email",title:"邮箱",valueType:"text",formItemProps:{rules:[{required:!0,message:"请输入邮箱"},{pattern:E,message:"邮箱格式错误"}]}},{dataIndex:"sex",key:"sex",title:"性别",valueType:"radio",valueEnum:e}]},V=()=>{var t,g;const{data:e,refetch:s}=A(),c=Q(),{message:l}=y.useApp(),{mutate:d,mutateAsync:r}=x(O,{onSuccess:()=>{s(),l.success("保存成功")}}),n={onSave:async(o,m)=>{await r({[o]:m[o]})}};return u(I,{align:"middle",children:[a(P,{span:4,children:u("div",{className:"w-[100px] relative m-auto",children:[a(v,{src:((g=(t=e==null?void 0:e.userInfo)==null?void 0:t.user)==null?void 0:g.avatar)??"Avatar",size:100}),a(B,{maxCount:1,showUploadList:!1,name:"avatarfile",accept:"image/jpeg,image/png",action:$,headers:{Authorization:N()},onChange:o=>{if(o.file.status!=="done")return;const{code:m,msg:C}=o.file.response;if(m!==200){l.error(C);return}d({avatar:o.file.response.data})},children:a(v,{icon:a(_,{}),className:"absolute bottom-0 right-0 bg-blue-500 cursor-pointer"})})]})}),u(P,{span:20,children:[a(w,{columns:K,dataSource:{userName:e==null?void 0:e.userInfo.user.userName,createTime:e==null?void 0:e.userInfo.user.createTime,deptName:e==null?void 0:e.userInfo.user.dept.deptName,roleName:e==null?void 0:e.userInfo.user.roles.map(o=>o.roleName).join("/")}}),a(j,{}),a(w,{columns:c,dataSource:e==null?void 0:e.userInfo.user,editable:n})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const W=()=>{const e=i.useRef(),s=z(),{message:c}=y.useApp(),{mutate:l,isLoading:d}=x(async()=>{var n;const r=await((n=e==null?void 0:e.current)==null?void 0:n.validateFields());await S(r)},{onSuccess:()=>{c.success("密码修改成功，即将自动退出登录并跳转至登录页面");const r=setTimeout(async()=>{await s(),clearTimeout(r)},1500)}});return u(q,{formRef:e,submitter:!1,children:[a(p.Password,{allowClear:!0,name:"oldPassword",label:"旧密码",rules:[{required:!0}],width:"md"}),a(p.Password,{allowClear:!0,name:"newPassword",label:"新密码",width:"md",rules:[{required:!0},{pattern:D,message:"长度在6-20之间，只能包含字母、数字和下划线"},({getFieldValue:r})=>({validator(n,t){return!t||t!==r("oldPassword")?Promise.resolve():Promise.reject(new Error("新旧密码不能相同"))}})]}),a(p.Password,{allowClear:!0,name:"confirmPassword",label:"确认密码",width:"md",rules:[{required:!0},({getFieldValue:r})=>({validator(n,t){return!t||r("newPassword")===t?Promise.resolve():Promise.reject(new Error("两次密码输入不一致"))}})]}),a(M,{type:"primary",loading:d,onClick:()=>l(),children:"更新密码"})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const ee=()=>{const[e,s]=i.useState("PASSWORD");return a(H,{title:"个人中心",children:u(h,{ghost:!0,direction:"column",gutter:[0,16],children:[a(h,{children:a(V,{})}),a(h,{children:a(L,{activeKey:e,onChange:c=>s(c),items:[{label:"安全设置",key:"PASSWORD",children:a(W,{})}]})})]})})};export{ee as default};
