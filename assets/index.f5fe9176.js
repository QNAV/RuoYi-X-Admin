import{aD as U,ac as M,a as e,b8 as O,ab as I,r as F,i as N,n as S,l as R,ba as b,j as c,aH as k,aL as l,p as y,aJ as D,aA as d,b9 as L,bb as j,bs as W,bt as q,bI as V,bJ as H,bc as J,F as K,bd as z,bK as G,a_ as _,bf as Q,bL as X,bk as Y,b5 as f}from"./index.7e2e4aff.js";import{B as Z}from"./index.0dac2af8.js";import{u as $,c as ee}from"./useInitActionType.07c1d484.js";import{b as m}from"./keepAlive.a2f6a073.js";import{a as te,u as se}from"./utils.81244b9b.js";import{C as oe,b as re,d as ae}from"./common.026964d1.js";import{u as ue}from"./useRowClick.c19aaf4b.js";import{A as p}from"./index.3efbd4c1.js";import{u as w}from"./index.b95225a0.js";import{u as B}from"./useMutation.esm.c7490ab8.js";import{E as ne}from"./index.37f2e67b.js";import{e as ce}from"./SysDeptService.a919a020.js";import{u as le}from"./useRequest.366cd4a8.js";import"./cloneDeep.5079a371.js";import"./utils.esm.6214005e.js";var de=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],ie=U.forwardRef(function(t,s){var o=t.fieldProps,r=t.unCheckedChildren,n=t.checkedChildren,a=t.proFieldProps,u=M(t,de);return e(O,I({valueType:"switch",fieldProps:I({unCheckedChildren:r,checkedChildren:n},o),ref:s,valuePropName:"checked",proFieldProps:a,filedConfig:{valuePropName:"checked",ignoreWidth:!0}},u))});const me=t=>F.exports.cloneElement(e("div",{onClick:s=>{s.stopPropagation()},children:t.children}),t),pe={dataIndex:"userId",key:"userId",title:"\u7528\u6237\u7F16\u53F7",valueType:"text",editable:!1,hideInSearch:!0},he={dataIndex:"userName",key:"userName",title:"\u7528\u6237\u540D\u79F0",valueType:"text"},Ce={dataIndex:"nickName",key:"nickName",title:"\u7528\u6237\u6635\u79F0",valueType:"text",hideInSearch:!0},Fe={dataIndex:["dept","deptName"],key:"deptDeptName",title:"\u90E8\u95E8\u540D\u79F0",valueType:"text",hideInSearch:!0},be={dataIndex:"phoneNumber",key:"phoneNumber",title:"\u624B\u673A\u53F7\u7801",valueType:"text"},v=N(void 0),A=()=>S(v),ye=()=>$(v),T=N(0),Pe=()=>S(T),fe=()=>R(T),g=te({open:!1,userId:0,userName:""}),Se=()=>{const t=R(g);return(s,o)=>{t({open:!0,userId:s,userName:o})}},ke=()=>se(g),Be=()=>S(g),ge=()=>{const t=ke(),{open:s,userId:o,userName:r}=Be();return e(b,{title:"\u91CD\u7F6E\u5BC6\u7801",open:s,onCancel:t,children:c(k,{children:[e(l,{}),e(l.Password,{})]})})};async function Ie(t,s){return y("/system/user/add",{method:"POST",headers:{"Content-Type":"application/json"},data:t,...s||{}})}async function xe(t){return y("/system/user/importTemplate",{method:"POST",...t||{}})}async function Ne(t,s){return y("/system/user/list",{method:"POST",headers:{"Content-Type":"application/json"},data:t,...s||{}})}async function Re(t,s){return y("/system/user/remove",{method:"POST",params:{...t},...s||{}})}const De=()=>{const t=m(),[s,{toggle:o}]=w(),r=F.exports.useRef(),n=A(),{isLoading:a,mutate:u}=B(async()=>{var i,h;const P=await((h=(i=r.current)==null?void 0:i.validateFieldsReturnFormatValue)==null?void 0:h.call(i));await Ie(P)},{onSuccess:()=>{n==null||n.reload(),D.success("\u6DFB\u52A0\u6210\u529F")}});return c(p,{accessible:t.canAddSysUser,children:[e(d,{type:"primary",icon:e(L,{}),onClick:o,children:"\u65B0\u589E"}),e(b,{title:"\u6DFB\u52A0\u7528\u6237",open:s,onCancel:o,confirmLoading:a,okText:"\u63D0\u4EA4",onOk:()=>u(),children:c(k,{submitter:!1,formRef:r,grid:!0,colProps:{span:12},children:[e(l,{name:"nickName",label:"\u7528\u6237\u6635\u79F0",rules:[{required:!0}]}),e(l,{name:"phoneNumber",label:"\u624B\u673A\u53F7\u7801"}),e(l,{name:"email",label:"\u90AE\u7BB1"}),e(l,{name:"userName",label:"\u7528\u6237\u540D\u79F0",rules:[{required:!0}]}),e(l.Password,{name:"password",label:"\u7528\u6237\u5BC6\u7801",rules:[{required:!0}]}),e(j.Group,{name:"status",label:"\u72B6\u6001"})]})})]})},we=()=>{const t=m();return e(p,{accessible:t.canEditSysUser,children:e(d,{type:"link",icon:e(W,{}),children:"\u7F16\u8F91"})})},ve=()=>{const t=m();return e(p,{accessible:t.canExportSysUser,children:e(d,{icon:e(q,{}),children:"\u5BFC\u51FA"})})},Ae=()=>{const t=m(),s=F.exports.useRef(),[o,{toggle:r}]=w(),{mutate:n,isLoading:a}=B(xe);return c(p,{accessible:t.canImportSysUser,children:[e(d,{icon:e(V,{}),onClick:r,children:"\u5BFC\u5165"}),c(b,{title:"\u5BFC\u5165\u7528\u6237",open:o,onCancel:r,children:[e("div",{className:"text-right",children:e(d,{type:"link",onClick:n,loading:a,children:"\u4E0B\u8F7D\u6A21\u677F"})}),c(k,{layout:"horizontal",submitter:!1,formRef:s,children:[e(ie,{name:"isCover",label:"\u662F\u5426\u66F4\u65B0\u5DF2\u7ECF\u5B58\u5728\u7684\u7528\u6237\u6570\u636E"}),e(H,{name:"list"})]})]})]})},E=({userId:t,userName:s,isBatch:o,disabled:r})=>{const n=o?"\u6279\u91CF\u5220\u9664":"\u5220\u9664",a=m(),u=A(),{mutateAsync:P,isLoading:i}=B(async C=>{await Re({userIds:C})},{onSuccess:()=>{var C;u==null||u.reload(),(C=u==null?void 0:u.clearSelected)==null||C.call(u),D.success("\u5220\u9664\u6210\u529F")}}),h=()=>{b.confirm({title:"\u5220\u9664\u7528\u6237",content:c(K,{children:["\u786E\u5B9A\u5220\u9664\u7528\u6237",e(z.Text,{code:!0,children:s}),"\u5417\uFF1F"]}),onOk:async()=>P(t),okButtonProps:{loading:i}})};return e(p,{accessible:a.canRemoveSysUser,children:e(d,{type:"link",danger:!0,disabled:r,icon:e(J,{}),onClick:h,children:n})})},Te=({userId:t,userName:s})=>{const o=m(),r=Se();return e(p,{accessible:o.canResetSysUserPwd,children:e(d,{type:"link",danger:!0,icon:e(G,{}),onClick:()=>r(t,s),children:"\u91CD\u7F6E\u5BC6\u7801"})})},Ee=[pe,he,Ce,Fe,be,oe,re,ae,{title:"\u64CD\u4F5C",valueType:"option",width:290,render:(t,s)=>c(me,{children:[e(we,{}),e(E,{userId:s.userId,userName:s.userName}),e(Te,{userId:s.userId,userName:s.userName})]})}],x="userId",Ue=({selectedRows:t})=>{const s=t.length===0;return e(E,{disabled:s,isBatch:!0,userId:t.map(o=>o.userId).join(","),userName:t.map(o=>o.userName).join(",")})},Me=()=>{const t=ye(),s=Pe(),o=s>0?{deptId:s}:{},{rowSelection:r,onClick:n}=ue(x);return e(_,{rowKey:x,actionRef:t,columns:Ee,params:o,search:{span:{xs:24,sm:24,md:12,lg:12,xl:12,xxl:6}},onRow:a=>({onClick:()=>n(a)}),rowSelection:r,tableAlertOptionRender:Ue,request:(...a)=>Ne(ee(...a)),toolbar:{actions:[e(ve,{},"ButtonExport"),e(Ae,{},"ButtonImport"),e(De,{},"ButtonAdd")]}})},Oe=()=>{const[t,s]=F.exports.useState(""),o=fe(),{data:r,loading:n}=le(()=>ce({deptName:t}),{refreshDeps:[t]});return r?c(Q,{spinning:n,children:[e(X.Search,{allowClear:!0,placeholder:"\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0",className:"mb-3",onSearch:a=>{s(a)}}),e(Y,{treeData:r,defaultExpandAll:!0,fieldNames:{title:"label",key:"id"},onSelect:(a,{node:{key:u}})=>{o(u)}})]}):e(ne,{})},$e=()=>c(Z,{children:[c(f,{ghost:!0,gutter:24,children:[e(f,{colSpan:"300px",className:"h-full",children:e(Oe,{})}),e(f,{ghost:!0,className:"h-full",children:e(Me,{})})]}),e(ge,{})]});export{$e as default};
