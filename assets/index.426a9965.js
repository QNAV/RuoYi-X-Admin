import{C as v,c as g,b as w}from"./common.061d994b.js";import{R as k,i as T,n as D,b7 as j,a as o,av as y,b8 as N,br as _,aG as m,aE as E,bs as V,bb as q,b9 as B,j as p,F as A,bc as L,r as F,aC as W,aI as b,ba as G,aY as $}from"./index.9ab0876b.js";import{B as H}from"./index.20e76e68.js";import{a as C}from"./keepAlive.e84d3901.js";import{u as K,c as Y}from"./useInitActionType.ce519f8e.js";import{u as z}from"./useRowClick.62b8e7c7.js";import{A as P}from"./index.036b3c89.js";import{u as f,E as J,a as Q}from"./useMutation.esm.f654451f.js";import{P as U}from"./index.1c0f5c5b.js";import{P as X}from"./index.da76da5a.js";import"./utils.esm.0b591295.js";const Z={dataIndex:"postId",key:"postId",title:"\u5C97\u4F4D\u7F16\u53F7",valueType:"text",hideInSearch:!0},tt={dataIndex:"postCode",key:"postCode",title:"\u5C97\u4F4D\u7F16\u7801",valueType:"text"},et={dataIndex:"postName",key:"postName",title:"\u5C97\u4F4D\u540D\u79F0",valueType:"text"},ot={dataIndex:"postSort",key:"postSort",title:"\u663E\u793A\u987A\u5E8F",valueType:"text",hideInSearch:!0},M="systemPost",O=k({key:`${M}AtomMainTableActions`,default:void 0}),st=()=>K(O),R=()=>T(O),h=k({key:`${M}AtomAddOrEditModal`,default:{open:!1,actionType:"add"}}),at=()=>{const t=D(h);return()=>t({open:!0,actionType:"add"})},nt=()=>{const t=D(h);return e=>t({open:!0,actionType:"edit",record:e})},ut=()=>j(h),rt=()=>T(h),dt=()=>{const t=C(),e=at();return o(P,{accessible:t.canAddSysPost,children:o(y,{type:"primary",icon:o(N,{}),onClick:e,children:"\u65B0\u5EFA"})})},ct=({record:t})=>{const e=C(),a=nt();return o(P,{accessible:e.canEditSysPost,children:o(y,{type:"link",icon:o(_,{}),onClick:()=>a(t),children:"\u7F16\u8F91"})})};async function it(t,e){return m("/system/post/add",{method:"POST",headers:{"Content-Type":"application/json"},data:t,...e||{}})}async function lt(t,e){return m("/system/post/edit",{method:"POST",headers:{"Content-Type":"application/json"},data:t,...e||{}})}async function pt(t,e){return m("/system/post/export",{method:"POST",headers:{"Content-Type":"application/json"},data:t,...e||{}})}async function mt(t,e){return m("/system/post/list",{method:"POST",headers:{"Content-Type":"application/json"},data:t,...e||{}})}async function Ft(t,e){return m("/system/post/remove",{method:"POST",params:{...t},...e||{}})}const yt=({searchParams:t})=>{const e=C(),{isLoading:a,mutate:r}=f(()=>pt(t),{onSuccess:()=>{E.success("\u5BFC\u51FA\u6210\u529F")}});return o(P,{accessible:e.canExportSysPost,children:o(y,{type:"link",icon:o(V,{}),loading:a,onClick:()=>r(),children:"\u5BFC\u51FA\u5F53\u524D\u5217\u8868"})})},I=({postId:t,postName:e,isBatch:a,disabled:r})=>{const l=a?"\u6279\u91CF\u5220\u9664":"\u5220\u9664",i=C(),n=R(),{mutateAsync:u,isLoading:d}=f(async s=>{await Ft({postIds:s})},{onSuccess:()=>{var s;n==null||n.reload(),(s=n==null?void 0:n.clearSelected)==null||s.call(n),E.success("\u5220\u9664\u6210\u529F")}}),c=()=>{B.confirm({title:"\u5220\u9664\u5C97\u4F4D",content:p(A,{children:["\u786E\u5B9A\u5220\u9664\u5C97\u4F4D",o(L.Text,{code:!0,children:e}),"\u5417\uFF1F"]}),onOk:async()=>u(t),okButtonProps:{loading:d}})};return o(P,{accessible:i.canRemoveSysPost,children:o(y,{type:"link",danger:!0,disabled:r,icon:o(q,{}),onClick:c,children:l})})},Ct=()=>{var c;const t=F.exports.useRef(),{open:e,actionType:a,record:r}=rt(),l=ut(),i=R(),n=()=>{var s;l(),(s=t.current)==null||s.resetFields()},{mutate:u,isLoading:d}=f(async()=>{var S;const s=await((S=t.current)==null?void 0:S.validateFields());if(!!s){if(a==="add"){await it(s);return}await lt({...s,postId:r.postId})}},{onSuccess:()=>{i==null||i.reload(),n(),E.success(a==="add"?"\u65B0\u5EFA\u6210\u529F":"\u4FDD\u5B58\u6210\u529F")}});return F.exports.useEffect(()=>{var s;a==="edit"&&r&&((s=t.current)==null?void 0:s.setFieldsValue)&&t.current.setFieldsValue(r)},[a,(c=t.current)==null?void 0:c.setFieldsValue]),o(B,{open:e,onCancel:n,okText:"\u63D0\u4EA4",okButtonProps:{loading:d},onOk:()=>u(),title:a==="add"?"\u65B0\u5EFA\u5C97\u4F4D":"\u7F16\u8F91\u5C97\u4F4D\u4FE1\u606F",children:p(W,{submitter:!1,formRef:t,children:[o(b,{name:"postName",label:"\u5C97\u4F4D\u540D\u79F0",rules:[{required:!0}]}),o(b,{name:"postCode",label:"\u5C97\u4F4D\u7F16\u7801",rules:[{required:!0}]}),o(U,{name:"postSort",label:"\u663E\u793A\u987A\u5E8F",rules:[{required:!0}],initialValue:0}),o(G.Group,{name:"status",label:"\u72B6\u6001",valueEnum:J,initialValue:Q.ENABLE}),o(X,{name:"remark",label:"\u5907\u6CE8"})]})})},Pt=[Z,tt,et,ot,v,g,w,{title:"\u64CD\u4F5C",valueType:"option",render:(t,e)=>p(A,{children:[o(ct,{record:e}),o(I,{postId:e.postId,postName:e.postName})]})}],x="postId",Mt=()=>{const[t,e]=F.exports.useState({}),a=F.exports.useRef(),r=st(),{rowSelection:l,onClick:i}=z(x);return p(H,{children:[o($,{formRef:a,actionRef:r,rowKey:x,request:async(...u)=>{const d=Y(...u);return e(d),await mt(d)},columns:Pt,toolbar:{actions:[o(dt,{},"ButtonAdd")]},rowSelection:l,onRow:u=>({onClick:()=>i(u)}),tableAlertOptionRender:({selectedRows:u})=>{const d=u.length===0;return p(A,{children:[o(I,{disabled:d,isBatch:!0,postId:u.map(c=>c.postId).join(","),postName:u.map(c=>c.postName).join(",")}),o(yt,{searchParams:t})]})}}),o(Ct,{})]})};export{Mt as default};
