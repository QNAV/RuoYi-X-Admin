import{j as s,Y as f,ap as Y,cj as y,ck as H,a1 as q,f as v,cl as G,cm as d,s as Q,ae as _,cn as $,b as h,q as W,av as j,co as z,a4 as J,cp as Z,ag as ee,cq as k,ad as te,Q as E,X as b,V as se,aj as w,r as p,cr as ae,c2 as N,cs as oe,ct as re,cu as ne,ao as ce,a0 as le,cv as ie,cw as F,cx as de,$ as ue,cy as me,C as he,cz as pe,cA as ge,N as Ie,I as fe,aE as ye,aJ as Ce,a2 as Te,a3 as be,cB as we,O as Ae,B as xe}from"./index-e45f2629.js";import{u as T}from"./useMutation-f45b4c91.js";import{u as P}from"./useRequest-22846eb6.js";import{a as B,u as D}from"./utils-bb2a9b42.js";import{u as Pe}from"./index-95a1eda3.js";import{U as Se}from"./index-8b2d85e5.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Me=({userId:e})=>{const t=Ze();return s(f,{accessKey:"system:user:edit",children:s(Y,{onClick:()=>t(e)})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const U=({userIds:e,batch:t,disabled:a})=>{const{message:r,modal:n}=y.useApp(),o=M(),{mutate:l,isLoading:i}=T(H,{onSuccess:()=>{var u;o==null||o.reload(),(u=o==null?void 0:o.clearSelected)==null||u.call(o),r.success("删除成功")}});return s(f,{accessKey:"system:user:remove",children:s(q,{batch:t,disabled:a,onClick:()=>{n.confirm({title:"删除用户",content:`确定删除用户编号为 ${e.join(",")} 的数据吗？`,onOk:()=>l({userIds:e}),okButtonProps:{loading:i}})}})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Re=({record:e})=>{const t=$e();return s(f,{accessKey:"system:user:resetPwd",children:s(v,{type:"link",danger:!0,icon:s(G,{}),onClick:()=>t(e),children:"重置密码"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const[ve]=d({title:"用户编号",dataIndex:"userId",table:{valueType:"text",hideInSearch:!0}}),[je,,L]=d({title:"用户名称",dataIndex:"userName",table:{valueType:"text"},form:{valueType:"text",formItemProps:{rules:[{required:!0}]}}}),[ke,,Ee]=d({title:"用户昵称",dataIndex:"nickName",table:{valueType:"text",hideInSearch:!0}}),[Ne]=d({title:"部门名称",dataIndex:["dept","deptName"],table:{valueType:"text",hideInSearch:!0}}),[Fe,,Be]=d({title:"手机号码",dataIndex:"phoneNumber",table:{valueType:"text",copyable:!0},form:{valueType:"text",formItemProps:{rules:[{pattern:Q,message:"手机号码格式不正确"}]},fieldProps:{maxLength:11}}}),O=()=>{const{valueEnumSysNormalDisable:e}=J();return d({title:"状态",dataIndex:"status",valueEnum:e,table:{valueType:"select"},form:{valueType:"select"}})},[De]=d({title:"创建时间",dataIndex:"createTime",table:{valueType:"dateTime",hideInSearch:!0}}),K=(e=!1)=>{const{data:t}=j(["sysConfigGetConfigKeySkipErrorHandler","sys.user.initPassword"],async()=>{const{data:a}=await Z({configKey:"sys.user.initPassword"});return a.msg});return d({title:"用户密码",dataIndex:"password",form:{valueType:"password",initialValue:e?t:void 0,formItemProps:{rules:[{required:!0},{pattern:ee,message:"密码长度应在6-20之间，只能包含字母、数字和下划线"}]}}})},Ue=()=>{const{data:e=[]}=P(()=>k({deptQuery:{}}));return d({title:"归属部门",dataIndex:"deptId",form:{valueType:"treeSelect",fieldProps:{treeData:e,fieldNames:{value:"id"}}}})},[,,Le]=d({title:"邮箱",dataIndex:"email",form:{valueType:"text",formItemProps:{rules:[{pattern:_,message:"邮箱格式错误"}]}}}),Oe=()=>{const{valueEnumSysUserSex:e}=te();return d({title:"用户性别",dataIndex:"sex",valueEnum:e,form:{valueType:"select"}})},Ke=e=>d({title:"岗位",dataIndex:"postIds",valueEnum:e,form:{valueType:"select",fieldProps:{mode:"multiple"},colProps:{span:24}}}),Ve=e=>d({title:"角色",dataIndex:"roleIds",valueEnum:e,form:{valueType:"select",fieldProps:{mode:"multiple"},colProps:{span:24}}}),[,,Xe]=d({title:"备注",dataIndex:"remark",form:{valueType:"textarea",colProps:{span:24}}}),Ye=()=>{const[,,e]=K();return[$(L,{readonly:!0}),e]},He=()=>{const[e]=O();return[ve,je,ke,Ne,Fe,e,De,{title:"操作",valueType:"option",render:(t,a)=>a.userId===1?null:h(W,{children:[s(Me,{userId:a.userId}),s(U,{userIds:[a.userId]}),s(Re,{record:a})]}),fixed:"right",width:300}]},qe=e=>{const{data:t}=j(["sysUserGetInfo"],async()=>{const{posts:g,roles:u}=await z();return{posts:g.reduce((I,c)=>I.set(c.postId,c.postName),new Map),roles:u.reduce((I,c)=>I.set(c.roleId,c.roleName),new Map)}}),[,,a]=Ue(),[,,r]=K(!0),[,,n]=Oe(),[,,o]=O(),[,,l]=Ke((t==null?void 0:t.posts)??{}),[,,i]=Ve((t==null?void 0:t.roles)??{});return[Ee,a,Be,Le,...e==="add"?[L,r]:[],n,o,l,i,Xe]};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const S=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomMainTableActions",E(void 0));S.debugLabel="atomMainTableActions";const M=()=>b(S),Ge=()=>se(S),R=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomSelectedDeptId",E(0));R.debugLabel="atomSelectedDeptId";const Qe=()=>b(R),_e=()=>w(R),A=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomResetPwdModal",B({open:!1}));A.debugLabel="atomResetPwdModal";const $e=()=>{const e=w(A);return t=>{e({open:!0,record:t})}},We=()=>D(A),ze=()=>b(A),C=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomAddOrEditModal",B({open:!1,actionType:"add"}));C.debugLabel="atomAddOrEditModal";const Je=()=>{const e=w(C);return()=>{e({open:!0,actionType:"add"})}},Ze=()=>{const e=w(C);return t=>{e({open:!0,actionType:"edit",userId:t})}},et=()=>D(C),tt=()=>b(C);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const st=()=>{const{message:e}=y.useApp(),t=p.useRef(),a=M(),{open:r,actionType:n,userId:o}=tt(),l=et(),i=()=>{var c;n==="edit"&&((c=t.current)==null||c.resetFields()),l()},[,g]=p.useTransition();P(async()=>{const{postIds:c,roleIds:m,user:x}=await ae({userId:o});return{...x,postIds:c,roleIds:m}},{ready:r&&n==="edit"&&!!o,onSuccess:c=>{g(()=>{var m;(m=t.current)==null||m.setFieldsValue(c)})},refreshDeps:[r]});const u=async c=>{var m;if(n==="add"){const{roleIds:x=[],postIds:V=[],...X}=c;await oe({roleIds:x,postIds:V,...X})}else await re({userId:o,...c});a==null||a.reload(),(m=t.current)==null||m.resetFields(),l(),e.success(n==="add"?"新增成功":"编辑成功")},I=qe(n);return s(N,{layoutType:"ModalForm",title:n==="add"?"新增用户":"编辑用户",formRef:t,grid:!0,colProps:{span:12},modalProps:{okText:"提交",onCancel:i},width:600,open:r,onFinish:u,columns:I})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const at=()=>{const{message:e}=y.useApp(),t=p.useRef(),a=Ye(),r=We(),{open:n,record:o}=ze(),[,l]=p.useTransition(),i=M(),g=async({password:u})=>{await ne({...o,password:u}),i==null||i.reload(),r(),e.success("重置密码成功")};return p.useEffect(()=>{n&&o&&l(()=>{var u;(u=t.current)==null||u.setFieldsValue({userName:o.userName,password:""})})},[n]),s(N,{title:"重置密码",layoutType:"ModalForm",columns:a,width:500,formRef:t,open:n,modalProps:{okText:"提交",onCancel:r},onFinish:g})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ot=()=>{const e=Je();return s(f,{accessKey:"system:user:add",children:s(ce,{onClick:e})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const rt=async e=>{const{data:t}=await ie(e,{format:"blob"});await F(t,`user_${new Date().getTime()}.xlsx`)},nt=({searchParams:e})=>{const{message:t}=y.useApp(),{isLoading:a,mutate:r}=T(rt,{onSuccess:()=>{t.success("导出成功")}});return s(f,{accessKey:"system:user:export",children:s(le,{loading:a,onClick:()=>r(e)})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const{Dragger:ct}=Se,lt=async()=>{const{data:e}=await pe({format:"blob"});await F(e,`user_template_${new Date().getTime()}.xlsx`)},it=async({updateSupport:e,file:t})=>{const{data:{code:a,msg:r}}=await ge({updateSupport:e},{file:t});return a!==200?Promise.reject(new Error(r)):r},dt=()=>{const[e,{toggle:t}]=Pe(),[a,r]=p.useState(!1),[n,o]=p.useState([]),{message:l,modal:i}=y.useApp(),{mutate:g,isLoading:u}=T(it,{onSuccess:m=>{t(),i.info({title:"导入结果",content:m})},onError:()=>{l.error("导入失败")}}),{mutate:I,isLoading:c}=T(lt);return h(f,{accessKey:"system:user:import",children:[s(de,{onClick:t}),h(ue,{title:"导入用户",open:e,onCancel:t,onOk:()=>g({updateSupport:a,file:n[0].originFileObj}),okButtonProps:{loading:u},children:[h(ct,{accept:".xlsx, .xls",maxCount:1,beforeUpload:()=>!1,onChange:m=>o(m.fileList),fileList:n,onRemove:()=>o([]),children:[s("p",{className:"ant-upload-drag-icon",children:s(me,{})}),s("p",{className:"ant-upload-text",children:"点击或拖拽文件到此区域上传"})]}),h("div",{className:"flex flex-col items-center pt-2",children:[s(he,{checked:a,onChange:m=>{r(m.target.checked)},children:"是否更新已经存在的用户数据"}),h("div",{children:[s("span",{children:"仅允许导入xls、xlsx格式文件"}),s(v,{type:"link",onClick:()=>I(),loading:c,children:"下载模板"})]})]})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ut=()=>{const[e,t]=p.useState(""),a=_e(),{data:r,loading:n}=P(()=>k({deptQuery:{deptName:e}}),{refreshDeps:[e],debounceWait:500});return h(Ie,{spinning:n,children:[s(fe.Search,{allowClear:!0,placeholder:"请输入部门名称",className:"mb-3",onSearch:o=>{t(o)}}),!r||r.length===0?s(ye,{}):s(Ce,{treeData:r,defaultExpandAll:!0,fieldNames:{title:"label",key:"id"},onSelect:(o,{node:{key:l}})=>{a(l)},blockNode:!0})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const mt=({selectedRows:e})=>s(U,{disabled:e.length===0,batch:!0,userIds:e.map(t=>t.userId)}),ht=(e,t)=>h("div",{className:"flex gap-4",children:[s(Ae,{className:"w-80",children:s(ut,{})}),s("div",{className:"overflow-auto w-full",children:t})]}),pt=()=>{const e=Ge(),[t,a]=p.useState({}),r=He(),n=Qe(),o=n>0?{deptId:n}:{};return s(Te,{rowKey:"userId",actionRef:e,columns:r,params:o,request:async(...l)=>{const i=be(...l);return a(i),await we(i)},toolbar:{actions:[s(nt,{searchParams:t},"ButtonExport"),s(dt,{},"ButtonImport"),s(ot,{},"ButtonAdd")]},tableRender:ht,tableAlertOptionRender:mt})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const bt=()=>h(xe,{children:[s(pt,{}),s(st,{}),s(at,{})]});export{bt as default};
