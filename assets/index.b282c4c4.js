import{j as F,F as f,a,b4 as d,aI as p,be as I,r as N,bM as y,aA as c,bN as h,bO as E,bs as g,bP as T,b5 as C,aJ as B}from"./index.7e2e4aff.js";import{B as D}from"./index.0dac2af8.js";import{c as P}from"./common.026964d1.js";import{C as O,a as w,b as A,c as k,d as v,e as G,f as x,g as _,h as j,i as L,j as R,k as q,l as J,m as M,n as K,o as Q,p as z,q as S,r as Z,s as H,t as U,u as V,v as W,G as X,w as Y}from"./GenService.797f12ec.js";import{G as $,u as ee}from"./useMutation.esm.c7490ab8.js";import{u as se}from"./useRequest.366cd4a8.js";import"./utils.esm.6214005e.js";const ae=({dataSource:s,handleEdit:n})=>{const l={onSave:async(u,e)=>{const t=u;await n({[t]:e[t]})}};return F(f,{children:[a(d,{dataSource:s,columns:[O,w,A,k,P],editable:l}),a(p,{}),a(d,{columns:[v,G,x,_,j,L,...(s==null?void 0:s.genType)===$.ZIP?[]:[R]],dataSource:s,editable:l})]})},ne=({dataSource:s,handleEdit:n,loading:l=!1})=>{const[u]=I.useForm(),[e,t]=N.exports.useState([]),m=(e==null?void 0:e.length)>0;return a(y,{toolbar:{actions:m?[a(c,{onClick:()=>t([]),icon:a(h,{}),children:"\u53D6\u6D88\u7F16\u8F91"},"cancelEdit"),a(c,{type:"primary",loading:l,icon:a(E,{}),onClick:async()=>{const o=await u.validateFields();await n({columns:Object.keys(o).map(i=>({...o[i],columnId:Number(i)}))}),t([])},children:"\u4FDD\u5B58"},"edit")]:[a(c,{icon:a(g,{}),type:"primary",onClick:()=>{s&&t(s==null?void 0:s.map(o=>{var i,r;return(r=(i=o==null?void 0:o.columnId)==null?void 0:i.toString())!=null?r:""}))},children:"\u7F16\u8F91"},"edit")]},rowKey:"columnId",ghost:!0,size:"small",scroll:{x:"max-content"},columns:[q,J,M,K,Q,z,S,Z,H,U,V,W],value:s,recordCreatorProps:!1,editable:{form:u,editableKeys:e}})},b={BASE_INFO:"\u57FA\u672C\u4FE1\u606F",FIELD_INFO:"\u5B57\u6BB5\u4FE1\u606F"},ce=()=>{var i;const s=T(),n=Number((i=s==null?void 0:s.tableId)!=null?i:"0"),[l,u]=N.exports.useState("BASE_INFO"),{data:e,refresh:t}=se(async()=>await X({tableId:n}),{ready:n>0,refreshDeps:[n]}),{mutateAsync:m,isLoading:o}=ee(async r=>{await Y({tableId:n,businessName:e.info.businessName,functionName:e.info.functionName,className:e.info.className,functionAuthor:e.info.functionAuthor,moduleName:e.info.moduleName,packageName:e.info.packageName,tableComment:e.info.tableComment,tableName:e.info.tableName,columns:e.rows,...r})},{onSuccess:()=>{t(),B.success("\u4FDD\u5B58\u6210\u529F")}});return a(D,{children:F(C,{tabs:{activeKey:l,onChange:r=>{u(r)}},children:[a(C.TabPane,{tab:b.BASE_INFO,children:a(ae,{dataSource:e==null?void 0:e.info,handleEdit:m})},"BASE_INFO"),a(C.TabPane,{tab:b.FIELD_INFO,children:a(ne,{dataSource:e==null?void 0:e.rows,handleEdit:m,loading:o})},"FIELD_INFO")]})})};export{ce as default};
