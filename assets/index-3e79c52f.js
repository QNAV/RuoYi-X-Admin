import{e as W,a as s,r as g,j as u,F as $}from"./jsx-runtime-06f68cbc.js";import{b as z,aE as J,_ as v,bH as j,bI as Z,bJ as ee,bd as te,ck as se,bc as ae,Y as E,aI as oe,be as re,cl as ie,aT as ce,aD as ne,bN as le,bR as de,bf as ue,aU as he,ay as me}from"./index-6fe704bc.js";import{g as pe,k as ge,e as be}from"./index-512b82d5.js";import{b as ye}from"./index-431aa2ed.js";import{b as N,c as A,u as T,a5 as fe,a6 as we,a7 as D,a8 as Pe,a9 as Ae,aa as Te,ab as Ce,ac as Se,ad as Re,ae as Ie,af as ke}from"./react-8fc26eed.js";import{a as F,u as B}from"./utils-75bcec49.js";import{h as xe,n as Me,o as ve,A as L,j as je}from"./index-58ea63b0.js";import{u as f}from"./useRequest-30b64258.js";import{A as C}from"./index-074386b4.js";import{u as S}from"./useMutation-72610ef8.js";import{P as m}from"./index-1e5188af.js";import{P as Ee}from"./index-6f4415e8.js";import{P as I}from"./index-11252502.js";import{P as Ne}from"./index-90b56d94.js";import{P as De}from"./index-be9792c9.js";import{A as y}from"./index-2a88ac4e.js";import{u as Fe}from"./index-66e83bf7.js";import{P as Be}from"./index-cdb1d218.js";import"./utils-1fed7460.js";import"./mutation-2d78eeb5.js";import"./index-b0f3b909.js";var Le=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],Ve=W.forwardRef(function(e,t){var o=e.fieldProps,i=e.unCheckedChildren,r=e.checkedChildren,a=e.proFieldProps,n=z(e,Le);return s(J,v({valueType:"switch",fieldProps:v({unCheckedChildren:i,checkedChildren:r},o),ref:t,valuePropName:"checked",proFieldProps:a,filedConfig:{valuePropName:"checked",ignoreWidth:!0}},n))});const Ue=Ve;globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const k=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomMainTableActions",N(void 0));k.debugLabel="atomMainTableActions";const V=()=>A(k),qe=()=>ye(k),x=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomSelectedDeptId",N(0));x.debugLabel="atomSelectedDeptId";const Oe=()=>A(x),Ke=()=>T(x),R=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomResetPwdModal",F({open:!1}));R.debugLabel="atomResetPwdModal";const Ye=()=>{const e=T(R);return t=>{e({open:!0,record:t})}},Xe=()=>B(R),_e=()=>A(R),w=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomAddOrEditModal",F({open:!1,actionType:"add"}));w.debugLabel="atomAddOrEditModal";const He=()=>{const e=T(w);return()=>{e({open:!0,actionType:"add"})}},Ge=()=>{const e=T(w);return t=>{e({open:!0,actionType:"edit",userId:t})}},Qe=()=>B(w),We=()=>A(w);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const $e=()=>{const{message:e}=C.useApp(),t=g.useRef(),o=V(),{open:i,actionType:r,userId:a}=We(),n=Qe(),l=()=>{var c;r==="edit"&&((c=t.current)==null||c.resetFields()),n()},{valueEnumSysNormalDisable:M,defaultValueSysNormalDisable:P}=pe(),{valueEnumSysUserSex:q,defaultValueSysUserSex:O}=ge(),{data:b}=f(async()=>{const{posts:c,roles:d}=await fe();return{posts:c.reduce((h,p)=>h.set(p.postId,p.postName),new Map),roles:d.reduce((h,p)=>h.set(p.roleId,p.roleName),new Map)}}),{data:K}=f(async()=>{const{data:c}=await we({configKey:"sys.user.initPassword"});return c.msg}),{data:Y}=f(()=>D({deptQuery:{}})),[,X]=g.useTransition();f(async()=>{const{postIds:c,roleIds:d,user:h}=await Pe({userId:a});return{...h,postIds:c,roleIds:d}},{ready:i&&r==="edit"&&!!a,onSuccess:c=>{X(()=>{var d;(d=t.current)==null||d.setFieldsValue(c)})},refreshDeps:[a]});const{isLoading:_,mutateAsync:H}=S(async()=>{var d,h;const c=await((h=(d=t.current)==null?void 0:d.validateFieldsReturnFormatValue)==null?void 0:h.call(d));if(r==="add"){const{roleIds:p=[],postIds:G=[],...Q}=c;await Ae({roleIds:p,postIds:G,...Q})}else await Te({userId:a,...c})},{onSuccess:()=>{var c;n(),o==null||o.reload(),(c=t.current)==null||c.resetFields(),e.success(r==="add"?"新增成功":"编辑成功")}});return u(j,{title:r==="add"?"新增用户":"编辑用户",formRef:t,grid:!0,colProps:{span:12},modalProps:{okText:"提交",onCancel:l,confirmLoading:_},width:600,open:i,onFinish:()=>H(),children:[s(m,{name:"nickName",label:"用户昵称",rules:[{required:!0}]}),s(Ee,{name:"deptId",label:"归属部门",fieldProps:{treeData:Y??[],fieldNames:{value:"id"}}}),s(m,{name:"phoneNumber",label:"手机号码",rules:[{pattern:xe,message:"手机号码格式错误"}],fieldProps:{maxLength:11}}),s(m,{name:"email",label:"邮箱",rules:[{pattern:Me,message:"邮箱格式错误"}]}),r==="add"&&s(m,{name:"userName",label:"用户名称",rules:[{required:!0}]}),r==="add"&&s(m.Password,{name:"password",label:"用户密码",rules:[{required:!0}],initialValue:K}),s(I,{name:"sex",label:"用户性别",valueEnum:q,initialValue:O}),s(Ne.Group,{name:"status",label:"状态",valueEnum:M,initialValue:P,rules:[{required:!0}]}),s(I,{name:"postIds",label:"岗位",valueEnum:(b==null?void 0:b.posts)??{},mode:"multiple",colProps:{span:24}}),s(I,{name:"roleIds",label:"角色",valueEnum:(b==null?void 0:b.roles)??{},mode:"multiple",colProps:{span:24}}),s(De,{name:"remark",label:"备注",colProps:{span:24}})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ze=()=>{const{message:e}=C.useApp(),t=g.useRef(),o=Xe(),{open:i,record:r}=_e();return g.useEffect(()=>{var a;if(i){(a=t.current)==null||a.resetFields();const n=setTimeout(()=>{var l;(l=t.current)==null||l.setFieldsValue({userName:r.userName}),clearTimeout(n)},0)}},[i]),u(j,{title:"重置密码",open:i,formRef:t,modalProps:{onCancel:o},width:500,onFinish:async({password:a})=>{await Ce({...r,password:a}),e.success("重置密码成功")},children:[s(m,{name:"userName",label:"用户名称",readonly:!0}),s(m.Password,{required:!0,name:"password",label:"新密码",rules:[{required:!0,message:"请输入新密码"},{pattern:ve,message:"密码长度应在6-20之间，只能包含字母、数字和下划线"}]}),s(m.Password,{required:!0,name:"confirmPassword",label:"确认密码",rules:[{required:!0,message:"请输入确认密码"},({getFieldsValue:a})=>({validator(n,l){return!l||a().password===l?Promise.resolve():Promise.reject(new Error("两次输入的密码不一致"))}})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Je=()=>{const e=He();return s(y,{accessKey:"system:user:add",children:s(Z,{onClick:e})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ze=({userId:e})=>{const t=Ge();return s(y,{accessKey:"system:user:edit",children:s(ee,{onClick:()=>t(e)})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const et=({searchParams:e})=>{const{message:t}=C.useApp(),{isLoading:o,mutate:i}=S(async()=>{const r=await Se(e,{format:"blob"});await L(r.data,`user_${new Date().getTime()}.xlsx`)},{onSuccess:()=>{t.success("导出成功")}});return s(y,{accessKey:"system:user:export",children:s(te,{loading:o,onClick:()=>i()})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const tt=()=>{const e=g.useRef(),[t,{toggle:o}]=Fe(),{mutate:i,isLoading:r}=S(async()=>{const{data:a}=await Re();await L(a,`user_template_${new Date().getTime()}.xlsx`)});return u(y,{accessKey:"system:user:import",children:[s(se,{onClick:o}),u(ae,{title:"导入用户",open:t,onCancel:o,children:[s("div",{className:"text-right",children:s(E,{type:"link",onClick:()=>i(),loading:r,children:"下载模板"})}),u(oe,{layout:"horizontal",submitter:!1,formRef:e,children:[s(Ue,{name:"isCover",label:"是否更新已经存在的用户数据"}),s(Be,{name:"list"})]})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const U=({userIds:e,batch:t,disabled:o})=>{const{message:i,modal:r}=C.useApp(),a=V(),{mutate:n,isLoading:l}=S(Ie,{onSuccess:()=>{var P;a==null||a.reload(),(P=a==null?void 0:a.clearSelected)==null||P.call(a),i.success("删除成功")}});return s(y,{accessKey:"system:user:remove",children:s(re,{batch:t,disabled:o,onClick:()=>{r.confirm({title:"删除用户",content:`确定删除用户编号为 ${e.join(",")} 的数据吗？`,onOk:()=>n({userIds:e}),okButtonProps:{loading:l}})}})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const st=({record:e})=>{const t=Ye();return s(y,{accessKey:"system:user:resetPwd",children:s(E,{type:"link",danger:!0,icon:s(ie,{}),onClick:()=>t(e),children:"重置密码"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const at=()=>{const[e,t]=g.useState(""),o=Ke(),{data:i,loading:r}=f(()=>D({deptQuery:{deptName:e}}),{refreshDeps:[e],debounceWait:500});return u(ce,{spinning:r,children:[s(ne.Search,{allowClear:!0,placeholder:"请输入部门名称",className:"mb-3",onSearch:a=>{t(a)}}),!i||i.length===0?s(le,{}):s(de,{treeData:i,defaultExpandAll:!0,fieldNames:{title:"label",key:"id"},onSelect:(a,{node:{key:n}})=>{o(n)},blockNode:!0})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ot=()=>{const{data:e}=be("sys_normal_disable");return[{dataIndex:"userId",key:"userId",title:"用户编号",valueType:"text",hideInSearch:!0},{dataIndex:"userName",key:"userName",title:"用户名称",valueType:"text"},{dataIndex:"nickName",key:"nickName",title:"用户昵称",valueType:"text",hideInSearch:!0},{dataIndex:["dept","deptName"],key:"deptDeptName",title:"部门名称",valueType:"text",hideInSearch:!0},{dataIndex:"phoneNumber",key:"phoneNumber",title:"手机号码",valueType:"text",copyable:!0},{title:"状态",dataIndex:"status",key:"status",valueType:"select",valueEnum:(e==null?void 0:e.valueEnum)??{}},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",hideInSearch:!0,sorter:!0},{title:"操作",valueType:"option",render:(t,o)=>o.userId===1?null:u($,{children:[s(Ze,{userId:o.userId}),s(U,{userIds:[o.userId]}),s(st,{record:o})]}),fixed:"right",width:300},{title:"创建时间",dataIndex:"createTimeRange",key:"createTimeRange",valueType:"dateTimeRange",hideInTable:!0}]},rt=({selectedRows:e})=>s(U,{disabled:e.length===0,batch:!0,userIds:e.map(t=>t.userId)}),it=(e,t)=>u("div",{className:"flex gap-4",children:[s(he,{className:"w-80",children:s(at,{})}),s("div",{className:"overflow-auto w-full",children:t})]}),ct=()=>{const e=qe(),[t,o]=g.useState({}),i=ot(),r=Oe(),a=r>0?{deptId:r}:{};return s(ue,{rowKey:"userId",actionRef:e,columns:i,params:a,request:async(...n)=>{const l=je(...n);return o(l),await ke(l)},toolbar:{actions:[s(et,{searchParams:t},"ButtonExport"),s(tt,{},"ButtonImport"),s(Je,{},"ButtonAdd")]},tableRender:it,tableAlertOptionRender:rt})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Mt=()=>u(me,{children:[s(ct,{}),s($e,{}),s(ze,{})]});export{Mt as default};
