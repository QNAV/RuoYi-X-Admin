import"./keepAlive.9d779ec7.js";import{i as Q}from"./initialState.89f510bf.js";import{ao as $,r as C,_ as R,l as G,g as u,a,j as r,m as O,n as A,aS as V,C as _,aT as D,aU as J,aV as X,a1 as Y,y as H,aW as Z,F as U,aX as ee,aY as M,aZ as re,a_ as te,a$ as ae,b0 as ie,b1 as se,b2 as j}from"./index.4a7583d0.js";import{c as W,F as ne,I as ue,P as z,r as q,C as oe,a as le,D as ce,b as de}from"./index.1dd6cd73.js";import{r as me}from"./regExp.b11de8ba.js";import{u as pe}from"./useRequest.89fb4399.js";import{B as fe,T as ge}from"./index.4fe5dc19.js";import{P as L}from"./index.cb224c53.js";import{P as he}from"./index.07882f96.js";import{S as ve}from"./Skeleton.fa8c4d67.js";/* empty css              */import"./useQuery.esm.7a058e2a.js";import"./utils.esm.85bc56f4.js";import"./PortalWrapper.7f9fd477.js";var Fe=["rules","name","phoneName","fieldProps","captchaTextRender","captchaProps"],be=$.forwardRef(function(e,o){var m=ne.useFormInstance(),g=C.exports.useState(e.countDown||60),d=R(g,2),t=d[0],h=d[1],v=C.exports.useState(!1),x=R(v,2),F=x[0],b=x[1],i=C.exports.useState(),s=R(i,2),c=s[0],T=s[1];e.rules,e.name;var k=e.phoneName,S=e.fieldProps,n=e.captchaTextRender,w=n===void 0?function(p,B){return p?"".concat(B," \u79D2\u540E\u91CD\u65B0\u83B7\u53D6"):"\u83B7\u53D6\u9A8C\u8BC1\u7801"}:n,N=e.captchaProps,P=G(e,Fe),y=function(){var p=O(A().mark(function B(E){return A().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.prev=0,T(!0),f.next=4,P.onGetCaptcha(E);case 4:T(!1),b(!0),f.next=13;break;case 8:f.prev=8,f.t0=f.catch(0),b(!1),T(!1),console.log(f.t0);case 13:case"end":return f.stop()}},B,null,[[0,8]])}));return function(E){return p.apply(this,arguments)}}();return C.exports.useImperativeHandle(o,function(){return{startTiming:function(){return b(!0)},endTiming:function(){return b(!1)}}}),C.exports.useEffect(function(){var p=0,B=e.countDown;return F&&(p=window.setInterval(function(){h(function(E){return E<=1?(b(!1),clearInterval(p),B||60):E-1})},1e3)),function(){return clearInterval(p)}},[F]),u("div",{style:a(a({},S==null?void 0:S.style),{},{display:"flex",alignItems:"center"}),ref:o,children:[r(ue,a(a({},S),{},{style:{flex:1,transition:"width .3s",marginRight:8}})),r(fe,a(a({style:{display:"block"},disabled:F,loading:c},N),{},{onClick:function(){var p=O(A().mark(function E(){var I;return A().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(l.prev=0,!k){l.next=9;break}return l.next=4,m.validateFields([k].flat(1));case 4:return I=m.getFieldValue([k].flat(1)),l.next=7,y(I);case 7:l.next=11;break;case 9:return l.next=11,y("");case 11:l.next=16;break;case 13:l.prev=13,l.t0=l.catch(0),console.log(l.t0);case 16:case"end":return l.stop()}},E,null,[[0,13]])}));function B(){return p.apply(this,arguments)}return B}(),children:w(F,t)}))]})}),Ce=W(be);const Pe=Ce;var ye=["options","fieldProps","proFieldProps","valueEnum"],Be=$.forwardRef(function(e,o){var m=e.options,g=e.fieldProps,d=e.proFieldProps,t=e.valueEnum,h=G(e,ye);return r(z,a({ref:o,valueType:"checkbox",valueEnum:q(t,void 0),fieldProps:a({options:m},g),lightProps:a({labelFormatter:function(){return r(z,a({ref:o,valueType:"checkbox",mode:"read",valueEnum:q(t,void 0),filedConfig:{customLightMode:!0},fieldProps:a({options:m},g),proFieldProps:d},h))}},h.lightProps),proFieldProps:d},h))}),xe=$.forwardRef(function(e,o){var m=e.fieldProps,g=e.children;return r(oe,a(a({ref:o},m),{},{children:g}))}),Se=W(xe,{valuePropName:"checked"}),K=Se;K.Group=Be;const Ee=K;var Te=["logo","message","style","activityConfig","backgroundImageUrl","title","subTitle","actions","children"];function ke(e){var o=e.logo,m=e.message,g=e.style,d=e.activityConfig,t=d===void 0?{}:d,h=e.backgroundImageUrl,v=e.title,x=e.subTitle,F=e.actions,b=e.children,i=G(e,Te),s=V(),c=function(){var P,y;return i.submitter===!1||((P=i.submitter)===null||P===void 0?void 0:P.submitButtonProps)===!1?!1:a({size:"large",style:{width:"100%"}},(y=i.submitter)===null||y===void 0?void 0:y.submitButtonProps)},T=a(a({searchConfig:{submitText:s.getMessage("loginForm.submitText","\u767B\u5F55")},render:function(P,y){return y.pop()}},i.submitter),{},{submitButtonProps:c()}),k=C.exports.useContext(_.ConfigContext),S=k.getPrefixCls("pro-form-login-page"),n=function(P){return"".concat(S,"-").concat(P)},w=C.exports.useMemo(function(){return o?typeof o=="string"?r("img",{src:o}):o:null},[o]);return u("div",{className:S,style:a(a({},g),{},{backgroundImage:'url("'.concat(h,'")')}),children:[r("div",{className:n("notice"),children:t&&u("div",{className:n("notice-activity"),style:t.style,children:[t.title&&u("div",{className:n("notice-activity-title"),children:[" ",t.title," "]}),t.subTitle&&u("div",{className:n("notice-activity-subTitle"),children:[" ",t.subTitle," "]}),t.action&&u("div",{className:n("notice-activity-action"),children:[" ",t.action," "]})]})}),u("div",{className:n("container"),children:[u("div",{className:n("top"),children:[v||w?u("div",{className:n("header"),children:[w?r("span",{className:n("logo"),children:w}):null,v?r("span",{className:n("title"),children:v}):null]}):null,x?r("div",{className:n("desc"),children:x}):null]}),u("div",{className:n("main"),children:[u(le,a(a({isKeyPressSubmit:!0},i),{},{submitter:T,children:[m,b]})),F?r("div",{className:n("other"),children:F}):null]})]})]})}const we=()=>u("div",{className:"flex flex-col justify-center items-center",children:[r(ce,{plain:!0,children:r("span",{className:"text-sm font-normal text-neutral-400",children:"\u5176\u4ED6\u767B\u5F55\u65B9\u5F0F"})}),r("div",{onClick:()=>{D.info("\u656C\u8BF7\u671F\u5F85")},className:"flex justify-center items-center cursor-pointer rounded-full h-[40px] w-[40px] border-solid border border-gray-300",children:r(J,{style:{fontSize:"20px",color:"#00ac84"}})})]});async function Ne(e){return X("/captchaImage",{method:"GET",...e||{}})}const Ae=[{label:"\u8D26\u53F7\u5BC6\u7801\u767B\u5F55",key:"USERNAME"},{label:"\u624B\u673A\u53F7\u767B\u5F55",key:"MOBILE"}],Qe=()=>{const[e,o]=C.exports.useState("USERNAME"),m=Y(),g=H(),[d]=Z(),{data:t,run:h}=pe(Ne),v=async(i,s)=>{var c;se(i?j.LOCAL_STORAGE:j.SESSION_STORAGE,`Bearer ${s}`),await m.invalidateQueries(Q),g((c=d.get("redirect"))!=null?c:"/")},x=async(i,s)=>{const{token:c}=await ae(s);await v(i,c)},F=async(i,s)=>{if(!t){D.error("\u8BF7\u5148\u83B7\u53D6\u56FE\u7247\u9A8C\u8BC1\u7801");return}const{token:c}=await ie({...s,uuid:t.uuid});await v(i,c)},b=async i=>{try{const{autoLogin:s,...c}=i;if(e==="MOBILE"){await x(s,c);return}if(e==="USERNAME"){await F(s,c);return}}catch{e==="USERNAME"&&h()}};return C.exports.useEffect(()=>{d.get("msg")&&D.error(d.get("msg"))},[]),r("div",{className:"h-[100vh]",children:u(ke,{backgroundImageUrl:"https://gw.alipayobjects.com/zos/rmsportal/FfdJeJRQWjEeGTpqgBKj.png",logo:"https://github.githubassets.com/images/modules/logos_page/Octocat.png",title:"RuoYi X Umi",subTitle:"\u82E5\u4F9D\u540E\u53F0\u7BA1\u7406\u7CFB\u7EDF",actions:r(we,{}),onFinish:b,children:[r(ge,{centered:!0,activeKey:e,onChange:i=>o(i),items:Ae}),e==="USERNAME"&&u(U,{children:[r(L,{name:"username",fieldProps:{size:"large",prefix:r(ee,{})},placeholder:"admin",initialValue:"admin",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"}]}),r(L.Password,{name:"password",fieldProps:{size:"large",prefix:r(M,{})},placeholder:"admin123",initialValue:"admin123",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801"}]}),u(he,{children:[r(L,{width:160,name:"code",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",fieldProps:{size:"large",prefix:r(re,{})},rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801"}]}),r("div",{className:"h-[40px] w-[135px] cursor-pointer border border-solid border-gray-300",children:t!=null&&t.img?r(de,{src:`data:image/png;base64,${t==null?void 0:t.img}`,preview:!1,height:40,width:135,alt:"\u56FE\u7247\u9A8C\u8BC1\u7801",onClick:h}):r(ve.Button,{active:!0,block:!0,size:"large"})})]})]}),e==="MOBILE"&&u(U,{children:[r(L,{fieldProps:{maxLength:11,size:"large",prefix:r(te,{})},name:"phoneNumber",placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7"},{pattern:me,message:"\u624B\u673A\u53F7\u683C\u5F0F\u9519\u8BEF"}]}),r(Pe,{fieldProps:{size:"large",prefix:r(M,{})},captchaProps:{size:"large"},placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",captchaTextRender:(i,s)=>i?`${s} \u83B7\u53D6\u9A8C\u8BC1\u7801`:"\u83B7\u53D6\u9A8C\u8BC1\u7801",name:"smsCode",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801"}],onGetCaptcha:async()=>(D.info("\u656C\u8BF7\u671F\u5F85"),Promise.reject(new Error("\u656C\u8BF7\u671F\u5F85")))})]}),r(Ee,{name:"autoLogin",children:"\u81EA\u52A8\u767B\u5F55"})]})})};export{Qe as default};
