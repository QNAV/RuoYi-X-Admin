import{e as Y,a as H,j as a,P as $,d as J,X as U,aj as Z,av as R,aw as j,ax as k,r as f,ay as E,a4 as x,b as i,Y as L,ao as _,$ as q,o as ee,p as N,az as te,a1 as ae,q as A,aA as se,aB as re,aC as oe,aD as le,F as ne,aE as M,N as B,D as w,aF as ce,f as ie,aG as de,aH as ue,aI as pe,aJ as me,aK as he,B as ge,O as T}from"./index-b4f947db.js";import{a as ye,u as fe}from"./utils-ca7c5bb3.js";import{u as De}from"./index-ea5b889e.js";import{u as O}from"./useMutation-343b08de.js";import{P as Pe}from"./index-1b56c351.js";import{P as y}from"./index-30b27df1.js";import{P as be}from"./index-a369b695.js";import{u as Se}from"./useRequest-71d7981b.js";import{P as I}from"./index-d2bfc0cb.js";import{P as Te}from"./index-425b959c.js";import{T as C}from"./index-3d0e2d35.js";var Ie=["fieldProps","request","params","proFieldProps"],ve=function(t,r){var l=t.fieldProps,n=t.request,s=t.params,o=t.proFieldProps,p=H(t,Ie);return a($,J({valueType:"treeSelect",fieldProps:l,ref:r,request:n,params:s,filedConfig:{customLightMode:!0},proFieldProps:o},p))},xe=Y.forwardRef(ve);const Ne=xe;globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Q="systemDept",b=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/dept/model/index.ts/atomDeptDetails",ye({open:!1,deptId:0,deptName:""}));b.debugLabel="atomDeptDetails";const K=()=>U(b),Ae=()=>{const e=Z(b);return(t,r)=>{e({open:!0,deptId:t,deptName:r})}},Fe=()=>fe(b),V=[Q,"list"],we=(e,t)=>{const r=R(V,async()=>{const l=await j(e);return{treeData:k(l,{id:"deptId",pId:"parentId",rootPId:null}),map:l.reduce((s,o)=>s.set(o.deptId,o),new Map),allParentIds:Array.from(l.reduce((s,o)=>s.add(o.parentId),new Set))}},{onSuccess:l=>{t.onSuccess(l.allParentIds)}});return f.useEffect(()=>{r.refetch()},[e]),r},W=()=>{const e=E();return()=>e.invalidateQueries(V)},z=[Q,"options"],G=()=>R(z,async()=>{const e=await j({});return k(e,{id:"deptId",pId:"parentId",rootPId:null})}),X=()=>{const e=E();return()=>e.invalidateQueries(z)};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ce=()=>{const e=f.useRef(),[t,{toggle:r}]=De(),{data:l,refetch:n}=G(),{defaultValueSysNormalDisable:s,valueEnumSysNormalDisable:o}=x(),{mutate:p,isLoading:m}=O(async()=>{var u;const d=await((u=e.current)==null?void 0:u.validateFields());await te(d)},{onSuccess:async()=>{var d;r(),(d=e.current)==null||d.resetFields(),n(),N.success("新增成功")}});return i(L,{accessKey:"system:dept:add",children:[a(_,{onClick:r}),a(q,{title:"新增部门",okText:"提交",open:t,onCancel:r,onOk:()=>p(),okButtonProps:{loading:m},children:i(ee,{submitter:!1,formRef:e,grid:!0,rowProps:{gutter:[16,0]},children:[a(Ne,{name:"parentId",label:"上级部门",rules:[{required:!0,message:"请选择上级部门"}],fieldProps:{treeData:l??[],fieldNames:{label:"deptName",value:"deptId"}}}),a(y,{name:"deptName",label:"部门名称",rules:[{required:!0}],colProps:{span:12}}),a(Pe,{name:"orderNum",label:"显示排序",initialValue:0,rules:[{required:!0}],colProps:{span:12}}),a(y,{name:"leader",label:"负责人",colProps:{span:12}}),a(y,{name:"phone",label:"联系电话",colProps:{span:12}}),a(y,{name:"email",label:"邮箱",colProps:{span:12}}),a(be.Group,{name:"status",label:"状态",valueEnum:o,initialValue:s,colProps:{span:12}})]})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Re=()=>{const{deptId:e,deptName:t,open:r}=K(),l=Fe(),n=W(),s=X();return a(L,{accessKey:"system:dept:remove",children:a(ae,{disabled:!r,type:"primary",size:"middle",onClick:()=>{q.confirm({title:"删除确认",content:i(A,{children:["确定删除部门",a(se.Text,{code:!0,children:t}),"吗？"]}),onOk:async()=>{await re({deptId:e}),await Promise.all([l(),n(),s()]),N.success("删除成功")}})}})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const v={xs:1,sm:1,md:1,lg:1,xl:2},je=()=>{const e=W(),t=X(),{deptId:r,open:l}=K(),{data:n}=G(),{valueEnumSysNormalDisable:s}=x(),{data:o,loading:p,refresh:m}=Se(async()=>{const{ancestors:c,...h}=await oe({deptId:r}),g=(c==null?void 0:c.split(","))??[];return{...h,ancestors:Number(g[g.length-1])}},{ready:l&&r>0,refreshDeps:[r],onSuccess:()=>{F([])}}),{mutateAsync:d}=O(ce,{onSuccess:async()=>{m(),await Promise.all([e(),t()]),N.success("保存成功")}}),u=le(),[D]=ne.useForm(),[P,F]=f.useState([]),S=u("system:dept:edit")?{form:D,editableKeys:P,onChange:(c,h)=>{if(F(c),c.length>0){const[g]=c;D.setFieldsValue({[g]:h[g]})}},onSave:async(c,h)=>{await d({deptId:r,deptName:o.deptName,orderNum:o.orderNum,parentId:o.parentId,[c]:h[c]})}}:void 0;return l?i(B,{spinning:p,children:[a(I,{column:v,editable:S,dataSource:o,columns:[{title:"状态",dataIndex:"status",key:"status",valueType:"select",valueEnum:s},{title:"排序",dataIndex:"orderNum",key:"orderNum",valueType:"digit"},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",editable:!1}]}),a(w,{}),a(I,{column:v,editable:S,dataSource:o,columns:[{title:"部门名称",dataIndex:"deptName",key:"deptName",valueType:"text"},{title:"上级部门",dataIndex:"parentId",key:"parentId",valueType:"treeSelect",fieldProps:{treeData:n,dropdownMatchSelectWidth:250,fieldNames:{label:"deptName",value:"deptId"}}}]}),a(w,{}),a(I,{column:v,editable:S,dataSource:o,columns:[{title:"负责人",dataIndex:"leader",key:"leader",valueType:"text"},{title:"联系电话",dataIndex:"phone",key:"phone",valueType:"text"},{title:"邮箱",dataIndex:"email",key:"email",valueType:"text"}]})]}):a(M,{description:"点击选择左侧部门项查看详情"})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ke=e=>i(A,{children:[a(C,{color:"rgb(148 163 184)",children:e.orderNum}),i(he,{children:[e.deptName,a(C,{color:e.status==="NORMAL"?"success":"error",children:e.status==="NORMAL"?"启用中":"已禁用"})]})]}),Ee=()=>{var d;const[e,t]=f.useState([]),[r,l]=f.useState({}),{valueEnumSysNormalDisable:n}=x(),{data:s,isFetching:o}=we(r,{onSuccess:u=>{t(u)}}),p=Ae(),m=(e==null?void 0:e.length)!==0&&(e==null?void 0:e.length)===((d=s==null?void 0:s.allParentIds)==null?void 0:d.length);return i(A,{children:[i("div",{className:"flex justify-between items-center",children:[a(ie,{size:"small",className:"my-2",icon:m?a(de,{}):a(ue,{}),onClick:()=>t(m?[]:s==null?void 0:s.allParentIds),children:m?"全部折叠":"全部展开"}),i(pe,{onFinish:async u=>l(u),children:[a(y,{name:"deptName",label:"部门名称"}),a(Te,{name:"status",label:"状态",valueEnum:n})]})]}),a(B,{spinning:o,children:s!=null&&s.treeData.length?a(me,{blockNode:!0,showLine:{showLeafIcon:!1},titleRender:ke,treeData:s.treeData,expandedKeys:e,onExpand:t,height:700,fieldNames:{title:"deptName",key:"deptId"},onSelect:(u,{selected:D,node:{key:P}})=>{D&&p(P,s.map.get(P).deptName)}}):a(M,{})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Xe=()=>a(ge,{children:i(T,{ghost:!0,gutter:[16,16],wrap:!0,children:[a(T,{title:"部门列表",colSpan:{xxl:8,xl:12,lg:14,md:24,sm:24,xs:24},extra:a(Ce,{}),children:a(Ee,{})}),a(T,{title:"部门详情",colSpan:{xxl:16,xl:12,lg:10,md:24,sm:24,xs:24},className:"h-full",extra:a(Re,{}),children:a(je,{})})]})});export{Xe as default};
