import{j as t,t as Y,u as z,g as y,v as G,w as H,o as b,C as _,x as U,y as Z,p as A}from"./antdProComponents-d97761a4.js";import{h as $,F as J,Q as w,R as C,T as F,U as R,V as N,A as k,L as ee,W as te,l as se,X as ae,Y as oe,Z as re,_ as E,$ as ne,B as ce}from"./index-7df8d6db.js";import{r as j,b6 as S,aE as le,N as ie,I as ue,af as L,aH as T,B as de,b4 as pe,aX as he,b8 as v,ae as me}from"./antd-79b0e736.js";import{a as xe,u as ge}from"./utils-6d3e551f.js";import{u as ye}from"./index-371e4e07.js";import{u as B}from"./useMutation-6894a2eb.js";import{u as je}from"./useRequest-6b8c6b76.js";import"./iconPark-31f72c99.js";import"./wangEditor-f0c73729.js";import"./tslib.es6-59680bf8.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const M="systemDept",D=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/dept/model/index.ts/atomDeptDetails",xe({open:!1,deptId:0,deptName:""}));D.debugLabel="atomDeptDetails";const O=()=>$(D),De=()=>{const e=J(D);return(s,r)=>{e({open:!0,deptId:s,deptName:r})}},fe=()=>ge(D),q=[M,"list"],be=(e,s)=>{const r=w(q,async()=>{const o=await C(e);return{treeData:F(o,{id:"deptId",pId:"parentId",rootPId:null}),map:o.reduce((a,n)=>a.set(n.deptId,n),new Map),allParentIds:Array.from(o.reduce((a,n)=>a.add(n.parentId),new Set))}},{onSuccess:o=>{s.onSuccess(o.allParentIds)}});return j.useEffect(()=>{r.refetch()},[e]),r},Q=()=>{const e=R();return()=>e.invalidateQueries(q)},V=[M,"options"],K=()=>w(V,async()=>{const e=await C({});return F(e,{id:"deptId",pId:"parentId",rootPId:null})}),W=()=>{const e=R();return()=>e.invalidateQueries(V)};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const Ae=()=>{const{message:e}=S.useApp(),s=j.useRef(),[r,{toggle:o}]=ye(),{data:u,refetch:a}=K(),{defaultValueSysNormalDisable:n,valueEnumSysNormalDisable:c}=N(),{mutate:d,isLoading:p}=B(async()=>{var h;const l=await((h=s.current)==null?void 0:h.validateFields());await te(l)},{onSuccess:async()=>{var l;o(),(l=s.current)==null||l.resetFields(),a(),e.success("新增成功")}});return t.jsxs(k,{accessKey:"system:dept:add",children:[t.jsx(ee,{onClick:o}),t.jsx(le,{title:"新增部门",okText:"提交",open:r,onCancel:o,onOk:()=>d(),okButtonProps:{loading:p},children:t.jsxs(Y,{submitter:!1,formRef:s,grid:!0,rowProps:{gutter:[16,0]},children:[t.jsx(z,{name:"parentId",label:"上级部门",rules:[{required:!0,message:"请选择上级部门"}],fieldProps:{treeData:u??[],fieldNames:{label:"deptName",value:"deptId"}}}),t.jsx(y,{name:"deptName",label:"部门名称",rules:[{required:!0}],colProps:{span:12}}),t.jsx(G,{name:"orderNum",label:"显示排序",initialValue:0,rules:[{required:!0}],colProps:{span:12}}),t.jsx(y,{name:"leader",label:"负责人",colProps:{span:12}}),t.jsx(y,{name:"phone",label:"联系电话",colProps:{span:12}}),t.jsx(y,{name:"email",label:"邮箱",colProps:{span:12}}),t.jsx(H.Group,{name:"status",label:"状态",valueEnum:c,initialValue:n,colProps:{span:12}})]})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const Ie=()=>{const{deptId:e,deptName:s,open:r}=O(),o=fe(),u=Q(),a=W(),{message:n,modal:c}=S.useApp(),d=()=>{c.confirm({title:"删除确认",content:t.jsxs(t.Fragment,{children:["确定删除部门",t.jsx(ie.Text,{code:!0,children:s}),"吗？"]}),onOk:async()=>{await ae({deptId:e}),await Promise.all([o(),u(),a()]),n.success("删除成功")}})};return t.jsx(k,{accessKey:"system:dept:remove",children:t.jsx(se,{disabled:!r,type:"primary",size:"middle",onClick:d})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const I={xs:1,sm:1,md:1,lg:1,xl:2},Ne=()=>{const e=Q(),s=W(),{message:r}=S.useApp(),{deptId:o,open:u}=O(),{data:a}=K(),{valueEnumSysNormalDisable:n}=N(),{data:c,loading:d,refresh:p}=je(async()=>{const{ancestors:i,...x}=await oe({deptId:o}),g=(i==null?void 0:i.split(","))??[];return{...x,ancestors:Number(g[g.length-1])}},{ready:u&&o>0,refreshDeps:[o],onSuccess:()=>{P([])}}),{mutateAsync:l}=B(ne,{onSuccess:async()=>{p(),await Promise.all([e(),s()]),r.success("保存成功")}}),h=re(),[m]=ue.useForm(),[X,P]=j.useState([]),f=h("system:dept:edit")?{form:m,editableKeys:X,onChange:(i,x)=>{if(P(i),i.length>0){const[g]=i;m.setFieldsValue({[g]:x[g]})}},onSave:async(i,x)=>{await l({deptId:o,deptName:c.deptName,orderNum:c.orderNum,parentId:c.parentId,[i]:x[i]})}}:void 0;return u?t.jsxs(L,{spinning:d,children:[t.jsx(b,{column:I,editable:f,dataSource:c,columns:[{title:"状态",dataIndex:"status",key:"status",valueType:"select",valueEnum:n},{title:"排序",dataIndex:"orderNum",key:"orderNum",valueType:"digit"},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",editable:!1}]}),t.jsx(T,{}),t.jsx(b,{column:I,editable:f,dataSource:c,columns:[{title:"部门名称",dataIndex:"deptName",key:"deptName",valueType:"text"},{title:"上级部门",dataIndex:"parentId",key:"parentId",valueType:"treeSelect",fieldProps:{treeData:a,dropdownMatchSelectWidth:250,fieldNames:{label:"deptName",value:"deptId"}}}]}),t.jsx(T,{}),t.jsx(b,{column:I,editable:f,dataSource:c,columns:[{title:"负责人",dataIndex:"leader",key:"leader",valueType:"text"},{title:"联系电话",dataIndex:"phone",key:"phone",valueType:"text"},{title:"邮箱",dataIndex:"email",key:"email",valueType:"text"}]})]}):t.jsx(E,{description:"点击选择左侧部门项查看详情"})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const Se=e=>t.jsxs(t.Fragment,{children:[t.jsx(v,{color:"rgb(148 163 184)",children:e.orderNum}),t.jsxs(me,{children:[e.deptName,t.jsx(v,{color:e.status==="NORMAL"?"success":"error",children:e.status==="NORMAL"?"启用中":"已禁用"})]})]}),Pe=()=>{var p;const[e,s]=j.useState([]),[r,o]=j.useState({}),{valueEnumSysNormalDisable:u}=N(),{data:a,isFetching:n}=be(r,{onSuccess:l=>{s(l)}}),c=De(),d=(e==null?void 0:e.length)!==0&&(e==null?void 0:e.length)===((p=a==null?void 0:a.allParentIds)==null?void 0:p.length);return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx(de,{size:"small",className:"my-2",icon:d?t.jsx(pe,{}):t.jsx(_,{}),onClick:()=>s(d?[]:a==null?void 0:a.allParentIds),children:d?"全部折叠":"全部展开"}),t.jsxs(U,{onFinish:async l=>o(l),children:[t.jsx(y,{name:"deptName",label:"部门名称"}),t.jsx(Z,{name:"status",label:"状态",valueEnum:u})]})]}),t.jsx(L,{spinning:n,children:a!=null&&a.treeData.length?t.jsx(he,{blockNode:!0,showLine:{showLeafIcon:!1},titleRender:Se,treeData:a.treeData,expandedKeys:e,onExpand:s,height:700,fieldNames:{title:"deptName",key:"deptId"},onSelect:(l,{selected:h,node:{key:m}})=>{h&&c(m,a.map.get(m).deptName)}}):t.jsx(E,{})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const Me=()=>t.jsx(ce,{children:t.jsxs(A,{ghost:!0,gutter:[16,16],wrap:!0,children:[t.jsx(A,{title:"部门列表",colSpan:{xxl:8,xl:12,lg:14,md:24,sm:24,xs:24},extra:t.jsx(Ae,{}),children:t.jsx(Pe,{})}),t.jsx(A,{title:"部门详情",colSpan:{xxl:16,xl:12,lg:10,md:24,sm:24,xs:24},className:"h-full",extra:t.jsx(Ie,{}),children:t.jsx(Ne,{})})]})});export{Me as default};
