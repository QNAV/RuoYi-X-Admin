import{j as F,F as N,a,b0 as b,aB as f,bb as I,r as p,bG as y,at as c,bH as h,bI as E,bp as g,bJ as B,b1 as C,aC as T}from"./index.80762a21.js";import{B as D}from"./index.7af2a90e.js";import{c as P}from"./common.05077553.js";import{C as O,a as w,b as G,c as k,d as v,e as A,f as x,g as _,h as j,i as L,j as R,k as q,l as J,m as K,n as M,o as Q,p as z,q as H,r as S,s as Z,t as U,u as V,v as W,G as X,w as Y}from"./GenService.90b52b6a.js";import{G as $,u as ee}from"./useMutation.esm.ac983421.js";import{u as se}from"./useRequest.31d7be24.js";import"./utils.esm.812ffd2f.js";const ae=({dataSource:s,handleEdit:n})=>{const l={onSave:async(u,e)=>{const t=u;await n({[t]:e[t]})}};return F(N,{children:[a(b,{dataSource:s,columns:[O,w,G,k,P],editable:l}),a(f,{}),a(b,{columns:[v,A,x,_,j,L,...(s==null?void 0:s.genType)===$.ZIP?[]:[R]],dataSource:s,editable:l})]})},ne=({dataSource:s,handleEdit:n,loading:l=!1})=>{const[u]=I.useForm(),[e,t]=p.exports.useState([]),m=(e==null?void 0:e.length)>0;return a(y,{toolbar:{actions:m?[a(c,{onClick:()=>t([]),icon:a(h,{}),children:"\u53D6\u6D88\u7F16\u8F91"},"cancelEdit"),a(c,{type:"primary",loading:l,icon:a(E,{}),onClick:async()=>{const o=await u.validateFields();await n({columns:Object.keys(o).map(i=>({...o[i],columnId:Number(i)}))}),t([])},children:"\u4FDD\u5B58"},"edit")]:[a(c,{icon:a(g,{}),type:"primary",onClick:()=>{s&&t(s==null?void 0:s.map(o=>{var i,r;return(r=(i=o==null?void 0:o.columnId)==null?void 0:i.toString())!=null?r:""}))},children:"\u7F16\u8F91"},"edit")]},rowKey:"columnId",ghost:!0,size:"small",scroll:{x:"max-content"},columns:[q,J,K,M,Q,z,H,S,Z,U,V,W],value:s,recordCreatorProps:!1,editable:{form:u,editableKeys:e}})},d={BASE_INFO:"\u57FA\u672C\u4FE1\u606F",FIELD_INFO:"\u5B57\u6BB5\u4FE1\u606F"},ce=()=>{var i;const s=B(),n=Number((i=s==null?void 0:s.tableId)!=null?i:"0"),[l,u]=p.exports.useState("BASE_INFO"),{data:e,refresh:t}=se(async()=>await X({tableId:n}),{ready:n>0,refreshDeps:[n]}),{mutateAsync:m,isLoading:o}=ee(async r=>{await Y({tableId:n,businessName:e.info.businessName,functionName:e.info.functionName,className:e.info.className,functionAuthor:e.info.functionAuthor,moduleName:e.info.moduleName,packageName:e.info.packageName,tableComment:e.info.tableComment,tableName:e.info.tableName,columns:e.rows,...r})},{onSuccess:()=>{t(),T.success("\u4FDD\u5B58\u6210\u529F")}});return a(D,{children:F(C,{tabs:{activeKey:l,onChange:r=>{u(r)}},children:[a(C.TabPane,{tab:d.BASE_INFO,children:a(ae,{dataSource:e==null?void 0:e.info,handleEdit:m})},"BASE_INFO"),a(C.TabPane,{tab:d.FIELD_INFO,children:a(ne,{dataSource:e==null?void 0:e.rows,handleEdit:m,loading:o})},"FIELD_INFO")]})})};export{ce as default};
