import{aY as X,aj as _,ce as k,cf as R,cg as E,r as f,am as L,ch as N,j as l,b$ as B,d as t,c3 as $,a_ as M,aF as J,aH as v,ci as U,ca as Z,h as A,cj as ee,ck as te,cl as ae,ay as se,cm as q,cn as O,aG as F,co as oe,aA as re,cp as ce,cq as ne,cr as le,cs as ie,v as de,av as ue,bi as I}from"./index-9ee3b490.js";import{a as pe,u as me}from"./utils-12f1ec3e.js";import{u as he}from"./index-ef9f30f8.js";import{u as Q}from"./useMutation.esm-bb7a6502.js";import{P as ge}from"./index-bcf1509d.js";import{P as ye}from"./index-cd7d5dd5.js";import{P as y}from"./index-4863e599.js";import{P as fe}from"./index-8ce6e771.js";import{b as De}from"./index-ff1f025a.js";import{u as be}from"./useRequest-523d255d.js";import{P as S}from"./index-1ae16b76.js";import{P as Pe}from"./index-38e6eed2.js";import{T as j}from"./index-fb43524f.js";import"./Skeleton-e9bd9189.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const V="systemDept",P=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/dept/model/index.ts/atomDeptDetails",pe({open:!1,deptId:0,deptName:""}));P.debugLabel="atomDeptDetails";const K=()=>X(P),xe=()=>{const e=_(P);return(a,o)=>{e({open:!0,deptId:a,deptName:o})}},Ie=()=>me(P),G=[V,"list"],Se=(e,a)=>{const o=k(G,async()=>{const r=await R(e);return{treeData:E(r,{id:"deptId",pId:"parentId",rootPId:null}),map:r.reduce((s,c)=>s.set(c.deptId,c),new Map),allParentIds:Array.from(r.reduce((s,c)=>s.add(c.parentId),new Set))}},{onSuccess:r=>{a.onSuccess(r.allParentIds)}});return f.exports.useEffect(()=>{o.refetch()},[e]),o},W=()=>{const e=L();return()=>e.invalidateQueries(G)},Y=[V,"options"],z=()=>k(Y,async()=>{const e=await R({});return E(e,{id:"deptId",pId:"parentId",rootPId:null})}),H=()=>{const e=L();return()=>e.invalidateQueries(Y)};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Te=()=>{const e=f.exports.useRef(),[a,{toggle:o}]=he(),{data:r,refetch:u}=z(),{defaultValueSysNormalDisable:s,valueEnumSysNormalDisable:c}=N(),{mutate:m,isLoading:p}=Q(async()=>{var d;const i=await((d=e.current)==null?void 0:d.validateFields());await U(i)},{onSuccess:async()=>{var i;o(),(i=e.current)==null||i.resetFields(),u(),v.success("新建成功")}});return l(B,{accessKey:"system:dept:add",children:[t($,{onClick:o}),t(M,{title:"新建部门",okText:"提交",open:a,onCancel:o,onOk:()=>m(),okButtonProps:{loading:p},children:l(J,{submitter:!1,formRef:e,grid:!0,rowProps:{gutter:[16,0]},children:[t(ge,{name:"parentId",label:"上级部门",rules:[{required:!0,message:"请选择上级部门"}],fieldProps:{treeData:r!=null?r:[],fieldNames:{label:"deptName",value:"deptId"}}}),t(y,{name:"deptName",label:"部门名称",rules:[{required:!0}],colProps:{span:12}}),t(ye,{name:"orderNum",label:"显示排序",initialValue:0,rules:[{required:!0}],colProps:{span:12}}),t(y,{name:"leader",label:"负责人",colProps:{span:12}}),t(y,{name:"phone",label:"联系电话",colProps:{span:12}}),t(y,{name:"email",label:"邮箱",colProps:{span:12}}),t(fe.Group,{name:"status",label:"状态",valueEnum:c,initialValue:s,colProps:{span:12}})]})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Ne=()=>{const{deptId:e,deptName:a,open:o}=K(),r=Ie(),u=W(),s=H();return t(B,{accessKey:"system:dept:remove",children:t(Z,{disabled:!o,type:"primary",size:"middle",onClick:()=>{M.confirm({title:"删除确认",content:l(A,{children:["确定删除部门",t(ee.Text,{code:!0,children:a}),"吗？"]}),onOk:async()=>{await te({deptId:e}),await Promise.all([r(),u(),s()]),v.success("删除成功")}})}})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const T={xs:1,sm:1,md:1,lg:1,xl:2},ve=()=>{const e=W(),a=H(),{deptId:o,open:r}=K(),{data:u}=z(),{valueEnumSysNormalDisable:s}=N(),{data:c,loading:m,refresh:p}=be(async()=>{var C;const{ancestors:n,...h}=await ae({deptId:o}),g=(C=n==null?void 0:n.split(","))!=null?C:[];return{...h,ancestors:Number(g[g.length-1])}},{ready:r&&o>0,refreshDeps:[o],onSuccess:()=>{w([])}}),{mutateAsync:i}=Q(oe,{onSuccess:async()=>{p(),await Promise.all([e(),a()]),v.success("保存成功")}}),d=De(),[D]=se.useForm(),[b,w]=f.exports.useState([]),x=d("system:dept:edit")?{form:D,editableKeys:b,onChange:(n,h)=>{if(w(n),n.length>0){const[g]=n;D.setFieldsValue({[g]:h[g]})}},onSave:async(n,h)=>{await i({deptId:o,deptName:c.deptName,orderNum:c.orderNum,parentId:c.parentId,[n]:h[n]})}}:void 0;return r?l(O,{spinning:m,children:[t(S,{column:T,editable:x,dataSource:c,columns:[{title:"状态",dataIndex:"status",key:"status",valueType:"select",valueEnum:s},{title:"排序",dataIndex:"orderNum",key:"orderNum",valueType:"digit"},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",editable:!1}]}),t(F,{}),t(S,{column:T,editable:x,dataSource:c,columns:[{title:"部门名称",dataIndex:"deptName",key:"deptName",valueType:"text"},{title:"上级部门",dataIndex:"parentId",key:"parentId",valueType:"treeSelect",fieldProps:{treeData:u,dropdownMatchSelectWidth:250,fieldNames:{label:"deptName",value:"deptId"}}}]}),t(F,{}),t(S,{column:T,editable:x,dataSource:c,columns:[{title:"负责人",dataIndex:"leader",key:"leader",valueType:"text"},{title:"联系电话",dataIndex:"phone",key:"phone",valueType:"text"},{title:"邮箱",dataIndex:"email",key:"email",valueType:"text"}]})]}):t(q,{description:"点击选择左侧部门项查看详情"})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Ae=e=>l(A,{children:[t(j,{color:"rgb(148 163 184)",children:e.orderNum}),l(de,{children:[e.deptName,t(j,{color:e.status==="0"?"success":"error",children:e.status==="0"?"启用中":"已禁用"})]})]}),we=()=>{var i;const[e,a]=f.exports.useState([]),[o,r]=f.exports.useState({}),{valueEnumSysNormalDisable:u}=N(),{data:s,isFetching:c}=Se(o,{onSuccess:d=>{a(d)}}),m=xe(),p=(e==null?void 0:e.length)!==0&&(e==null?void 0:e.length)===((i=s==null?void 0:s.allParentIds)==null?void 0:i.length);return l(A,{children:[l("div",{className:"flex justify-between items-center",children:[t(re,{size:"small",className:"my-2",icon:p?t(ce,{}):t(ne,{}),onClick:()=>a(p?[]:s==null?void 0:s.allParentIds),children:p?"全部折叠":"全部展开"}),l(le,{onFinish:async d=>r(d),children:[t(y,{name:"deptName",label:"部门名称"}),t(Pe,{name:"status",label:"状态",valueEnum:u})]})]}),t(O,{spinning:c,children:s!=null&&s.treeData.length?t(ie,{blockNode:!0,showLine:{showLeafIcon:!1},titleRender:Ae,treeData:s.treeData,expandedKeys:e,onExpand:a,height:700,fieldNames:{title:"deptName",key:"deptId"},onSelect:(d,{selected:D,node:{key:b}})=>{!D||m(b,s.map.get(b).deptName)}}):t(q,{})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Ge=()=>t(ue,{children:l(I,{ghost:!0,gutter:[16,16],wrap:!0,children:[t(I,{title:"部门列表",colSpan:{xxl:8,xl:12,lg:14,md:24,sm:24,xs:24},extra:t(Te,{}),children:t(we,{})}),t(I,{title:"部门详情",colSpan:{xxl:16,xl:12,lg:10,md:24,sm:24,xs:24},className:"h-full",extra:t(Ne,{}),children:t(ve,{})})]})});export{Ge as default};
