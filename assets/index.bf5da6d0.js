import{e as d,F as p,j as t,ap as C,$ as N,bC as f,aH as g,r as F,bD as I,ai as m,bE as y,bF as T,b5 as E,bG as A,M as D,at as h,q as B}from"./index.c6bff1dc.js";import{F as P,G as w,H as O,I as j,j as G,J as k,K as v,L as _,M as x,N as M,O as L,P as R,Q as q,R as J,S as K,T as Q,U as H,V as S,W as Z,X as $,Y as z,Z as U,_ as V,$ as W}from"./index.4a710fdf.js";import{G as X,a as Y}from"./GenService.cd631750.js";import{u as ee}from"./useRequest.2098e614.js";import{u as ae}from"./useMutation.esm.09011b99.js";import"./utils.esm.07655be9.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const se=({dataSource:e,handleEdit:s})=>{const r={onSave:async(l,a)=>{const n=l;await s({[n]:a[n]})}};return d(p,{children:[t(C,{dataSource:e,columns:[P,w,O,j,G],editable:r}),t(N,{}),t(C,{columns:[k,v,_,x,M,L,...(e==null?void 0:e.genType)===f.ZIP?[]:[R]],dataSource:e,editable:r})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const te=({dataSource:e,handleEdit:s,loading:r=!1})=>{const[l]=g.useForm(),[a,n]=F.exports.useState([]),u=(a==null?void 0:a.length)>0;return t(I,{toolbar:{actions:u?[t(m,{onClick:()=>n([]),icon:t(y,{}),children:"\u53D6\u6D88\u7F16\u8F91"},"cancelEdit"),t(m,{type:"primary",loading:r,icon:t(T,{}),onClick:async()=>{const o=await l.validateFields();await s({columns:Object.keys(o).map(i=>({...o[i],columnId:Number(i)}))}),n([])},children:"\u4FDD\u5B58"},"edit")]:[t(m,{icon:t(E,{}),type:"primary",onClick:()=>{e&&n(e==null?void 0:e.map(o=>{var i,c;return(c=(i=o==null?void 0:o.columnId)==null?void 0:i.toString())!=null?c:""}))},children:"\u7F16\u8F91"},"edit")]},rowKey:"columnId",ghost:!0,size:"small",scroll:{x:"max-content"},columns:[q,J,K,Q,H,S,Z,$,z,U,V,W],value:e,recordCreatorProps:!1,editable:{form:l,editableKeys:a}})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const b={BASE_INFO:"\u57FA\u672C\u4FE1\u606F",FIELD_INFO:"\u5B57\u6BB5\u4FE1\u606F"},ue=()=>{var i;const e=A(),s=Number((i=e==null?void 0:e.tableId)!=null?i:"0"),[r,l]=F.exports.useState("BASE_INFO"),{data:a,refresh:n}=ee(async()=>await X({tableId:s}),{ready:s>0,refreshDeps:[s]}),{mutateAsync:u,isLoading:o}=ae(async c=>{await Y({tableId:s,businessName:a.info.businessName,functionName:a.info.functionName,className:a.info.className,functionAuthor:a.info.functionAuthor,moduleName:a.info.moduleName,packageName:a.info.packageName,tableComment:a.info.tableComment,tableName:a.info.tableName,columns:a.rows,...c})},{onSuccess:()=>{n(),B.success("\u4FDD\u5B58\u6210\u529F")}});return t(D,{children:d(h,{tabs:{activeKey:r,onChange:c=>{l(c)}},children:[t(h.TabPane,{tab:b.BASE_INFO,children:t(se,{dataSource:a==null?void 0:a.info,handleEdit:u})},"BASE_INFO"),t(h.TabPane,{tab:b.FIELD_INFO,children:t(te,{dataSource:a==null?void 0:a.rows,handleEdit:u,loading:o})},"FIELD_INFO")]})})};export{ue as default};
