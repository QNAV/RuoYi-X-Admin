import{e as X,r as u,a as t,j as l,F as A}from"./jsx-runtime-06f68cbc.js";import{b as J,bP as U,aE as _,_ as R,bF as $,bd as Z,aC as ee,bK as L,aT as O,aJ as B,ag as j,bb as te,aI as ae,bW as se,aN as I,ai as re,t as oe,bX as ne,Y as le,bL as ce,bM as ie,bN as ue,X as de,bO as me,ay as he,aU as w}from"./index-37fcb888.js";import{A as G}from"./index-be624491.js";import{useShowModalAdd as K,useAtomValueSelectedMenuData as D,useDeleteMenu as V,useReFetchMenuList as Q,useReFetchMenuOptions as pe,useHideModalAdd as ye,useAtomValueModalAdd as ge,useQueryMenuOptions as fe,useAtomStateSelectedMenuData as be,useResetSelectedMenuData as Me,useQueryMenuList as Ce}from"./index-16c74a32.js";import{M as H,a as d}from"./index-e338c608.js";import{a as Te}from"./index-0b89c729.js";import{g as q,h as Pe,f as Y}from"./index-e664d339.js";import{a5 as Se,a6 as xe,a7 as ve}from"./react-27f57fd0.js";import{u as Fe}from"./useRequest-d8c32193.js";import{u as z}from"./useMutation-a5a4d775.js";import{P as k}from"./index-4f7a74e8.js";import{q as Ne}from"./index-6f927546.js";import{P as F}from"./index-79dca7fe.js";import{P as S}from"./index-6de84089.js";import{P as Ae}from"./index-5cb01e9d.js";import{P as Ie}from"./index-3ea42731.js";import{T as g}from"./index-1af96d1e.js";import{l as we}from"./index-8b1461db.js";import{P as ke}from"./index-07678be4.js";import"./utils-409125c9.js";import"./mutation-9ec6c65f.js";import"./index-92527557.js";import"./Skeleton-9c00c7cd.js";var Ee=["fieldProps","request","params","proFieldProps"],je=function(a,o){var c=a.fieldProps,r=a.request,i=a.params,n=a.proFieldProps,f=J(a,Ee),m=u.useContext(U);return t(_,R({valueType:"cascader",fieldProps:R({getPopupContainer:m.getPopupContainer},c),ref:o,request:r,params:i,filedConfig:{customLightMode:!0},proFieldProps:n},f))};const De=X.forwardRef(je);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const qe=()=>{const e=K();return t(G,{accessKey:"system:menu:add",children:t($,{onClick:e})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Re=()=>{const{hasSelected:e,selectedMenuId:a,selectedMenuName:o}=D(),c=V();return t(G,{accessKey:"system:menu:remove",children:t(Z,{disabled:!e,type:"primary",size:"middle",onClick:()=>c({menuId:a,menuName:o})})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const E={xs:1,sm:1,md:1,lg:1,xl:2},Be=e=>{const{valueEnumSysNormalDisable:a}=q(),{valueEnumSysShowHide:o}=Pe(),{valueEnumSysYesNo:c}=Y();return u.useMemo(()=>{const r=[];return e?(e!==d.F&&r.push({title:"状态",dataIndex:"status",key:"status",valueType:"radio",valueEnum:a},{title:"是否显示",dataIndex:"visible",key:"visible",valueType:"radio",valueEnum:o,tooltip:"选择否则路由将不会出现在侧边栏，但仍然可以访问"},{title:"是否外链",dataIndex:"isFrame",key:"isFrame",valueType:"radio",valueEnum:c,tooltip:"选择是外链则路由地址需要以`http(s)://`开头"},{title:"图标",dataIndex:"icon",key:"icon",valueType:"text",tooltip:"https://ant.design/components/icon-cn/"},{title:"路由地址",dataIndex:"path",key:"path",valueType:"text",tooltip:"访问的路由地址，如：`user`，如外网地址需内链访问则以`http(s)://`开头"}),e===d.C&&r.push({title:"路由参数",dataIndex:"queryParam",key:"queryParam",valueType:"code",tooltip:'访问路由的默认传递参数，如：{"id": 1, "name": "ry"}'}),e!==d.M&&r.push({title:"权限标识",dataIndex:"perms",key:"perms",valueType:"text",copyable:!0}),r):[]},[e])},Le=()=>{const e=Q(),a=pe(),{hasSelected:o,selectedMenuId:c}=D(),{data:r,loading:i,refresh:n}=Fe(async()=>await Se({menuId:c}),{ready:o,refreshDeps:[c]}),{mutateAsync:f}=z(xe,{onSuccess:async()=>{await Promise.all([n(),e(),a()]),j.success("保存成功")}}),m=Be(r==null?void 0:r.menuType),M=Te(),[C]=ee.useForm(),[s,h]=u.useState([]),b=M("system:menu:edit")?{form:C,editableKeys:s,onChange:(p,T)=>{if(h(p),p.length>0){const[P]=p;C.setFieldsValue({[P]:T[P]})}},onSave:async(p,T)=>{const{menuType:P,orderNum:x,menuName:v,menuId:y}=T;await f({menuId:y,menuType:P,orderNum:x,menuName:v,[p]:T[p]})}}:void 0;return o?l(O,{spinning:i,children:[t(k,{columns:[{title:"类型",dataIndex:"menuType",key:"menuType",valueType:"select",valueEnum:H},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime"}],dataSource:r,column:E}),t(B,{}),t(k,{columns:[{title:"名称",dataIndex:"menuName",key:"menuName",valueType:"text"},{title:"排序",dataIndex:"orderNum",key:"orderNum",valueType:"digit"},{title:"备注",dataIndex:"remark",key:"remark",valueType:"textarea"}],dataSource:r,editable:b,column:E}),t(B,{}),t(k,{columns:m,dataSource:r,editable:b,column:E})]}):t(L,{description:"点击选择左侧菜单项查看详情"})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Oe=()=>{const e=u.useRef(),a=ye(),o=ge(),{selectedMenuId:c}=D(),{valueEnumSysNormalDisable:r}=q(),{valueEnumSysYesNo:i}=Y(),{data:n,refetch:f}=fe(),m=Q(),{isLoading:M,mutate:C}=z(async()=>{var h,b;const s=await((b=(h=e.current)==null?void 0:h.validateFieldsReturnFormatValue)==null?void 0:b.call(h));s&&await ve(s)},{onSuccess:async()=>{var s;await Promise.all([f(),m()]),a(),(s=e.current)==null||s.resetFields(),j.success("新增成功")}});return u.useEffect(()=>{o&&u.startTransition(()=>{var s;(s=e.current)==null||s.setFieldsValue({parentId:Ne((n==null?void 0:n.map)??new Map,c)})})},[o]),t(te,{open:o,onCancel:a,title:"新增菜单",width:515,onOk:()=>C(),okButtonProps:{loading:M},children:l(ae,{submitter:!1,formRef:e,children:[t(De,{name:"parentId",label:"父级菜单",fieldProps:{options:(n==null?void 0:n.options)??[],fieldNames:{label:"menuName",value:"menuId",children:"children"},changeOnSelect:!0},rules:[{required:!0}],transform:s=>s&&{parentId:s[s.length-1]}}),t(F.Group,{name:"menuType",label:"菜单类型",valueEnum:H,rules:[{required:!0}]}),t(se,{name:["menuType"],children:({menuType:s})=>s?l(A,{children:[l(I,{children:[t(S,{name:"menuName",label:"菜单名称",width:"sm",rules:[{required:!0}]}),t(Ae,{name:"orderNum",label:"显示排序",tooltip:"默认数值为0，数值越大排序越靠后，数值相等按照创建时间先后排序",rules:[{required:!0}],width:"sm",initialValue:0})]}),s!==d.F&&l(A,{children:[l(I,{children:[t(F.Group,{tooltip:"选择停用则路由将不会出现在侧边栏，也不能被访问",name:"status",label:"菜单状态",required:!0,valueEnum:r}),t(F.Group,{name:"visible",label:"菜单是否隐藏",valueEnum:i,required:!0,tooltip:"选择否则路由将不会出现在侧边栏，但仍然可以访问"}),t(F.Group,{name:"isFrame",label:"是否外链",valueEnum:i,required:!0,tooltip:"选择是外链则路由地址需要以`http(s)://`开头"})]}),l(I,{children:[t(S,{name:"icon",label:"菜单图标",width:"sm",tooltip:"https://ant.design/components/icon-cn/"}),t(S,{width:"sm",name:"path",label:"路由地址",tooltip:"访问的路由地址，如：`user`，如外网地址需内链访问则以`http(s)://`开头",rules:[{required:!0}]})]})]}),s===d.C&&t(S,{name:"queryParam",label:"路由参数",tooltip:'访问路由的默认传递参数，如：{"id": 1, "name": "ry"}'}),s!==d.M&&t(S,{name:"perms",label:"权限标识"})]}):null}),t(Ie,{name:"remark",label:"备注"})]})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Ge=()=>l("div",{className:"mb-2",children:["标签含义：",t(g,{color:"rgb(148 163 184)",children:"显示顺序"}),t(g,{color:N[d.M],children:"目录"}),t(g,{color:N[d.C],children:"菜单"}),t(g,{color:N[d.F],children:"按钮"}),t(g,{children:"权限标识"})]});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const Ke=e=>l(A,{children:[t(g,{color:"rgb(148 163 184)",children:e.orderNum}),(e==null?void 0:e.icon)&&t(re,{name:e.icon,className:"mr-1"}),t(g,{color:N[e.menuType],style:{margin:"0 0 2px 0"},children:e.menuName}),(e==null?void 0:e.perms)&&t(g,{style:{margin:"0 0 2px 2px"},children:l(oe,{size:"small",children:[e.perms,t("div",{onClick:a=>{a.stopPropagation()},children:t(we.CopyToClipboard,{text:e.perms,onCopy:async(a,o)=>{o&&j.success("复制成功")},children:t(ne,{style:{color:"#1890ff"}})})})]})})]});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const N={M:"blue",C:"green",F:"red"},Ve={title:"menuName",key:"menuId"},Qe=()=>{var v;const[e,a]=u.useState({}),[o,c]=u.useState(0),[r,i]=u.useState([]),[n,f]=be(),m=Me(),M=K(),{valueEnumSysNormalDisable:C}=q(),{data:s,refetch:h,isFetching:b}=Ce(e,y=>{i(y)}),p=V(),T=(y,{node:{key:W}})=>{c(W)},P=({node:y})=>{c(y.key)},x=(r==null?void 0:r.length)&&(r==null?void 0:r.length)===((v=s==null?void 0:s.parentIds)==null?void 0:v.length);return u.useEffect(()=>{h()},[e]),u.useEffect(()=>{o>0?f({hasSelected:!0,selectedMenuId:o,selectedMenuName:s.map.get(o).menuName}):m()},[o]),l(A,{children:[t(Ge,{}),l("div",{className:"flex justify-between items-center",children:[t(le,{size:"small",className:"my-2",icon:x?t(ce,{}):t(ie,{}),onClick:()=>i(x?[]:s==null?void 0:s.parentIds),children:x?"全部折叠":"全部展开"}),l(ue,{onFinish:async y=>{c(0),i([]),a(y)},children:[t(S,{name:"menuName",label:"菜单名称"}),t(ke,{name:"status",label:"状态",valueEnum:C})]})]}),t(O,{spinning:b,children:t(de,{menu:{items:[{label:"新增",key:"create",disabled:!n.hasSelected,onClick:()=>M()},{label:"在根目录下新增",key:"createBase",onClick:()=>{m(),M()}},{label:"删除",key:"delete",danger:!0,disabled:!n.hasSelected,onClick:()=>p({menuId:n.selectedMenuId,menuName:n.selectedMenuName})}]},trigger:["contextMenu"],children:s!=null&&s.treeData.length?t(me,{blockNode:!0,selectedKeys:[o],onSelect:T,expandedKeys:r,titleRender:Ke,onExpand:i,showLine:{showLeafIcon:!1},fieldNames:Ve,height:700,treeData:s==null?void 0:s.treeData,onRightClick:P}):t(L,{})})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const ht=()=>l(he,{children:[l(w,{ghost:!0,gutter:[16,16],wrap:!0,children:[t(w,{title:"菜单列表",colSpan:{xxl:8,xl:12,lg:14,md:24,sm:24,xs:24},extra:t(qe,{}),children:t(Qe,{})}),t(w,{title:"菜单详情",extra:t(Re,{}),colSpan:{xxl:16,xl:12,lg:10,md:24,sm:24,xs:24},className:"h-full",children:t(Le,{})})]}),t(Oe,{})]});export{ht as default};
