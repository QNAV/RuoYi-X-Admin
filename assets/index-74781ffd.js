import{r as p,A as z,_ as v,j as s,Z as I,aj as G,p as C,cr as _,a1 as $,f as j,Q as i,s as q,ad as Q,cs as W,d as g,q as J,at as E,ct as Z,ax as ee,bF as te,af as se,cu as N,ac as ae,W as k,Y as b,X as oe,ai as w,cv as re,am as F,cw as ne,cx as ce,cy as le,ap as ie,$ as de,cz as ue,a0 as B,cA as me,ay as he,C as pe,cB as ge,cC as fe,L as Ie,I as Ce,aE as ye,aJ as Te,O as be,a2 as we,K as Ae,cD as xe,M as Se,B as Pe}from"./index-cde0b745.js";import{u as T}from"./useMutation-c6d67192.js";import{u as S}from"./useRequest-41b27702.js";import{a as D,u as U}from"./utils-c4afd625.js";import{u as Re}from"./index-1942a5ae.js";import{U as Me}from"./index-9644627d.js";import{I as ve}from"./InboxOutlined-864dc61b.js";var je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M508 704c79.5 0 144-64.5 144-144s-64.5-144-144-144-144 64.5-144 144 64.5 144 144 144zm0-224c44.2 0 80 35.8 80 80s-35.8 80-80 80-80-35.8-80-80 35.8-80 80-80z"}},{tag:"path",attrs:{d:"M832 256h-28.1l-35.7-120.9c-4-13.7-16.5-23.1-30.7-23.1h-451c-14.3 0-26.8 9.4-30.7 23.1L220.1 256H192c-17.7 0-32 14.3-32 32v28c0 4.4 3.6 8 8 8h45.8l47.7 558.7a32 32 0 0031.9 29.3h429.2a32 32 0 0031.9-29.3L802.2 324H856c4.4 0 8-3.6 8-8v-28c0-17.7-14.3-32-32-32zm-518.6-76h397.2l22.4 76H291l22.4-76zm376.2 664H326.4L282 324h451.9l-44.3 520z"}}]},name:"rest",theme:"outlined"};const Ee=je;var L=function(t,a){return p.createElement(z,v(v({},t),{},{ref:a,icon:Ee}))};L.displayName="RestOutlined";const Ne=p.forwardRef(L);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ke=({userId:e})=>{const t=lt();return s(I,{accessKey:"system:user:edit",children:s(G,{onClick:()=>t(e)})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const O=({userIds:e,batch:t,disabled:a})=>{const{message:r,modal:n}=C.useApp(),o=R(),{mutate:d,isLoading:l}=T(_,{onSuccess:()=>{var m;o==null||o.reload(),(m=o==null?void 0:o.clearSelected)==null||m.call(o),r.success("删除成功")}});return s(I,{accessKey:"system:user:remove",children:s($,{batch:t,disabled:a,onClick:()=>{n.confirm({title:"删除用户",content:`确定删除用户编号为 ${e.join(",")} 的数据吗？`,onOk:()=>d({userIds:e}),okButtonProps:{loading:l}})}})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Fe=({record:e})=>{const t=ot();return s(I,{accessKey:"system:user:resetPwd",children:s(j,{type:"link",danger:!0,icon:s(Ne,{}),onClick:()=>t(e),children:"重置密码"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const[Be]=i({title:"用户编号",dataIndex:"userId",table:{valueType:"text",hideInSearch:!0}}),[De,,V]=i({title:"用户名称",dataIndex:"userName",table:{valueType:"text"},form:{valueType:"text",formItemProps:{rules:[{required:!0}]}}}),[Ue,,Le]=i({title:"用户昵称",dataIndex:"nickName",table:{valueType:"text",hideInSearch:!0},form:{valueType:"text"}}),[Oe]=i({title:"部门名称",dataIndex:["dept","deptName"],table:{valueType:"text",hideInSearch:!0}}),[Ve,,He]=i({title:"手机号码",dataIndex:"phoneNumber",table:{valueType:"text",copyable:!0},form:{valueType:"text",formItemProps:{rules:[{pattern:q,message:"手机号码格式不正确"}]},fieldProps:{maxLength:11}}}),Ke="NORMAL",H=()=>{const{valueEnumSysNormalDisable:e}=ee();return i({title:"状态",dataIndex:"status",valueEnum:e,table:{valueType:"select"},form:{initialValue:Ke,valueType:"radio"}})},[Xe]=i({title:"创建时间",dataIndex:"createTime",table:{valueType:"dateTime",hideInSearch:!0,sorter:!0}}),[Ye]=i({title:"创建时间",dataIndex:"createTimeRange",table:{valueType:"dateTimeRange",hideInTable:!0}}),K=(e=!1)=>{const{data:t}=E(["sysConfigGetConfigKeySkipErrorHandler","sys.user.initPassword"],async()=>{const{data:a}=await te({configKey:"sys.user.initPassword"});return a.msg});return i({title:"用户密码",dataIndex:"password",form:{valueType:"password",initialValue:e?t:void 0,formItemProps:{rules:[{required:!0},{pattern:se,message:"密码长度应在6-20之间，只能包含字母、数字和下划线"}]}}})},ze=()=>{const{data:e=[]}=S(()=>N({}));return i({title:"归属部门",dataIndex:"deptId",form:{valueType:"treeSelect",fieldProps:{treeData:e,fieldNames:{value:"id"}}}})},[,,Ge]=i({title:"邮箱",dataIndex:"email",form:{valueType:"text",formItemProps:{rules:[{pattern:Q,message:"邮箱格式错误"}]}}}),_e="UNKNOWN",$e=()=>{const{valueEnumSysUserSex:e}=ae();return i({title:"用户性别",dataIndex:"sex",valueEnum:e,form:{valueType:"radio",initialValue:_e}})},qe=e=>i({title:"岗位",dataIndex:"postIds",valueEnum:e,form:{valueType:"select",fieldProps:{mode:"multiple"},colProps:{span:24}}}),Qe=e=>i({title:"角色",dataIndex:"roleIds",valueEnum:e,form:{valueType:"select",fieldProps:{mode:"multiple"},colProps:{span:24}}}),[,,We]=i({title:"备注",dataIndex:"remark",form:{valueType:"textarea",colProps:{span:24}}}),Je=()=>{const[,,e]=K();return[W(V,{readonly:!0}),e]},Ze=()=>{const[e]=H();return[Be,De,Ue,Oe,Ve,e,Xe,Ye,{title:"操作",valueType:"option",render:(t,a)=>a.userId===1?null:g(J,{children:[s(ke,{userId:a.userId}),s(O,{userIds:[a.userId]}),s(Fe,{record:a})]}),fixed:"right",width:260}]},et=e=>{const{data:t}=E(["sysUserGetInfo"],async()=>{const{posts:u,roles:m}=await Z();return{posts:u.reduce((f,c)=>f.set(c.postId,c.postName),new Map),roles:m.reduce((f,c)=>f.set(c.roleId,c.roleName),new Map)}}),[,,a]=ze(),[,,r]=K(!0),[,,n]=$e(),[,,o]=H(),[,,d]=qe((t==null?void 0:t.posts)??{}),[,,l]=Qe((t==null?void 0:t.roles)??{});return[Le,a,He,Ge,...e==="add"?[V,r]:[],n,o,d,l,We]};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const P=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomMainTableActions",k(void 0));P.debugLabel="atomMainTableActions";const R=()=>b(P),tt=()=>oe(P),M=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomSelectedDeptId",k(0));M.debugLabel="atomSelectedDeptId";const st=()=>b(M),at=()=>w(M),A=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomResetPwdModal",D({open:!1}));A.debugLabel="atomResetPwdModal";const ot=()=>{const e=w(A);return t=>{e({open:!0,record:t})}},rt=()=>U(A),nt=()=>b(A),y=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomAddOrEditModal",D({open:!1,actionType:"add"}));y.debugLabel="atomAddOrEditModal";const ct=()=>{const e=w(y);return()=>{e({open:!0,actionType:"add"})}},lt=()=>{const e=w(y);return t=>{e({open:!0,actionType:"edit",userId:t})}},it=()=>U(y),dt=()=>b(y);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ut=()=>{const{message:e}=C.useApp(),t=p.useRef(),a=R(),{open:r,actionType:n,userId:o}=dt(),d=it(),l=()=>{var c;n==="edit"&&((c=t.current)==null||c.resetFields()),d()},[,u]=p.useTransition();S(async()=>{const{postIds:c,roleIds:h,user:x}=await re({userId:o});return{...x,postIds:c,roleIds:h}},{ready:r&&n==="edit"&&!!o,onSuccess:c=>{u(()=>{var h;(h=t.current)==null||h.setFieldsValue(c)})},refreshDeps:[r]});const m=async c=>{var h;if(n==="add"){const{roleIds:x=[],postIds:X=[],...Y}=c;await ne({roleIds:x,postIds:X,...Y})}else await ce({userId:o,...c});a==null||a.reload(),(h=t.current)==null||h.resetFields(),d(),e.success(n==="add"?"新增成功":"编辑成功")},f=et(n);return s(F,{layoutType:"ModalForm",title:n==="add"?"新增用户":"编辑用户",formRef:t,grid:!0,colProps:{span:12},modalProps:{okText:"提交",onCancel:l},width:600,open:r,onFinish:m,columns:f})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const mt=()=>{const{message:e}=C.useApp(),t=p.useRef(),a=Je(),r=rt(),{open:n,record:o}=nt(),[,d]=p.useTransition(),l=R(),u=async({password:m})=>{await le({...o,password:m}),l==null||l.reload(),r(),e.success("重置密码成功")};return p.useEffect(()=>{n&&o&&d(()=>{var m;(m=t.current)==null||m.setFieldsValue({userName:o.userName,password:""})})},[n]),s(F,{title:"重置密码",layoutType:"ModalForm",columns:a,width:500,formRef:t,open:n,modalProps:{okText:"提交",onCancel:r},onFinish:u})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ht=()=>{const e=ct();return s(I,{accessKey:"system:user:add",children:s(ie,{onClick:e})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const pt=async e=>{const{data:t}=await ue(e,{format:"blob"});await B(t,`user_${new Date().getTime()}.xlsx`)},gt=({searchParams:e})=>{const{message:t}=C.useApp(),{isLoading:a,mutate:r}=T(pt,{onSuccess:()=>{t.success("导出成功")}});return s(I,{accessKey:"system:user:export",children:s(de,{loading:a,onClick:()=>r(e)})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const{Dragger:ft}=Me,It=async()=>{const{data:e}=await ge({format:"blob"});await B(e,`user_template_${new Date().getTime()}.xlsx`)},Ct=async({updateSupport:e,file:t})=>{const{data:{code:a,msg:r}}=await fe({updateSupport:e},{file:t});return a!==200?Promise.reject(new Error(r)):r},yt=()=>{const[e,{toggle:t}]=Re(),[a,r]=p.useState(!1),[n,o]=p.useState([]),{message:d,modal:l}=C.useApp(),{mutate:u,isLoading:m}=T(Ct,{onSuccess:h=>{t(),l.info({title:"导入结果",content:h})},onError:()=>{d.error("导入失败")}}),{mutate:f,isLoading:c}=T(It);return g(I,{accessKey:"system:user:import",children:[s(me,{onClick:t}),g(he,{title:"导入用户",open:e,onCancel:t,onOk:()=>u({updateSupport:a,file:n[0].originFileObj}),okButtonProps:{loading:m},children:[g(ft,{accept:".xlsx, .xls",maxCount:1,beforeUpload:()=>!1,onChange:h=>o(h.fileList),fileList:n,onRemove:()=>o([]),children:[s("p",{className:"ant-upload-drag-icon",children:s(ve,{})}),s("p",{className:"ant-upload-text",children:"点击或拖拽文件到此区域上传"})]}),g("div",{className:"flex flex-col items-center pt-2",children:[s(pe,{checked:a,onChange:h=>{r(h.target.checked)},children:"是否更新已经存在的用户数据"}),g("div",{children:[s("span",{children:"仅允许导入xls、xlsx格式文件"}),s(j,{type:"link",onClick:()=>f(),loading:c,children:"下载模板"})]})]})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Tt=()=>{const[e,t]=p.useState(""),a=at(),{data:r,loading:n}=S(()=>N({deptName:e}),{refreshDeps:[e]});return g(Ie,{spinning:n,children:[s(Ce.Search,{allowClear:!0,placeholder:"请输入部门名称",className:"mb-3",onSearch:o=>t(o)}),!r||r.length===0?s(ye,{}):s(Te,{treeData:r,defaultExpandAll:!0,fieldNames:{title:"label",key:"id"},onSelect:(o,{node:{key:d}})=>{a(d)},blockNode:!0})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const bt=({selectedRowKeys:e})=>s(O,{disabled:e.length===0,batch:!0,userIds:e}),wt=(e,t)=>g("div",{className:"flex gap-4",children:[s(Se,{className:"w-80",children:s(Tt,{})}),s("div",{className:"overflow-auto w-full",children:t})]}),At=()=>{const e=tt(),[t,a]=p.useState({}),r=Ze(),n=st(),o=n>0?{deptId:n}:{};return s(be,{rowKey:"userId",actionRef:e,columns:r,params:o,request:async(...d)=>{const{createTimeRange:l,...u}=we(...d);return Ae(l)&&(u.beginCreateTime=l[0],u.endCreateTime=l[1]),a(u),await xe(u)},toolbar:{actions:[s(gt,{searchParams:t},"ButtonExport"),s(yt,{},"ButtonImport"),s(ht,{},"ButtonAdd")]},tableRender:wt,tableAlertOptionRender:bt})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Et=()=>g(Pe,{children:[s(At,{}),s(ut,{}),s(mt,{})]});export{Et as default};
