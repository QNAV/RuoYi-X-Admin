import{Z as W,m as O,r as M,g as s,a2 as Y,W as j,X as z,by as L,aL as se,aX as v,ah as A,k as Q,n as N,i as ue,bz as X,e as V,E as ce,a9 as ve,S as fe,bx as ge,bA as me}from"./antd-f7a9cbdb.js";import{b as he,bK as q,bL as ye,a as y,j as t,bM as G,F as U,bN as pe,bO as ee,bP as be,bQ as Se,d as ae,bR as K,P as H,bS as ke}from"./index-b5eebe28.js";var we=function(e){return(Y.warn||Y.warning)(e)};function Ee(n){var e=n.data,a=n.row;return s(s({},e),a)}function Ce(n){var e=n.type||"single",a=he(),r=W([],{value:n.editableKeys,onChange:n.onChange?function(i){var g;n==null||(g=n.onChange)===null||g===void 0||g.call(n,i,n.dataSource)}:void 0}),l=O(r,2),o=l[0],c=l[1],f=M.useMemo(function(){var i=e==="single"?o==null?void 0:o.slice(0,1):o;return new Set(i)},[(o||[]).join(","),e]),u=M.useCallback(function(i){return!!(o!=null&&o.includes(q(i)))},[(o||[]).join(",")]),b=function(g){return f.size>0&&e==="single"?(we(n.onlyOneLineEditorAlertMessage||a.getMessage("editableTable.onlyOneLineEditor","只能同时编辑一行")),!1):(f.add(q(g)),c(Array.from(f)),!0)},T=function(g){return f.delete(q(g)),c(Array.from(f)),!0},P=function(){var i=j(z().mark(function g(S,p,E,k){var I,B;return z().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,n==null||(I=n.onCancel)===null||I===void 0?void 0:I.call(n,S,p,E,k);case 2:if(B=d.sent,B!==!1){d.next=5;break}return d.abrupt("return",!1);case 5:return d.abrupt("return",!0);case 6:case"end":return d.stop()}},g)}));return function(S,p,E,k){return i.apply(this,arguments)}}(),h=function(){var i=j(z().mark(function g(S,p,E){var k,I,B;return z().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,n==null||(k=n.onSave)===null||k===void 0?void 0:k.call(n,S,p,E);case 2:if(I=d.sent,I!==!1){d.next=5;break}return d.abrupt("return",!1);case 5:return T(S),B={data:n.dataSource,row:p,key:S,childrenColumnName:n.childrenColumnName||"children"},n.setDataSource(Ee(B)),d.abrupt("return",!0);case 9:case"end":return d.stop()}},g)}));return function(S,p,E){return i.apply(this,arguments)}}(),x=a.getMessage("editableTable.action.save","保存"),R=a.getMessage("editableTable.action.delete","删除"),C=a.getMessage("editableTable.action.cancel","取消"),D=M.useCallback(function(i,g){var S=s({recordKey:i,cancelEditable:T,onCancel:P,onSave:h,editableKeys:o,setEditableRowKeys:c,saveText:x,cancelText:C,deleteText:R,deletePopconfirmMessage:"".concat(a.getMessage("deleteThisLine","删除此行"),"?"),editorType:"Map"},g),p=ye(n.dataSource,S);return n.actionRender?n.actionRender(n.dataSource,S,{save:p.save,delete:p.delete,cancel:p.cancel}):[p.save,p.delete,p.cancel]},[o&&o.join(","),n.dataSource]);return{editableKeys:o,setEditableRowKeys:c,isEditable:u,actionRender:D,startEditable:b,cancelEditable:T}}var Z=function(e){var a=e.padding;return t("div",{style:{padding:a||"0 24px"},children:t(se,{style:{margin:0}})})},Ie={xs:2,sm:2,md:4,lg:4,xl:6,xxl:6},xe=function(e){var a=e.size,r=e.active,l=G(),o=a===void 0?Ie[l]||6:a,c=function(u){return u===0?0:o>2?42:16};return t(L,{bordered:!1,style:{marginBlockEnd:16},children:t("div",{style:{width:"100%",justifyContent:"space-between",display:"flex"},children:new Array(o).fill(null).map(function(f,u){return y("div",{style:{borderInlineStart:o>2&&u===1?"1px solid rgba(0,0,0,0.06)":void 0,paddingInlineStart:c(u),flex:1,marginInlineEnd:u===0?16:0},children:[t(v,{active:r,paragraph:!1,title:{width:100,style:{marginBlockStart:0}}}),t(v.Button,{active:r,style:{height:48}})]},u)})})})},De=function(e){var a=e.active;return y(U,{children:[t(L,{bordered:!1,style:{borderRadius:0},bodyStyle:{padding:24},children:y("div",{style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t("div",{style:{maxWidth:"100%",flex:1},children:t(v,{active:a,title:{width:100,style:{marginBlockStart:0}},paragraph:{rows:1,style:{margin:0}}})}),t(v.Button,{active:a,size:"small",style:{width:165,marginBlockStart:12}})]})}),t(Z,{})]})},Be=function(e){var a=e.size,r=e.active,l=r===void 0?!0:r,o=e.actionButton;return y(L,{bordered:!1,bodyStyle:{padding:0},children:[new Array(a).fill(null).map(function(c,f){return t(De,{active:!!l},f)}),o!==!1&&t(L,{bordered:!1,style:{borderStartEndRadius:0,borderTopLeftRadius:0},bodyStyle:{display:"flex",alignItems:"center",justifyContent:"center"},children:t(v.Button,{style:{width:102},active:l,size:"small"})})]})},J=function(e){var a=e.active;return y("div",{style:{marginBlockEnd:16},children:[t(v,{paragraph:!1,title:{width:185}}),t(v.Button,{active:a,size:"small"})]})},Te=function(e){var a=e.active;return t(L,{bordered:!1,style:{borderBottomRightRadius:0,borderBottomLeftRadius:0},bodyStyle:{paddingBlockEnd:8},children:y(A,{style:{width:"100%",justifyContent:"space-between"},children:[t(v.Button,{active:a,style:{width:200},size:"small"}),y(A,{children:[t(v.Button,{active:a,size:"small",style:{width:120}}),t(v.Button,{active:a,size:"small",style:{width:80}})]})]})})},Pe=function(e){var a=e.active,r=a===void 0?!0:a,l=e.statistic,o=e.actionButton,c=e.toolbar,f=e.pageHeader,u=e.list,b=u===void 0?5:u;return y("div",{style:{width:"100%"},children:[f!==!1&&t(J,{active:r}),l!==!1&&t(xe,{size:l,active:r}),(c!==!1||b!==!1)&&y(L,{bordered:!1,bodyStyle:{padding:0},children:[c!==!1&&t(Te,{active:r}),b!==!1&&t(Be,{size:b,active:r,actionButton:o})]})]})};const Re=Pe;var te={xs:1,sm:2,md:3,lg:3,xl:3,xxl:4},Le=function(e){var a=e.active;return y("div",{style:{marginBlockStart:32},children:[t(v.Button,{active:a,size:"small",style:{width:100,marginBlockEnd:16}}),y("div",{style:{width:"100%",justifyContent:"space-between",display:"flex"},children:[y("div",{style:{flex:1,marginInlineEnd:24,maxWidth:300},children:[t(v,{active:a,paragraph:!1,title:{style:{marginBlockStart:0}}}),t(v,{active:a,paragraph:!1,title:{style:{marginBlockStart:8}}}),t(v,{active:a,paragraph:!1,title:{style:{marginBlockStart:8}}})]}),t("div",{style:{flex:1,alignItems:"center",justifyContent:"center"},children:y("div",{style:{maxWidth:300,margin:"auto"},children:[t(v,{active:a,paragraph:!1,title:{style:{marginBlockStart:0}}}),t(v,{active:a,paragraph:!1,title:{style:{marginBlockStart:8}}})]})})]})]})},ze=function(e){var a=e.size,r=e.active,l=G(),o=a===void 0?te[l]||3:a;return t("div",{style:{width:"100%",justifyContent:"space-between",display:"flex"},children:new Array(o).fill(null).map(function(c,f){return y("div",{style:{flex:1,paddingInlineStart:f===0?0:24,paddingInlineEnd:f===o-1?0:24},children:[t(v,{active:r,paragraph:!1,title:{style:{marginBlockStart:0}}}),t(v,{active:r,paragraph:!1,title:{style:{marginBlockStart:8}}}),t(v,{active:r,paragraph:!1,title:{style:{marginBlockStart:8}}})]},f)})})},_=function(e){var a=e.active,r=e.header,l=r===void 0?!1:r,o=G(),c=te[o]||3;return y(U,{children:[y("div",{style:{display:"flex",background:l?"rgba(0,0,0,0.02)":"none",padding:"24px 8px"},children:[new Array(c).fill(null).map(function(f,u){return t("div",{style:{flex:1,paddingInlineStart:l&&u===0?0:20,paddingInlineEnd:32},children:t(v,{active:a,paragraph:!1,title:{style:{margin:0,height:24,width:l?"75px":"100%"}}})},u)}),t("div",{style:{flex:3,paddingInlineStart:32},children:t(v,{active:a,paragraph:!1,title:{style:{margin:0,height:24,width:l?"75px":"100%"}}})})]}),t(Z,{padding:"0px 0px"})]})},Fe=function(e){var a=e.active,r=e.size,l=r===void 0?4:r;return y(L,{bordered:!1,children:[t(v.Button,{active:a,size:"small",style:{width:100,marginBlockEnd:16}}),t(_,{header:!0,active:a}),new Array(l).fill(null).map(function(o,c){return t(_,{active:a},c)}),t("div",{style:{display:"flex",justifyContent:"flex-end",paddingBlockStart:16},children:t(v,{active:a,paragraph:!1,title:{style:{margin:0,height:32,float:"right",maxWidth:"630px"}}})})]})},$e=function(e){var a=e.active;return y(L,{bordered:!1,style:{borderStartEndRadius:0,borderTopLeftRadius:0},children:[t(v.Button,{active:a,size:"small",style:{width:100,marginBlockEnd:16}}),t(ze,{active:a}),t(Le,{active:a})]})},Me=function(e){var a=e.active,r=a===void 0?!0:a,l=e.pageHeader,o=e.list;return y("div",{style:{width:"100%"},children:[l!==!1&&t(J,{active:r}),t($e,{active:r}),o!==!1&&t(Z,{}),o!==!1&&t(Fe,{active:r,size:o})]})};const Ae=Me;var je=function(e){var a=e.active,r=a===void 0?!0:a,l=e.pageHeader;return y("div",{style:{width:"100%"},children:[l!==!1&&t(J,{active:r}),t(L,{children:y("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",padding:128},children:[t(v.Avatar,{size:64,style:{marginBlockEnd:32}}),t(v.Button,{active:r,style:{width:214,marginBlockEnd:8}}),t(v.Button,{active:r,style:{width:328},size:"small"}),y(A,{style:{marginBlockStart:24},children:[t(v.Button,{active:r,style:{width:116}}),t(v.Button,{active:r,style:{width:116}})]})]})})]})};const qe=je;var Ke=["type"],He=function(e){var a=e.type,r=a===void 0?"list":a,l=Q(e,Ke);return r==="result"?t(qe,s({},l)):r==="descriptions"?t(Ae,s({},l)):t(Re,s({},l))};const We=He;var Oe=function(e,a){var r=a||{},l=r.onRequestError,o=r.effects,c=r.manual,f=r.dataSource,u=r.defaultDataSource,b=r.onDataSourceChange,T=W(u,{value:f,onChange:b}),P=O(T,2),h=P[0],x=P[1],R=W(a==null?void 0:a.loading,{value:a==null?void 0:a.loading,onChange:a==null?void 0:a.onLoadingChange}),C=O(R,2),D=C[0],i=C[1],g=function(E){x(E),i(!1)},S=function(){var p=j(z().mark(function E(){var k,I,B;return z().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(!D){d.next=2;break}return d.abrupt("return");case 2:return i(!0),d.prev=3,d.next=6,e();case 6:if(d.t0=d.sent,d.t0){d.next=9;break}d.t0={};case 9:k=d.t0,I=k.data,B=k.success,B!==!1&&g(I),d.next=23;break;case 15:if(d.prev=15,d.t1=d.catch(3),l!==void 0){d.next=21;break}throw new Error(d.t1);case 21:l(d.t1);case 22:i(!1);case 23:return d.prev=23,i(!1),d.finish(23);case 26:case"end":return d.stop()}},E,null,[[3,15,23,26]])}));return function(){return p.apply(this,arguments)}}();return M.useEffect(function(){c||S()},[].concat(N(o||[]),[c])),{dataSource:h,setDataSource:x,loading:D,reload:function(){return S()}}};const Ne=Oe;var Ve=["valueEnum","render","renderText","mode","plain","dataIndex","request","params","editable"],Qe=["request","columns","params","dataSource","onDataSourceChange","formProps","editable","loading","onLoadingChange","actionRef","onRequestError"],Xe=function(e,a){var r=e.dataIndex;if(r){var l=Array.isArray(r)?fe(a,r):a[r];if(l!==void 0||l!==null)return l}return e.children},Ge=function(e){var a=e.valueEnum,r=e.action,l=e.index,o=e.text,c=e.entity,f=e.mode,u=e.render,b=e.editableUtils,T=e.valueType,P=e.plain,h=e.dataIndex,x=e.request,R=e.renderFormItem,C=e.params,D=ae.useFormInstance(),i={text:o,valueEnum:a,mode:f||"read",proFieldProps:{render:u?function(){return u==null?void 0:u(o,c,l,r,s(s({},e),{},{type:"descriptions"}))}:void 0},ignoreFormItem:!0,valueType:T,request:x,params:C,plain:P};if(f==="read"||!f||T==="option"){var g=K(e.fieldProps,void 0,s(s({},e),{},{rowKey:h,isEditable:!1}));return t(H,s(s({name:h},i),{},{fieldProps:g}))}var S=function(){var E,k=K(e.formItemProps,D,s(s({},e),{},{rowKey:h,isEditable:!0})),I=K(e.fieldProps,D,s(s({},e),{},{rowKey:h,isEditable:!0})),B=R?R==null?void 0:R(s(s({},e),{},{type:"descriptions"}),{isEditable:!0,recordKey:h,record:D.getFieldValue([h].flat(1)),defaultRender:function(){return t(H,s(s({},i),{},{fieldProps:I}))},type:"descriptions"},D):void 0;return y(A,{style:{alignItems:"baseline"},children:[t(ke,s(s({name:h},k),{},{style:s({margin:0},(k==null?void 0:k.style)||{}),initialValue:o||(k==null?void 0:k.initialValue),children:B||t(H,s(s({},i),{},{proFieldProps:s({},i.proFieldProps),fieldProps:I}))})),b==null||(E=b.actionRender)===null||E===void 0?void 0:E.call(b,h||l,{cancelText:t(ge,{}),saveText:t(me,{}),deleteText:!1})]})};return t("div",{style:{marginTop:-5,marginBottom:-5,marginLeft:0,marginRight:0},children:S()})},Ze=function(e,a,r,l){var o,c=[],f=e==null||(o=e.map)===null||o===void 0?void 0:o.call(e,function(u,b){var T,P;if(V.isValidElement(u))return u;var h=u;h.valueEnum,h.render;var x=h.renderText,R=h.mode;h.plain;var C=h.dataIndex;h.request,h.params;var D=h.editable,i=Q(h,Ve),g=(T=Xe(u,a))!==null&&T!==void 0?T:i.children,S=x?x(g,a,b,r):g,p=typeof i.title=="function"?i.title(u,"descriptions",null):i.title,E=typeof i.valueType=="function"?i.valueType(a||{},"descriptions"):i.valueType,k=l==null?void 0:l.isEditable(C||b),I=R||k?"edit":"read",B=l&&I==="read"&&D!==!1&&(D==null?void 0:D(S,a,b))!==!1,F=B?A:V.Fragment,d=I==="edit"?S:Se(S,u,S),$=M.createElement(X.Item,s(s({},i),{},{key:i.key||((P=i.label)===null||P===void 0?void 0:P.toString())||b,label:(p||i.label||i.tooltip||i.tip)&&t(ee,{label:p||i.label,tooltip:i.tooltip||i.tip,ellipsis:u.ellipsis})}),y(F,{children:[t(Ge,s(s({},u),{},{dataIndex:u.dataIndex||b,mode:I,text:d,valueType:E,entity:a,index:b,action:r,editableUtils:l})),B&&E!=="option"&&t(ce,{onClick:function(){l==null||l.startEditable(C||b)}})]}));return E==="option"?(c.push($),null):$}).filter(function(u){return u});return{options:c!=null&&c.length?c:null,children:f}},Je=function(e){return t(X.Item,s(s({},e),{},{children:e.children}))},Ye=function(e){return e.children},_e=function(e){var a,r=e.request,l=e.columns,o=e.params,c=o===void 0?{}:o,f=e.dataSource,u=e.onDataSourceChange,b=e.formProps,T=e.editable,P=e.loading,h=e.onLoadingChange,x=e.actionRef,R=e.onRequestError,C=Q(e,Qe),D=M.useContext(ue.ConfigContext),i=Ne(j(z().mark(function d(){var $;return z().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(!r){w.next=6;break}return w.next=3,r(c);case 3:w.t0=w.sent,w.next=7;break;case 6:w.t0={data:{}};case 7:return $=w.t0,w.abrupt("return",$);case 9:case"end":return w.stop()}},d)})),{onRequestError:R,effects:[pe(c)],manual:!r,dataSource:f,loading:P,onLoadingChange:h,onDataSourceChange:u}),g=Ce(s(s({},e.editable),{},{childrenColumnName:void 0,dataSource:i.dataSource,setDataSource:i.setDataSource}));if(M.useEffect(function(){x&&(x.current=s({reload:i.reload},g))},[i,x,g]),i.loading||i.loading===void 0&&r)return t(We,{type:"descriptions",list:!1,pageHeader:!1});var S=function(){var $=ve(e.children).filter(Boolean).map(function(m){if(!V.isValidElement(m))return m;var w=m==null?void 0:m.props,re=w.valueEnum,ne=w.valueType,ie=w.dataIndex,le=w.ellipsis,de=w.copyable,oe=w.request;return!ne&&!re&&!ie&&!oe&&!le&&!de?m:s(s({},m==null?void 0:m.props),{},{entity:f})});return[].concat(N(l||[]),N($)).filter(function(m){return!m||m!=null&&m.valueType&&["index","indexBorder"].includes(m==null?void 0:m.valueType)?!1:!(m!=null&&m.hideInDescriptions)}).sort(function(m,w){return w.order||m.order?(w.order||0)-(m.order||0):(w.index||0)-(m.index||0)})},p=Ze(S(),i.dataSource||{},(x==null?void 0:x.current)||i,T?g:void 0),E=p.options,k=p.children,I=T?ae:Ye,B=null;(C.title||C.tooltip||C.tip)&&(B=t(ee,{label:C.title,tooltip:C.tooltip||C.tip}));var F=D.getPrefixCls("pro-descriptions");return t(be,{children:t(I,s(s({form:(a=e.editable)===null||a===void 0?void 0:a.form,component:!1,submitter:!1},b),{},{onFinish:void 0,children:t(X,s(s({className:F},C),{},{extra:C.extra?y(A,{children:[E,C.extra]}):E,title:B,children:k}))}),"form")})};_e.Item=Je;export{_e as P};
