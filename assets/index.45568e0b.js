import{aD as ee,O as te,j as a,aE as ae,_ as L,h as q,l as B,n as S,o as h,r as f,g as d,ay as V,$ as g,a1 as se,av as oe,aO as E,Y as I,aw as ue,af as A,ag as C,aA as re,aB as ce,aj as ne,bD as ie,ai as W,W as le,bE as de,ah as he,F as Y,aH as me,bF as pe,aK as ge,bG as Fe,aJ as ye,aP as Ce,ak as be,al as fe,I as Ae}from"./index.843eb19a.js";import{c as M,a as T}from"./index.e83de61a.js";import{a as Te}from"./index.33c87331.js";import{a as X,u as _}from"./utils.9fa4cccf.js";import{f as Pe}from"./SysConfigService.70872e58.js";import{f as G}from"./SysDeptService.ea7a8784.js";import{P as we}from"./index.5a5a1c48.js";import{W as Ee}from"./index.382e1f14.js";import{u as P}from"./useRequest.5a9871d3.js";import{u as R}from"./useMutation.esm.cd538344.js";import{u as Be}from"./index.7dfffe11.js";import"./useQuery.esm.6466b65c.js";import"./utils.esm.43e4942d.js";import"./SysLoginService.119121c4.js";var Se=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],Ie=ee.forwardRef(function(e,t){var u=e.fieldProps,s=e.unCheckedChildren,r=e.checkedChildren,c=e.proFieldProps,o=te(e,Se);return a(ae,L({valueType:"switch",fieldProps:L({unCheckedChildren:s,checkedChildren:r},u),ref:t,valuePropName:"checked",proFieldProps:c,filedConfig:{valuePropName:"checked",ignoreWidth:!0}},o))});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const x=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomMainTableActions",q(void 0));x.debugLabel="atomMainTableActions";const H=()=>B(x),Re=()=>Te(x),D=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomSelectedDeptId",q(0));D.debugLabel="atomSelectedDeptId";const je=()=>B(D),ke=()=>S(D),j=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomResetPwdModal",X({open:!1}));j.debugLabel="atomResetPwdModal";const Me=()=>{const e=S(j);return t=>{e({open:!0,record:t})}},xe=()=>_(j),De=()=>B(j),w=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomAddOrEditModal",X({open:!1,actionType:"add",userId:0}));w.debugLabel="atomAddOrEditModal";const ve=()=>{const e=S(w);return()=>{e({open:!0,actionType:"add",userId:0})}},Ne=()=>{const e=S(w);return t=>{e({open:!0,actionType:"edit",userId:t})}},Oe=()=>_(w),Ue=()=>B(w);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};async function Le(e,t){return h("/system/user/",{method:"GET",params:{...e},...t||{}})}async function qe(e,t){return h("/system/user/add",{method:"POST",headers:{"Content-Type":"application/json"},data:e,...t||{}})}async function Ve(e,t){return h("/system/user/edit",{method:"POST",headers:{"Content-Type":"application/json"},data:e,...t||{}})}async function We(e,t){return h("/system/user/export",{method:"POST",headers:{"Content-Type":"application/json"},data:e,...t||{}})}async function Ye(e){return h("/system/user/importTemplate",{method:"POST",...e||{}})}async function Xe(e,t){return h("/system/user/info",{method:"GET",params:{...e},...t||{}})}async function _e(e,t){return h("/system/user/list",{method:"POST",headers:{"Content-Type":"application/json"},data:e,...t||{}})}async function Ge(e,t){return h("/system/user/remove",{method:"POST",params:{...e},...t||{}})}async function He(e,t){return h("/system/user/resetPwd",{method:"POST",headers:{"Content-Type":"application/json"},data:e,...t||{}})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ke=()=>{var v,N,O,U;const e=f.exports.useRef(),t=H(),{open:u,actionType:s,userId:r}=Ue(),c=Oe(),o=()=>{var n;s==="edit"&&((n=e.current)==null||n.resetFields()),c()},{data:m}=M("sys_normal_disable"),{data:i}=M("sys_user_sex"),{data:F}=P(async()=>{const{posts:n,roles:l}=await Le({});return{posts:n.reduce((p,y)=>p.set(y.postId,y.postName),new Map),roles:l.reduce((p,y)=>p.set(y.roleId,y.roleName),new Map)}}),{data:b}=P(async()=>(await Pe({configKey:"sys.user.initPassword"},{skipErrorHandler:!0})).data.msg),{data:k}=P(()=>G({}),{}),{data:z}=P(async()=>{const{postIds:n,roleIds:l,user:p}=await Xe({userId:r});return{...p,postIds:n,roleIds:l}},{ready:u&&s==="edit"&&r>0,onSuccess:n=>{var l;(l=e.current)==null||l.setFieldsValue(n)},refreshDeps:[r]}),{isLoading:J,mutateAsync:Q}=R(async()=>{var l,p;const n=await((p=(l=e.current)==null?void 0:l.validateFieldsReturnFormatValue)==null?void 0:p.call(l));if(s==="add"){const{roleIds:y=[],postIds:$=[],...Z}=n;await qe({roleIds:y,postIds:$,...Z})}else await Ve({...z,...n,userId:r})},{onSuccess:()=>{var n;c(),t==null||t.reload(),(n=e.current)==null||n.resetFields(),I.success(s==="add"?"\u65B0\u589E\u6210\u529F":"\u7F16\u8F91\u6210\u529F")}});return d(V,{title:s==="add"?"\u65B0\u589E\u7528\u6237":"\u7F16\u8F91\u7528\u6237",formRef:e,grid:!0,colProps:{span:12},modalProps:{okText:"\u63D0\u4EA4",onCancel:o,confirmLoading:J},width:600,open:u,onFinish:()=>Q(),children:[a(g,{name:"nickName",label:"\u7528\u6237\u6635\u79F0",rules:[{required:!0}]}),a(Ee,{name:"deptId",label:"\u5F52\u5C5E\u90E8\u95E8",fieldProps:{treeData:k!=null?k:[],fieldNames:{value:"id"}}}),a(g,{name:"phoneNumber",label:"\u624B\u673A\u53F7\u7801",rules:[{pattern:se,message:"\u624B\u673A\u53F7\u7801\u683C\u5F0F\u9519\u8BEF"}],fieldProps:{maxLength:11}}),a(g,{name:"email",label:"\u90AE\u7BB1",rules:[{pattern:oe,message:"\u90AE\u7BB1\u683C\u5F0F\u9519\u8BEF"}]}),s==="add"&&a(g,{name:"userName",label:"\u7528\u6237\u540D\u79F0",rules:[{required:!0}]}),s==="add"&&a(g.Password,{name:"password",label:"\u7528\u6237\u5BC6\u7801",rules:[{required:!0}],initialValue:b}),a(E,{name:"sex",label:"\u7528\u6237\u6027\u522B",valueEnum:(v=i==null?void 0:i.mapData)!=null?v:{}}),a(E,{name:"status",label:"\u72B6\u6001",valueEnum:(N=m==null?void 0:m.mapData)!=null?N:{},rules:[{required:!0}]}),a(E,{name:"postIds",label:"\u5C97\u4F4D",valueEnum:(O=F==null?void 0:F.posts)!=null?O:{},mode:"multiple",colProps:{span:24}}),a(E,{name:"roleIds",label:"\u89D2\u8272",valueEnum:(U=F==null?void 0:F.roles)!=null?U:{},mode:"multiple",colProps:{span:24}}),a(we,{name:"remark",label:"\u5907\u6CE8",colProps:{span:24}})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ze=()=>{const e=xe(),t=f.exports.useRef(),{open:u,record:s}=De();return f.exports.useEffect(()=>{var r;if(u){(r=t.current)==null||r.resetFields();const c=setTimeout(()=>{var o;(o=t.current)==null||o.setFieldsValue({userName:s.userName}),clearTimeout(c)},0)}},[u]),d(V,{title:"\u91CD\u7F6E\u5BC6\u7801",open:u,formRef:t,modalProps:{onCancel:e},width:500,onFinish:async({password:r})=>{await He({...s,password:r}),I.success("\u91CD\u7F6E\u5BC6\u7801\u6210\u529F")},children:[a(g,{name:"userName",label:"\u7528\u6237\u540D\u79F0",readonly:!0}),a(g.Password,{required:!0,name:"password",label:"\u65B0\u5BC6\u7801",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u65B0\u5BC6\u7801"},{pattern:ue,message:"\u5BC6\u7801\u957F\u5EA6\u5E94\u57286-20\u4E4B\u95F4\uFF0C\u53EA\u80FD\u5305\u542B\u5B57\u6BCD\u3001\u6570\u5B57\u548C\u4E0B\u5212\u7EBF"}]}),a(g.Password,{required:!0,name:"confirmPassword",label:"\u786E\u8BA4\u5BC6\u7801",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u786E\u8BA4\u5BC6\u7801"},({getFieldsValue:r})=>({validator(c,o){return!o||r().password===o?Promise.resolve():Promise.reject(new Error("\u4E24\u6B21\u8F93\u5165\u7684\u5BC6\u7801\u4E0D\u4E00\u81F4"))}})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Je=()=>{const{canAddSysUser:e}=T(),t=ve();return a(A,{accessible:e,children:a(C,{type:"primary",icon:a(re,{}),onClick:t,children:"\u65B0\u589E"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Qe=({userId:e})=>{const{canEditSysUser:t}=T(),u=Ne();return a(A,{accessible:t,children:a(C,{type:"link",icon:a(ce,{}),onClick:()=>u(e),children:"\u7F16\u8F91"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const $e=({searchParams:e})=>{const{canExportSysUser:t}=T(),{isLoading:u,mutate:s}=R(()=>We(e),{onSuccess:()=>{I.success("\u5BFC\u51FA\u6210\u529F")}});return a(A,{accessible:t,children:a(C,{icon:a(ne,{}),loading:u,onClick:()=>s(),children:"\u5BFC\u51FA"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ze=()=>{const{canImportSysUser:e}=T(),t=f.exports.useRef(),[u,{toggle:s}]=Be(),{mutate:r,isLoading:c}=R(Ye);return d(A,{accessible:e,children:[a(C,{icon:a(ie,{}),onClick:s,children:"\u5BFC\u5165"}),d(W,{title:"\u5BFC\u5165\u7528\u6237",open:u,onCancel:s,children:[a("div",{className:"text-right",children:a(C,{type:"link",onClick:r,loading:c,children:"\u4E0B\u8F7D\u6A21\u677F"})}),d(le,{layout:"horizontal",submitter:!1,formRef:t,children:[a(Ie,{name:"isCover",label:"\u662F\u5426\u66F4\u65B0\u5DF2\u7ECF\u5B58\u5728\u7684\u7528\u6237\u6570\u636E"}),a(de,{name:"list"})]})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const K=({userId:e,userName:t,isBatch:u,disabled:s})=>{const r=u?"\u6279\u91CF\u5220\u9664":"\u5220\u9664",{canRemoveSysUser:c}=T(),o=H(),{mutateAsync:m,isLoading:i}=R(b=>Ge({userIds:b}),{onSuccess:()=>{var b;o==null||o.reload(),(b=o==null?void 0:o.clearSelected)==null||b.call(o),I.success("\u5220\u9664\u6210\u529F")}});return a(A,{accessible:c,children:a(C,{type:"link",danger:!0,disabled:s,icon:a(he,{}),onClick:()=>{W.confirm({title:"\u5220\u9664\u7528\u6237",content:d(Y,{children:["\u786E\u5B9A\u5220\u9664\u7528\u6237",a(me.Text,{code:!0,children:t}),"\u5417\uFF1F"]}),onOk:()=>m(e),okButtonProps:{loading:i}})},children:r})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const et=({record:e})=>{const{canResetSysUserPwd:t}=T(),u=Me();return a(A,{accessible:t,children:a(C,{type:"link",danger:!0,icon:a(pe,{}),onClick:()=>u(e),children:"\u91CD\u7F6E\u5BC6\u7801"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const tt=()=>{const[e,t]=f.exports.useState(""),u=ke(),{data:s,loading:r}=P(()=>G({deptName:e}),{refreshDeps:[e],debounceWait:500});return d(ge,{spinning:r,children:[a(Fe.Search,{allowClear:!0,placeholder:"\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0",className:"mb-3",onSearch:c=>{t(c)}}),!s||s.length===0?a(ye,{}):a(Ce,{treeData:s,defaultExpandAll:!0,fieldNames:{title:"label",key:"id"},onSelect:(c,{node:{key:o}})=>{u(o)},blockNode:!0})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const at=({selectedRows:e})=>a(K,{disabled:e.length===0,isBatch:!0,userId:e.map(t=>t.userId).join(","),userName:e.map(t=>t.userName).join(",")}),st=(e,t)=>d("div",{className:"flex gap-4",children:[a("div",{className:"bg-white p-4",children:a(tt,{})}),a("div",{className:"overflow-auto w-full",children:t})]}),ot=()=>{var o;const e=Re(),[t,u]=f.exports.useState({}),s=je(),r=s>0?{deptId:s}:{},{data:c}=M("sys_normal_disable");return a(be,{rowKey:"userId",actionRef:e,columns:[{dataIndex:"userId",key:"userId",title:"\u7528\u6237\u7F16\u53F7",valueType:"text",editable:!1,hideInSearch:!0},{dataIndex:"userName",key:"userName",title:"\u7528\u6237\u540D\u79F0",valueType:"text"},{dataIndex:"nickName",key:"nickName",title:"\u7528\u6237\u6635\u79F0",valueType:"text",hideInSearch:!0},{dataIndex:["dept","deptName"],key:"deptDeptName",title:"\u90E8\u95E8\u540D\u79F0",valueType:"text",hideInSearch:!0},{dataIndex:"phoneNumber",key:"phoneNumber",title:"\u624B\u673A\u53F7\u7801",valueType:"text",copyable:!0},{title:"\u72B6\u6001",dataIndex:"status",key:"status",valueType:"select",valueEnum:(o=c==null?void 0:c.mapData)!=null?o:{},formItemProps:{initialValue:c==null?void 0:c.defaultValue,required:!0,rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u72B6\u6001"}]}},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createTime",key:"createTime",valueType:"dateTime",editable:!1,hideInSearch:!0,sorter:!0},{title:"\u64CD\u4F5C",valueType:"option",render:(m,i)=>d(Y,{children:[a(Qe,{userId:i.userId}),a(K,{userId:i.userId,userName:i.userName}),a(et,{record:i})]}),fixed:"right",width:300},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createTimeRange",key:"createTimeRange",valueType:"dateTimeRange",hideInTable:!0}],params:r,request:async(...m)=>{const i=fe(...m);return u(i),await _e(i)},toolbar:{actions:[a($e,{searchParams:t},"ButtonExport"),a(Ze,{},"ButtonImport"),a(Je,{},"ButtonAdd")]},tableRender:st,tableAlertOptionRender:at})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const bt=()=>d(Ae,{children:[a(ot,{}),a(Ke,{}),a(ze,{})]});export{bt as default};
