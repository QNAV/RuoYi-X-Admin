import{j as t,k as Y,l as z,d as y,m as G,n as U,h as f,o as _,p as H,i as A}from"./antdProComponents-1965180d.js";import{h as Z,F as $,Q as w,R as C,T as F,U as R,V as S,A as k,L as J,W as ee,l as te,X as se,Y as ae,Z as oe,_ as E,$ as re,B as ne}from"./index-2c084e82.js";import{r as j,be as N,ay as ce,A as le,F as ie,a7 as L,aB as T,B as de,b6 as ue,b7 as pe,aU as he,bn as v,a6 as me}from"./antd-6bc2bb7d.js";import{a as xe,u as ge}from"./utils-e1e68311.js";import{u as ye}from"./index-28715962.js";import{u as B}from"./useMutation-f0283657.js";import{u as je}from"./useRequest-cc46c8cb.js";import"./iconPark-3c306205.js";import"./wangEditor-f607bedb.js";import"./tslib.es6-3c43c0a4.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const M="systemDept",D=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/dept/model/index.ts/atomDeptDetails",xe({open:!1,deptId:0,deptName:""}));D.debugLabel="atomDeptDetails";const O=()=>Z(D),De=()=>{const e=$(D);return(s,r)=>{e({open:!0,deptId:s,deptName:r})}},be=()=>ge(D),q=[M,"list"],fe=(e,s)=>{const r=w(q,async()=>{const o=await C(e);return{treeData:F(o,{id:"deptId",pId:"parentId",rootPId:null}),map:o.reduce((a,n)=>a.set(n.deptId,n),new Map),allParentIds:Array.from(o.reduce((a,n)=>a.add(n.parentId),new Set))}},{onSuccess:o=>{s.onSuccess(o.allParentIds)}});return j.useEffect(()=>{r.refetch()},[e]),r},Q=()=>{const e=R();return()=>e.invalidateQueries(q)},V=[M,"options"],K=()=>w(V,async()=>{const e=await C({});return F(e,{id:"deptId",pId:"parentId",rootPId:null})}),W=()=>{const e=R();return()=>e.invalidateQueries(V)};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const Ae=()=>{const{message:e}=N.useApp(),s=j.useRef(),[r,{toggle:o}]=ye(),{data:d,refetch:a}=K(),{defaultValueSysNormalDisable:n,valueEnumSysNormalDisable:c}=S(),{mutate:u,isLoading:p}=B(async()=>{var h;const l=await((h=s.current)==null?void 0:h.validateFields());await ee(l)},{onSuccess:async()=>{var l;o(),(l=s.current)==null||l.resetFields(),a(),e.success("新增成功")}});return t.jsxs(k,{accessKey:"system:dept:add",children:[t.jsx(J,{onClick:o}),t.jsx(ce,{title:"新增部门",okText:"提交",open:r,onCancel:o,onOk:()=>u(),okButtonProps:{loading:p},children:t.jsxs(Y,{submitter:!1,formRef:s,grid:!0,rowProps:{gutter:[16,0]},children:[t.jsx(z,{name:"parentId",label:"上级部门",rules:[{required:!0,message:"请选择上级部门"}],fieldProps:{treeData:d??[],fieldNames:{label:"deptName",value:"deptId"}}}),t.jsx(y,{name:"deptName",label:"部门名称",rules:[{required:!0}],colProps:{span:12}}),t.jsx(G,{name:"orderNum",label:"显示排序",initialValue:0,rules:[{required:!0}],colProps:{span:12}}),t.jsx(y,{name:"leader",label:"负责人",colProps:{span:12}}),t.jsx(y,{name:"phone",label:"联系电话",colProps:{span:12}}),t.jsx(y,{name:"email",label:"邮箱",colProps:{span:12}}),t.jsx(U.Group,{name:"status",label:"状态",valueEnum:c,initialValue:n,colProps:{span:12}})]})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const Ie=()=>{const{deptId:e,deptName:s,open:r}=O(),o=be(),d=Q(),a=W(),{message:n,modal:c}=N.useApp(),u=()=>{c.confirm({title:"删除确认",content:t.jsxs(t.Fragment,{children:["确定删除部门",t.jsx(le.Text,{code:!0,children:s}),"吗？"]}),onOk:async()=>{await se({deptId:e}),await Promise.all([o(),d(),a()]),n.success("删除成功")}})};return t.jsx(k,{accessKey:"system:dept:remove",children:t.jsx(te,{disabled:!r,type:"primary",size:"middle",onClick:u})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const I={xs:1,sm:1,md:1,lg:1,xl:2},Se=()=>{const e=Q(),s=W(),{message:r}=N.useApp(),{deptId:o,open:d}=O(),{data:a}=K(),{valueEnumSysNormalDisable:n}=S(),{data:c,loading:u,refresh:p}=je(async()=>{const{ancestors:i,...x}=await ae({deptId:o}),g=(i==null?void 0:i.split(","))??[];return{...x,ancestors:Number(g[g.length-1])}},{ready:d&&o>0,refreshDeps:[o],onSuccess:()=>{P([])}}),{mutateAsync:l}=B(re,{onSuccess:async()=>{p(),await Promise.all([e(),s()]),r.success("保存成功")}}),h=oe(),[m]=ie.useForm(),[X,P]=j.useState([]),b=h("system:dept:edit")?{form:m,editableKeys:X,onChange:(i,x)=>{if(P(i),i.length>0){const[g]=i;m.setFieldsValue({[g]:x[g]})}},onSave:async(i,x)=>{await l({deptId:o,deptName:c.deptName,orderNum:c.orderNum,parentId:c.parentId,[i]:x[i]})}}:void 0;return d?t.jsxs(L,{spinning:u,children:[t.jsx(f,{column:I,editable:b,dataSource:c,columns:[{title:"状态",dataIndex:"status",key:"status",valueType:"select",valueEnum:n},{title:"排序",dataIndex:"orderNum",key:"orderNum",valueType:"digit"},{title:"创建时间",dataIndex:"createTime",key:"createTime",valueType:"dateTime",editable:!1}]}),t.jsx(T,{}),t.jsx(f,{column:I,editable:b,dataSource:c,columns:[{title:"部门名称",dataIndex:"deptName",key:"deptName",valueType:"text"},{title:"上级部门",dataIndex:"parentId",key:"parentId",valueType:"treeSelect",fieldProps:{treeData:a,dropdownMatchSelectWidth:250,fieldNames:{label:"deptName",value:"deptId"}}}]}),t.jsx(T,{}),t.jsx(f,{column:I,editable:b,dataSource:c,columns:[{title:"负责人",dataIndex:"leader",key:"leader",valueType:"text"},{title:"联系电话",dataIndex:"phone",key:"phone",valueType:"text"},{title:"邮箱",dataIndex:"email",key:"email",valueType:"text"}]})]}):t.jsx(E,{description:"点击选择左侧部门项查看详情"})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const Ne=e=>t.jsxs(t.Fragment,{children:[t.jsx(v,{color:"rgb(148 163 184)",children:e.orderNum}),t.jsxs(me,{children:[e.deptName,t.jsx(v,{color:e.status==="NORMAL"?"success":"error",children:e.status==="NORMAL"?"启用中":"已禁用"})]})]}),Pe=()=>{var p;const[e,s]=j.useState([]),[r,o]=j.useState({}),{valueEnumSysNormalDisable:d}=S(),{data:a,isFetching:n}=fe(r,{onSuccess:l=>{s(l)}}),c=De(),u=(e==null?void 0:e.length)!==0&&(e==null?void 0:e.length)===((p=a==null?void 0:a.allParentIds)==null?void 0:p.length);return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx(de,{size:"small",className:"my-2",icon:u?t.jsx(ue,{}):t.jsx(pe,{}),onClick:()=>s(u?[]:a==null?void 0:a.allParentIds),children:u?"全部折叠":"全部展开"}),t.jsxs(_,{onFinish:async l=>o(l),children:[t.jsx(y,{name:"deptName",label:"部门名称"}),t.jsx(H,{name:"status",label:"状态",valueEnum:d})]})]}),t.jsx(L,{spinning:n,children:a!=null&&a.treeData.length?t.jsx(he,{blockNode:!0,showLine:{showLeafIcon:!1},titleRender:Ne,treeData:a.treeData,expandedKeys:e,onExpand:s,height:700,fieldNames:{title:"deptName",key:"deptId"},onSelect:(l,{selected:h,node:{key:m}})=>{h&&c(m,a.map.get(m).deptName)}}):t.jsx(E,{})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,s){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,s),s)}};const Me=()=>t.jsx(ne,{children:t.jsxs(A,{ghost:!0,gutter:[16,16],wrap:!0,children:[t.jsx(A,{title:"部门列表",colSpan:{xxl:8,xl:12,lg:14,md:24,sm:24,xs:24},extra:t.jsx(Ae,{}),children:t.jsx(Pe,{})}),t.jsx(A,{title:"部门详情",colSpan:{xxl:16,xl:12,lg:10,md:24,sm:24,xs:24},className:"h-full",extra:t.jsx(Ie,{}),children:t.jsx(Se,{})})]})});export{Me as default};
