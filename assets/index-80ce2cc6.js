import{j as s,A as I,T as X,bq as Y,y as q,p as i,e as G,L as W,br as _,a as p,F as $,a1 as v,bs as Q,a5 as z,aT as Z,N as J,bt as j,K as ee,q as N,v as y,t as te,R as w,bu as se,W as k,bv as ae,bw as oe,bx as re,Z as ne,w as ce,by as le,x as E,bz as ie,bA as de,bB as ue,aa as me,o as he,z as pe,m as ge,bC as be,n as Ie,B as Te}from"./index-b5eebe28.js";import{bg as T,B as F,bw as Ce,r as g,aH as fe,br as ye,al as we,bn as Ae,ai as xe,af as Pe,a$ as Se}from"./antd-f7a9cbdb.js";import{u as f}from"./useMutation-cb32f323.js";import{u as P}from"./useRequest-238e95e7.js";import{a as B,u as D}from"./utils-2835fcdf.js";import{u as Re}from"./index-942a5fdd.js";import"./@icon-park/react-8ab893b5.js";import"./@wangeditor/editor-2b25ac2d.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Me=({userId:e})=>{const t=at();return s(I,{accessKey:"system:user:edit",children:s(X,{onClick:()=>t(e)})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const U=({userIds:e,batch:t,disabled:a})=>{const{message:r,modal:n}=T.useApp(),o=R(),{mutate:d,isLoading:l}=f(Y,{onSuccess:()=>{var m;o==null||o.reload(),(m=o==null?void 0:o.clearSelected)==null||m.call(o),r.success("删除成功")}});return s(I,{accessKey:"system:user:remove",children:s(q,{batch:t,disabled:a,onClick:()=>{n.confirm({title:"删除用户",content:`确定删除用户编号为 ${e.join(",")} 的数据吗？`,onOk:()=>d({userIds:e}),okButtonProps:{loading:l}})}})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ve=({record:e})=>{const t=Je();return s(I,{accessKey:"system:user:resetPwd",children:s(F,{type:"link",danger:!0,icon:s(Ce,{}),onClick:()=>t(e),children:"重置密码"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const[je]=i({title:"用户编号",dataIndex:"userId",table:{valueType:"text",hideInSearch:!0}}),[Ne,,L]=i({title:"用户名称",dataIndex:"userName",table:{valueType:"text"},form:{valueType:"text",formItemProps:{rules:[{required:!0}]}}}),[ke,,Ee]=i({title:"用户昵称",dataIndex:"nickName",table:{valueType:"text",hideInSearch:!0},form:{valueType:"text"}}),[Fe]=i({title:"部门名称",dataIndex:["dept","deptName"],table:{valueType:"text",hideInSearch:!0}}),[Be,,De]=i({title:"手机号码",dataIndex:"phoneNumber",table:{valueType:"text",copyable:!0},form:{valueType:"text",formItemProps:{rules:[{pattern:G,message:"手机号码格式不正确"}]},fieldProps:{maxLength:11}}}),Ue="NORMAL",O=()=>{const{valueEnumSysNormalDisable:e}=z();return i({title:"状态",dataIndex:"status",valueEnum:e,table:{valueType:"select"},form:{initialValue:Ue,valueType:"radio"}})},[Le]=i({title:"创建时间",dataIndex:"createTime",table:{valueType:"dateTime",hideInSearch:!0,sorter:!0}}),[Oe]=i({title:"创建时间",dataIndex:"createTimeRange",table:{valueType:"dateTimeRange",hideInTable:!0}}),V=(e=!1)=>{const{data:t}=v(["sysConfigGetConfigKeySkipErrorHandler","sys.user.initPassword"],async()=>{const{data:a}=await Z({configKey:"sys.user.initPassword"});return a.msg});return i({title:"用户密码",dataIndex:"password",form:{valueType:"password",initialValue:e?t:void 0,formItemProps:{rules:[{required:!0},{pattern:J,message:"密码长度应在6-20之间，只能包含字母、数字和下划线"}]}}})},Ve=()=>{const{data:e=[]}=P(()=>j({}));return i({title:"归属部门",dataIndex:"deptId",form:{valueType:"treeSelect",fieldProps:{treeData:e,fieldNames:{value:"id"}}}})},[,,Ke]=i({title:"邮箱",dataIndex:"email",form:{valueType:"text",formItemProps:{rules:[{pattern:W,message:"邮箱格式错误"}]}}}),He="UNKNOWN",Xe=()=>{const{valueEnumSysUserSex:e}=ee();return i({title:"用户性别",dataIndex:"sex",valueEnum:e,form:{valueType:"radio",initialValue:He}})},Ye=e=>i({title:"岗位",dataIndex:"postIds",valueEnum:e,form:{valueType:"select",fieldProps:{mode:"multiple"},colProps:{span:24}}}),qe=e=>i({title:"角色",dataIndex:"roleIds",valueEnum:e,form:{valueType:"select",fieldProps:{mode:"multiple"},colProps:{span:24}}}),[,,Ge]=i({title:"备注",dataIndex:"remark",form:{valueType:"textarea",colProps:{span:24}}}),We=()=>{const[,,e]=V();return[_(L,{readonly:!0}),e]},_e=()=>{const[e]=O();return[je,Ne,ke,Fe,Be,e,Le,Oe,{title:"操作",valueType:"option",render:(t,a)=>a.userId===1?null:p($,{children:[s(Me,{userId:a.userId}),s(U,{userIds:[a.userId]}),s(ve,{record:a})]}),fixed:"right",width:260}]},$e=e=>{const{data:t}=v(["sysUserGetInfo"],async()=>{const{posts:u,roles:m}=await Q();return{posts:u.reduce((b,c)=>b.set(c.postId,c.postName),new Map),roles:m.reduce((b,c)=>b.set(c.roleId,c.roleName),new Map)}}),[,,a]=Ve(),[,,r]=V(!0),[,,n]=Xe(),[,,o]=O(),[,,d]=Ye((t==null?void 0:t.posts)??{}),[,,l]=qe((t==null?void 0:t.roles)??{});return[Ee,a,De,Ke,...e==="add"?[L,r]:[],n,o,d,l,Ge]};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const S=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomMainTableActions",N(void 0));S.debugLabel="atomMainTableActions";const R=()=>y(S),Qe=()=>te(S),M=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomSelectedDeptId",N(0));M.debugLabel="atomSelectedDeptId";const ze=()=>y(M),Ze=()=>w(M),A=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomResetPwdModal",B({open:!1}));A.debugLabel="atomResetPwdModal";const Je=()=>{const e=w(A);return t=>{e({open:!0,record:t})}},et=()=>D(A),tt=()=>y(A),C=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomAddOrEditModal",B({open:!1,actionType:"add"}));C.debugLabel="atomAddOrEditModal";const st=()=>{const e=w(C);return()=>{e({open:!0,actionType:"add"})}},at=()=>{const e=w(C);return t=>{e({open:!0,actionType:"edit",userId:t})}},ot=()=>D(C),rt=()=>y(C);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const nt=()=>{const{message:e}=T.useApp(),t=g.useRef(),a=R(),{open:r,actionType:n,userId:o}=rt(),d=ot(),l=()=>{var c;n==="edit"&&((c=t.current)==null||c.resetFields()),d()},[,u]=g.useTransition();P(async()=>{const{postIds:c,roleIds:h,user:x}=await se({userId:o});return{...x,postIds:c,roleIds:h}},{ready:r&&n==="edit"&&!!o,onSuccess:c=>{u(()=>{var h;(h=t.current)==null||h.setFieldsValue(c)})},refreshDeps:[r]});const m=async c=>{var h;if(n==="add"){const{roleIds:x=[],postIds:K=[],...H}=c;await ae({roleIds:x,postIds:K,...H})}else await oe({userId:o,...c});a==null||a.reload(),(h=t.current)==null||h.resetFields(),d(),e.success(n==="add"?"新增成功":"编辑成功")},b=$e(n);return s(k,{layoutType:"ModalForm",title:n==="add"?"新增用户":"编辑用户",formRef:t,grid:!0,colProps:{span:12},modalProps:{okText:"提交",onCancel:l},width:600,open:r,onFinish:m,columns:b})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ct=()=>{const{message:e}=T.useApp(),t=g.useRef(),a=We(),r=et(),{open:n,record:o}=tt(),[,d]=g.useTransition(),l=R(),u=async({password:m})=>{await re({...o,password:m}),l==null||l.reload(),r(),e.success("重置密码成功")};return g.useEffect(()=>{n&&o&&d(()=>{var m;(m=t.current)==null||m.setFieldsValue({userName:o.userName,password:""})})},[n]),s(k,{title:"重置密码",layoutType:"ModalForm",columns:a,width:500,formRef:t,open:n,modalProps:{okText:"提交",onCancel:r},onFinish:u})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const lt=()=>{const e=st();return s(I,{accessKey:"system:user:add",children:s(ne,{onClick:e})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const it=async e=>{const{data:t}=await le(e,{format:"blob"});await E(t,`user_${new Date().getTime()}.xlsx`)},dt=({searchParams:e})=>{const{message:t}=T.useApp(),{isLoading:a,mutate:r}=f(it,{onSuccess:()=>{t.success("导出成功")}});return s(I,{accessKey:"system:user:export",children:s(ce,{loading:a,onClick:()=>r(e)})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const{Dragger:ut}=Ae,mt=async()=>{const{data:e}=await de({format:"blob"});await E(e,`user_template_${new Date().getTime()}.xlsx`)},ht=async({updateSupport:e,file:t})=>{const{data:{code:a,msg:r}}=await ue({updateSupport:e},{file:t});return a!==200?Promise.reject(new Error(r)):r},pt=()=>{const[e,{toggle:t}]=Re(),[a,r]=g.useState(!1),[n,o]=g.useState([]),{message:d,modal:l}=T.useApp(),{mutate:u,isLoading:m}=f(ht,{onSuccess:h=>{t(),l.info({title:"导入结果",content:h})},onError:()=>{d.error("导入失败")}}),{mutate:b,isLoading:c}=f(mt);return p(I,{accessKey:"system:user:import",children:[s(ie,{onClick:t}),p(fe,{title:"导入用户",open:e,onCancel:t,onOk:()=>u({updateSupport:a,file:n[0].originFileObj}),okButtonProps:{loading:m},children:[p(ut,{accept:".xlsx, .xls",maxCount:1,beforeUpload:()=>!1,onChange:h=>o(h.fileList),fileList:n,onRemove:()=>o([]),children:[s("p",{className:"ant-upload-drag-icon",children:s(ye,{})}),s("p",{className:"ant-upload-text",children:"点击或拖拽文件到此区域上传"})]}),p("div",{className:"flex flex-col items-center pt-2",children:[s(we,{checked:a,onChange:h=>{r(h.target.checked)},children:"是否更新已经存在的用户数据"}),p("div",{children:[s("span",{children:"仅允许导入xls、xlsx格式文件"}),s(F,{type:"link",onClick:()=>b(),loading:c,children:"下载模板"})]})]})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const gt=()=>{const[e,t]=g.useState(""),a=Ze(),{data:r,loading:n}=P(()=>j({deptName:e}),{refreshDeps:[e]});return p(xe,{spinning:n,children:[s(Pe.Search,{allowClear:!0,placeholder:"请输入部门名称",className:"mb-3",onSearch:o=>t(o)}),!r||r.length===0?s(me,{}):s(Se,{treeData:r,defaultExpandAll:!0,fieldNames:{title:"label",key:"id"},onSelect:(o,{node:{key:d}})=>{a(d)},blockNode:!0})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const bt=({selectedRowKeys:e})=>s(U,{disabled:e.length===0,batch:!0,userIds:e}),It=(e,t)=>p("div",{className:"flex gap-4",children:[s(Ie,{className:"w-80",children:s(gt,{})}),s("div",{className:"overflow-auto w-full",children:t})]}),Tt=()=>{const e=Qe(),[t,a]=g.useState({}),r=_e(),n=ze(),o=n>0?{deptId:n}:{};return s(he,{rowKey:"userId",actionRef:e,columns:r,params:o,request:async(...d)=>{const{createTimeRange:l,...u}=pe(...d);return ge(l)&&(u.beginCreateTime=l[0],u.endCreateTime=l[1]),a(u),await be(u)},toolbar:{actions:[s(dt,{searchParams:t},"ButtonExport"),s(pt,{},"ButtonImport"),s(lt,{},"ButtonAdd")]},tableRender:It,tableAlertOptionRender:bt})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Rt=()=>p(Te,{children:[s(Tt,{}),s(nt,{}),s(ct,{})]});export{Rt as default};
