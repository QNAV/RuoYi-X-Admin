import{aP as te,W as se,j as s,aQ as ae,_ as L,ai as T,aj as b,aM as oe,w as d,q as S,ak as re,al as V,e as l,F as W,am as ue,bN as ce,an as A,s as X,v as j,g as M,r as y,aH as Y,a2 as p,a4 as ne,aD as ie,b4 as E,aF as le,aL as de,ap as he,bO as me,$ as pe,bP as ge,b0 as Ce,bQ as be,a$ as Fe,b5 as ye,aq as Te,ar as Ae,bR as fe,O as Pe}from"./index.4a69b3a4.js";import{e as f,j as q}from"./index.f06c68b6.js";import{b as we}from"./index.a27565ea.js";import{a as _,u as G}from"./utils.e7921364.js";import{B as Be,T as Ee,a as Se}from"./index.a0580862.js";import{u as R}from"./useMutation.esm.915086cd.js";import{f as je}from"./SysConfigService.ecdf31b9.js";import{f as H}from"./SysDeptService.c520dd42.js";import{P as Me}from"./index.2b4730a3.js";import{W as Re}from"./index.8d7d4127.js";import{u as w}from"./useRequest.1aaf15ba.js";import{u as De}from"./index.a60d6f13.js";import"./useQuery.esm.83ceadeb.js";var Ie=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],ke=te.forwardRef(function(e,t){var o=e.fieldProps,a=e.unCheckedChildren,u=e.checkedChildren,c=e.proFieldProps,r=se(e,Ie);return s(ae,L({valueType:"switch",fieldProps:L({unCheckedChildren:a,checkedChildren:u},o),ref:t,valuePropName:"checked",proFieldProps:c,filedConfig:{valuePropName:"checked",ignoreWidth:!0}},r))});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const xe=({userId:e})=>{const{canEditSysUser:t}=f(),o=rt();return s(T,{accessible:t,children:s(b,{type:"link",icon:s(oe,{}),onClick:()=>o(e),children:"\u7F16\u8F91"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};async function Ne(e,t){return d("/system/user/",{method:"GET",params:{...e},...t||{}})}async function ve(e,t){return d("/system/user/add",{method:"POST",headers:{"Content-Type":"application/json"},data:e,...t||{}})}async function Oe(e,t){return d("/system/user/edit",{method:"POST",headers:{"Content-Type":"application/json"},data:e,...t||{}})}async function Ue(e,t){return d("/system/user/export",{method:"POST",headers:{"Content-Type":"application/json"},data:e,...t||{}})}async function Le(e){return d("/system/user/importTemplate",{method:"POST",...e||{}})}async function qe(e,t){return d("/system/user/info",{method:"GET",params:{...e},...t||{}})}async function Ve(e,t){return d("/system/user/list",{method:"POST",headers:{"Content-Type":"application/json"},data:e,...t||{}})}async function We(e,t){return d("/system/user/remove",{method:"POST",params:{...e},...t||{}})}async function Xe(e,t){return d("/system/user/resetPwd",{method:"POST",headers:{"Content-Type":"application/json"},data:e,...t||{}})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const K=({userId:e,userName:t,isBatch:o,disabled:a})=>{const u=o?"\u6279\u91CF\u5220\u9664":"\u5220\u9664",{canRemoveSysUser:c}=f(),r=Q(),{mutateAsync:h,isLoading:P}=R(F=>We({userIds:F}),{onSuccess:()=>{var F;r==null||r.reload(),(F=r==null?void 0:r.clearSelected)==null||F.call(r),S.success("\u5220\u9664\u6210\u529F")}});return s(T,{accessible:c,children:s(b,{type:"link",danger:!0,disabled:a,icon:s(re,{}),onClick:()=>{V.confirm({title:"\u5220\u9664\u7528\u6237",content:l(W,{children:["\u786E\u5B9A\u5220\u9664\u7528\u6237",s(ue.Text,{code:!0,children:t}),"\u5417\uFF1F"]}),onOk:()=>h(e),okButtonProps:{loading:P}})},children:u})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ye=({record:e})=>{const{canResetSysUserPwd:t}=f(),o=tt();return s(T,{accessible:t,children:s(b,{type:"link",danger:!0,icon:s(ce,{}),onClick:()=>o(e),children:"\u91CD\u7F6E\u5BC6\u7801"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const[_e]=A({dataIndex:"userId",key:"userId",title:"\u7528\u6237\u7F16\u53F7",valueType:"text",editable:!1,hideInSearch:!0}),[Ge]=A({dataIndex:"userName",key:"userName",title:"\u7528\u6237\u540D\u79F0",valueType:"text"}),[He]=A({dataIndex:"nickName",key:"nickName",title:"\u7528\u6237\u6635\u79F0",valueType:"text",hideInSearch:!0}),[Ke]=A({dataIndex:["dept","deptName"],key:"deptDeptName",title:"\u90E8\u95E8\u540D\u79F0",valueType:"text",hideInSearch:!0}),[Qe]=A({dataIndex:"phoneNumber",key:"phoneNumber",title:"\u624B\u673A\u53F7\u7801",valueType:"text"},{table:{copyable:!0}}),[$e]=A({title:"\u64CD\u4F5C",valueType:"option",render:(e,t)=>l(W,{children:[s(xe,{userId:t.userId}),s(K,{userId:t.userId,userName:t.userName}),s(Ye,{record:t})]})},{table:{fixed:"right",width:300}}),ze=()=>{const[e]=Be();return[_e,Ge,He,Ke,Qe,e,Ee,$e,Se]};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const k=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomMainTableActions",X(void 0));k.debugLabel="atomMainTableActions";const Q=()=>j(k),Je=()=>we(k),x=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomSelectedDeptId",X(0));x.debugLabel="atomSelectedDeptId";const Ze=()=>j(x),et=()=>M(x),D=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomResetPwdModal",_({open:!1}));D.debugLabel="atomResetPwdModal";const tt=()=>{const e=M(D);return t=>{e({open:!0,record:t})}},st=()=>G(D),at=()=>j(D),B=globalThis.jotaiAtomCache.get("/home/runner/work/RuoYi-X-Admin/RuoYi-X-Admin/src/pages/system/user/model/index.ts/atomAddOrEditModal",_({open:!1,actionType:"add",userId:0}));B.debugLabel="atomAddOrEditModal";const ot=()=>{const e=M(B);return()=>{e({open:!0,actionType:"add",userId:0})}},rt=()=>{const e=M(B);return t=>{e({open:!0,actionType:"edit",userId:t})}},ut=()=>G(B),ct=()=>j(B);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const nt=()=>{var N,v,O,U;const e=y.exports.useRef(),t=Q(),{open:o,actionType:a,userId:u}=ct(),c=ut(),r=()=>{var n;a==="edit"&&((n=e.current)==null||n.resetFields()),c()},{data:h}=q("sys_normal_disable"),{data:P}=q("sys_user_sex"),{data:g}=w(async()=>{const{posts:n,roles:i}=await Ne({});return{posts:n.reduce((m,C)=>m.set(C.postId,C.postName),new Map),roles:i.reduce((m,C)=>m.set(C.roleId,C.roleName),new Map)}}),{data:F}=w(async()=>(await je({configKey:"sys.user.initPassword"},{skipErrorHandler:!0})).data.msg),{data:I}=w(()=>H({}),{}),{data:$}=w(async()=>{const{postIds:n,roleIds:i,user:m}=await qe({userId:u});return{...m,postIds:n,roleIds:i}},{ready:o&&a==="edit"&&u>0,onSuccess:n=>{var i;(i=e.current)==null||i.setFieldsValue(n)},refreshDeps:[u]}),{isLoading:z,mutateAsync:J}=R(async()=>{var i,m;const n=await((m=(i=e.current)==null?void 0:i.validateFieldsReturnFormatValue)==null?void 0:m.call(i));if(a==="add"){const{roleIds:C=[],postIds:Z=[],...ee}=n;await ve({roleIds:C,postIds:Z,...ee})}else await Oe({...$,...n,userId:u})},{onSuccess:()=>{var n;c(),t==null||t.reload(),(n=e.current)==null||n.resetFields(),S.success(a==="add"?"\u65B0\u589E\u6210\u529F":"\u7F16\u8F91\u6210\u529F")}});return l(Y,{title:a==="add"?"\u65B0\u589E\u7528\u6237":"\u7F16\u8F91\u7528\u6237",formRef:e,grid:!0,colProps:{span:12},modalProps:{okText:"\u63D0\u4EA4",onCancel:r,confirmLoading:z},width:600,open:o,onFinish:()=>J(),children:[s(p,{name:"nickName",label:"\u7528\u6237\u6635\u79F0",rules:[{required:!0}]}),s(Re,{name:"deptId",label:"\u5F52\u5C5E\u90E8\u95E8",fieldProps:{treeData:I!=null?I:[],fieldNames:{value:"id"}}}),s(p,{name:"phoneNumber",label:"\u624B\u673A\u53F7\u7801",rules:[{pattern:ne,message:"\u624B\u673A\u53F7\u7801\u683C\u5F0F\u9519\u8BEF"}],fieldProps:{maxLength:11}}),s(p,{name:"email",label:"\u90AE\u7BB1",rules:[{pattern:ie,message:"\u90AE\u7BB1\u683C\u5F0F\u9519\u8BEF"}]}),a==="add"&&s(p,{name:"userName",label:"\u7528\u6237\u540D\u79F0",rules:[{required:!0}]}),a==="add"&&s(p.Password,{name:"password",label:"\u7528\u6237\u5BC6\u7801",rules:[{required:!0}],initialValue:F}),s(E,{name:"sex",label:"\u7528\u6237\u6027\u522B",valueEnum:(N=P==null?void 0:P.mapData)!=null?N:{}}),s(E,{name:"status",label:"\u72B6\u6001",valueEnum:(v=h==null?void 0:h.mapData)!=null?v:{},rules:[{required:!0}]}),s(E,{name:"postIds",label:"\u5C97\u4F4D",valueEnum:(O=g==null?void 0:g.posts)!=null?O:{},mode:"multiple",colProps:{span:24}}),s(E,{name:"roleIds",label:"\u89D2\u8272",valueEnum:(U=g==null?void 0:g.roles)!=null?U:{},mode:"multiple",colProps:{span:24}}),s(Me,{name:"remark",label:"\u5907\u6CE8",colProps:{span:24}})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const it=()=>{const e=st(),t=y.exports.useRef(),{open:o,record:a}=at();return y.exports.useEffect(()=>{var u;if(o){(u=t.current)==null||u.resetFields();const c=setTimeout(()=>{var r;(r=t.current)==null||r.setFieldsValue({userName:a.userName}),clearTimeout(c)},0)}},[o]),l(Y,{title:"\u91CD\u7F6E\u5BC6\u7801",open:o,formRef:t,modalProps:{onCancel:e},width:500,onFinish:async({password:u})=>{await Xe({...a,password:u}),S.success("\u91CD\u7F6E\u5BC6\u7801\u6210\u529F")},children:[s(p,{name:"userName",label:"\u7528\u6237\u540D\u79F0",readonly:!0}),s(p.Password,{required:!0,name:"password",label:"\u65B0\u5BC6\u7801",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u65B0\u5BC6\u7801"},{pattern:le,message:"\u5BC6\u7801\u957F\u5EA6\u5E94\u57286-20\u4E4B\u95F4\uFF0C\u53EA\u80FD\u5305\u542B\u5B57\u6BCD\u3001\u6570\u5B57\u548C\u4E0B\u5212\u7EBF"}]}),s(p.Password,{required:!0,name:"confirmPassword",label:"\u786E\u8BA4\u5BC6\u7801",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u786E\u8BA4\u5BC6\u7801"},({getFieldsValue:u})=>({validator(c,r){return!r||u().password===r?Promise.resolve():Promise.reject(new Error("\u4E24\u6B21\u8F93\u5165\u7684\u5BC6\u7801\u4E0D\u4E00\u81F4"))}})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const lt=()=>{const{canAddSysUser:e}=f(),t=ot();return s(T,{accessible:e,children:s(b,{type:"primary",icon:s(de,{}),onClick:t,children:"\u65B0\u589E"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const dt=({searchParams:e})=>{const{canExportSysUser:t}=f(),{isLoading:o,mutate:a}=R(()=>Ue(e),{onSuccess:()=>{S.success("\u5BFC\u51FA\u6210\u529F")}});return s(T,{accessible:t,children:s(b,{icon:s(he,{}),loading:o,onClick:()=>a(),children:"\u5BFC\u51FA"})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ht=()=>{const{canImportSysUser:e}=f(),t=y.exports.useRef(),[o,{toggle:a}]=De(),{mutate:u,isLoading:c}=R(Le);return l(T,{accessible:e,children:[s(b,{icon:s(me,{}),onClick:a,children:"\u5BFC\u5165"}),l(V,{title:"\u5BFC\u5165\u7528\u6237",open:o,onCancel:a,children:[s("div",{className:"text-right",children:s(b,{type:"link",onClick:u,loading:c,children:"\u4E0B\u8F7D\u6A21\u677F"})}),l(pe,{layout:"horizontal",submitter:!1,formRef:t,children:[s(ke,{name:"isCover",label:"\u662F\u5426\u66F4\u65B0\u5DF2\u7ECF\u5B58\u5728\u7684\u7528\u6237\u6570\u636E"}),s(ge,{name:"list"})]})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const mt=()=>{const[e,t]=y.exports.useState(""),o=et(),{data:a,loading:u}=w(()=>H({deptName:e}),{refreshDeps:[e],debounceWait:500});return l(Ce,{spinning:u,children:[s(be.Search,{allowClear:!0,placeholder:"\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0",className:"mb-3",onSearch:c=>{t(c)}}),!a||a.length===0?s(Fe,{}):s(ye,{treeData:a,defaultExpandAll:!0,fieldNames:{title:"label",key:"id"},onSelect:(c,{node:{key:r}})=>{o(r)},blockNode:!0})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const pt=({selectedRows:e})=>s(fe,{selectedNum:e.length,children:s(K,{disabled:e.length===0,isBatch:!0,userId:e.map(t=>t.userId).join(","),userName:e.map(t=>t.userName).join(",")})}),gt=(e,t)=>l("div",{className:"flex gap-4",children:[s("div",{className:"bg-white p-4",children:s(mt,{})}),s("div",{className:"overflow-auto w-full",children:t})]}),Ct=()=>{const e=Je(),[t,o]=y.exports.useState({}),a=Ze(),u=a>0?{deptId:a}:{},c=ze();return s(Te,{rowKey:"userId",actionRef:e,columns:c,params:u,tableAlertRender:pt,request:async(...r)=>{const h=Ae(...r);return o(h),await Ve(h)},toolbar:{actions:[s(dt,{searchParams:t},"ButtonExport"),s(ht,{},"ButtonImport"),s(lt,{},"ButtonAdd")]},tableRender:gt})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Rt=()=>l(Pe,{children:[s(Ct,{}),s(nt,{}),s(it,{})]});export{Rt as default};
