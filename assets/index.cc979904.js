import{ao as re,l as se,j as e,a as ne,R as $,cG as H,K as ae,H as z,J as oe,a1 as le,aT as S,r as F,g as c,aE as ie,F as b,c2 as ce,cf as de,cH as me,cI as Fe,c1 as pe}from"./index.4a7583d0.js";import{B as Ee}from"./index.62272242.js";import{A as J,P as A}from"./index.c092874e.js";import{u as k,M as m,b as W,E as T,a as Ce,Y as P,c as G}from"./useMutation.esm.38207e49.js";import{c as N}from"./keepAlive.9d779ec7.js";import{S as he,a as ye,b as Be,c as De,d as fe}from"./SysMenuService.cd2d4e82.js";import{p as Ae,s as j,g as Me}from"./tree.1ad4d651.js";import{u as be}from"./useQuery.esm.7a058e2a.js";import{M as X,L as Pe,T as Se}from"./Tree.4351fdb6.js";import{B as w,b as ge,D as Ie,S as K}from"./index.4fe5dc19.js";import{P as xe,a as ve,g as ke,D as Q,X as p}from"./index.1dd6cd73.js";import{P as Te}from"./index.a5b75982.js";import{P as g}from"./index.07882f96.js";import{P as B}from"./index.cb224c53.js";import{P as Ne}from"./index.89414dd9.js";import{E as U}from"./index.83d075ef.js";import{u as we}from"./useRequest.89fb4399.js";import{P as I}from"./index.09f5e557.js";import{c as qe,P as x}from"./index.dc1867e7.js";import{M as Le}from"./RouteContext.2736af70.js";import{P as Oe}from"./index.5f55261d.js";/* empty css              */import"./utils.esm.85bc56f4.js";import"./PortalWrapper.7f9fd477.js";import"./index.d5be6b4e.js";import"./index.dbef3ab0.js";/* empty css              */import"./Skeleton.fa8c4d67.js";var Ve=["fieldProps","request","params","proFieldProps"],Re=function(u,r){var s=u.fieldProps,n=u.request,i=u.params,o=u.proFieldProps,E=se(u,Ve);return e(xe,ne({valueType:"cascader",fieldProps:s,ref:r,request:n,params:i,filedConfig:{customLightMode:!0},proFieldProps:o},E))};const _e=re.forwardRef(Re),q="systemMenu",Ge=t=>{const u=r=>r.filter(s=>s.menuType!==m.F).map(({menuId:s,menuName:n,children:i})=>({menuId:s,menuName:n,children:i?u(i):[]}));return[{menuId:0,menuName:"\u6839\u76EE\u5F55",children:t?u(t):[]}]},L=$({key:`${q}SelectedMenuId`,default:0}),Z=()=>H(L),je=()=>ae(L),O=()=>z(L),V=$({key:`${q}VisibleCreateModal`,default:!1}),Qe=()=>H(V),ee=()=>oe(V),Ye=()=>z(V),ue=[q,"list"],R=(t={})=>be(ue,async()=>{const u=await he(t),r=Ae(u,{id:"menuId",pId:"parentId",rootPId:null});return{options:Ge(j(r)),treeData:j(r),map:u.reduce((s,n)=>({...s,[n.menuId]:n}),{}),parentIds:Me(u)}}),te=()=>{const t=le(),u=Z();return k(async r=>{X.confirm({title:"\u5220\u9664\u83DC\u5355",content:"\u786E\u5B9A\u5220\u9664\u8BE5\u83DC\u5355\u5417\uFF1F",onOk:async()=>{await ye({menuId:r}),await t.invalidateQueries(ue),u(),S.success("\u5220\u9664\u6210\u529F")}})})},Y=(t,u)=>{const r=[0];if(u===0)return r;const s=n=>{var i;!(t!=null&&t[n])||((i=t==null?void 0:t[n])!=null&&i.parentId&&s(t[n].parentId.toString()),t[n].menuType!==m.F&&r.push(Number(n)))};return s(u.toString()),r},$e=()=>{var l;const t=N(),u=F.exports.useRef(),r=ee(),s=Qe(),n=Ye(),i=O(),{data:o,refetch:E}=R(),{isLoading:C,mutate:h}=k(async()=>{var d,y;const a=await((y=(d=u.current)==null?void 0:d.validateFieldsReturnFormatValue)==null?void 0:y.call(d));!a||await Be(a)},{onSuccess:()=>{var a;E(),s(),(a=u==null?void 0:u.current)==null||a.resetFields(),S.success("\u65B0\u5EFA\u6210\u529F")}});return F.exports.useEffect(()=>{var a,d;((a=u==null?void 0:u.current)==null?void 0:a.setFieldsValue)&&(o==null?void 0:o.map)&&((d=u==null?void 0:u.current)==null||d.setFieldsValue({parentId:Y(o.map,i)}))},[i,o==null?void 0:o.map,u==null?void 0:u.current]),c(J,{accessible:t.canAddSysMenu,children:[e(w,{type:"primary",onClick:()=>r(!0),icon:e(ie,{}),children:"\u65B0\u5EFA"}),e(X,{open:n,onCancel:s,title:"\u65B0\u5EFA\u83DC\u5355",width:515,okText:"\u63D0\u4EA4",onOk:()=>h(),okButtonProps:{loading:C},children:c(ve,{submitter:!1,formRef:u,children:[e(_e,{name:"parentId",label:"\u7236\u7EA7\u83DC\u5355",initialValue:Y((l=o==null?void 0:o.map)!=null?l:{},i),fieldProps:{options:o==null?void 0:o.options,fieldNames:{label:"menuName",value:"menuId",children:"children"},changeOnSelect:!0},rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u7236\u7EA7\u83DC\u5355"}],transform:a=>({parentId:a[a.length-1]})}),e(A.Group,{name:"menuType",label:"\u83DC\u5355\u7C7B\u578B",valueEnum:W,rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u83DC\u5355\u7C7B\u578B"}]}),e(ke,{name:["menuType"],children:({menuType:a})=>a?c(b,{children:[c(g,{children:[e(B,{name:"menuName",label:"\u83DC\u5355\u540D\u79F0",width:"sm",rules:[{required:!0}]}),e(Ne,{name:"orderNum",label:"\u663E\u793A\u6392\u5E8F",tooltip:"\u9ED8\u8BA4\u6570\u503C\u4E3A0\uFF0C\u6570\u503C\u8D8A\u5927\u6392\u5E8F\u8D8A\u9760\u540E\uFF0C\u6570\u503C\u76F8\u7B49\u6309\u7167\u521B\u5EFA\u65F6\u95F4\u5148\u540E\u6392\u5E8F",rules:[{required:!0}],width:"sm",initialValue:0})]}),a!==m.F&&c(b,{children:[c(g,{children:[e(A.Group,{tooltip:"\u9009\u62E9\u505C\u7528\u5219\u8DEF\u7531\u5C06\u4E0D\u4F1A\u51FA\u73B0\u5728\u4FA7\u8FB9\u680F\uFF0C\u4E5F\u4E0D\u80FD\u88AB\u8BBF\u95EE",name:"status",label:"\u83DC\u5355\u72B6\u6001",valueEnum:T,required:!0,initialValue:Ce.ENABLE}),e(A.Group,{name:"visible",label:"\u83DC\u5355\u662F\u5426\u663E\u793A",valueEnum:P,required:!0,initialValue:G.YES,tooltip:"\u9009\u62E9\u5426\u5219\u8DEF\u7531\u5C06\u4E0D\u4F1A\u51FA\u73B0\u5728\u4FA7\u8FB9\u680F\uFF0C\u4F46\u4ECD\u7136\u53EF\u4EE5\u8BBF\u95EE"}),e(A.Group,{name:"isFrame",label:"\u662F\u5426\u5916\u94FE",valueEnum:P,required:!0,initialValue:G.NO,tooltip:"\u9009\u62E9\u662F\u5916\u94FE\u5219\u8DEF\u7531\u5730\u5740\u9700\u8981\u4EE5`http(s)://`\u5F00\u5934"})]}),c(g,{children:[e(B,{name:"icon",label:"\u83DC\u5355\u56FE\u6807",width:"sm",tooltip:"https://ant.design/components/icon-cn/"}),e(B,{width:"sm",name:"path",label:"\u8DEF\u7531\u5730\u5740",tooltip:"\u8BBF\u95EE\u7684\u8DEF\u7531\u5730\u5740\uFF0C\u5982\uFF1A`user`\uFF0C\u5982\u5916\u7F51\u5730\u5740\u9700\u5185\u94FE\u8BBF\u95EE\u5219\u4EE5`http(s)://`\u5F00\u5934",rules:[{required:!0}]})]})]}),a===m.C&&e(B,{name:"queryParam",label:"\u8DEF\u7531\u53C2\u6570",tooltip:'\u8BBF\u95EE\u8DEF\u7531\u7684\u9ED8\u8BA4\u4F20\u9012\u53C2\u6570\uFF0C\u5982\uFF1A{"id": 1, "name": "ry"}'}),a!==m.M&&e(B,{name:"perms",label:"\u6743\u9650\u6807\u8BC6"})]}):null}),e(Te,{name:"remark",label:"\u5907\u6CE8"})]})})]})},He=()=>{const t=N(),u=O(),{mutate:r,isLoading:s}=te();return e(J,{accessible:t.canRemoveSysMenu,children:e(w,{icon:e(ce,{}),loading:s,disabled:u===0,danger:!0,onClick:()=>r(u),children:"\u5220\u9664"})})},v={xs:1,sm:1,md:1,lg:1,xl:2},ze=t=>F.exports.useMemo(()=>{const u=[];return t?(t!==m.F&&u.push({title:"\u72B6\u6001",dataIndex:"status",key:"status",valueType:"radio",valueEnum:T},{title:"\u662F\u5426\u663E\u793A",dataIndex:"visible",key:"visible",valueType:"radio",valueEnum:P,tooltip:"\u9009\u62E9\u5426\u5219\u8DEF\u7531\u5C06\u4E0D\u4F1A\u51FA\u73B0\u5728\u4FA7\u8FB9\u680F\uFF0C\u4F46\u4ECD\u7136\u53EF\u4EE5\u8BBF\u95EE"},{title:"\u662F\u5426\u5916\u94FE",dataIndex:"isFrame",key:"isFrame",valueType:"radio",valueEnum:P,tooltip:"\u9009\u62E9\u662F\u5916\u94FE\u5219\u8DEF\u7531\u5730\u5740\u9700\u8981\u4EE5`http(s)://`\u5F00\u5934"},{title:"\u56FE\u6807",dataIndex:"icon",key:"icon",valueType:"text",tooltip:"https://ant.design/components/icon-cn/"},{title:"\u8DEF\u7531\u5730\u5740",dataIndex:"path",key:"path",valueType:"text",tooltip:"\u8BBF\u95EE\u7684\u8DEF\u7531\u5730\u5740\uFF0C\u5982\uFF1A`user`\uFF0C\u5982\u5916\u7F51\u5730\u5740\u9700\u5185\u94FE\u8BBF\u95EE\u5219\u4EE5`http(s)://`\u5F00\u5934"},{title:"\u8DEF\u7531\u53C2\u6570",dataIndex:"queryParam",key:"queryParam",valueType:"code",tooltip:'\u8BBF\u95EE\u8DEF\u7531\u7684\u9ED8\u8BA4\u4F20\u9012\u53C2\u6570\uFF0C\u5982\uFF1A{"id": 1, "name": "ry"}'}),t!==m.M&&u.push({title:"\u6743\u9650\u6807\u8BC6",dataIndex:"perms",key:"perms",valueType:"text",copyable:!0}),u):[]},[t]),Je=()=>{const t=N(),{refetch:u}=R(),r=O(),{data:s,loading:n,refresh:i}=we(async()=>await De({menuId:r}),{ready:r>0,refreshDeps:[r]}),{mutateAsync:o}=k(fe,{onSuccess:()=>{i(),u(),S.success("\u4FDD\u5B58\u6210\u529F")}}),E=ze(s==null?void 0:s.menuType),C=t.canEditSysMenu?{onSave:async(h,l)=>{const{menuType:a,orderNum:d,menuName:y,menuId:D}=l;await o({menuId:D,menuType:a,orderNum:d,menuName:y,[h]:l[h]})}}:void 0;return r===0?e(U,{description:"\u70B9\u51FB\u9009\u62E9\u5DE6\u4FA7\u83DC\u5355\u9879\u67E5\u770B\u8BE6\u60C5"}):c(ge,{spinning:n,children:[e(I,{columns:[{title:"\u7C7B\u578B",dataIndex:"menuType",key:"menuType",valueType:"select",valueEnum:W,editable:!1},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createTime",key:"createTime",valueType:"dateTime",editable:!1}],dataSource:s,column:v}),e(Q,{}),e(I,{columns:[{title:"\u540D\u79F0",dataIndex:"menuName",key:"menuName",valueType:"text"},{title:"\u663E\u793A\u987A\u5E8F",dataIndex:"orderNum",key:"orderNum",valueType:"digit",tooltip:"\u9ED8\u8BA4\u6570\u503C\u4E3A0\uFF0C\u6570\u503C\u8D8A\u5927\u6392\u5E8F\u8D8A\u9760\u540E\uFF0C\u6570\u503C\u76F8\u7B49\u6309\u7167\u521B\u5EFA\u65F6\u95F4\u5148\u540E\u6392\u5E8F"},{title:"\u5907\u6CE8",dataIndex:"remark",key:"remark",valueType:"textarea",hideInSearch:!0}],dataSource:s,editable:C,column:v}),e(Q,{}),e(I,{columns:E,dataSource:s,editable:C,column:v})]})},M={M:"blue",C:"green",F:"red"},We=t=>c(b,{children:[e(p,{color:"rgb(148 163 184)",children:t.orderNum}),(t==null?void 0:t.icon)&&e(Fe,{name:t.icon,className:"mr-1"}),e(p,{color:M[t.menuType],style:{margin:"0 0 2px 0"},children:t.menuName}),(t==null?void 0:t.perms)&&e(p,{style:{margin:"0 0 2px 2px"},children:c(K,{size:"small",children:[t.perms,e(pe,{style:{color:"#1890ff"},onClick:u=>{qe(t.perms),S.success("\u590D\u5236\u6210\u529F"),u.stopPropagation()}})]})})]}),Xe=()=>c("div",{className:"mb-2",children:["\u6807\u7B7E\u542B\u4E49\uFF1A",e(p,{color:"rgb(148 163 184)",children:"\u663E\u793A\u987A\u5E8F"}),e(p,{color:M[m.M],children:"\u76EE\u5F55"}),e(p,{color:M[m.C],children:"\u83DC\u5355"}),e(p,{color:M[m.F],children:"\u6309\u94AE"}),e(p,{children:"\u6743\u9650\u6807\u8BC6"})]}),Ke=()=>{var _;const[t,u]=F.exports.useState({}),[r,s]=F.exports.useState([]),[n,i]=F.exports.useState([]),[o,E]=je(),C=Z(),h=ee(),{data:l,refetch:a}=R(t),{mutate:d}=te(),y=f=>{s(f)},D=(n==null?void 0:n.length)!==0&&(n==null?void 0:n.length)===((_=l==null?void 0:l.parentIds)==null?void 0:_.length);return F.exports.useEffect(()=>{a()},[t]),F.exports.useEffect(()=>{r!=null&&r[0]?E(r[0]):C()},[r]),c(b,{children:[e(Xe,{}),c("div",{className:"flex justify-between items-center",children:[e(w,{size:"small",className:"my-2",icon:D?e(de,{}):e(me,{}),onClick:()=>i(D?[]:l==null?void 0:l.parentIds),children:D?"\u5168\u90E8\u6298\u53E0":"\u5168\u90E8\u5C55\u5F00"}),c(Pe,{onFinish:async f=>{s([]),i([]),u(f)},children:[e(B,{name:"menuName",label:"\u83DC\u5355\u540D\u79F0"}),e(Oe,{name:"status",label:"\u72B6\u6001",valueEnum:T})]})]}),e(Ie,{overlay:e(Le,{items:[{label:"\u65B0\u5EFA",key:"create",onClick:()=>h(!0)},{label:"\u5728\u6839\u76EE\u5F55\u4E0B\u65B0\u5EFA",key:"create",onClick:()=>{C(),h(!0)}},{label:"\u5220\u9664",key:"delete",danger:!0,disabled:r.length===0,onClick:()=>d(o)}]}),trigger:["contextMenu"],children:e("div",{className:"max-h-[60vh] overflow-auto",children:l!=null&&l.treeData.length?e(Se,{blockNode:!0,selectedKeys:r,onSelect:y,expandedKeys:n,titleRender:We,onExpand:i,showLine:{showLeafIcon:!1},fieldNames:{title:"menuName",key:"menuId",children:"children"},treeData:l==null?void 0:l.treeData,onRightClick:f=>s([f.node.key])}):e(U,{})})})]})},Su=()=>e(Ee,{children:c(x,{ghost:!0,gutter:24,children:[e(x,{title:"\u83DC\u5355\u5217\u8868",colSpan:"550px",extra:c(K,{children:[e($e,{}),e(He,{})]}),children:e(Ke,{})}),e(x,{title:"\u83DC\u5355\u8BE6\u60C5",children:e(Je,{})})]})});export{Su as default};
